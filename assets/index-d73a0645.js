function TP(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in t)){const u=Object.getOwnPropertyDescriptor(i,o);u&&Object.defineProperty(t,o,u.get?u:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();var SP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function PE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var CE={exports:{}},pm={},ME={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fd=Symbol.for("react.element"),AP=Symbol.for("react.portal"),IP=Symbol.for("react.fragment"),PP=Symbol.for("react.strict_mode"),CP=Symbol.for("react.profiler"),MP=Symbol.for("react.provider"),kP=Symbol.for("react.context"),LP=Symbol.for("react.forward_ref"),RP=Symbol.for("react.suspense"),DP=Symbol.for("react.memo"),zP=Symbol.for("react.lazy"),c1=Symbol.iterator;function OP(t){return t===null||typeof t!="object"?null:(t=c1&&t[c1]||t["@@iterator"],typeof t=="function"?t:null)}var kE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},LE=Object.assign,RE={};function du(t,e,n){this.props=t,this.context=e,this.refs=RE,this.updater=n||kE}du.prototype.isReactComponent={};du.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};du.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function DE(){}DE.prototype=du.prototype;function m0(t,e,n){this.props=t,this.context=e,this.refs=RE,this.updater=n||kE}var g0=m0.prototype=new DE;g0.constructor=m0;LE(g0,du.prototype);g0.isPureReactComponent=!0;var u1=Array.isArray,zE=Object.prototype.hasOwnProperty,_0={current:null},OE={key:!0,ref:!0,__self:!0,__source:!0};function FE(t,e,n){var i,o={},u=null,f=null;if(e!=null)for(i in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(u=""+e.key),e)zE.call(e,i)&&!OE.hasOwnProperty(i)&&(o[i]=e[i]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var b=Array(l),w=0;w<l;w++)b[w]=arguments[w+2];o.children=b}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)o[i]===void 0&&(o[i]=l[i]);return{$$typeof:fd,type:t,key:u,ref:f,props:o,_owner:_0.current}}function FP(t,e){return{$$typeof:fd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function y0(t){return typeof t=="object"&&t!==null&&t.$$typeof===fd}function BP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var h1=/\/+/g;function jg(t,e){return typeof t=="object"&&t!==null&&t.key!=null?BP(""+t.key):e.toString(36)}function ap(t,e,n,i,o){var u=typeof t;(u==="undefined"||u==="boolean")&&(t=null);var f=!1;if(t===null)f=!0;else switch(u){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case fd:case AP:f=!0}}if(f)return f=t,o=o(f),t=i===""?"."+jg(f,0):i,u1(o)?(n="",t!=null&&(n=t.replace(h1,"$&/")+"/"),ap(o,e,n,"",function(w){return w})):o!=null&&(y0(o)&&(o=FP(o,n+(!o.key||f&&f.key===o.key?"":(""+o.key).replace(h1,"$&/")+"/")+t)),e.push(o)),1;if(f=0,i=i===""?".":i+":",u1(t))for(var l=0;l<t.length;l++){u=t[l];var b=i+jg(u,l);f+=ap(u,e,n,b,o)}else if(b=OP(t),typeof b=="function")for(t=b.call(t),l=0;!(u=t.next()).done;)u=u.value,b=i+jg(u,l++),f+=ap(u,e,n,b,o);else if(u==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function Lf(t,e,n){if(t==null)return t;var i=[],o=0;return ap(t,i,"","",function(u){return e.call(n,u,o++)}),i}function NP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gr={current:null},lp={transition:null},UP={ReactCurrentDispatcher:gr,ReactCurrentBatchConfig:lp,ReactCurrentOwner:_0};Yt.Children={map:Lf,forEach:function(t,e,n){Lf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Lf(t,function(){e++}),e},toArray:function(t){return Lf(t,function(e){return e})||[]},only:function(t){if(!y0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Yt.Component=du;Yt.Fragment=IP;Yt.Profiler=CP;Yt.PureComponent=m0;Yt.StrictMode=PP;Yt.Suspense=RP;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UP;Yt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=LE({},t.props),o=t.key,u=t.ref,f=t._owner;if(e!=null){if(e.ref!==void 0&&(u=e.ref,f=_0.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(b in e)zE.call(e,b)&&!OE.hasOwnProperty(b)&&(i[b]=e[b]===void 0&&l!==void 0?l[b]:e[b])}var b=arguments.length-2;if(b===1)i.children=n;else if(1<b){l=Array(b);for(var w=0;w<b;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:fd,type:t.type,key:o,ref:u,props:i,_owner:f}};Yt.createContext=function(t){return t={$$typeof:kP,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:MP,_context:t},t.Consumer=t};Yt.createElement=FE;Yt.createFactory=function(t){var e=FE.bind(null,t);return e.type=t,e};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(t){return{$$typeof:LP,render:t}};Yt.isValidElement=y0;Yt.lazy=function(t){return{$$typeof:zP,_payload:{_status:-1,_result:t},_init:NP}};Yt.memo=function(t,e){return{$$typeof:DP,type:t,compare:e===void 0?null:e}};Yt.startTransition=function(t){var e=lp.transition;lp.transition={};try{t()}finally{lp.transition=e}};Yt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Yt.useCallback=function(t,e){return gr.current.useCallback(t,e)};Yt.useContext=function(t){return gr.current.useContext(t)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(t){return gr.current.useDeferredValue(t)};Yt.useEffect=function(t,e){return gr.current.useEffect(t,e)};Yt.useId=function(){return gr.current.useId()};Yt.useImperativeHandle=function(t,e,n){return gr.current.useImperativeHandle(t,e,n)};Yt.useInsertionEffect=function(t,e){return gr.current.useInsertionEffect(t,e)};Yt.useLayoutEffect=function(t,e){return gr.current.useLayoutEffect(t,e)};Yt.useMemo=function(t,e){return gr.current.useMemo(t,e)};Yt.useReducer=function(t,e,n){return gr.current.useReducer(t,e,n)};Yt.useRef=function(t){return gr.current.useRef(t)};Yt.useState=function(t){return gr.current.useState(t)};Yt.useSyncExternalStore=function(t,e,n){return gr.current.useSyncExternalStore(t,e,n)};Yt.useTransition=function(){return gr.current.useTransition()};Yt.version="18.2.0";ME.exports=Yt;var at=ME.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VP=at,jP=Symbol.for("react.element"),GP=Symbol.for("react.fragment"),$P=Object.prototype.hasOwnProperty,HP=VP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,WP={key:!0,ref:!0,__self:!0,__source:!0};function BE(t,e,n){var i,o={},u=null,f=null;n!==void 0&&(u=""+n),e.key!==void 0&&(u=""+e.key),e.ref!==void 0&&(f=e.ref);for(i in e)$P.call(e,i)&&!WP.hasOwnProperty(i)&&(o[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:jP,type:t,key:u,ref:f,props:o,_owner:HP.current}}pm.Fragment=GP;pm.jsx=BE;pm.jsxs=BE;CE.exports=pm;var fs=CE.exports,NE={exports:{}},es={},UE={exports:{}},VE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(tt,wt){var St=tt.length;tt.push(wt);e:for(;0<St;){var tn=St-1>>>1,nn=tt[tn];if(0<o(nn,wt))tt[tn]=wt,tt[St]=nn,St=tn;else break e}}function n(tt){return tt.length===0?null:tt[0]}function i(tt){if(tt.length===0)return null;var wt=tt[0],St=tt.pop();if(St!==wt){tt[0]=St;e:for(var tn=0,nn=tt.length,nr=nn>>>1;tn<nr;){var ni=2*(tn+1)-1,xi=tt[ni],ii=ni+1,ln=tt[ii];if(0>o(xi,St))ii<nn&&0>o(ln,xi)?(tt[tn]=ln,tt[ii]=St,tn=ii):(tt[tn]=xi,tt[ni]=St,tn=ni);else if(ii<nn&&0>o(ln,St))tt[tn]=ln,tt[ii]=St,tn=ii;else break e}}return wt}function o(tt,wt){var St=tt.sortIndex-wt.sortIndex;return St!==0?St:tt.id-wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,l=f.now();t.unstable_now=function(){return f.now()-l}}var b=[],w=[],M=1,L=null,C=3,W=!1,Q=!1,ne=!1,_e=typeof setTimeout=="function"?setTimeout:null,K=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(tt){for(var wt=n(w);wt!==null;){if(wt.callback===null)i(w);else if(wt.startTime<=tt)i(w),wt.sortIndex=wt.expirationTime,e(b,wt);else break;wt=n(w)}}function pe(tt){if(ne=!1,J(tt),!Q)if(n(b)!==null)Q=!0,xt(ye);else{var wt=n(w);wt!==null&&vi(pe,wt.startTime-tt)}}function ye(tt,wt){Q=!1,ne&&(ne=!1,K(Be),Be=-1),W=!0;var St=C;try{for(J(wt),L=n(b);L!==null&&(!(L.expirationTime>wt)||tt&&!mt());){var tn=L.callback;if(typeof tn=="function"){L.callback=null,C=L.priorityLevel;var nn=tn(L.expirationTime<=wt);wt=t.unstable_now(),typeof nn=="function"?L.callback=nn:L===n(b)&&i(b),J(wt)}else i(b);L=n(b)}if(L!==null)var nr=!0;else{var ni=n(w);ni!==null&&vi(pe,ni.startTime-wt),nr=!1}return nr}finally{L=null,C=St,W=!1}}var Ae=!1,Oe=null,Be=-1,Xe=5,je=-1;function mt(){return!(t.unstable_now()-je<Xe)}function Dt(){if(Oe!==null){var tt=t.unstable_now();je=tt;var wt=!0;try{wt=Oe(!0,tt)}finally{wt?qt():(Ae=!1,Oe=null)}}else Ae=!1}var qt;if(typeof $=="function")qt=function(){$(Dt)};else if(typeof MessageChannel<"u"){var zt=new MessageChannel,ti=zt.port2;zt.port1.onmessage=Dt,qt=function(){ti.postMessage(null)}}else qt=function(){_e(Dt,0)};function xt(tt){Oe=tt,Ae||(Ae=!0,qt())}function vi(tt,wt){Be=_e(function(){tt(t.unstable_now())},wt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(tt){tt.callback=null},t.unstable_continueExecution=function(){Q||W||(Q=!0,xt(ye))},t.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Xe=0<tt?Math.floor(1e3/tt):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_getFirstCallbackNode=function(){return n(b)},t.unstable_next=function(tt){switch(C){case 1:case 2:case 3:var wt=3;break;default:wt=C}var St=C;C=wt;try{return tt()}finally{C=St}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(tt,wt){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var St=C;C=tt;try{return wt()}finally{C=St}},t.unstable_scheduleCallback=function(tt,wt,St){var tn=t.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?tn+St:tn):St=tn,tt){case 1:var nn=-1;break;case 2:nn=250;break;case 5:nn=1073741823;break;case 4:nn=1e4;break;default:nn=5e3}return nn=St+nn,tt={id:M++,callback:wt,priorityLevel:tt,startTime:St,expirationTime:nn,sortIndex:-1},St>tn?(tt.sortIndex=St,e(w,tt),n(b)===null&&tt===n(w)&&(ne?(K(Be),Be=-1):ne=!0,vi(pe,St-tn))):(tt.sortIndex=nn,e(b,tt),Q||W||(Q=!0,xt(ye))),tt},t.unstable_shouldYield=mt,t.unstable_wrapCallback=function(tt){var wt=C;return function(){var St=C;C=wt;try{return tt.apply(this,arguments)}finally{C=St}}}})(VE);UE.exports=VE;var qP=UE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jE=at,Jr=qP;function Ve(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var GE=new Set,Gh={};function Bl(t,e){Xc(t,e),Xc(t+"Capture",e)}function Xc(t,e){for(Gh[t]=e,t=0;t<e.length;t++)GE.add(e[t])}var Uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),H_=Object.prototype.hasOwnProperty,ZP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d1={},f1={};function XP(t){return H_.call(f1,t)?!0:H_.call(d1,t)?!1:ZP.test(t)?f1[t]=!0:(d1[t]=!0,!1)}function YP(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function KP(t,e,n,i){if(e===null||typeof e>"u"||YP(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function _r(t,e,n,i,o,u,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=u,this.removeEmptyString=f}var Ui={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ui[t]=new _r(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ui[e]=new _r(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ui[t]=new _r(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ui[t]=new _r(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ui[t]=new _r(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ui[t]=new _r(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ui[t]=new _r(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ui[t]=new _r(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ui[t]=new _r(t,5,!1,t.toLowerCase(),null,!1,!1)});var v0=/[\-:]([a-z])/g;function x0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(v0,x0);Ui[e]=new _r(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(v0,x0);Ui[e]=new _r(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(v0,x0);Ui[e]=new _r(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ui[t]=new _r(t,1,!1,t.toLowerCase(),null,!1,!1)});Ui.xlinkHref=new _r("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ui[t]=new _r(t,1,!1,t.toLowerCase(),null,!0,!0)});function b0(t,e,n,i){var o=Ui.hasOwnProperty(e)?Ui[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(KP(e,n,o,i)&&(n=null),i||o===null?XP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,i=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var qo=jE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Rf=Symbol.for("react.element"),Ic=Symbol.for("react.portal"),Pc=Symbol.for("react.fragment"),w0=Symbol.for("react.strict_mode"),W_=Symbol.for("react.profiler"),$E=Symbol.for("react.provider"),HE=Symbol.for("react.context"),E0=Symbol.for("react.forward_ref"),q_=Symbol.for("react.suspense"),Z_=Symbol.for("react.suspense_list"),T0=Symbol.for("react.memo"),wa=Symbol.for("react.lazy"),WE=Symbol.for("react.offscreen"),p1=Symbol.iterator;function lh(t){return t===null||typeof t!="object"?null:(t=p1&&t[p1]||t["@@iterator"],typeof t=="function"?t:null)}var Vn=Object.assign,Gg;function Th(t){if(Gg===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gg=e&&e[1]||""}return`
`+Gg+t}var $g=!1;function Hg(t,e){if(!t||$g)return"";$g=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var o=w.stack.split(`
`),u=i.stack.split(`
`),f=o.length-1,l=u.length-1;1<=f&&0<=l&&o[f]!==u[l];)l--;for(;1<=f&&0<=l;f--,l--)if(o[f]!==u[l]){if(f!==1||l!==1)do if(f--,l--,0>l||o[f]!==u[l]){var b=`
`+o[f].replace(" at new "," at ");return t.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",t.displayName)),b}while(1<=f&&0<=l);break}}}finally{$g=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Th(t):""}function JP(t){switch(t.tag){case 5:return Th(t.type);case 16:return Th("Lazy");case 13:return Th("Suspense");case 19:return Th("SuspenseList");case 0:case 2:case 15:return t=Hg(t.type,!1),t;case 11:return t=Hg(t.type.render,!1),t;case 1:return t=Hg(t.type,!0),t;default:return""}}function X_(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Pc:return"Fragment";case Ic:return"Portal";case W_:return"Profiler";case w0:return"StrictMode";case q_:return"Suspense";case Z_:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case HE:return(t.displayName||"Context")+".Consumer";case $E:return(t._context.displayName||"Context")+".Provider";case E0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case T0:return e=t.displayName||null,e!==null?e:X_(t.type)||"Memo";case wa:e=t._payload,t=t._init;try{return X_(t(e))}catch{}}return null}function QP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return X_(e);case 8:return e===w0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ua(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function qE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eC(t){var e=qE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(f){i=""+f,u.call(this,f)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(f){i=""+f},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Df(t){t._valueTracker||(t._valueTracker=eC(t))}function ZE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=qE(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ap(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Y_(t,e){var n=e.checked;return Vn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function m1(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Ua(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function XE(t,e){e=e.checked,e!=null&&b0(t,"checked",e,!1)}function K_(t,e){XE(t,e);var n=Ua(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?J_(t,e.type,n):e.hasOwnProperty("defaultValue")&&J_(t,e.type,Ua(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function g1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function J_(t,e,n){(e!=="number"||Ap(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Sh=Array.isArray;function Vc(t,e,n,i){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Ua(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,i&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Q_(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ve(91));return Vn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ve(92));if(Sh(n)){if(1<n.length)throw Error(Ve(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ua(n)}}function YE(t,e){var n=Ua(e.value),i=Ua(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function y1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function KE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ey(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?KE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var zf,JE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(zf=zf||document.createElement("div"),zf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=zf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function $h(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Mh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tC=["Webkit","ms","Moz","O"];Object.keys(Mh).forEach(function(t){tC.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Mh[e]=Mh[t]})});function QE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Mh.hasOwnProperty(t)&&Mh[t]?(""+e).trim():e+"px"}function eT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,o=QE(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,o):t[n]=o}}var nC=Vn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ty(t,e){if(e){if(nC[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ve(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ve(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ve(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ve(62))}}function ny(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var iy=null;function S0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ry=null,jc=null,Gc=null;function v1(t){if(t=gd(t)){if(typeof ry!="function")throw Error(Ve(280));var e=t.stateNode;e&&(e=vm(e),ry(t.stateNode,t.type,e))}}function tT(t){jc?Gc?Gc.push(t):Gc=[t]:jc=t}function nT(){if(jc){var t=jc,e=Gc;if(Gc=jc=null,v1(t),e)for(t=0;t<e.length;t++)v1(e[t])}}function iT(t,e){return t(e)}function rT(){}var Wg=!1;function sT(t,e,n){if(Wg)return t(e,n);Wg=!0;try{return iT(t,e,n)}finally{Wg=!1,(jc!==null||Gc!==null)&&(rT(),nT())}}function Hh(t,e){var n=t.stateNode;if(n===null)return null;var i=vm(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ve(231,e,typeof n));return n}var sy=!1;if(Uo)try{var ch={};Object.defineProperty(ch,"passive",{get:function(){sy=!0}}),window.addEventListener("test",ch,ch),window.removeEventListener("test",ch,ch)}catch{sy=!1}function iC(t,e,n,i,o,u,f,l,b){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(M){this.onError(M)}}var kh=!1,Ip=null,Pp=!1,oy=null,rC={onError:function(t){kh=!0,Ip=t}};function sC(t,e,n,i,o,u,f,l,b){kh=!1,Ip=null,iC.apply(rC,arguments)}function oC(t,e,n,i,o,u,f,l,b){if(sC.apply(this,arguments),kh){if(kh){var w=Ip;kh=!1,Ip=null}else throw Error(Ve(198));Pp||(Pp=!0,oy=w)}}function Nl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function oT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function x1(t){if(Nl(t)!==t)throw Error(Ve(188))}function aC(t){var e=t.alternate;if(!e){if(e=Nl(t),e===null)throw Error(Ve(188));return e!==t?null:t}for(var n=t,i=e;;){var o=n.return;if(o===null)break;var u=o.alternate;if(u===null){if(i=o.return,i!==null){n=i;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===n)return x1(o),t;if(u===i)return x1(o),e;u=u.sibling}throw Error(Ve(188))}if(n.return!==i.return)n=o,i=u;else{for(var f=!1,l=o.child;l;){if(l===n){f=!0,n=o,i=u;break}if(l===i){f=!0,i=o,n=u;break}l=l.sibling}if(!f){for(l=u.child;l;){if(l===n){f=!0,n=u,i=o;break}if(l===i){f=!0,i=u,n=o;break}l=l.sibling}if(!f)throw Error(Ve(189))}}if(n.alternate!==i)throw Error(Ve(190))}if(n.tag!==3)throw Error(Ve(188));return n.stateNode.current===n?t:e}function aT(t){return t=aC(t),t!==null?lT(t):null}function lT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=lT(t);if(e!==null)return e;t=t.sibling}return null}var cT=Jr.unstable_scheduleCallback,b1=Jr.unstable_cancelCallback,lC=Jr.unstable_shouldYield,cC=Jr.unstable_requestPaint,ei=Jr.unstable_now,uC=Jr.unstable_getCurrentPriorityLevel,A0=Jr.unstable_ImmediatePriority,uT=Jr.unstable_UserBlockingPriority,Cp=Jr.unstable_NormalPriority,hC=Jr.unstable_LowPriority,hT=Jr.unstable_IdlePriority,mm=null,ho=null;function dC(t){if(ho&&typeof ho.onCommitFiberRoot=="function")try{ho.onCommitFiberRoot(mm,t,void 0,(t.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:mC,fC=Math.log,pC=Math.LN2;function mC(t){return t>>>=0,t===0?32:31-(fC(t)/pC|0)|0}var Of=64,Ff=4194304;function Ah(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Mp(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,o=t.suspendedLanes,u=t.pingedLanes,f=n&268435455;if(f!==0){var l=f&~o;l!==0?i=Ah(l):(u&=f,u!==0&&(i=Ah(u)))}else f=n&~o,f!==0?i=Ah(f):u!==0&&(i=Ah(u));if(i===0)return 0;if(e!==0&&e!==i&&!(e&o)&&(o=i&-i,u=e&-e,o>=u||o===16&&(u&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Fs(e),o=1<<n,i|=t[n],e&=~o;return i}function gC(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _C(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,u=t.pendingLanes;0<u;){var f=31-Fs(u),l=1<<f,b=o[f];b===-1?(!(l&n)||l&i)&&(o[f]=gC(l,e)):b<=e&&(t.expiredLanes|=l),u&=~l}}function ay(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function dT(){var t=Of;return Of<<=1,!(Of&4194240)&&(Of=64),t}function qg(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function pd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fs(e),t[e]=n}function yC(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-Fs(n),u=1<<o;e[o]=0,i[o]=-1,t[o]=-1,n&=~u}}function I0(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Fs(n),o=1<<i;o&e|t[i]&e&&(t[i]|=e),n&=~o}}var pn=0;function fT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var pT,P0,mT,gT,_T,ly=!1,Bf=[],Ma=null,ka=null,La=null,Wh=new Map,qh=new Map,Ta=[],vC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function w1(t,e){switch(t){case"focusin":case"focusout":Ma=null;break;case"dragenter":case"dragleave":ka=null;break;case"mouseover":case"mouseout":La=null;break;case"pointerover":case"pointerout":Wh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":qh.delete(e.pointerId)}}function uh(t,e,n,i,o,u){return t===null||t.nativeEvent!==u?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:u,targetContainers:[o]},e!==null&&(e=gd(e),e!==null&&P0(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function xC(t,e,n,i,o){switch(e){case"focusin":return Ma=uh(Ma,t,e,n,i,o),!0;case"dragenter":return ka=uh(ka,t,e,n,i,o),!0;case"mouseover":return La=uh(La,t,e,n,i,o),!0;case"pointerover":var u=o.pointerId;return Wh.set(u,uh(Wh.get(u)||null,t,e,n,i,o)),!0;case"gotpointercapture":return u=o.pointerId,qh.set(u,uh(qh.get(u)||null,t,e,n,i,o)),!0}return!1}function yT(t){var e=Tl(t.target);if(e!==null){var n=Nl(e);if(n!==null){if(e=n.tag,e===13){if(e=oT(n),e!==null){t.blockedOn=e,_T(t.priority,function(){mT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function cp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=cy(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);iy=i,n.target.dispatchEvent(i),iy=null}else return e=gd(n),e!==null&&P0(e),t.blockedOn=n,!1;e.shift()}return!0}function E1(t,e,n){cp(t)&&n.delete(e)}function bC(){ly=!1,Ma!==null&&cp(Ma)&&(Ma=null),ka!==null&&cp(ka)&&(ka=null),La!==null&&cp(La)&&(La=null),Wh.forEach(E1),qh.forEach(E1)}function hh(t,e){t.blockedOn===e&&(t.blockedOn=null,ly||(ly=!0,Jr.unstable_scheduleCallback(Jr.unstable_NormalPriority,bC)))}function Zh(t){function e(o){return hh(o,t)}if(0<Bf.length){hh(Bf[0],t);for(var n=1;n<Bf.length;n++){var i=Bf[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ma!==null&&hh(Ma,t),ka!==null&&hh(ka,t),La!==null&&hh(La,t),Wh.forEach(e),qh.forEach(e),n=0;n<Ta.length;n++)i=Ta[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ta.length&&(n=Ta[0],n.blockedOn===null);)yT(n),n.blockedOn===null&&Ta.shift()}var $c=qo.ReactCurrentBatchConfig,kp=!0;function wC(t,e,n,i){var o=pn,u=$c.transition;$c.transition=null;try{pn=1,C0(t,e,n,i)}finally{pn=o,$c.transition=u}}function EC(t,e,n,i){var o=pn,u=$c.transition;$c.transition=null;try{pn=4,C0(t,e,n,i)}finally{pn=o,$c.transition=u}}function C0(t,e,n,i){if(kp){var o=cy(t,e,n,i);if(o===null)i_(t,e,i,Lp,n),w1(t,i);else if(xC(o,t,e,n,i))i.stopPropagation();else if(w1(t,i),e&4&&-1<vC.indexOf(t)){for(;o!==null;){var u=gd(o);if(u!==null&&pT(u),u=cy(t,e,n,i),u===null&&i_(t,e,i,Lp,n),u===o)break;o=u}o!==null&&i.stopPropagation()}else i_(t,e,i,null,n)}}var Lp=null;function cy(t,e,n,i){if(Lp=null,t=S0(i),t=Tl(t),t!==null)if(e=Nl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=oT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Lp=t,null}function vT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uC()){case A0:return 1;case uT:return 4;case Cp:case hC:return 16;case hT:return 536870912;default:return 16}default:return 16}}var Aa=null,M0=null,up=null;function xT(){if(up)return up;var t,e=M0,n=e.length,i,o="value"in Aa?Aa.value:Aa.textContent,u=o.length;for(t=0;t<n&&e[t]===o[t];t++);var f=n-t;for(i=1;i<=f&&e[n-i]===o[u-i];i++);return up=o.slice(t,1<i?1-i:void 0)}function hp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Nf(){return!0}function T1(){return!1}function ts(t){function e(n,i,o,u,f){this._reactName=n,this._targetInst=o,this.type=i,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(u):u[l]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Nf:T1,this.isPropagationStopped=T1,this}return Vn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Nf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Nf)},persist:function(){},isPersistent:Nf}),e}var fu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},k0=ts(fu),md=Vn({},fu,{view:0,detail:0}),TC=ts(md),Zg,Xg,dh,gm=Vn({},md,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:L0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==dh&&(dh&&t.type==="mousemove"?(Zg=t.screenX-dh.screenX,Xg=t.screenY-dh.screenY):Xg=Zg=0,dh=t),Zg)},movementY:function(t){return"movementY"in t?t.movementY:Xg}}),S1=ts(gm),SC=Vn({},gm,{dataTransfer:0}),AC=ts(SC),IC=Vn({},md,{relatedTarget:0}),Yg=ts(IC),PC=Vn({},fu,{animationName:0,elapsedTime:0,pseudoElement:0}),CC=ts(PC),MC=Vn({},fu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kC=ts(MC),LC=Vn({},fu,{data:0}),A1=ts(LC),RC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OC(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=zC[t])?!!e[t]:!1}function L0(){return OC}var FC=Vn({},md,{key:function(t){if(t.key){var e=RC[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=hp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?DC[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:L0,charCode:function(t){return t.type==="keypress"?hp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?hp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BC=ts(FC),NC=Vn({},gm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),I1=ts(NC),UC=Vn({},md,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:L0}),VC=ts(UC),jC=Vn({},fu,{propertyName:0,elapsedTime:0,pseudoElement:0}),GC=ts(jC),$C=Vn({},gm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HC=ts($C),WC=[9,13,27,32],R0=Uo&&"CompositionEvent"in window,Lh=null;Uo&&"documentMode"in document&&(Lh=document.documentMode);var qC=Uo&&"TextEvent"in window&&!Lh,bT=Uo&&(!R0||Lh&&8<Lh&&11>=Lh),P1=String.fromCharCode(32),C1=!1;function wT(t,e){switch(t){case"keyup":return WC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ET(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Cc=!1;function ZC(t,e){switch(t){case"compositionend":return ET(e);case"keypress":return e.which!==32?null:(C1=!0,P1);case"textInput":return t=e.data,t===P1&&C1?null:t;default:return null}}function XC(t,e){if(Cc)return t==="compositionend"||!R0&&wT(t,e)?(t=xT(),up=M0=Aa=null,Cc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return bT&&e.locale!=="ko"?null:e.data;default:return null}}var YC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!YC[t.type]:e==="textarea"}function TT(t,e,n,i){tT(i),e=Rp(e,"onChange"),0<e.length&&(n=new k0("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Rh=null,Xh=null;function KC(t){zT(t,0)}function _m(t){var e=Lc(t);if(ZE(e))return t}function JC(t,e){if(t==="change")return e}var ST=!1;if(Uo){var Kg;if(Uo){var Jg="oninput"in document;if(!Jg){var k1=document.createElement("div");k1.setAttribute("oninput","return;"),Jg=typeof k1.oninput=="function"}Kg=Jg}else Kg=!1;ST=Kg&&(!document.documentMode||9<document.documentMode)}function L1(){Rh&&(Rh.detachEvent("onpropertychange",AT),Xh=Rh=null)}function AT(t){if(t.propertyName==="value"&&_m(Xh)){var e=[];TT(e,Xh,t,S0(t)),sT(KC,e)}}function QC(t,e,n){t==="focusin"?(L1(),Rh=e,Xh=n,Rh.attachEvent("onpropertychange",AT)):t==="focusout"&&L1()}function eM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return _m(Xh)}function tM(t,e){if(t==="click")return _m(e)}function nM(t,e){if(t==="input"||t==="change")return _m(e)}function iM(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Us=typeof Object.is=="function"?Object.is:iM;function Yh(t,e){if(Us(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!H_.call(e,o)||!Us(t[o],e[o]))return!1}return!0}function R1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function D1(t,e){var n=R1(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=R1(n)}}function IT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?IT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function PT(){for(var t=window,e=Ap();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ap(t.document)}return e}function D0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function rM(t){var e=PT(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&IT(n.ownerDocument.documentElement,n)){if(i!==null&&D0(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,u=Math.min(i.start,o);i=i.end===void 0?u:Math.min(i.end,o),!t.extend&&u>i&&(o=i,i=u,u=o),o=D1(n,u);var f=D1(n,i);o&&f&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==f.node||t.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),u>i?(t.addRange(e),t.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sM=Uo&&"documentMode"in document&&11>=document.documentMode,Mc=null,uy=null,Dh=null,hy=!1;function z1(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;hy||Mc==null||Mc!==Ap(i)||(i=Mc,"selectionStart"in i&&D0(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Dh&&Yh(Dh,i)||(Dh=i,i=Rp(uy,"onSelect"),0<i.length&&(e=new k0("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Mc)))}function Uf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var kc={animationend:Uf("Animation","AnimationEnd"),animationiteration:Uf("Animation","AnimationIteration"),animationstart:Uf("Animation","AnimationStart"),transitionend:Uf("Transition","TransitionEnd")},Qg={},CT={};Uo&&(CT=document.createElement("div").style,"AnimationEvent"in window||(delete kc.animationend.animation,delete kc.animationiteration.animation,delete kc.animationstart.animation),"TransitionEvent"in window||delete kc.transitionend.transition);function ym(t){if(Qg[t])return Qg[t];if(!kc[t])return t;var e=kc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in CT)return Qg[t]=e[n];return t}var MT=ym("animationend"),kT=ym("animationiteration"),LT=ym("animationstart"),RT=ym("transitionend"),DT=new Map,O1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ga(t,e){DT.set(t,e),Bl(e,[t])}for(var e_=0;e_<O1.length;e_++){var t_=O1[e_],oM=t_.toLowerCase(),aM=t_[0].toUpperCase()+t_.slice(1);Ga(oM,"on"+aM)}Ga(MT,"onAnimationEnd");Ga(kT,"onAnimationIteration");Ga(LT,"onAnimationStart");Ga("dblclick","onDoubleClick");Ga("focusin","onFocus");Ga("focusout","onBlur");Ga(RT,"onTransitionEnd");Xc("onMouseEnter",["mouseout","mouseover"]);Xc("onMouseLeave",["mouseout","mouseover"]);Xc("onPointerEnter",["pointerout","pointerover"]);Xc("onPointerLeave",["pointerout","pointerover"]);Bl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ih));function F1(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,oC(i,e,void 0,t),t.currentTarget=null}function zT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],o=i.event;i=i.listeners;e:{var u=void 0;if(e)for(var f=i.length-1;0<=f;f--){var l=i[f],b=l.instance,w=l.currentTarget;if(l=l.listener,b!==u&&o.isPropagationStopped())break e;F1(o,l,w),u=b}else for(f=0;f<i.length;f++){if(l=i[f],b=l.instance,w=l.currentTarget,l=l.listener,b!==u&&o.isPropagationStopped())break e;F1(o,l,w),u=b}}}if(Pp)throw t=oy,Pp=!1,oy=null,t}function Pn(t,e){var n=e[gy];n===void 0&&(n=e[gy]=new Set);var i=t+"__bubble";n.has(i)||(OT(e,t,2,!1),n.add(i))}function n_(t,e,n){var i=0;e&&(i|=4),OT(n,t,i,e)}var Vf="_reactListening"+Math.random().toString(36).slice(2);function Kh(t){if(!t[Vf]){t[Vf]=!0,GE.forEach(function(n){n!=="selectionchange"&&(lM.has(n)||n_(n,!1,t),n_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Vf]||(e[Vf]=!0,n_("selectionchange",!1,e))}}function OT(t,e,n,i){switch(vT(e)){case 1:var o=wC;break;case 4:o=EC;break;default:o=C0}n=o.bind(null,e,n,t),o=void 0,!sy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function i_(t,e,n,i,o){var u=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var f=i.tag;if(f===3||f===4){var l=i.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(f===4)for(f=i.return;f!==null;){var b=f.tag;if((b===3||b===4)&&(b=f.stateNode.containerInfo,b===o||b.nodeType===8&&b.parentNode===o))return;f=f.return}for(;l!==null;){if(f=Tl(l),f===null)return;if(b=f.tag,b===5||b===6){i=u=f;continue e}l=l.parentNode}}i=i.return}sT(function(){var w=u,M=S0(n),L=[];e:{var C=DT.get(t);if(C!==void 0){var W=k0,Q=t;switch(t){case"keypress":if(hp(n)===0)break e;case"keydown":case"keyup":W=BC;break;case"focusin":Q="focus",W=Yg;break;case"focusout":Q="blur",W=Yg;break;case"beforeblur":case"afterblur":W=Yg;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=S1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=AC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=VC;break;case MT:case kT:case LT:W=CC;break;case RT:W=GC;break;case"scroll":W=TC;break;case"wheel":W=HC;break;case"copy":case"cut":case"paste":W=kC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=I1}var ne=(e&4)!==0,_e=!ne&&t==="scroll",K=ne?C!==null?C+"Capture":null:C;ne=[];for(var $=w,J;$!==null;){J=$;var pe=J.stateNode;if(J.tag===5&&pe!==null&&(J=pe,K!==null&&(pe=Hh($,K),pe!=null&&ne.push(Jh($,pe,J)))),_e)break;$=$.return}0<ne.length&&(C=new W(C,Q,null,n,M),L.push({event:C,listeners:ne}))}}if(!(e&7)){e:{if(C=t==="mouseover"||t==="pointerover",W=t==="mouseout"||t==="pointerout",C&&n!==iy&&(Q=n.relatedTarget||n.fromElement)&&(Tl(Q)||Q[Vo]))break e;if((W||C)&&(C=M.window===M?M:(C=M.ownerDocument)?C.defaultView||C.parentWindow:window,W?(Q=n.relatedTarget||n.toElement,W=w,Q=Q?Tl(Q):null,Q!==null&&(_e=Nl(Q),Q!==_e||Q.tag!==5&&Q.tag!==6)&&(Q=null)):(W=null,Q=w),W!==Q)){if(ne=S1,pe="onMouseLeave",K="onMouseEnter",$="mouse",(t==="pointerout"||t==="pointerover")&&(ne=I1,pe="onPointerLeave",K="onPointerEnter",$="pointer"),_e=W==null?C:Lc(W),J=Q==null?C:Lc(Q),C=new ne(pe,$+"leave",W,n,M),C.target=_e,C.relatedTarget=J,pe=null,Tl(M)===w&&(ne=new ne(K,$+"enter",Q,n,M),ne.target=J,ne.relatedTarget=_e,pe=ne),_e=pe,W&&Q)t:{for(ne=W,K=Q,$=0,J=ne;J;J=_c(J))$++;for(J=0,pe=K;pe;pe=_c(pe))J++;for(;0<$-J;)ne=_c(ne),$--;for(;0<J-$;)K=_c(K),J--;for(;$--;){if(ne===K||K!==null&&ne===K.alternate)break t;ne=_c(ne),K=_c(K)}ne=null}else ne=null;W!==null&&B1(L,C,W,ne,!1),Q!==null&&_e!==null&&B1(L,_e,Q,ne,!0)}}e:{if(C=w?Lc(w):window,W=C.nodeName&&C.nodeName.toLowerCase(),W==="select"||W==="input"&&C.type==="file")var ye=JC;else if(M1(C))if(ST)ye=nM;else{ye=eM;var Ae=QC}else(W=C.nodeName)&&W.toLowerCase()==="input"&&(C.type==="checkbox"||C.type==="radio")&&(ye=tM);if(ye&&(ye=ye(t,w))){TT(L,ye,n,M);break e}Ae&&Ae(t,C,w),t==="focusout"&&(Ae=C._wrapperState)&&Ae.controlled&&C.type==="number"&&J_(C,"number",C.value)}switch(Ae=w?Lc(w):window,t){case"focusin":(M1(Ae)||Ae.contentEditable==="true")&&(Mc=Ae,uy=w,Dh=null);break;case"focusout":Dh=uy=Mc=null;break;case"mousedown":hy=!0;break;case"contextmenu":case"mouseup":case"dragend":hy=!1,z1(L,n,M);break;case"selectionchange":if(sM)break;case"keydown":case"keyup":z1(L,n,M)}var Oe;if(R0)e:{switch(t){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else Cc?wT(t,n)&&(Be="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Be="onCompositionStart");Be&&(bT&&n.locale!=="ko"&&(Cc||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&Cc&&(Oe=xT()):(Aa=M,M0="value"in Aa?Aa.value:Aa.textContent,Cc=!0)),Ae=Rp(w,Be),0<Ae.length&&(Be=new A1(Be,t,null,n,M),L.push({event:Be,listeners:Ae}),Oe?Be.data=Oe:(Oe=ET(n),Oe!==null&&(Be.data=Oe)))),(Oe=qC?ZC(t,n):XC(t,n))&&(w=Rp(w,"onBeforeInput"),0<w.length&&(M=new A1("onBeforeInput","beforeinput",null,n,M),L.push({event:M,listeners:w}),M.data=Oe))}zT(L,e)})}function Jh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Rp(t,e){for(var n=e+"Capture",i=[];t!==null;){var o=t,u=o.stateNode;o.tag===5&&u!==null&&(o=u,u=Hh(t,n),u!=null&&i.unshift(Jh(t,u,o)),u=Hh(t,e),u!=null&&i.push(Jh(t,u,o))),t=t.return}return i}function _c(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function B1(t,e,n,i,o){for(var u=e._reactName,f=[];n!==null&&n!==i;){var l=n,b=l.alternate,w=l.stateNode;if(b!==null&&b===i)break;l.tag===5&&w!==null&&(l=w,o?(b=Hh(n,u),b!=null&&f.unshift(Jh(n,b,l))):o||(b=Hh(n,u),b!=null&&f.push(Jh(n,b,l)))),n=n.return}f.length!==0&&t.push({event:e,listeners:f})}var cM=/\r\n?/g,uM=/\u0000|\uFFFD/g;function N1(t){return(typeof t=="string"?t:""+t).replace(cM,`
`).replace(uM,"")}function jf(t,e,n){if(e=N1(e),N1(t)!==e&&n)throw Error(Ve(425))}function Dp(){}var dy=null,fy=null;function py(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var my=typeof setTimeout=="function"?setTimeout:void 0,hM=typeof clearTimeout=="function"?clearTimeout:void 0,U1=typeof Promise=="function"?Promise:void 0,dM=typeof queueMicrotask=="function"?queueMicrotask:typeof U1<"u"?function(t){return U1.resolve(null).then(t).catch(fM)}:my;function fM(t){setTimeout(function(){throw t})}function r_(t,e){var n=e,i=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(i===0){t.removeChild(o),Zh(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=o}while(n);Zh(e)}function Ra(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function V1(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var pu=Math.random().toString(36).slice(2),ao="__reactFiber$"+pu,Qh="__reactProps$"+pu,Vo="__reactContainer$"+pu,gy="__reactEvents$"+pu,pM="__reactListeners$"+pu,mM="__reactHandles$"+pu;function Tl(t){var e=t[ao];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vo]||n[ao]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=V1(t);t!==null;){if(n=t[ao])return n;t=V1(t)}return e}t=n,n=t.parentNode}return null}function gd(t){return t=t[ao]||t[Vo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Lc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ve(33))}function vm(t){return t[Qh]||null}var _y=[],Rc=-1;function $a(t){return{current:t}}function Cn(t){0>Rc||(t.current=_y[Rc],_y[Rc]=null,Rc--)}function An(t,e){Rc++,_y[Rc]=t.current,t.current=e}var Va={},tr=$a(Va),Ir=$a(!1),kl=Va;function Yc(t,e){var n=t.type.contextTypes;if(!n)return Va;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},u;for(u in n)o[u]=e[u];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Pr(t){return t=t.childContextTypes,t!=null}function zp(){Cn(Ir),Cn(tr)}function j1(t,e,n){if(tr.current!==Va)throw Error(Ve(168));An(tr,e),An(Ir,n)}function FT(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Ve(108,QP(t)||"Unknown",o));return Vn({},n,i)}function Op(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Va,kl=tr.current,An(tr,t),An(Ir,Ir.current),!0}function G1(t,e,n){var i=t.stateNode;if(!i)throw Error(Ve(169));n?(t=FT(t,e,kl),i.__reactInternalMemoizedMergedChildContext=t,Cn(Ir),Cn(tr),An(tr,t)):Cn(Ir),An(Ir,n)}var Do=null,xm=!1,s_=!1;function BT(t){Do===null?Do=[t]:Do.push(t)}function gM(t){xm=!0,BT(t)}function Ha(){if(!s_&&Do!==null){s_=!0;var t=0,e=pn;try{var n=Do;for(pn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Do=null,xm=!1}catch(o){throw Do!==null&&(Do=Do.slice(t+1)),cT(A0,Ha),o}finally{pn=e,s_=!1}}return null}var Dc=[],zc=0,Fp=null,Bp=0,gs=[],_s=0,Ll=null,Fo=1,Bo="";function bl(t,e){Dc[zc++]=Bp,Dc[zc++]=Fp,Fp=t,Bp=e}function NT(t,e,n){gs[_s++]=Fo,gs[_s++]=Bo,gs[_s++]=Ll,Ll=t;var i=Fo;t=Bo;var o=32-Fs(i)-1;i&=~(1<<o),n+=1;var u=32-Fs(e)+o;if(30<u){var f=o-o%5;u=(i&(1<<f)-1).toString(32),i>>=f,o-=f,Fo=1<<32-Fs(e)+o|n<<o|i,Bo=u+t}else Fo=1<<u|n<<o|i,Bo=t}function z0(t){t.return!==null&&(bl(t,1),NT(t,1,0))}function O0(t){for(;t===Fp;)Fp=Dc[--zc],Dc[zc]=null,Bp=Dc[--zc],Dc[zc]=null;for(;t===Ll;)Ll=gs[--_s],gs[_s]=null,Bo=gs[--_s],gs[_s]=null,Fo=gs[--_s],gs[_s]=null}var Yr=null,Zr=null,Dn=!1,zs=null;function UT(t,e){var n=ys(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function $1(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Yr=t,Zr=Ra(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Yr=t,Zr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ll!==null?{id:Fo,overflow:Bo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ys(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Yr=t,Zr=null,!0):!1;default:return!1}}function yy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function vy(t){if(Dn){var e=Zr;if(e){var n=e;if(!$1(t,e)){if(yy(t))throw Error(Ve(418));e=Ra(n.nextSibling);var i=Yr;e&&$1(t,e)?UT(i,n):(t.flags=t.flags&-4097|2,Dn=!1,Yr=t)}}else{if(yy(t))throw Error(Ve(418));t.flags=t.flags&-4097|2,Dn=!1,Yr=t}}}function H1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Yr=t}function Gf(t){if(t!==Yr)return!1;if(!Dn)return H1(t),Dn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!py(t.type,t.memoizedProps)),e&&(e=Zr)){if(yy(t))throw VT(),Error(Ve(418));for(;e;)UT(t,e),e=Ra(e.nextSibling)}if(H1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ve(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Zr=Ra(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Zr=null}}else Zr=Yr?Ra(t.stateNode.nextSibling):null;return!0}function VT(){for(var t=Zr;t;)t=Ra(t.nextSibling)}function Kc(){Zr=Yr=null,Dn=!1}function F0(t){zs===null?zs=[t]:zs.push(t)}var _M=qo.ReactCurrentBatchConfig;function Rs(t,e){if(t&&t.defaultProps){e=Vn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Np=$a(null),Up=null,Oc=null,B0=null;function N0(){B0=Oc=Up=null}function U0(t){var e=Np.current;Cn(Np),t._currentValue=e}function xy(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Hc(t,e){Up=t,B0=Oc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ar=!0),t.firstContext=null)}function bs(t){var e=t._currentValue;if(B0!==t)if(t={context:t,memoizedValue:e,next:null},Oc===null){if(Up===null)throw Error(Ve(308));Oc=t,Up.dependencies={lanes:0,firstContext:t}}else Oc=Oc.next=t;return e}var Sl=null;function V0(t){Sl===null?Sl=[t]:Sl.push(t)}function jT(t,e,n,i){var o=e.interleaved;return o===null?(n.next=n,V0(e)):(n.next=o.next,o.next=n),e.interleaved=n,jo(t,i)}function jo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ea=!1;function j0(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GT(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function No(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Da(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,on&2){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,jo(t,n)}return o=i.interleaved,o===null?(e.next=e,V0(i)):(e.next=o.next,o.next=e),i.interleaved=e,jo(t,n)}function dp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,I0(t,n)}}function W1(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var o=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?o=u=f:u=u.next=f,n=n.next}while(n!==null);u===null?o=u=e:u=u.next=e}else o=u=e;n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Vp(t,e,n,i){var o=t.updateQueue;Ea=!1;var u=o.firstBaseUpdate,f=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var b=l,w=b.next;b.next=null,f===null?u=w:f.next=w,f=b;var M=t.alternate;M!==null&&(M=M.updateQueue,l=M.lastBaseUpdate,l!==f&&(l===null?M.firstBaseUpdate=w:l.next=w,M.lastBaseUpdate=b))}if(u!==null){var L=o.baseState;f=0,M=w=b=null,l=u;do{var C=l.lane,W=l.eventTime;if((i&C)===C){M!==null&&(M=M.next={eventTime:W,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Q=t,ne=l;switch(C=e,W=n,ne.tag){case 1:if(Q=ne.payload,typeof Q=="function"){L=Q.call(W,L,C);break e}L=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=ne.payload,C=typeof Q=="function"?Q.call(W,L,C):Q,C==null)break e;L=Vn({},L,C);break e;case 2:Ea=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,C=o.effects,C===null?o.effects=[l]:C.push(l))}else W={eventTime:W,lane:C,tag:l.tag,payload:l.payload,callback:l.callback,next:null},M===null?(w=M=W,b=L):M=M.next=W,f|=C;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;C=l,l=C.next,C.next=null,o.lastBaseUpdate=C,o.shared.pending=null}}while(1);if(M===null&&(b=L),o.baseState=b,o.firstBaseUpdate=w,o.lastBaseUpdate=M,e=o.shared.interleaved,e!==null){o=e;do f|=o.lane,o=o.next;while(o!==e)}else u===null&&(o.shared.lanes=0);Dl|=f,t.lanes=f,t.memoizedState=L}}function q1(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],o=i.callback;if(o!==null){if(i.callback=null,i=n,typeof o!="function")throw Error(Ve(191,o));o.call(i)}}}var $T=new jE.Component().refs;function by(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Vn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var bm={isMounted:function(t){return(t=t._reactInternals)?Nl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=mr(),o=Oa(t),u=No(i,o);u.payload=e,n!=null&&(u.callback=n),e=Da(t,u,o),e!==null&&(Bs(e,t,o,i),dp(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=mr(),o=Oa(t),u=No(i,o);u.tag=1,u.payload=e,n!=null&&(u.callback=n),e=Da(t,u,o),e!==null&&(Bs(e,t,o,i),dp(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=mr(),i=Oa(t),o=No(n,i);o.tag=2,e!=null&&(o.callback=e),e=Da(t,o,i),e!==null&&(Bs(e,t,i,n),dp(e,t,i))}};function Z1(t,e,n,i,o,u,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,u,f):e.prototype&&e.prototype.isPureReactComponent?!Yh(n,i)||!Yh(o,u):!0}function HT(t,e,n){var i=!1,o=Va,u=e.contextType;return typeof u=="object"&&u!==null?u=bs(u):(o=Pr(e)?kl:tr.current,i=e.contextTypes,u=(i=i!=null)?Yc(t,o):Va),e=new e(n,u),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bm,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=u),e}function X1(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&bm.enqueueReplaceState(e,e.state,null)}function wy(t,e,n,i){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs=$T,j0(t);var u=e.contextType;typeof u=="object"&&u!==null?o.context=bs(u):(u=Pr(e)?kl:tr.current,o.context=Yc(t,u)),o.state=t.memoizedState,u=e.getDerivedStateFromProps,typeof u=="function"&&(by(t,e,u,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&bm.enqueueReplaceState(o,o.state,null),Vp(t,n,o,i),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function fh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ve(309));var i=n.stateNode}if(!i)throw Error(Ve(147,t));var o=i,u=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===u?e.ref:(e=function(f){var l=o.refs;l===$T&&(l=o.refs={}),f===null?delete l[u]:l[u]=f},e._stringRef=u,e)}if(typeof t!="string")throw Error(Ve(284));if(!n._owner)throw Error(Ve(290,t))}return t}function $f(t,e){throw t=Object.prototype.toString.call(e),Error(Ve(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Y1(t){var e=t._init;return e(t._payload)}function WT(t){function e(K,$){if(t){var J=K.deletions;J===null?(K.deletions=[$],K.flags|=16):J.push($)}}function n(K,$){if(!t)return null;for(;$!==null;)e(K,$),$=$.sibling;return null}function i(K,$){for(K=new Map;$!==null;)$.key!==null?K.set($.key,$):K.set($.index,$),$=$.sibling;return K}function o(K,$){return K=Fa(K,$),K.index=0,K.sibling=null,K}function u(K,$,J){return K.index=J,t?(J=K.alternate,J!==null?(J=J.index,J<$?(K.flags|=2,$):J):(K.flags|=2,$)):(K.flags|=1048576,$)}function f(K){return t&&K.alternate===null&&(K.flags|=2),K}function l(K,$,J,pe){return $===null||$.tag!==6?($=d_(J,K.mode,pe),$.return=K,$):($=o($,J),$.return=K,$)}function b(K,$,J,pe){var ye=J.type;return ye===Pc?M(K,$,J.props.children,pe,J.key):$!==null&&($.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===wa&&Y1(ye)===$.type)?(pe=o($,J.props),pe.ref=fh(K,$,J),pe.return=K,pe):(pe=yp(J.type,J.key,J.props,null,K.mode,pe),pe.ref=fh(K,$,J),pe.return=K,pe)}function w(K,$,J,pe){return $===null||$.tag!==4||$.stateNode.containerInfo!==J.containerInfo||$.stateNode.implementation!==J.implementation?($=f_(J,K.mode,pe),$.return=K,$):($=o($,J.children||[]),$.return=K,$)}function M(K,$,J,pe,ye){return $===null||$.tag!==7?($=Cl(J,K.mode,pe,ye),$.return=K,$):($=o($,J),$.return=K,$)}function L(K,$,J){if(typeof $=="string"&&$!==""||typeof $=="number")return $=d_(""+$,K.mode,J),$.return=K,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case Rf:return J=yp($.type,$.key,$.props,null,K.mode,J),J.ref=fh(K,null,$),J.return=K,J;case Ic:return $=f_($,K.mode,J),$.return=K,$;case wa:var pe=$._init;return L(K,pe($._payload),J)}if(Sh($)||lh($))return $=Cl($,K.mode,J,null),$.return=K,$;$f(K,$)}return null}function C(K,$,J,pe){var ye=$!==null?$.key:null;if(typeof J=="string"&&J!==""||typeof J=="number")return ye!==null?null:l(K,$,""+J,pe);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Rf:return J.key===ye?b(K,$,J,pe):null;case Ic:return J.key===ye?w(K,$,J,pe):null;case wa:return ye=J._init,C(K,$,ye(J._payload),pe)}if(Sh(J)||lh(J))return ye!==null?null:M(K,$,J,pe,null);$f(K,J)}return null}function W(K,$,J,pe,ye){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return K=K.get(J)||null,l($,K,""+pe,ye);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case Rf:return K=K.get(pe.key===null?J:pe.key)||null,b($,K,pe,ye);case Ic:return K=K.get(pe.key===null?J:pe.key)||null,w($,K,pe,ye);case wa:var Ae=pe._init;return W(K,$,J,Ae(pe._payload),ye)}if(Sh(pe)||lh(pe))return K=K.get(J)||null,M($,K,pe,ye,null);$f($,pe)}return null}function Q(K,$,J,pe){for(var ye=null,Ae=null,Oe=$,Be=$=0,Xe=null;Oe!==null&&Be<J.length;Be++){Oe.index>Be?(Xe=Oe,Oe=null):Xe=Oe.sibling;var je=C(K,Oe,J[Be],pe);if(je===null){Oe===null&&(Oe=Xe);break}t&&Oe&&je.alternate===null&&e(K,Oe),$=u(je,$,Be),Ae===null?ye=je:Ae.sibling=je,Ae=je,Oe=Xe}if(Be===J.length)return n(K,Oe),Dn&&bl(K,Be),ye;if(Oe===null){for(;Be<J.length;Be++)Oe=L(K,J[Be],pe),Oe!==null&&($=u(Oe,$,Be),Ae===null?ye=Oe:Ae.sibling=Oe,Ae=Oe);return Dn&&bl(K,Be),ye}for(Oe=i(K,Oe);Be<J.length;Be++)Xe=W(Oe,K,Be,J[Be],pe),Xe!==null&&(t&&Xe.alternate!==null&&Oe.delete(Xe.key===null?Be:Xe.key),$=u(Xe,$,Be),Ae===null?ye=Xe:Ae.sibling=Xe,Ae=Xe);return t&&Oe.forEach(function(mt){return e(K,mt)}),Dn&&bl(K,Be),ye}function ne(K,$,J,pe){var ye=lh(J);if(typeof ye!="function")throw Error(Ve(150));if(J=ye.call(J),J==null)throw Error(Ve(151));for(var Ae=ye=null,Oe=$,Be=$=0,Xe=null,je=J.next();Oe!==null&&!je.done;Be++,je=J.next()){Oe.index>Be?(Xe=Oe,Oe=null):Xe=Oe.sibling;var mt=C(K,Oe,je.value,pe);if(mt===null){Oe===null&&(Oe=Xe);break}t&&Oe&&mt.alternate===null&&e(K,Oe),$=u(mt,$,Be),Ae===null?ye=mt:Ae.sibling=mt,Ae=mt,Oe=Xe}if(je.done)return n(K,Oe),Dn&&bl(K,Be),ye;if(Oe===null){for(;!je.done;Be++,je=J.next())je=L(K,je.value,pe),je!==null&&($=u(je,$,Be),Ae===null?ye=je:Ae.sibling=je,Ae=je);return Dn&&bl(K,Be),ye}for(Oe=i(K,Oe);!je.done;Be++,je=J.next())je=W(Oe,K,Be,je.value,pe),je!==null&&(t&&je.alternate!==null&&Oe.delete(je.key===null?Be:je.key),$=u(je,$,Be),Ae===null?ye=je:Ae.sibling=je,Ae=je);return t&&Oe.forEach(function(Dt){return e(K,Dt)}),Dn&&bl(K,Be),ye}function _e(K,$,J,pe){if(typeof J=="object"&&J!==null&&J.type===Pc&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case Rf:e:{for(var ye=J.key,Ae=$;Ae!==null;){if(Ae.key===ye){if(ye=J.type,ye===Pc){if(Ae.tag===7){n(K,Ae.sibling),$=o(Ae,J.props.children),$.return=K,K=$;break e}}else if(Ae.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===wa&&Y1(ye)===Ae.type){n(K,Ae.sibling),$=o(Ae,J.props),$.ref=fh(K,Ae,J),$.return=K,K=$;break e}n(K,Ae);break}else e(K,Ae);Ae=Ae.sibling}J.type===Pc?($=Cl(J.props.children,K.mode,pe,J.key),$.return=K,K=$):(pe=yp(J.type,J.key,J.props,null,K.mode,pe),pe.ref=fh(K,$,J),pe.return=K,K=pe)}return f(K);case Ic:e:{for(Ae=J.key;$!==null;){if($.key===Ae)if($.tag===4&&$.stateNode.containerInfo===J.containerInfo&&$.stateNode.implementation===J.implementation){n(K,$.sibling),$=o($,J.children||[]),$.return=K,K=$;break e}else{n(K,$);break}else e(K,$);$=$.sibling}$=f_(J,K.mode,pe),$.return=K,K=$}return f(K);case wa:return Ae=J._init,_e(K,$,Ae(J._payload),pe)}if(Sh(J))return Q(K,$,J,pe);if(lh(J))return ne(K,$,J,pe);$f(K,J)}return typeof J=="string"&&J!==""||typeof J=="number"?(J=""+J,$!==null&&$.tag===6?(n(K,$.sibling),$=o($,J),$.return=K,K=$):(n(K,$),$=d_(J,K.mode,pe),$.return=K,K=$),f(K)):n(K,$)}return _e}var Jc=WT(!0),qT=WT(!1),_d={},fo=$a(_d),ed=$a(_d),td=$a(_d);function Al(t){if(t===_d)throw Error(Ve(174));return t}function G0(t,e){switch(An(td,e),An(ed,t),An(fo,_d),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ey(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ey(e,t)}Cn(fo),An(fo,e)}function Qc(){Cn(fo),Cn(ed),Cn(td)}function ZT(t){Al(td.current);var e=Al(fo.current),n=ey(e,t.type);e!==n&&(An(ed,t),An(fo,n))}function $0(t){ed.current===t&&(Cn(fo),Cn(ed))}var Nn=$a(0);function jp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var o_=[];function H0(){for(var t=0;t<o_.length;t++)o_[t]._workInProgressVersionPrimary=null;o_.length=0}var fp=qo.ReactCurrentDispatcher,a_=qo.ReactCurrentBatchConfig,Rl=0,Un=null,gi=null,Ii=null,Gp=!1,zh=!1,nd=0,yM=0;function Xi(){throw Error(Ve(321))}function W0(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Us(t[n],e[n]))return!1;return!0}function q0(t,e,n,i,o,u){if(Rl=u,Un=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,fp.current=t===null||t.memoizedState===null?wM:EM,t=n(i,o),zh){u=0;do{if(zh=!1,nd=0,25<=u)throw Error(Ve(301));u+=1,Ii=gi=null,e.updateQueue=null,fp.current=TM,t=n(i,o)}while(zh)}if(fp.current=$p,e=gi!==null&&gi.next!==null,Rl=0,Ii=gi=Un=null,Gp=!1,e)throw Error(Ve(300));return t}function Z0(){var t=nd!==0;return nd=0,t}function oo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?Un.memoizedState=Ii=t:Ii=Ii.next=t,Ii}function ws(){if(gi===null){var t=Un.alternate;t=t!==null?t.memoizedState:null}else t=gi.next;var e=Ii===null?Un.memoizedState:Ii.next;if(e!==null)Ii=e,gi=t;else{if(t===null)throw Error(Ve(310));gi=t,t={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Ii===null?Un.memoizedState=Ii=t:Ii=Ii.next=t}return Ii}function id(t,e){return typeof e=="function"?e(t):e}function l_(t){var e=ws(),n=e.queue;if(n===null)throw Error(Ve(311));n.lastRenderedReducer=t;var i=gi,o=i.baseQueue,u=n.pending;if(u!==null){if(o!==null){var f=o.next;o.next=u.next,u.next=f}i.baseQueue=o=u,n.pending=null}if(o!==null){u=o.next,i=i.baseState;var l=f=null,b=null,w=u;do{var M=w.lane;if((Rl&M)===M)b!==null&&(b=b.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var L={lane:M,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};b===null?(l=b=L,f=i):b=b.next=L,Un.lanes|=M,Dl|=M}w=w.next}while(w!==null&&w!==u);b===null?f=i:b.next=l,Us(i,e.memoizedState)||(Ar=!0),e.memoizedState=i,e.baseState=f,e.baseQueue=b,n.lastRenderedState=i}if(t=n.interleaved,t!==null){o=t;do u=o.lane,Un.lanes|=u,Dl|=u,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function c_(t){var e=ws(),n=e.queue;if(n===null)throw Error(Ve(311));n.lastRenderedReducer=t;var i=n.dispatch,o=n.pending,u=e.memoizedState;if(o!==null){n.pending=null;var f=o=o.next;do u=t(u,f.action),f=f.next;while(f!==o);Us(u,e.memoizedState)||(Ar=!0),e.memoizedState=u,e.baseQueue===null&&(e.baseState=u),n.lastRenderedState=u}return[u,i]}function XT(){}function YT(t,e){var n=Un,i=ws(),o=e(),u=!Us(i.memoizedState,o);if(u&&(i.memoizedState=o,Ar=!0),i=i.queue,X0(QT.bind(null,n,i,t),[t]),i.getSnapshot!==e||u||Ii!==null&&Ii.memoizedState.tag&1){if(n.flags|=2048,rd(9,JT.bind(null,n,i,o,e),void 0,null),Pi===null)throw Error(Ve(349));Rl&30||KT(n,e,o)}return o}function KT(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Un.updateQueue,e===null?(e={lastEffect:null,stores:null},Un.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function JT(t,e,n,i){e.value=n,e.getSnapshot=i,e2(e)&&t2(t)}function QT(t,e,n){return n(function(){e2(e)&&t2(t)})}function e2(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Us(t,n)}catch{return!0}}function t2(t){var e=jo(t,1);e!==null&&Bs(e,t,1,-1)}function K1(t){var e=oo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:id,lastRenderedState:t},e.queue=t,t=t.dispatch=bM.bind(null,Un,t),[e.memoizedState,t]}function rd(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Un.updateQueue,e===null?(e={lastEffect:null,stores:null},Un.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function n2(){return ws().memoizedState}function pp(t,e,n,i){var o=oo();Un.flags|=t,o.memoizedState=rd(1|e,n,void 0,i===void 0?null:i)}function wm(t,e,n,i){var o=ws();i=i===void 0?null:i;var u=void 0;if(gi!==null){var f=gi.memoizedState;if(u=f.destroy,i!==null&&W0(i,f.deps)){o.memoizedState=rd(e,n,u,i);return}}Un.flags|=t,o.memoizedState=rd(1|e,n,u,i)}function J1(t,e){return pp(8390656,8,t,e)}function X0(t,e){return wm(2048,8,t,e)}function i2(t,e){return wm(4,2,t,e)}function r2(t,e){return wm(4,4,t,e)}function s2(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function o2(t,e,n){return n=n!=null?n.concat([t]):null,wm(4,4,s2.bind(null,e,t),n)}function Y0(){}function a2(t,e){var n=ws();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&W0(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function l2(t,e){var n=ws();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&W0(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function c2(t,e,n){return Rl&21?(Us(n,e)||(n=dT(),Un.lanes|=n,Dl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ar=!0),t.memoizedState=n)}function vM(t,e){var n=pn;pn=n!==0&&4>n?n:4,t(!0);var i=a_.transition;a_.transition={};try{t(!1),e()}finally{pn=n,a_.transition=i}}function u2(){return ws().memoizedState}function xM(t,e,n){var i=Oa(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},h2(t))d2(e,n);else if(n=jT(t,e,n,i),n!==null){var o=mr();Bs(n,t,i,o),f2(n,e,i)}}function bM(t,e,n){var i=Oa(t),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(h2(t))d2(e,o);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=e.lastRenderedReducer,u!==null))try{var f=e.lastRenderedState,l=u(f,n);if(o.hasEagerState=!0,o.eagerState=l,Us(l,f)){var b=e.interleaved;b===null?(o.next=o,V0(e)):(o.next=b.next,b.next=o),e.interleaved=o;return}}catch{}finally{}n=jT(t,e,o,i),n!==null&&(o=mr(),Bs(n,t,i,o),f2(n,e,i))}}function h2(t){var e=t.alternate;return t===Un||e!==null&&e===Un}function d2(t,e){zh=Gp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function f2(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,I0(t,n)}}var $p={readContext:bs,useCallback:Xi,useContext:Xi,useEffect:Xi,useImperativeHandle:Xi,useInsertionEffect:Xi,useLayoutEffect:Xi,useMemo:Xi,useReducer:Xi,useRef:Xi,useState:Xi,useDebugValue:Xi,useDeferredValue:Xi,useTransition:Xi,useMutableSource:Xi,useSyncExternalStore:Xi,useId:Xi,unstable_isNewReconciler:!1},wM={readContext:bs,useCallback:function(t,e){return oo().memoizedState=[t,e===void 0?null:e],t},useContext:bs,useEffect:J1,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,pp(4194308,4,s2.bind(null,e,t),n)},useLayoutEffect:function(t,e){return pp(4194308,4,t,e)},useInsertionEffect:function(t,e){return pp(4,2,t,e)},useMemo:function(t,e){var n=oo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=oo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=xM.bind(null,Un,t),[i.memoizedState,t]},useRef:function(t){var e=oo();return t={current:t},e.memoizedState=t},useState:K1,useDebugValue:Y0,useDeferredValue:function(t){return oo().memoizedState=t},useTransition:function(){var t=K1(!1),e=t[0];return t=vM.bind(null,t[1]),oo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Un,o=oo();if(Dn){if(n===void 0)throw Error(Ve(407));n=n()}else{if(n=e(),Pi===null)throw Error(Ve(349));Rl&30||KT(i,e,n)}o.memoizedState=n;var u={value:n,getSnapshot:e};return o.queue=u,J1(QT.bind(null,i,u,t),[t]),i.flags|=2048,rd(9,JT.bind(null,i,u,n,e),void 0,null),n},useId:function(){var t=oo(),e=Pi.identifierPrefix;if(Dn){var n=Bo,i=Fo;n=(i&~(1<<32-Fs(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=nd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=yM++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},EM={readContext:bs,useCallback:a2,useContext:bs,useEffect:X0,useImperativeHandle:o2,useInsertionEffect:i2,useLayoutEffect:r2,useMemo:l2,useReducer:l_,useRef:n2,useState:function(){return l_(id)},useDebugValue:Y0,useDeferredValue:function(t){var e=ws();return c2(e,gi.memoizedState,t)},useTransition:function(){var t=l_(id)[0],e=ws().memoizedState;return[t,e]},useMutableSource:XT,useSyncExternalStore:YT,useId:u2,unstable_isNewReconciler:!1},TM={readContext:bs,useCallback:a2,useContext:bs,useEffect:X0,useImperativeHandle:o2,useInsertionEffect:i2,useLayoutEffect:r2,useMemo:l2,useReducer:c_,useRef:n2,useState:function(){return c_(id)},useDebugValue:Y0,useDeferredValue:function(t){var e=ws();return gi===null?e.memoizedState=t:c2(e,gi.memoizedState,t)},useTransition:function(){var t=c_(id)[0],e=ws().memoizedState;return[t,e]},useMutableSource:XT,useSyncExternalStore:YT,useId:u2,unstable_isNewReconciler:!1};function eu(t,e){try{var n="",i=e;do n+=JP(i),i=i.return;while(i);var o=n}catch(u){o=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:e,stack:o,digest:null}}function u_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ey(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var SM=typeof WeakMap=="function"?WeakMap:Map;function p2(t,e,n){n=No(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Wp||(Wp=!0,Ry=i),Ey(t,e)},n}function m2(t,e,n){n=No(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;n.payload=function(){return i(o)},n.callback=function(){Ey(t,e)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){Ey(t,e),typeof i!="function"&&(za===null?za=new Set([this]):za.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),n}function Q1(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new SM;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(n)||(o.add(n),t=NM.bind(null,t,e,n),e.then(t,t))}function eb(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function tb(t,e,n,i,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=No(-1,1),e.tag=2,Da(n,e,1))),n.lanes|=1),t)}var AM=qo.ReactCurrentOwner,Ar=!1;function fr(t,e,n,i){e.child=t===null?qT(e,null,n,i):Jc(e,t.child,n,i)}function nb(t,e,n,i,o){n=n.render;var u=e.ref;return Hc(e,o),i=q0(t,e,n,i,u,o),n=Z0(),t!==null&&!Ar?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Go(t,e,o)):(Dn&&n&&z0(e),e.flags|=1,fr(t,e,i,o),e.child)}function ib(t,e,n,i,o){if(t===null){var u=n.type;return typeof u=="function"&&!rv(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=u,g2(t,e,u,i,o)):(t=yp(n.type,null,i,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(u=t.child,!(t.lanes&o)){var f=u.memoizedProps;if(n=n.compare,n=n!==null?n:Yh,n(f,i)&&t.ref===e.ref)return Go(t,e,o)}return e.flags|=1,t=Fa(u,i),t.ref=e.ref,t.return=e,e.child=t}function g2(t,e,n,i,o){if(t!==null){var u=t.memoizedProps;if(Yh(u,i)&&t.ref===e.ref)if(Ar=!1,e.pendingProps=i=u,(t.lanes&o)!==0)t.flags&131072&&(Ar=!0);else return e.lanes=t.lanes,Go(t,e,o)}return Ty(t,e,n,i,o)}function _2(t,e,n){var i=e.pendingProps,o=i.children,u=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(Bc,Hr),Hr|=n;else{if(!(n&1073741824))return t=u!==null?u.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,An(Bc,Hr),Hr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=u!==null?u.baseLanes:n,An(Bc,Hr),Hr|=i}else u!==null?(i=u.baseLanes|n,e.memoizedState=null):i=n,An(Bc,Hr),Hr|=i;return fr(t,e,o,n),e.child}function y2(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ty(t,e,n,i,o){var u=Pr(n)?kl:tr.current;return u=Yc(e,u),Hc(e,o),n=q0(t,e,n,i,u,o),i=Z0(),t!==null&&!Ar?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Go(t,e,o)):(Dn&&i&&z0(e),e.flags|=1,fr(t,e,n,o),e.child)}function rb(t,e,n,i,o){if(Pr(n)){var u=!0;Op(e)}else u=!1;if(Hc(e,o),e.stateNode===null)mp(t,e),HT(e,n,i),wy(e,n,i,o),i=!0;else if(t===null){var f=e.stateNode,l=e.memoizedProps;f.props=l;var b=f.context,w=n.contextType;typeof w=="object"&&w!==null?w=bs(w):(w=Pr(n)?kl:tr.current,w=Yc(e,w));var M=n.getDerivedStateFromProps,L=typeof M=="function"||typeof f.getSnapshotBeforeUpdate=="function";L||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==i||b!==w)&&X1(e,f,i,w),Ea=!1;var C=e.memoizedState;f.state=C,Vp(e,i,f,o),b=e.memoizedState,l!==i||C!==b||Ir.current||Ea?(typeof M=="function"&&(by(e,n,M,i),b=e.memoizedState),(l=Ea||Z1(e,n,l,i,C,b,w))?(L||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=b),f.props=i,f.state=b,f.context=w,i=l):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{f=e.stateNode,GT(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:Rs(e.type,l),f.props=w,L=e.pendingProps,C=f.context,b=n.contextType,typeof b=="object"&&b!==null?b=bs(b):(b=Pr(n)?kl:tr.current,b=Yc(e,b));var W=n.getDerivedStateFromProps;(M=typeof W=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==L||C!==b)&&X1(e,f,i,b),Ea=!1,C=e.memoizedState,f.state=C,Vp(e,i,f,o);var Q=e.memoizedState;l!==L||C!==Q||Ir.current||Ea?(typeof W=="function"&&(by(e,n,W,i),Q=e.memoizedState),(w=Ea||Z1(e,n,w,i,C,Q,b)||!1)?(M||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(i,Q,b),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(i,Q,b)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&C===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&C===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=Q),f.props=i,f.state=Q,f.context=b,i=w):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&C===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&C===t.memoizedState||(e.flags|=1024),i=!1)}return Sy(t,e,n,i,u,o)}function Sy(t,e,n,i,o,u){y2(t,e);var f=(e.flags&128)!==0;if(!i&&!f)return o&&G1(e,n,!1),Go(t,e,u);i=e.stateNode,AM.current=e;var l=f&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&f?(e.child=Jc(e,t.child,null,u),e.child=Jc(e,null,l,u)):fr(t,e,l,u),e.memoizedState=i.state,o&&G1(e,n,!0),e.child}function v2(t){var e=t.stateNode;e.pendingContext?j1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&j1(t,e.context,!1),G0(t,e.containerInfo)}function sb(t,e,n,i,o){return Kc(),F0(o),e.flags|=256,fr(t,e,n,i),e.child}var Ay={dehydrated:null,treeContext:null,retryLane:0};function Iy(t){return{baseLanes:t,cachePool:null,transitions:null}}function x2(t,e,n){var i=e.pendingProps,o=Nn.current,u=!1,f=(e.flags&128)!==0,l;if((l=f)||(l=t!==null&&t.memoizedState===null?!1:(o&2)!==0),l?(u=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),An(Nn,o&1),t===null)return vy(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(f=i.children,t=i.fallback,u?(i=e.mode,u=e.child,f={mode:"hidden",children:f},!(i&1)&&u!==null?(u.childLanes=0,u.pendingProps=f):u=Sm(f,i,0,null),t=Cl(t,i,n,null),u.return=e,t.return=e,u.sibling=t,e.child=u,e.child.memoizedState=Iy(n),e.memoizedState=Ay,t):K0(e,f));if(o=t.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return IM(t,e,f,i,l,o,n);if(u){u=i.fallback,f=e.mode,o=t.child,l=o.sibling;var b={mode:"hidden",children:i.children};return!(f&1)&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=b,e.deletions=null):(i=Fa(o,b),i.subtreeFlags=o.subtreeFlags&14680064),l!==null?u=Fa(l,u):(u=Cl(u,f,n,null),u.flags|=2),u.return=e,i.return=e,i.sibling=u,e.child=i,i=u,u=e.child,f=t.child.memoizedState,f=f===null?Iy(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},u.memoizedState=f,u.childLanes=t.childLanes&~n,e.memoizedState=Ay,i}return u=t.child,t=u.sibling,i=Fa(u,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function K0(t,e){return e=Sm({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Hf(t,e,n,i){return i!==null&&F0(i),Jc(e,t.child,null,n),t=K0(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function IM(t,e,n,i,o,u,f){if(n)return e.flags&256?(e.flags&=-257,i=u_(Error(Ve(422))),Hf(t,e,f,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(u=i.fallback,o=e.mode,i=Sm({mode:"visible",children:i.children},o,0,null),u=Cl(u,o,f,null),u.flags|=2,i.return=e,u.return=e,i.sibling=u,e.child=i,e.mode&1&&Jc(e,t.child,null,f),e.child.memoizedState=Iy(f),e.memoizedState=Ay,u);if(!(e.mode&1))return Hf(t,e,f,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var l=i.dgst;return i=l,u=Error(Ve(419)),i=u_(u,i,void 0),Hf(t,e,f,i)}if(l=(f&t.childLanes)!==0,Ar||l){if(i=Pi,i!==null){switch(f&-f){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(i.suspendedLanes|f)?0:o,o!==0&&o!==u.retryLane&&(u.retryLane=o,jo(t,o),Bs(i,t,o,-1))}return iv(),i=u_(Error(Ve(421))),Hf(t,e,f,i)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=UM.bind(null,t),o._reactRetry=e,null):(t=u.treeContext,Zr=Ra(o.nextSibling),Yr=e,Dn=!0,zs=null,t!==null&&(gs[_s++]=Fo,gs[_s++]=Bo,gs[_s++]=Ll,Fo=t.id,Bo=t.overflow,Ll=e),e=K0(e,i.children),e.flags|=4096,e)}function ob(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),xy(t.return,e,n)}function h_(t,e,n,i,o){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(u.isBackwards=e,u.rendering=null,u.renderingStartTime=0,u.last=i,u.tail=n,u.tailMode=o)}function b2(t,e,n){var i=e.pendingProps,o=i.revealOrder,u=i.tail;if(fr(t,e,i.children,n),i=Nn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ob(t,n,e);else if(t.tag===19)ob(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(An(Nn,i),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&jp(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),h_(e,!1,o,n,u);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&jp(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}h_(e,!0,n,null,u);break;case"together":h_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function mp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Go(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Dl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ve(153));if(e.child!==null){for(t=e.child,n=Fa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Fa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function PM(t,e,n){switch(e.tag){case 3:v2(e),Kc();break;case 5:ZT(e);break;case 1:Pr(e.type)&&Op(e);break;case 4:G0(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;An(Np,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(An(Nn,Nn.current&1),e.flags|=128,null):n&e.child.childLanes?x2(t,e,n):(An(Nn,Nn.current&1),t=Go(t,e,n),t!==null?t.sibling:null);An(Nn,Nn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return b2(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),An(Nn,Nn.current),i)break;return null;case 22:case 23:return e.lanes=0,_2(t,e,n)}return Go(t,e,n)}var w2,Py,E2,T2;w2=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Py=function(){};E2=function(t,e,n,i){var o=t.memoizedProps;if(o!==i){t=e.stateNode,Al(fo.current);var u=null;switch(n){case"input":o=Y_(t,o),i=Y_(t,i),u=[];break;case"select":o=Vn({},o,{value:void 0}),i=Vn({},i,{value:void 0}),u=[];break;case"textarea":o=Q_(t,o),i=Q_(t,i),u=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Dp)}ty(n,i);var f;n=null;for(w in o)if(!i.hasOwnProperty(w)&&o.hasOwnProperty(w)&&o[w]!=null)if(w==="style"){var l=o[w];for(f in l)l.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Gh.hasOwnProperty(w)?u||(u=[]):(u=u||[]).push(w,null));for(w in i){var b=i[w];if(l=o!=null?o[w]:void 0,i.hasOwnProperty(w)&&b!==l&&(b!=null||l!=null))if(w==="style")if(l){for(f in l)!l.hasOwnProperty(f)||b&&b.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in b)b.hasOwnProperty(f)&&l[f]!==b[f]&&(n||(n={}),n[f]=b[f])}else n||(u||(u=[]),u.push(w,n)),n=b;else w==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,l=l?l.__html:void 0,b!=null&&l!==b&&(u=u||[]).push(w,b)):w==="children"?typeof b!="string"&&typeof b!="number"||(u=u||[]).push(w,""+b):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Gh.hasOwnProperty(w)?(b!=null&&w==="onScroll"&&Pn("scroll",t),u||l===b||(u=[])):(u=u||[]).push(w,b))}n&&(u=u||[]).push("style",n);var w=u;(e.updateQueue=w)&&(e.flags|=4)}};T2=function(t,e,n,i){n!==i&&(e.flags|=4)};function ph(t,e){if(!Dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Yi(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function CM(t,e,n){var i=e.pendingProps;switch(O0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yi(e),null;case 1:return Pr(e.type)&&zp(),Yi(e),null;case 3:return i=e.stateNode,Qc(),Cn(Ir),Cn(tr),H0(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Gf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zs!==null&&(Oy(zs),zs=null))),Py(t,e),Yi(e),null;case 5:$0(e);var o=Al(td.current);if(n=e.type,t!==null&&e.stateNode!=null)E2(t,e,n,i,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ve(166));return Yi(e),null}if(t=Al(fo.current),Gf(e)){i=e.stateNode,n=e.type;var u=e.memoizedProps;switch(i[ao]=e,i[Qh]=u,t=(e.mode&1)!==0,n){case"dialog":Pn("cancel",i),Pn("close",i);break;case"iframe":case"object":case"embed":Pn("load",i);break;case"video":case"audio":for(o=0;o<Ih.length;o++)Pn(Ih[o],i);break;case"source":Pn("error",i);break;case"img":case"image":case"link":Pn("error",i),Pn("load",i);break;case"details":Pn("toggle",i);break;case"input":m1(i,u),Pn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!u.multiple},Pn("invalid",i);break;case"textarea":_1(i,u),Pn("invalid",i)}ty(n,u),o=null;for(var f in u)if(u.hasOwnProperty(f)){var l=u[f];f==="children"?typeof l=="string"?i.textContent!==l&&(u.suppressHydrationWarning!==!0&&jf(i.textContent,l,t),o=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(u.suppressHydrationWarning!==!0&&jf(i.textContent,l,t),o=["children",""+l]):Gh.hasOwnProperty(f)&&l!=null&&f==="onScroll"&&Pn("scroll",i)}switch(n){case"input":Df(i),g1(i,u,!0);break;case"textarea":Df(i),y1(i);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(i.onclick=Dp)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{f=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=KE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=f.createElement(n,{is:i.is}):(t=f.createElement(n),n==="select"&&(f=t,i.multiple?f.multiple=!0:i.size&&(f.size=i.size))):t=f.createElementNS(t,n),t[ao]=e,t[Qh]=i,w2(t,e,!1,!1),e.stateNode=t;e:{switch(f=ny(n,i),n){case"dialog":Pn("cancel",t),Pn("close",t),o=i;break;case"iframe":case"object":case"embed":Pn("load",t),o=i;break;case"video":case"audio":for(o=0;o<Ih.length;o++)Pn(Ih[o],t);o=i;break;case"source":Pn("error",t),o=i;break;case"img":case"image":case"link":Pn("error",t),Pn("load",t),o=i;break;case"details":Pn("toggle",t),o=i;break;case"input":m1(t,i),o=Y_(t,i),Pn("invalid",t);break;case"option":o=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},o=Vn({},i,{value:void 0}),Pn("invalid",t);break;case"textarea":_1(t,i),o=Q_(t,i),Pn("invalid",t);break;default:o=i}ty(n,o),l=o;for(u in l)if(l.hasOwnProperty(u)){var b=l[u];u==="style"?eT(t,b):u==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&JE(t,b)):u==="children"?typeof b=="string"?(n!=="textarea"||b!=="")&&$h(t,b):typeof b=="number"&&$h(t,""+b):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Gh.hasOwnProperty(u)?b!=null&&u==="onScroll"&&Pn("scroll",t):b!=null&&b0(t,u,b,f))}switch(n){case"input":Df(t),g1(t,i,!1);break;case"textarea":Df(t),y1(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Ua(i.value));break;case"select":t.multiple=!!i.multiple,u=i.value,u!=null?Vc(t,!!i.multiple,u,!1):i.defaultValue!=null&&Vc(t,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=Dp)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yi(e),null;case 6:if(t&&e.stateNode!=null)T2(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ve(166));if(n=Al(td.current),Al(fo.current),Gf(e)){if(i=e.stateNode,n=e.memoizedProps,i[ao]=e,(u=i.nodeValue!==n)&&(t=Yr,t!==null))switch(t.tag){case 3:jf(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&jf(i.nodeValue,n,(t.mode&1)!==0)}u&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ao]=e,e.stateNode=i}return Yi(e),null;case 13:if(Cn(Nn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dn&&Zr!==null&&e.mode&1&&!(e.flags&128))VT(),Kc(),e.flags|=98560,u=!1;else if(u=Gf(e),i!==null&&i.dehydrated!==null){if(t===null){if(!u)throw Error(Ve(318));if(u=e.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Ve(317));u[ao]=e}else Kc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yi(e),u=!1}else zs!==null&&(Oy(zs),zs=null),u=!0;if(!u)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Nn.current&1?_i===0&&(_i=3):iv())),e.updateQueue!==null&&(e.flags|=4),Yi(e),null);case 4:return Qc(),Py(t,e),t===null&&Kh(e.stateNode.containerInfo),Yi(e),null;case 10:return U0(e.type._context),Yi(e),null;case 17:return Pr(e.type)&&zp(),Yi(e),null;case 19:if(Cn(Nn),u=e.memoizedState,u===null)return Yi(e),null;if(i=(e.flags&128)!==0,f=u.rendering,f===null)if(i)ph(u,!1);else{if(_i!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(f=jp(t),f!==null){for(e.flags|=128,ph(u,!1),i=f.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)u=n,t=i,u.flags&=14680066,f=u.alternate,f===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,t=f.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return An(Nn,Nn.current&1|2),e.child}t=t.sibling}u.tail!==null&&ei()>tu&&(e.flags|=128,i=!0,ph(u,!1),e.lanes=4194304)}else{if(!i)if(t=jp(f),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ph(u,!0),u.tail===null&&u.tailMode==="hidden"&&!f.alternate&&!Dn)return Yi(e),null}else 2*ei()-u.renderingStartTime>tu&&n!==1073741824&&(e.flags|=128,i=!0,ph(u,!1),e.lanes=4194304);u.isBackwards?(f.sibling=e.child,e.child=f):(n=u.last,n!==null?n.sibling=f:e.child=f,u.last=f)}return u.tail!==null?(e=u.tail,u.rendering=e,u.tail=e.sibling,u.renderingStartTime=ei(),e.sibling=null,n=Nn.current,An(Nn,i?n&1|2:n&1),e):(Yi(e),null);case 22:case 23:return nv(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Hr&1073741824&&(Yi(e),e.subtreeFlags&6&&(e.flags|=8192)):Yi(e),null;case 24:return null;case 25:return null}throw Error(Ve(156,e.tag))}function MM(t,e){switch(O0(e),e.tag){case 1:return Pr(e.type)&&zp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Qc(),Cn(Ir),Cn(tr),H0(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $0(e),null;case 13:if(Cn(Nn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ve(340));Kc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Cn(Nn),null;case 4:return Qc(),null;case 10:return U0(e.type._context),null;case 22:case 23:return nv(),null;case 24:return null;default:return null}}var Wf=!1,Qi=!1,kM=typeof WeakSet=="function"?WeakSet:Set,pt=null;function Fc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){qn(t,e,i)}else n.current=null}function Cy(t,e,n){try{n()}catch(i){qn(t,e,i)}}var ab=!1;function LM(t,e){if(dy=kp,t=PT(),D0(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var o=i.anchorOffset,u=i.focusNode;i=i.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var f=0,l=-1,b=-1,w=0,M=0,L=t,C=null;t:for(;;){for(var W;L!==n||o!==0&&L.nodeType!==3||(l=f+o),L!==u||i!==0&&L.nodeType!==3||(b=f+i),L.nodeType===3&&(f+=L.nodeValue.length),(W=L.firstChild)!==null;)C=L,L=W;for(;;){if(L===t)break t;if(C===n&&++w===o&&(l=f),C===u&&++M===i&&(b=f),(W=L.nextSibling)!==null)break;L=C,C=L.parentNode}L=W}n=l===-1||b===-1?null:{start:l,end:b}}else n=null}n=n||{start:0,end:0}}else n=null;for(fy={focusedElem:t,selectionRange:n},kp=!1,pt=e;pt!==null;)if(e=pt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pt=t;else for(;pt!==null;){e=pt;try{var Q=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Q!==null){var ne=Q.memoizedProps,_e=Q.memoizedState,K=e.stateNode,$=K.getSnapshotBeforeUpdate(e.elementType===e.type?ne:Rs(e.type,ne),_e);K.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var J=e.stateNode.containerInfo;J.nodeType===1?J.textContent="":J.nodeType===9&&J.documentElement&&J.removeChild(J.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ve(163))}}catch(pe){qn(e,e.return,pe)}if(t=e.sibling,t!==null){t.return=e.return,pt=t;break}pt=e.return}return Q=ab,ab=!1,Q}function Oh(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var u=o.destroy;o.destroy=void 0,u!==void 0&&Cy(e,n,u)}o=o.next}while(o!==i)}}function Em(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function My(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function S2(t){var e=t.alternate;e!==null&&(t.alternate=null,S2(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ao],delete e[Qh],delete e[gy],delete e[pM],delete e[mM])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function A2(t){return t.tag===5||t.tag===3||t.tag===4}function lb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||A2(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ky(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Dp));else if(i!==4&&(t=t.child,t!==null))for(ky(t,e,n),t=t.sibling;t!==null;)ky(t,e,n),t=t.sibling}function Ly(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Ly(t,e,n),t=t.sibling;t!==null;)Ly(t,e,n),t=t.sibling}var Fi=null,Ds=!1;function ga(t,e,n){for(n=n.child;n!==null;)I2(t,e,n),n=n.sibling}function I2(t,e,n){if(ho&&typeof ho.onCommitFiberUnmount=="function")try{ho.onCommitFiberUnmount(mm,n)}catch{}switch(n.tag){case 5:Qi||Fc(n,e);case 6:var i=Fi,o=Ds;Fi=null,ga(t,e,n),Fi=i,Ds=o,Fi!==null&&(Ds?(t=Fi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Fi.removeChild(n.stateNode));break;case 18:Fi!==null&&(Ds?(t=Fi,n=n.stateNode,t.nodeType===8?r_(t.parentNode,n):t.nodeType===1&&r_(t,n),Zh(t)):r_(Fi,n.stateNode));break;case 4:i=Fi,o=Ds,Fi=n.stateNode.containerInfo,Ds=!0,ga(t,e,n),Fi=i,Ds=o;break;case 0:case 11:case 14:case 15:if(!Qi&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var u=o,f=u.destroy;u=u.tag,f!==void 0&&(u&2||u&4)&&Cy(n,e,f),o=o.next}while(o!==i)}ga(t,e,n);break;case 1:if(!Qi&&(Fc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){qn(n,e,l)}ga(t,e,n);break;case 21:ga(t,e,n);break;case 22:n.mode&1?(Qi=(i=Qi)||n.memoizedState!==null,ga(t,e,n),Qi=i):ga(t,e,n);break;default:ga(t,e,n)}}function cb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new kM),e.forEach(function(i){var o=VM.bind(null,t,i);n.has(i)||(n.add(i),i.then(o,o))})}}function Ls(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];try{var u=t,f=e,l=f;e:for(;l!==null;){switch(l.tag){case 5:Fi=l.stateNode,Ds=!1;break e;case 3:Fi=l.stateNode.containerInfo,Ds=!0;break e;case 4:Fi=l.stateNode.containerInfo,Ds=!0;break e}l=l.return}if(Fi===null)throw Error(Ve(160));I2(u,f,o),Fi=null,Ds=!1;var b=o.alternate;b!==null&&(b.return=null),o.return=null}catch(w){qn(o,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)P2(e,t),e=e.sibling}function P2(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ls(e,t),no(t),i&4){try{Oh(3,t,t.return),Em(3,t)}catch(ne){qn(t,t.return,ne)}try{Oh(5,t,t.return)}catch(ne){qn(t,t.return,ne)}}break;case 1:Ls(e,t),no(t),i&512&&n!==null&&Fc(n,n.return);break;case 5:if(Ls(e,t),no(t),i&512&&n!==null&&Fc(n,n.return),t.flags&32){var o=t.stateNode;try{$h(o,"")}catch(ne){qn(t,t.return,ne)}}if(i&4&&(o=t.stateNode,o!=null)){var u=t.memoizedProps,f=n!==null?n.memoizedProps:u,l=t.type,b=t.updateQueue;if(t.updateQueue=null,b!==null)try{l==="input"&&u.type==="radio"&&u.name!=null&&XE(o,u),ny(l,f);var w=ny(l,u);for(f=0;f<b.length;f+=2){var M=b[f],L=b[f+1];M==="style"?eT(o,L):M==="dangerouslySetInnerHTML"?JE(o,L):M==="children"?$h(o,L):b0(o,M,L,w)}switch(l){case"input":K_(o,u);break;case"textarea":YE(o,u);break;case"select":var C=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!u.multiple;var W=u.value;W!=null?Vc(o,!!u.multiple,W,!1):C!==!!u.multiple&&(u.defaultValue!=null?Vc(o,!!u.multiple,u.defaultValue,!0):Vc(o,!!u.multiple,u.multiple?[]:"",!1))}o[Qh]=u}catch(ne){qn(t,t.return,ne)}}break;case 6:if(Ls(e,t),no(t),i&4){if(t.stateNode===null)throw Error(Ve(162));o=t.stateNode,u=t.memoizedProps;try{o.nodeValue=u}catch(ne){qn(t,t.return,ne)}}break;case 3:if(Ls(e,t),no(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Zh(e.containerInfo)}catch(ne){qn(t,t.return,ne)}break;case 4:Ls(e,t),no(t);break;case 13:Ls(e,t),no(t),o=t.child,o.flags&8192&&(u=o.memoizedState!==null,o.stateNode.isHidden=u,!u||o.alternate!==null&&o.alternate.memoizedState!==null||(ev=ei())),i&4&&cb(t);break;case 22:if(M=n!==null&&n.memoizedState!==null,t.mode&1?(Qi=(w=Qi)||M,Ls(e,t),Qi=w):Ls(e,t),no(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!M&&t.mode&1)for(pt=t,M=t.child;M!==null;){for(L=pt=M;pt!==null;){switch(C=pt,W=C.child,C.tag){case 0:case 11:case 14:case 15:Oh(4,C,C.return);break;case 1:Fc(C,C.return);var Q=C.stateNode;if(typeof Q.componentWillUnmount=="function"){i=C,n=C.return;try{e=i,Q.props=e.memoizedProps,Q.state=e.memoizedState,Q.componentWillUnmount()}catch(ne){qn(i,n,ne)}}break;case 5:Fc(C,C.return);break;case 22:if(C.memoizedState!==null){hb(L);continue}}W!==null?(W.return=C,pt=W):hb(L)}M=M.sibling}e:for(M=null,L=t;;){if(L.tag===5){if(M===null){M=L;try{o=L.stateNode,w?(u=o.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(l=L.stateNode,b=L.memoizedProps.style,f=b!=null&&b.hasOwnProperty("display")?b.display:null,l.style.display=QE("display",f))}catch(ne){qn(t,t.return,ne)}}}else if(L.tag===6){if(M===null)try{L.stateNode.nodeValue=w?"":L.memoizedProps}catch(ne){qn(t,t.return,ne)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===t)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===t)break e;for(;L.sibling===null;){if(L.return===null||L.return===t)break e;M===L&&(M=null),L=L.return}M===L&&(M=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Ls(e,t),no(t),i&4&&cb(t);break;case 21:break;default:Ls(e,t),no(t)}}function no(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(A2(n)){var i=n;break e}n=n.return}throw Error(Ve(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&($h(o,""),i.flags&=-33);var u=lb(t);Ly(t,u,o);break;case 3:case 4:var f=i.stateNode.containerInfo,l=lb(t);ky(t,l,f);break;default:throw Error(Ve(161))}}catch(b){qn(t,t.return,b)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function RM(t,e,n){pt=t,C2(t)}function C2(t,e,n){for(var i=(t.mode&1)!==0;pt!==null;){var o=pt,u=o.child;if(o.tag===22&&i){var f=o.memoizedState!==null||Wf;if(!f){var l=o.alternate,b=l!==null&&l.memoizedState!==null||Qi;l=Wf;var w=Qi;if(Wf=f,(Qi=b)&&!w)for(pt=o;pt!==null;)f=pt,b=f.child,f.tag===22&&f.memoizedState!==null?db(o):b!==null?(b.return=f,pt=b):db(o);for(;u!==null;)pt=u,C2(u),u=u.sibling;pt=o,Wf=l,Qi=w}ub(t)}else o.subtreeFlags&8772&&u!==null?(u.return=o,pt=u):ub(t)}}function ub(t){for(;pt!==null;){var e=pt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qi||Em(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Qi)if(n===null)i.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:Rs(e.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var u=e.updateQueue;u!==null&&q1(e,u,i);break;case 3:var f=e.updateQueue;if(f!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}q1(e,f,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var b=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&n.focus();break;case"img":b.src&&(n.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var M=w.memoizedState;if(M!==null){var L=M.dehydrated;L!==null&&Zh(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ve(163))}Qi||e.flags&512&&My(e)}catch(C){qn(e,e.return,C)}}if(e===t){pt=null;break}if(n=e.sibling,n!==null){n.return=e.return,pt=n;break}pt=e.return}}function hb(t){for(;pt!==null;){var e=pt;if(e===t){pt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,pt=n;break}pt=e.return}}function db(t){for(;pt!==null;){var e=pt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Em(4,e)}catch(b){qn(e,n,b)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(b){qn(e,o,b)}}var u=e.return;try{My(e)}catch(b){qn(e,u,b)}break;case 5:var f=e.return;try{My(e)}catch(b){qn(e,f,b)}}}catch(b){qn(e,e.return,b)}if(e===t){pt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,pt=l;break}pt=e.return}}var DM=Math.ceil,Hp=qo.ReactCurrentDispatcher,J0=qo.ReactCurrentOwner,vs=qo.ReactCurrentBatchConfig,on=0,Pi=null,ui=null,Ni=0,Hr=0,Bc=$a(0),_i=0,sd=null,Dl=0,Tm=0,Q0=0,Fh=null,Sr=null,ev=0,tu=1/0,Ro=null,Wp=!1,Ry=null,za=null,qf=!1,Ia=null,qp=0,Bh=0,Dy=null,gp=-1,_p=0;function mr(){return on&6?ei():gp!==-1?gp:gp=ei()}function Oa(t){return t.mode&1?on&2&&Ni!==0?Ni&-Ni:_M.transition!==null?(_p===0&&(_p=dT()),_p):(t=pn,t!==0||(t=window.event,t=t===void 0?16:vT(t.type)),t):1}function Bs(t,e,n,i){if(50<Bh)throw Bh=0,Dy=null,Error(Ve(185));pd(t,n,i),(!(on&2)||t!==Pi)&&(t===Pi&&(!(on&2)&&(Tm|=n),_i===4&&Sa(t,Ni)),Cr(t,i),n===1&&on===0&&!(e.mode&1)&&(tu=ei()+500,xm&&Ha()))}function Cr(t,e){var n=t.callbackNode;_C(t,e);var i=Mp(t,t===Pi?Ni:0);if(i===0)n!==null&&b1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&b1(n),e===1)t.tag===0?gM(fb.bind(null,t)):BT(fb.bind(null,t)),dM(function(){!(on&6)&&Ha()}),n=null;else{switch(fT(i)){case 1:n=A0;break;case 4:n=uT;break;case 16:n=Cp;break;case 536870912:n=hT;break;default:n=Cp}n=F2(n,M2.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function M2(t,e){if(gp=-1,_p=0,on&6)throw Error(Ve(327));var n=t.callbackNode;if(Wc()&&t.callbackNode!==n)return null;var i=Mp(t,t===Pi?Ni:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Zp(t,i);else{e=i;var o=on;on|=2;var u=L2();(Pi!==t||Ni!==e)&&(Ro=null,tu=ei()+500,Pl(t,e));do try{FM();break}catch(l){k2(t,l)}while(1);N0(),Hp.current=u,on=o,ui!==null?e=0:(Pi=null,Ni=0,e=_i)}if(e!==0){if(e===2&&(o=ay(t),o!==0&&(i=o,e=zy(t,o))),e===1)throw n=sd,Pl(t,0),Sa(t,i),Cr(t,ei()),n;if(e===6)Sa(t,i);else{if(o=t.current.alternate,!(i&30)&&!zM(o)&&(e=Zp(t,i),e===2&&(u=ay(t),u!==0&&(i=u,e=zy(t,u))),e===1))throw n=sd,Pl(t,0),Sa(t,i),Cr(t,ei()),n;switch(t.finishedWork=o,t.finishedLanes=i,e){case 0:case 1:throw Error(Ve(345));case 2:wl(t,Sr,Ro);break;case 3:if(Sa(t,i),(i&130023424)===i&&(e=ev+500-ei(),10<e)){if(Mp(t,0)!==0)break;if(o=t.suspendedLanes,(o&i)!==i){mr(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=my(wl.bind(null,t,Sr,Ro),e);break}wl(t,Sr,Ro);break;case 4:if(Sa(t,i),(i&4194240)===i)break;for(e=t.eventTimes,o=-1;0<i;){var f=31-Fs(i);u=1<<f,f=e[f],f>o&&(o=f),i&=~u}if(i=o,i=ei()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*DM(i/1960))-i,10<i){t.timeoutHandle=my(wl.bind(null,t,Sr,Ro),i);break}wl(t,Sr,Ro);break;case 5:wl(t,Sr,Ro);break;default:throw Error(Ve(329))}}}return Cr(t,ei()),t.callbackNode===n?M2.bind(null,t):null}function zy(t,e){var n=Fh;return t.current.memoizedState.isDehydrated&&(Pl(t,e).flags|=256),t=Zp(t,e),t!==2&&(e=Sr,Sr=n,e!==null&&Oy(e)),t}function Oy(t){Sr===null?Sr=t:Sr.push.apply(Sr,t)}function zM(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var o=n[i],u=o.getSnapshot;o=o.value;try{if(!Us(u(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Sa(t,e){for(e&=~Q0,e&=~Tm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fs(e),i=1<<n;t[n]=-1,e&=~i}}function fb(t){if(on&6)throw Error(Ve(327));Wc();var e=Mp(t,0);if(!(e&1))return Cr(t,ei()),null;var n=Zp(t,e);if(t.tag!==0&&n===2){var i=ay(t);i!==0&&(e=i,n=zy(t,i))}if(n===1)throw n=sd,Pl(t,0),Sa(t,e),Cr(t,ei()),n;if(n===6)throw Error(Ve(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wl(t,Sr,Ro),Cr(t,ei()),null}function tv(t,e){var n=on;on|=1;try{return t(e)}finally{on=n,on===0&&(tu=ei()+500,xm&&Ha())}}function zl(t){Ia!==null&&Ia.tag===0&&!(on&6)&&Wc();var e=on;on|=1;var n=vs.transition,i=pn;try{if(vs.transition=null,pn=1,t)return t()}finally{pn=i,vs.transition=n,on=e,!(on&6)&&Ha()}}function nv(){Hr=Bc.current,Cn(Bc)}function Pl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hM(n)),ui!==null)for(n=ui.return;n!==null;){var i=n;switch(O0(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&zp();break;case 3:Qc(),Cn(Ir),Cn(tr),H0();break;case 5:$0(i);break;case 4:Qc();break;case 13:Cn(Nn);break;case 19:Cn(Nn);break;case 10:U0(i.type._context);break;case 22:case 23:nv()}n=n.return}if(Pi=t,ui=t=Fa(t.current,null),Ni=Hr=e,_i=0,sd=null,Q0=Tm=Dl=0,Sr=Fh=null,Sl!==null){for(e=0;e<Sl.length;e++)if(n=Sl[e],i=n.interleaved,i!==null){n.interleaved=null;var o=i.next,u=n.pending;if(u!==null){var f=u.next;u.next=o,i.next=f}n.pending=i}Sl=null}return t}function k2(t,e){do{var n=ui;try{if(N0(),fp.current=$p,Gp){for(var i=Un.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Gp=!1}if(Rl=0,Ii=gi=Un=null,zh=!1,nd=0,J0.current=null,n===null||n.return===null){_i=1,sd=e,ui=null;break}e:{var u=t,f=n.return,l=n,b=e;if(e=Ni,l.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var w=b,M=l,L=M.tag;if(!(M.mode&1)&&(L===0||L===11||L===15)){var C=M.alternate;C?(M.updateQueue=C.updateQueue,M.memoizedState=C.memoizedState,M.lanes=C.lanes):(M.updateQueue=null,M.memoizedState=null)}var W=eb(f);if(W!==null){W.flags&=-257,tb(W,f,l,u,e),W.mode&1&&Q1(u,w,e),e=W,b=w;var Q=e.updateQueue;if(Q===null){var ne=new Set;ne.add(b),e.updateQueue=ne}else Q.add(b);break e}else{if(!(e&1)){Q1(u,w,e),iv();break e}b=Error(Ve(426))}}else if(Dn&&l.mode&1){var _e=eb(f);if(_e!==null){!(_e.flags&65536)&&(_e.flags|=256),tb(_e,f,l,u,e),F0(eu(b,l));break e}}u=b=eu(b,l),_i!==4&&(_i=2),Fh===null?Fh=[u]:Fh.push(u),u=f;do{switch(u.tag){case 3:u.flags|=65536,e&=-e,u.lanes|=e;var K=p2(u,b,e);W1(u,K);break e;case 1:l=b;var $=u.type,J=u.stateNode;if(!(u.flags&128)&&(typeof $.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(za===null||!za.has(J)))){u.flags|=65536,e&=-e,u.lanes|=e;var pe=m2(u,l,e);W1(u,pe);break e}}u=u.return}while(u!==null)}D2(n)}catch(ye){e=ye,ui===n&&n!==null&&(ui=n=n.return);continue}break}while(1)}function L2(){var t=Hp.current;return Hp.current=$p,t===null?$p:t}function iv(){(_i===0||_i===3||_i===2)&&(_i=4),Pi===null||!(Dl&268435455)&&!(Tm&268435455)||Sa(Pi,Ni)}function Zp(t,e){var n=on;on|=2;var i=L2();(Pi!==t||Ni!==e)&&(Ro=null,Pl(t,e));do try{OM();break}catch(o){k2(t,o)}while(1);if(N0(),on=n,Hp.current=i,ui!==null)throw Error(Ve(261));return Pi=null,Ni=0,_i}function OM(){for(;ui!==null;)R2(ui)}function FM(){for(;ui!==null&&!lC();)R2(ui)}function R2(t){var e=O2(t.alternate,t,Hr);t.memoizedProps=t.pendingProps,e===null?D2(t):ui=e,J0.current=null}function D2(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=MM(n,e),n!==null){n.flags&=32767,ui=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_i=6,ui=null;return}}else if(n=CM(n,e,Hr),n!==null){ui=n;return}if(e=e.sibling,e!==null){ui=e;return}ui=e=t}while(e!==null);_i===0&&(_i=5)}function wl(t,e,n){var i=pn,o=vs.transition;try{vs.transition=null,pn=1,BM(t,e,n,i)}finally{vs.transition=o,pn=i}return null}function BM(t,e,n,i){do Wc();while(Ia!==null);if(on&6)throw Error(Ve(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ve(177));t.callbackNode=null,t.callbackPriority=0;var u=n.lanes|n.childLanes;if(yC(t,u),t===Pi&&(ui=Pi=null,Ni=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||qf||(qf=!0,F2(Cp,function(){return Wc(),null})),u=(n.flags&15990)!==0,n.subtreeFlags&15990||u){u=vs.transition,vs.transition=null;var f=pn;pn=1;var l=on;on|=4,J0.current=null,LM(t,n),P2(n,t),rM(fy),kp=!!dy,fy=dy=null,t.current=n,RM(n),cC(),on=l,pn=f,vs.transition=u}else t.current=n;if(qf&&(qf=!1,Ia=t,qp=o),u=t.pendingLanes,u===0&&(za=null),dC(n.stateNode),Cr(t,ei()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(Wp)throw Wp=!1,t=Ry,Ry=null,t;return qp&1&&t.tag!==0&&Wc(),u=t.pendingLanes,u&1?t===Dy?Bh++:(Bh=0,Dy=t):Bh=0,Ha(),null}function Wc(){if(Ia!==null){var t=fT(qp),e=vs.transition,n=pn;try{if(vs.transition=null,pn=16>t?16:t,Ia===null)var i=!1;else{if(t=Ia,Ia=null,qp=0,on&6)throw Error(Ve(331));var o=on;for(on|=4,pt=t.current;pt!==null;){var u=pt,f=u.child;if(pt.flags&16){var l=u.deletions;if(l!==null){for(var b=0;b<l.length;b++){var w=l[b];for(pt=w;pt!==null;){var M=pt;switch(M.tag){case 0:case 11:case 15:Oh(8,M,u)}var L=M.child;if(L!==null)L.return=M,pt=L;else for(;pt!==null;){M=pt;var C=M.sibling,W=M.return;if(S2(M),M===w){pt=null;break}if(C!==null){C.return=W,pt=C;break}pt=W}}}var Q=u.alternate;if(Q!==null){var ne=Q.child;if(ne!==null){Q.child=null;do{var _e=ne.sibling;ne.sibling=null,ne=_e}while(ne!==null)}}pt=u}}if(u.subtreeFlags&2064&&f!==null)f.return=u,pt=f;else e:for(;pt!==null;){if(u=pt,u.flags&2048)switch(u.tag){case 0:case 11:case 15:Oh(9,u,u.return)}var K=u.sibling;if(K!==null){K.return=u.return,pt=K;break e}pt=u.return}}var $=t.current;for(pt=$;pt!==null;){f=pt;var J=f.child;if(f.subtreeFlags&2064&&J!==null)J.return=f,pt=J;else e:for(f=$;pt!==null;){if(l=pt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Em(9,l)}}catch(ye){qn(l,l.return,ye)}if(l===f){pt=null;break e}var pe=l.sibling;if(pe!==null){pe.return=l.return,pt=pe;break e}pt=l.return}}if(on=o,Ha(),ho&&typeof ho.onPostCommitFiberRoot=="function")try{ho.onPostCommitFiberRoot(mm,t)}catch{}i=!0}return i}finally{pn=n,vs.transition=e}}return!1}function pb(t,e,n){e=eu(n,e),e=p2(t,e,1),t=Da(t,e,1),e=mr(),t!==null&&(pd(t,1,e),Cr(t,e))}function qn(t,e,n){if(t.tag===3)pb(t,t,n);else for(;e!==null;){if(e.tag===3){pb(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(za===null||!za.has(i))){t=eu(n,t),t=m2(e,t,1),e=Da(e,t,1),t=mr(),e!==null&&(pd(e,1,t),Cr(e,t));break}}e=e.return}}function NM(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=mr(),t.pingedLanes|=t.suspendedLanes&n,Pi===t&&(Ni&n)===n&&(_i===4||_i===3&&(Ni&130023424)===Ni&&500>ei()-ev?Pl(t,0):Q0|=n),Cr(t,e)}function z2(t,e){e===0&&(t.mode&1?(e=Ff,Ff<<=1,!(Ff&130023424)&&(Ff=4194304)):e=1);var n=mr();t=jo(t,e),t!==null&&(pd(t,e,n),Cr(t,n))}function UM(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),z2(t,n)}function VM(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ve(314))}i!==null&&i.delete(e),z2(t,n)}var O2;O2=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ir.current)Ar=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ar=!1,PM(t,e,n);Ar=!!(t.flags&131072)}else Ar=!1,Dn&&e.flags&1048576&&NT(e,Bp,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;mp(t,e),t=e.pendingProps;var o=Yc(e,tr.current);Hc(e,n),o=q0(null,e,i,t,o,n);var u=Z0();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Pr(i)?(u=!0,Op(e)):u=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,j0(e),o.updater=bm,e.stateNode=o,o._reactInternals=e,wy(e,i,t,n),e=Sy(null,e,i,!0,u,n)):(e.tag=0,Dn&&u&&z0(e),fr(null,e,o,n),e=e.child),e;case 16:i=e.elementType;e:{switch(mp(t,e),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=GM(i),t=Rs(i,t),o){case 0:e=Ty(null,e,i,t,n);break e;case 1:e=rb(null,e,i,t,n);break e;case 11:e=nb(null,e,i,t,n);break e;case 14:e=ib(null,e,i,Rs(i.type,t),n);break e}throw Error(Ve(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),Ty(t,e,i,o,n);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),rb(t,e,i,o,n);case 3:e:{if(v2(e),t===null)throw Error(Ve(387));i=e.pendingProps,u=e.memoizedState,o=u.element,GT(t,e),Vp(e,i,null,n);var f=e.memoizedState;if(i=f.element,u.isDehydrated)if(u={element:i,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=u,e.memoizedState=u,e.flags&256){o=eu(Error(Ve(423)),e),e=sb(t,e,i,n,o);break e}else if(i!==o){o=eu(Error(Ve(424)),e),e=sb(t,e,i,n,o);break e}else for(Zr=Ra(e.stateNode.containerInfo.firstChild),Yr=e,Dn=!0,zs=null,n=qT(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Kc(),i===o){e=Go(t,e,n);break e}fr(t,e,i,n)}e=e.child}return e;case 5:return ZT(e),t===null&&vy(e),i=e.type,o=e.pendingProps,u=t!==null?t.memoizedProps:null,f=o.children,py(i,o)?f=null:u!==null&&py(i,u)&&(e.flags|=32),y2(t,e),fr(t,e,f,n),e.child;case 6:return t===null&&vy(e),null;case 13:return x2(t,e,n);case 4:return G0(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Jc(e,null,i,n):fr(t,e,i,n),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),nb(t,e,i,o,n);case 7:return fr(t,e,e.pendingProps,n),e.child;case 8:return fr(t,e,e.pendingProps.children,n),e.child;case 12:return fr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,u=e.memoizedProps,f=o.value,An(Np,i._currentValue),i._currentValue=f,u!==null)if(Us(u.value,f)){if(u.children===o.children&&!Ir.current){e=Go(t,e,n);break e}}else for(u=e.child,u!==null&&(u.return=e);u!==null;){var l=u.dependencies;if(l!==null){f=u.child;for(var b=l.firstContext;b!==null;){if(b.context===i){if(u.tag===1){b=No(-1,n&-n),b.tag=2;var w=u.updateQueue;if(w!==null){w=w.shared;var M=w.pending;M===null?b.next=b:(b.next=M.next,M.next=b),w.pending=b}}u.lanes|=n,b=u.alternate,b!==null&&(b.lanes|=n),xy(u.return,n,e),l.lanes|=n;break}b=b.next}}else if(u.tag===10)f=u.type===e.type?null:u.child;else if(u.tag===18){if(f=u.return,f===null)throw Error(Ve(341));f.lanes|=n,l=f.alternate,l!==null&&(l.lanes|=n),xy(f,n,e),f=u.sibling}else f=u.child;if(f!==null)f.return=u;else for(f=u;f!==null;){if(f===e){f=null;break}if(u=f.sibling,u!==null){u.return=f.return,f=u;break}f=f.return}u=f}fr(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,Hc(e,n),o=bs(o),i=i(o),e.flags|=1,fr(t,e,i,n),e.child;case 14:return i=e.type,o=Rs(i,e.pendingProps),o=Rs(i.type,o),ib(t,e,i,o,n);case 15:return g2(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),mp(t,e),e.tag=1,Pr(i)?(t=!0,Op(e)):t=!1,Hc(e,n),HT(e,i,o),wy(e,i,o,n),Sy(null,e,i,!0,t,n);case 19:return b2(t,e,n);case 22:return _2(t,e,n)}throw Error(Ve(156,e.tag))};function F2(t,e){return cT(t,e)}function jM(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ys(t,e,n,i){return new jM(t,e,n,i)}function rv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function GM(t){if(typeof t=="function")return rv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===E0)return 11;if(t===T0)return 14}return 2}function Fa(t,e){var n=t.alternate;return n===null?(n=ys(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yp(t,e,n,i,o,u){var f=2;if(i=t,typeof t=="function")rv(t)&&(f=1);else if(typeof t=="string")f=5;else e:switch(t){case Pc:return Cl(n.children,o,u,e);case w0:f=8,o|=8;break;case W_:return t=ys(12,n,e,o|2),t.elementType=W_,t.lanes=u,t;case q_:return t=ys(13,n,e,o),t.elementType=q_,t.lanes=u,t;case Z_:return t=ys(19,n,e,o),t.elementType=Z_,t.lanes=u,t;case WE:return Sm(n,o,u,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $E:f=10;break e;case HE:f=9;break e;case E0:f=11;break e;case T0:f=14;break e;case wa:f=16,i=null;break e}throw Error(Ve(130,t==null?t:typeof t,""))}return e=ys(f,n,e,o),e.elementType=t,e.type=i,e.lanes=u,e}function Cl(t,e,n,i){return t=ys(7,t,i,e),t.lanes=n,t}function Sm(t,e,n,i){return t=ys(22,t,i,e),t.elementType=WE,t.lanes=n,t.stateNode={isHidden:!1},t}function d_(t,e,n){return t=ys(6,t,null,e),t.lanes=n,t}function f_(t,e,n){return e=ys(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $M(t,e,n,i,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qg(0),this.expirationTimes=qg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qg(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function sv(t,e,n,i,o,u,f,l,b){return t=new $M(t,e,n,l,b),e===1?(e=1,u===!0&&(e|=8)):e=0,u=ys(3,null,null,e),t.current=u,u.stateNode=t,u.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},j0(u),t}function HM(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ic,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function B2(t){if(!t)return Va;t=t._reactInternals;e:{if(Nl(t)!==t||t.tag!==1)throw Error(Ve(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Pr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ve(171))}if(t.tag===1){var n=t.type;if(Pr(n))return FT(t,n,e)}return e}function N2(t,e,n,i,o,u,f,l,b){return t=sv(n,i,!0,t,o,u,f,l,b),t.context=B2(null),n=t.current,i=mr(),o=Oa(n),u=No(i,o),u.callback=e??null,Da(n,u,o),t.current.lanes=o,pd(t,o,i),Cr(t,i),t}function Am(t,e,n,i){var o=e.current,u=mr(),f=Oa(o);return n=B2(n),e.context===null?e.context=n:e.pendingContext=n,e=No(u,f),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Da(o,e,f),t!==null&&(Bs(t,o,f,u),dp(t,o,f)),f}function Xp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function mb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ov(t,e){mb(t,e),(t=t.alternate)&&mb(t,e)}function WM(){return null}var U2=typeof reportError=="function"?reportError:function(t){console.error(t)};function av(t){this._internalRoot=t}Im.prototype.render=av.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ve(409));Am(t,e,null,null)};Im.prototype.unmount=av.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;zl(function(){Am(null,t,null,null)}),e[Vo]=null}};function Im(t){this._internalRoot=t}Im.prototype.unstable_scheduleHydration=function(t){if(t){var e=gT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ta.length&&e!==0&&e<Ta[n].priority;n++);Ta.splice(n,0,t),n===0&&yT(t)}};function lv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Pm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function gb(){}function qM(t,e,n,i,o){if(o){if(typeof i=="function"){var u=i;i=function(){var w=Xp(f);u.call(w)}}var f=N2(e,i,t,0,null,!1,!1,"",gb);return t._reactRootContainer=f,t[Vo]=f.current,Kh(t.nodeType===8?t.parentNode:t),zl(),f}for(;o=t.lastChild;)t.removeChild(o);if(typeof i=="function"){var l=i;i=function(){var w=Xp(b);l.call(w)}}var b=sv(t,0,!1,null,null,!1,!1,"",gb);return t._reactRootContainer=b,t[Vo]=b.current,Kh(t.nodeType===8?t.parentNode:t),zl(function(){Am(e,b,n,i)}),b}function Cm(t,e,n,i,o){var u=n._reactRootContainer;if(u){var f=u;if(typeof o=="function"){var l=o;o=function(){var b=Xp(f);l.call(b)}}Am(e,f,t,o)}else f=qM(n,e,t,o,i);return Xp(f)}pT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ah(e.pendingLanes);n!==0&&(I0(e,n|1),Cr(e,ei()),!(on&6)&&(tu=ei()+500,Ha()))}break;case 13:zl(function(){var i=jo(t,1);if(i!==null){var o=mr();Bs(i,t,1,o)}}),ov(t,1)}};P0=function(t){if(t.tag===13){var e=jo(t,134217728);if(e!==null){var n=mr();Bs(e,t,134217728,n)}ov(t,134217728)}};mT=function(t){if(t.tag===13){var e=Oa(t),n=jo(t,e);if(n!==null){var i=mr();Bs(n,t,e,i)}ov(t,e)}};gT=function(){return pn};_T=function(t,e){var n=pn;try{return pn=t,e()}finally{pn=n}};ry=function(t,e,n){switch(e){case"input":if(K_(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var o=vm(i);if(!o)throw Error(Ve(90));ZE(i),K_(i,o)}}}break;case"textarea":YE(t,n);break;case"select":e=n.value,e!=null&&Vc(t,!!n.multiple,e,!1)}};iT=tv;rT=zl;var ZM={usingClientEntryPoint:!1,Events:[gd,Lc,vm,tT,nT,tv]},mh={findFiberByHostInstance:Tl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},XM={bundleType:mh.bundleType,version:mh.version,rendererPackageName:mh.rendererPackageName,rendererConfig:mh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=aT(t),t===null?null:t.stateNode},findFiberByHostInstance:mh.findFiberByHostInstance||WM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zf.isDisabled&&Zf.supportsFiber)try{mm=Zf.inject(XM),ho=Zf}catch{}}es.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZM;es.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lv(e))throw Error(Ve(200));return HM(t,e,null,n)};es.createRoot=function(t,e){if(!lv(t))throw Error(Ve(299));var n=!1,i="",o=U2;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=sv(t,1,!1,null,null,n,!1,i,o),t[Vo]=e.current,Kh(t.nodeType===8?t.parentNode:t),new av(e)};es.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ve(188)):(t=Object.keys(t).join(","),Error(Ve(268,t)));return t=aT(e),t=t===null?null:t.stateNode,t};es.flushSync=function(t){return zl(t)};es.hydrate=function(t,e,n){if(!Pm(e))throw Error(Ve(200));return Cm(null,t,e,!0,n)};es.hydrateRoot=function(t,e,n){if(!lv(t))throw Error(Ve(405));var i=n!=null&&n.hydratedSources||null,o=!1,u="",f=U2;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),e=N2(e,null,t,1,n??null,o,!1,u,f),t[Vo]=e.current,Kh(t),i)for(t=0;t<i.length;t++)n=i[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new Im(e)};es.render=function(t,e,n){if(!Pm(e))throw Error(Ve(200));return Cm(null,t,e,!1,n)};es.unmountComponentAtNode=function(t){if(!Pm(t))throw Error(Ve(40));return t._reactRootContainer?(zl(function(){Cm(null,null,t,!1,function(){t._reactRootContainer=null,t[Vo]=null})}),!0):!1};es.unstable_batchedUpdates=tv;es.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Pm(n))throw Error(Ve(200));if(t==null||t._reactInternals===void 0)throw Error(Ve(38));return Cm(t,e,n,!1,i)};es.version="18.2.0-next-9e3b772b8-20220608";function V2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V2)}catch(t){console.error(t)}}V2(),NE.exports=es;var cv=NE.exports,j2,_b=cv;j2=_b.createRoot,_b.hydrateRoot;const YM="modulepreload",KM=function(t){return"/UA_deminer_IconStyle/"+t},yb={},JM=function(e,n,i){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(u=>{if(u=KM(u),u in yb)return;yb[u]=!0;const f=u.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(!!i)for(let M=o.length-1;M>=0;M--){const L=o[M];if(L.href===u&&(!f||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${l}`))return;const w=document.createElement("link");if(w.rel=f?"stylesheet":YM,f||(w.as="script",w.crossOrigin=""),w.href=u,document.head.appendChild(w),f)return new Promise((M,L)=>{w.addEventListener("load",M),w.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>e()).catch(u=>{const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u})},QM=at.createContext(null);function ek(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,u=Array.isArray(e)?e[1]:e?e.y:0;return n===o&&i===u}function zo(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!zo(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!zo(t[o],e[o]))return!1;return!0}return!1}function tk(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function vb(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();zo(n,i)||e.setProjection(n)}function xb(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function bb(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const o=t.center;t.center=new o.constructor(n.longitude,n.latitude),i=i||o!==t.center}if("zoom"in n){const o=t.zoom;t.zoom=n.zoom,i=i||o!==t.zoom}if("bearing"in n){const o=t.bearing;t.bearing=n.bearing,i=i||o!==t.bearing}if("pitch"in n){const o=t.pitch;t.pitch=n.pitch,i=i||o!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const nk=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wb(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let o=null;"interactive"in i&&(o=Object.assign({},i),delete o.interactive);const u=e[i.ref];if(u){o=o||Object.assign({},i),delete o.ref;for(const f of nk)f in u&&(o[f]=u[f])}return o||i});return{...t,layers:n}}const Eb={version:8,sources:{},layers:[]},Tb={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},p_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Sb={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},ik=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],rk=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class nu{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const u=this.props[Sb[o.type]];u?u(o):o.type==="error"&&console.error(o.error)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const u=this.props[Tb[o.type]];u&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),u(o),delete o.features)},this._onCameraEvent=o=>{if(!this._internalUpdate){const u=this.props[p_[o.type]];u&&u(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const o=this._updateSize(e),u=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||o||u&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=nu.savedMaps.pop();if(!i)return null;const o=i.map,u=o.getContainer();for(n.className=u.className;u.childNodes.length>0;)n.appendChild(u.childNodes[0]);o._container=n;const f=o._resizeObserver;f&&(f.disconnect(),f.observe(n)),i.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:l}=e;return l&&(l.bounds?o.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),o._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=Eb}=n,o={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||sk()||null,container:e,style:wb(i)},u=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[u.longitude||0,u.latitude||0],zoom:u.zoom||0,pitch:u.pitch||0,bearing:u.bearing||0}),n.gl){const M=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=M,n.gl)}const f=new this._MapClass(o);u.padding&&f.setPadding(u.padding),n.cursor&&(f.getCanvas().style.cursor=n.cursor),this._createShadowTransform(f);const l=f._render;f._render=M=>{this._inRender=!0,l.call(f,M),this._inRender=!1};const b=f._renderTaskQueue.run;f._renderTaskQueue.run=M=>{b.call(f._renderTaskQueue,M),this._onBeforeRepaint()},f.on("render",()=>this._onAfterRepaint());const w=f.fire;f.fire=this._fireEvent.bind(this,w),f.on("resize",()=>{this._renderTransform.resize(f.transform.width,f.transform.height)}),f.on("styledata",()=>{this._updateStyleComponents(this.props,{}),vb(f.transform,this._renderTransform)}),f.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const M in Tb)f.on(M,this._onPointerEvent);for(const M in p_)f.on(M,this._onCameraEvent);for(const M in Sb)f.on(M,this._onEvent);this._map=f}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),nu.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=tk(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,o=this._renderTransform,{zoom:u,pitch:f,bearing:l}=o,b=i.isMoving();b&&(o.cameraElevationReference="sea");const w=bb(o,{...xb(i.transform),...e});if(b&&(o.cameraElevationReference="ground"),w&&n){const M=this._deferredEvents;M.move=!0,M.zoom||(M.zoom=u!==o.zoom),M.rotate||(M.rotate=l!==o.bearing),M.pitch||(M.pitch=f!==o.pitch)}return b||bb(i.transform,e),w}_updateSettings(e,n){const i=this._map;let o=!1;for(const u of ik)if(u in e&&!zo(e[u],n[u])){o=!0;const f=i[`set${u[0].toUpperCase()}${u.slice(1)}`];f==null||f.call(i,e[u])}return o}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=Eb,styleDiffing:o=!0}=e,u={diff:o};return"localIdeographFontFamily"in e&&(u.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(wb(i),u),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let o=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!zo(e.light,n.light)&&(o=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!zo(e.fog,n.fog)&&(o=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!zo(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(o=!0,i.setTerrain(e.terrain))),o}_updateHandlers(e,n){var i,o;const u=this._map;let f=!1;for(const l of rk){const b=(i=e[l])!==null&&i!==void 0?i:!0,w=(o=n[l])!==null&&o!==void 0?o:!0;zo(b,w)||(f=!0,b?u[l].enable(b):u[l].disable())}return f}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:o=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:o.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const u=e.type,f=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),b=l.length>0;!b&&f&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,b&&!f&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=u}else this._hoveredFeatures=null}_fireEvent(e,n,i){const o=this._map,u=o.transform,f=typeof n=="string"?n:n.type;return f==="move"&&this._updateViewState(this.props,!1),f in p_&&(typeof n=="object"&&(n.viewState=xb(u)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,n,i),o.transform=u,o):(e.call(o,n,i),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{vb(this._renderTransform,n),e.transform=n}}}nu.savedMaps=[];function sk(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const ok=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function ak(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const o=e.transform;e.transform=t.transform;const u=e.project(i);return e.transform=o,u},unproject:i=>{const o=e.transform;e.transform=t.transform;const u=e.unproject(i);return e.transform=o,u},queryTerrainElevation:(i,o)=>{const u=e.transform;e.transform=t.transform;const f=e.queryTerrainElevation(i,o);return e.transform=u,f},queryRenderedFeatures:(i,o)=>{const u=e.transform;e.transform=t.transform;const f=e.queryRenderedFeatures(i,o);return e.transform=u,f}};for(const i of lk(e))!(i in n)&&!ok.includes(i)&&(n[i]=e[i].bind(e));return n}function lk(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const ck=typeof document<"u"?at.useLayoutEffect:at.useEffect,uk=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function hk(t,e){for(const i of uk)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!1)}const Mm=at.createContext(null);function dk(t,e,n){const i=at.useContext(QM),[o,u]=at.useState(null),f=at.useRef(),{current:l}=at.useRef({mapLib:null,map:null});at.useEffect(()=>{const M=t.mapLib;let L=!0,C;return Promise.resolve(M||n).then(W=>{if(!L)return;if(!W)throw new Error("Invalid mapLib");const Q="Map"in W?W:W.default;if(!Q.Map)throw new Error("Invalid mapLib");if(hk(Q,t),!Q.supported||Q.supported(t))t.reuseMaps&&(C=nu.reuse(t,f.current)),C||(C=new nu(Q.Map,t,f.current)),l.map=ak(C),l.mapLib=Q,u(C),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(W=>{const{onError:Q}=t;Q?Q({type:"error",target:null,originalEvent:null,error:W}):console.error(W)}),()=>{L=!1,C&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?C.recycle():C.destroy())}},[]),ck(()=>{o&&o.setProps(t)}),at.useImperativeHandle(e,()=>l.map,[o]);const b=at.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return at.createElement("div",{id:t.id,ref:f,style:b},o&&at.createElement(Mm.Provider,{value:l},at.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const fk=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ul(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const o=e[i];Number.isFinite(o)&&!fk.test(i)?n[i]=`${o}px`:n[i]=o}}function pk(t,e){const{map:n,mapLib:i}=at.useContext(Mm),o=at.useRef({props:t});o.current.props=t;const u=at.useMemo(()=>{let ne=!1;at.Children.forEach(t.children,$=>{$&&(ne=!0)});const _e={...t,element:ne?document.createElement("div"):null},K=new i.Marker(_e);return K.setLngLat([t.longitude,t.latitude]),K.getElement().addEventListener("click",$=>{var J,pe;(pe=(J=o.current.props).onClick)===null||pe===void 0||pe.call(J,{type:"click",target:K,originalEvent:$})}),K.on("dragstart",$=>{var J,pe;const ye=$;ye.lngLat=u.getLngLat(),(pe=(J=o.current.props).onDragStart)===null||pe===void 0||pe.call(J,ye)}),K.on("drag",$=>{var J,pe;const ye=$;ye.lngLat=u.getLngLat(),(pe=(J=o.current.props).onDrag)===null||pe===void 0||pe.call(J,ye)}),K.on("dragend",$=>{var J,pe;const ye=$;ye.lngLat=u.getLngLat(),(pe=(J=o.current.props).onDragEnd)===null||pe===void 0||pe.call(J,ye)}),K},[]);at.useEffect(()=>(u.addTo(n.getMap()),()=>{u.remove()}),[]);const{longitude:f,latitude:l,offset:b,style:w,draggable:M=!1,popup:L=null,rotation:C=0,rotationAlignment:W="auto",pitchAlignment:Q="auto"}=t;return at.useEffect(()=>{Ul(u.getElement(),w)},[w]),at.useImperativeHandle(e,()=>u,[]),(u.getLngLat().lng!==f||u.getLngLat().lat!==l)&&u.setLngLat([f,l]),b&&!ek(u.getOffset(),b)&&u.setOffset(b),u.isDraggable()!==M&&u.setDraggable(M),u.getRotation()!==C&&u.setRotation(C),u.getRotationAlignment()!==W&&u.setRotationAlignment(W),u.getPitchAlignment()!==Q&&u.setPitchAlignment(Q),u.getPopup()!==L&&u.setPopup(L),cv.createPortal(t.children,u.getElement())}at.memo(at.forwardRef(pk));function Ab(t){return new Set(t?t.trim().split(/\s+/):[])}function mk(t,e){const{map:n,mapLib:i}=at.useContext(Mm),o=at.useMemo(()=>document.createElement("div"),[]),u=at.useRef({props:t});u.current.props=t;const f=at.useMemo(()=>{const l={...t},b=new i.Popup(l);return b.setLngLat([t.longitude,t.latitude]),b.once("open",w=>{var M,L;(L=(M=u.current.props).onOpen)===null||L===void 0||L.call(M,w)}),b},[]);if(at.useEffect(()=>{const l=b=>{var w,M;(M=(w=u.current.props).onClose)===null||M===void 0||M.call(w,b)};return f.on("close",l),f.setDOMContent(o).addTo(n.getMap()),()=>{f.off("close",l),f.isOpen()&&f.remove()}},[]),at.useEffect(()=>{Ul(f.getElement(),t.style)},[t.style]),at.useImperativeHandle(e,()=>f,[]),f.isOpen()&&((f.getLngLat().lng!==t.longitude||f.getLngLat().lat!==t.latitude)&&f.setLngLat([t.longitude,t.latitude]),t.offset&&!zo(f.options.offset,t.offset)&&f.setOffset(t.offset),(f.options.anchor!==t.anchor||f.options.maxWidth!==t.maxWidth)&&(f.options.anchor=t.anchor,f.setMaxWidth(t.maxWidth)),f.options.className!==t.className)){const l=Ab(f.options.className),b=Ab(t.className);for(const w of l)b.has(w)||f.removeClassName(w);for(const w of b)l.has(w)||f.addClassName(w);f.options.className=t.className}return cv.createPortal(t.children,o)}at.memo(at.forwardRef(mk));function yd(t,e,n,i){const o=at.useContext(Mm),u=at.useMemo(()=>t(o),[]);return at.useEffect(()=>{const f=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,b=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=o;return w.hasControl(u)||(w.addControl(u,f==null?void 0:f.position),l&&l(o)),()=>{b&&b(o),w.hasControl(u)&&w.removeControl(u)}},[]),u}function gk(t){const e=yd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return at.useEffect(()=>{Ul(e._container,t.style)},[t.style]),null}at.memo(gk);function _k(t){const e=yd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return at.useEffect(()=>{Ul(e._controlContainer,t.style)},[t.style]),null}at.memo(_k);function yk(t,e){const n=at.useRef({props:t}),i=yd(({mapLib:o})=>{const u=new o.GeolocateControl(t),f=u._setupUI;return u._setupUI=l=>{u._container.hasChildNodes()||f(l)},u.on("geolocate",l=>{var b,w;(w=(b=n.current.props).onGeolocate)===null||w===void 0||w.call(b,l)}),u.on("error",l=>{var b,w;(w=(b=n.current.props).onError)===null||w===void 0||w.call(b,l)}),u.on("outofmaxbounds",l=>{var b,w;(w=(b=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(b,l)}),u.on("trackuserlocationstart",l=>{var b,w;(w=(b=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(b,l)}),u.on("trackuserlocationend",l=>{var b,w;(w=(b=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(b,l)}),u},{position:t.position});return n.current.props=t,at.useImperativeHandle(e,()=>i,[]),at.useEffect(()=>{Ul(i._container,t.style)},[t.style]),null}at.memo(at.forwardRef(yk));function vk(t){const e=yd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return at.useEffect(()=>{Ul(e._container,t.style)},[t.style]),null}at.memo(vk);function xk(t){const e=yd(({mapLib:u})=>new u.ScaleControl(t),{position:t.position}),n=at.useRef(t),i=n.current;n.current=t;const{style:o}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),at.useEffect(()=>{Ul(e._container,o)},[o]),null}at.memo(xk);const bk=JM(()=>import("./mapbox-gl-485233de.js").then(t=>t.m),[]),wk=(()=>at.forwardRef(function(e,n){return dk(e,n,bk)}))();var G2={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(SP,function(){var n,i,o;function u(l,b){if(!n)n=b;else if(!i)i=b;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",M={};n(M),o=b(M),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(l){var b=w;function w(a,r,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=c,this.p2y=d}function M(a,r,c,d){const g=new b(a,r,c,d);return function(y){return g.solve(y)}}w.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,d=0;d<8;d++){var g=this.sampleCurveX(c)-a;if(Math.abs(g)<r)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=g/y}var x=0,T=1;for(c=a,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-a)<r));d++)a>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const L=M(.25,.1,.25,1);function C(a,r,c){return Math.min(c,Math.max(r,a))}function W(a,r,c){const d=c-r,g=((a-r)%d+d)%d+r;return g===r?c:g}function Q(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}let ne=1;function _e(a,r){a.forEach(c=>{r[c]&&(r[c]=r[c].bind(r))})}function K(a,r,c){const d={};for(const g in a)d[g]=r.call(c||this,a[g],g,a);return d}function $(a,r,c){const d={};for(const g in a)r.call(c||this,a[g],g,a)&&(d[g]=a[g]);return d}function J(a){return Array.isArray(a)?a.map(J):typeof a=="object"&&a?K(a,J):a}const pe={};function ye(a){pe[a]||(typeof console<"u"&&console.warn(a),pe[a]=!0)}function Ae(a,r,c){return(c.y-a.y)*(r.x-a.x)>(r.y-a.y)*(c.x-a.x)}function Oe(a){let r=0;for(let c,d,g=0,y=a.length,x=y-1;g<y;x=g++)c=a[g],d=a[x],r+=(d.x-c.x)*(c.y+d.y);return r}function Be(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xe(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,y)=>{const x=g||y;return r[d]=!x||x.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r}let je,mt,Dt=null;function qt(a){if(Dt==null){const r=a.navigator?a.navigator.userAgent:null;Dt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Dt}function zt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ti={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const c=window.document.createElement("canvas"),d=c.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,d.drawImage(a,0,0,a.width,a.height),d.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(je||(je=document.createElement("a")),je.href=a,je.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(mt==null&&(mt=matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)}};var xt=vi;function vi(a,r){this.x=a,this.y=r}vi.prototype={clone:function(){return new vi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,c=a.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),c=Math.sin(a),d=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=d,this},_rotateAround:function(a,r){var c=Math.cos(a),d=Math.sin(a),g=r.y+d*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-d*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vi.convert=function(a){return a instanceof vi?a:Array.isArray(a)?new vi(a[0],a[1]):a};const tt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},wt="mapbox-tiles";let St,tn,nn=500,nr=50;function ni(){typeof caches>"u"||St||(St=caches.open(wt))}let xi=1/0;const ii={supported:!1,testSupport:function(a){!Wt&&bi&&(zn?ns(a):ln=a)}};let ln,bi,Wt=!1,zn=!1;function ns(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,bi),a.isContextLost())return;ii.supported=!0}catch{}a.deleteTexture(r),Wt=!0}typeof document<"u"&&(bi=document.createElement("img"),bi.onload=function(){ln&&ns(ln),ln=null,zn=!0},bi.onerror=function(){Wt=!0,ln=null},bi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ci={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ci);class Zn extends Error{constructor(r,c,d,g){super(`AJAXError: ${c} (${r}): ${d}`),this.status=r,this.statusText=c,this.url=d,this.body=g}}const Mr=Be()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Vi(a,r){const c=new AbortController,d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Mr(),signal:c.signal});let g=!1,y=!1;return a.type==="json"&&d.headers.set("Accept","application/json"),((x,T,S)=>{if(y)return;const P=Date.now();fetch(d).then(D=>D.ok?((O,N,G)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(H=>{y||(N&&G&&function(oe,se,ve){if(ni(),!St)return;const Te={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((we,De)=>Te.headers.set(De,we));const ge=Xe(se.headers.get("Cache-Control")||"");ge["no-store"]||(ge["max-age"]&&Te.headers.set("Expires",new Date(ve+1e3*ge["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-ve<42e4||function(we,De){if(tn===void 0)try{new Response(new ReadableStream),tn=!0}catch{tn=!1}tn?De(we.body):we.blob().then(De)}(se,we=>{const De=new Response(we,Te);ni(),St&&St.then(Re=>Re.put(function(it){const ct=it.indexOf("?");return ct<0?it:it.slice(0,ct)}(oe.url),De)).catch(Re=>ye(Re.message))}))}(d,N,G),g=!0,r(null,H,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(H=>{y||r(new Error(H.message))})})(D,null,P):D.blob().then(O=>r(new Zn(D.status,D.statusText,a.url,O)))).catch(D=>{D.code!==20&&r(new Error(D.message))})})(),{cancel:()=>{y=!0,g||c.abort()}}}const hi=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Be()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Be()){const d=a.url.substring(0,a.url.indexOf("://"));return(tt.REGISTERED_PROTOCOLS[d]||Vi)(a,r)}}if(!(/^file:/.test(c=a.url)||/^file:/.test(Mr())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Vi(a,r);if(Be()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var c;return function(d,g){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const x in d.headers)y.setRequestHeader(x,d.headers[x]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(d.type==="json")try{x=JSON.parse(y.response)}catch(T){return g(T)}g(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const x=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new Zn(y.status,y.statusText,d.url,x))}},y.send(d.body),{cancel:()=>y.abort()}}(a,r)},ji=function(a,r){return hi(Q(a,{type:"arrayBuffer"}),r)};function Vs(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mi,On;Mi=[],On=0;const is=function(a,r){if(ii.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),On>=tt.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Mi.push(y),y}On++;let c=!1;const d=()=>{if(!c)for(c=!0,On--;Mi.length&&On<tt.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Mi.shift(),{requestParameters:x,callback:T,cancelled:S}=y;S||(y.cancel=is(x,T).cancel)}},g=ji(a,(y,x,T,S)=>{d(),y?r(y):x&&function(P,D){typeof createImageBitmap=="function"?function(O,N){const G=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(G).then(H=>{N(null,H)}).catch(H=>{N(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(P,D):function(O,N){const G=new Image;G.onload=()=>{N(null,G),URL.revokeObjectURL(G.src),G.onload=null,window.requestAnimationFrame(()=>{G.src=jt})},G.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(O)],{type:"image/png"});G.src=O.byteLength?URL.createObjectURL(H):jt}(P,D)}(x,(P,D)=>{P!=null?r(P):D!=null&&r(null,D,{cacheControl:T,expires:S})})});return{cancel:()=>{g.cancel(),d()}}};function go(a,r,c){c[a]&&c[a].indexOf(r)!==-1||(c[a]=c[a]||[],c[a].push(r))}function kr(a,r,c){if(c&&c[a]){const d=c[a].indexOf(r);d!==-1&&c[a].splice(d,1)}}class Lr{constructor(r,c={}){Q(this,c),this.type=r}}class js extends Lr{constructor(r,c={}){super("error",Q({error:r},c))}}class yr{on(r,c){return this._listeners=this._listeners||{},go(r,c,this._listeners),this}off(r,c){return kr(r,c,this._listeners),kr(r,c,this._oneTimeListeners),this}once(r,c){return this._oneTimeListeners=this._oneTimeListeners||{},go(r,c,this._oneTimeListeners),this}fire(r,c){typeof r=="string"&&(r=new Lr(r,c||{}));const d=r.type;if(this.listens(d)){r.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of y)kr(d,T,this._oneTimeListeners),T.call(this,r);const x=this._eventedParent;x&&(Q(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof js&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class He{constructor(r,c,d,g){this.message=(r?`${r}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function rs(a){const r=a.value;return r?[new He(a.key,r,"constants have been deprecated as of v8")]:[]}function wi(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}function Nt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Gi(a){if(Array.isArray(a))return a.map(Gi);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const c in a)r[c]=Gi(a[c]);return r}return Nt(a)}class ki extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class Li{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(r){return new Li(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const ss={kind:"null"},$e={kind:"number"},Pt={kind:"string"},It={kind:"boolean"},Xn={kind:"color"},Rr={kind:"object"},At={kind:"value"},ir={kind:"collator"},jn={kind:"formatted"},Gs={kind:"padding"},Mn={kind:"resolvedImage"};function ri(a,r){return{kind:"array",itemType:a,N:r}}function Qt(a){if(a.kind==="array"){const r=Qt(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const $s=[ss,$e,Pt,It,Xn,jn,Rr,ri(At),Gs,Mn];function vr(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!vr(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const c of $s)if(!vr(c,r))return null}}return`Expected ${Qt(a)} but found ${Qt(r)} instead.`}function xr(a,r){return r.some(c=>c.kind===a.kind)}function Es(a,r){return r.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}var Hs,os={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Y(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return Y(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function F(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function q(a,r,c){return c<0?c+=1:c>1&&(c-=1),6*c<1?a+(r-a)*c*6:2*c<1?r:3*c<2?a+(r-a)*(2/3-c)*6:a}try{Hs={}.parseCSSColor=function(a){var r,c=a.replace(/ /g,"").toLowerCase();if(c in os)return os[c].slice();if(c[0]==="#")return c.length===4?(r=parseInt(c.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:c.length===7&&(r=parseInt(c.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var d=c.indexOf("("),g=c.indexOf(")");if(d!==-1&&g+1===c.length){var y=c.substr(0,d),x=c.substr(d+1,g-(d+1)).split(","),T=1;switch(y){case"rgba":if(x.length!==4)return null;T=F(x.pop());case"rgb":return x.length!==3?null:[R(x[0]),R(x[1]),R(x[2]),T];case"hsla":if(x.length!==4)return null;T=F(x.pop());case"hsl":if(x.length!==3)return null;var S=(parseFloat(x[0])%360+360)%360/360,P=F(x[1]),D=F(x[2]),O=D<=.5?D*(P+1):D+P-D*P,N=2*D-O;return[Y(255*q(N,O,S+1/3)),Y(255*q(N,O,S)),Y(255*q(N,O,S-1/3)),T];default:return null}}return null}}catch{}class Z{constructor(r,c,d,g=1){this.r=r,this.g=c,this.b=d,this.a=g}static parse(r){if(!r)return;if(r instanceof Z)return r;if(typeof r!="string")return;const c=Hs(r);return c?new Z(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[r,c,d,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(c)},${Math.round(d)},${g})`}toArray(){const{r,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*c/g,255*d/g,g]}}Z.black=new Z(0,0,0,1),Z.white=new Z(1,1,1,1),Z.transparent=new Z(0,0,0,0),Z.red=new Z(1,0,0,1);class le{constructor(r,c,d){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(r,c,d,g,y){this.text=r,this.image=c,this.scale=d,this.fontStack=g,this.textColor=y}}class ue{constructor(r){this.sections=r}static fromString(r){return new ue([new de(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof ue?r:ue.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class ae{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ae)return r;if(typeof r=="number")return new ae([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const c of r)if(typeof c!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new ae(r)}}toString(){return JSON.stringify(this.values)}}class fe{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new fe({name:r,available:!1}):null}}function Pe(a,r,c,d){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,r,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,r,c,d]:[a,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ze(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Z||a instanceof le||a instanceof ue||a instanceof ae||a instanceof fe)return!0;if(Array.isArray(a)){for(const r of a)if(!ze(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!ze(a[r]))return!1;return!0}return!1}function Ie(a){if(a===null)return ss;if(typeof a=="string")return Pt;if(typeof a=="boolean")return It;if(typeof a=="number")return $e;if(a instanceof Z)return Xn;if(a instanceof le)return ir;if(a instanceof ue)return jn;if(a instanceof ae)return Gs;if(a instanceof fe)return Mn;if(Array.isArray(a)){const r=a.length;let c;for(const d of a){const g=Ie(d);if(c){if(c===g)continue;c=At;break}c=g}return ri(c||At,r)}return Rr}function rt(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof Z||a instanceof ue||a instanceof ae||a instanceof fe?a.toString():JSON.stringify(a)}class lt{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(r.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ze(r[1]))return c.error("invalid value");const d=r[1];let g=Ie(d);const y=c.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new lt(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ye{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const gt={string:Pt,number:$e,boolean:It,object:Rr};class dt{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let d,g=1;const y=r[0];if(y==="array"){let T,S;if(r.length>2){const P=r[1];if(typeof P!="string"||!(P in gt)||P==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=gt[P],g++}else T=At;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);S=r[2],g++}d=ri(T,S)}else{if(!gt[y])throw new Error(`Types doesn't contain name = ${y}`);d=gt[y]}const x=[];for(;g<r.length;g++){const T=c.parse(r[g],g,At);if(!T)return null;x.push(T)}return new dt(d,x)}evaluate(r){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(r);if(!vr(this.type,Ie(d)))return d;if(c===this.args.length-1)throw new Ye(`Expected value to be of type ${Qt(this.type)}, but found ${Qt(Ie(d))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Mt={"to-boolean":It,"to-color":Xn,"to-number":$e,"to-string":Pt};class vt{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[0];if(!Mt[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&r.length!==2)return c.error("Expected one argument.");const g=Mt[d],y=[];for(let x=1;x<r.length;x++){const T=c.parse(r[x],x,At);if(!T)return null;y.push(T)}return new vt(g,y)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let c,d;for(const g of this.args){if(c=g.evaluate(r),d=null,c instanceof Z)return c;if(typeof c=="string"){const y=r.parseColor(c);if(y)return y}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Pe(c[0],c[1],c[2],c[3]),!d))return new Z(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ye(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="padding"){let c;for(const d of this.args){c=d.evaluate(r);const g=ae.parse(c);if(g)return g}throw new Ye(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(r),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new Ye(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?ue.fromString(rt(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?fe.fromString(rt(this.args[0].evaluate(r))):rt(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Tt=["Unknown","Point","LineString","Polygon"];class Ot{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=Z.parse(r)),c}}class Ut{constructor(r,c,d,g){this.name=r,this.type=c,this._evaluate=d,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,c){const d=r[0],g=Ut.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=x.filter(([P])=>!Array.isArray(P)||P.length===r.length-1);let S=null;for(const[P,D]of T){S=new Ne(c.registry,c.path,null,c.scope);const O=[];let N=!1;for(let G=1;G<r.length;G++){const H=r[G],oe=Array.isArray(P)?P[G-1]:P.type,se=S.parse(H,1+O.length,oe);if(!se){N=!0;break}O.push(se)}if(!N)if(Array.isArray(P)&&P.length!==O.length)S.error(`Expected ${P.length} arguments, but found ${O.length} instead.`);else{for(let G=0;G<O.length;G++){const H=Array.isArray(P)?P[G]:P.type,oe=O[G];S.concat(G+1).checkSubtype(H,oe.type)}if(S.errors.length===0)return new Ut(d,y,D,O)}}if(T.length===1)c.errors.push(...S.errors);else{const P=(T.length?T:x).map(([O])=>{return N=O,Array.isArray(N)?`(${N.map(Qt).join(", ")})`:`(${Qt(N.type)}...)`;var N}).join(" | "),D=[];for(let O=1;O<r.length;O++){const N=c.parse(r[O],1+D.length);if(!N)return null;D.push(Qt(N.type))}c.error(`Expected arguments of type ${P}, but found (${D.join(", ")}) instead.`)}return null}static register(r,c){Ut.definitions=c;for(const d in c)r[d]=Ut}}class un{constructor(r,c,d){this.type=ir,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(r.length!==2)return c.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,It);if(!g)return null;const y=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,It);if(!y)return null;let x=null;return d.locale&&(x=c.parse(d.locale,1,Pt),!x)?null:new un(g,y,x)}evaluate(r){return new le(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const hn=8192;function Yn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Dr(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function di(a,r){const c=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(c*g*hn),Math.round(d*g*hn)]}function Zt(a,r,c){const d=a[0]-r[0],g=a[1]-r[1],y=a[0]-c[0],x=a[1]-c[1];return d*x-y*g==0&&d*y<=0&&g*x<=0}function _o(a,r){let c=!1;for(let x=0,T=r.length;x<T;x++){const S=r[x];for(let P=0,D=S.length;P<D-1;P++){if(Zt(a,S[P],S[P+1]))return!1;(g=S[P])[1]>(d=a)[1]!=(y=S[P+1])[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(c=!c)}}var d,g,y;return c}function yo(a,r){for(let c=0;c<r.length;c++)if(_o(a,r[c]))return!0;return!1}function Yo(a,r,c,d){const g=d[0]-c[0],y=d[1]-c[1],x=(a[0]-c[0])*y-g*(a[1]-c[1]),T=(r[0]-c[0])*y-g*(r[1]-c[1]);return x>0&&T<0||x<0&&T>0}function Ko(a,r,c){for(const P of c)for(let D=0;D<P.length-1;++D)if((T=[(x=P[D+1])[0]-(y=P[D])[0],x[1]-y[1]])[0]*(S=[(g=r)[0]-(d=a)[0],g[1]-d[1]])[1]-T[1]*S[0]!=0&&Yo(d,g,y,x)&&Yo(y,x,d,g))return!0;var d,g,y,x,T,S;return!1}function Ws(a,r){for(let c=0;c<a.length;++c)if(!_o(a[c],r))return!1;for(let c=0;c<a.length-1;++c)if(Ko(a[c],a[c+1],r))return!1;return!0}function zr(a,r){for(let c=0;c<r.length;c++)if(Ws(a,r[c]))return!0;return!1}function Jo(a,r,c){const d=[];for(let g=0;g<a.length;g++){const y=[];for(let x=0;x<a[g].length;x++){const T=di(a[g][x],c);Yn(r,T),y.push(T)}d.push(y)}return d}function Qo(a,r,c){const d=[];for(let g=0;g<a.length;g++){const y=Jo(a[g],r,c);d.push(y)}return d}function ea(a,r,c,d){if(a[0]<c[0]||a[0]>c[2]){const g=.5*d;let y=a[0]-c[0]>g?-d:c[0]-a[0]>g?d:0;y===0&&(y=a[0]-c[2]>g?-d:c[2]-a[0]>g?d:0),a[0]+=y}Yn(r,a)}function Wa(a,r,c,d){const g=Math.pow(2,d.z)*hn,y=[d.x*hn,d.y*hn],x=[];for(const T of a)for(const S of T){const P=[S.x+y[0],S.y+y[1]];ea(P,r,c,g),x.push(P)}return x}function $l(a,r,c,d){const g=Math.pow(2,d.z)*hn,y=[d.x*hn,d.y*hn],x=[];for(const S of a){const P=[];for(const D of S){const O=[D.x+y[0],D.y+y[1]];Yn(r,O),P.push(O)}x.push(P)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const S of x)for(const P of S)ea(P,r,c,g)}var T;return x}class Ts{constructor(r,c){this.type=It,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ze(r[1])){const d=r[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const y=d.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ts(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ts(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Ts(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=Jo(d.coordinates,y,x),S=Wa(c.geometry(),g,y,x);if(!Dr(g,y))return!1;for(const P of S)if(!_o(P,T))return!1}if(d.type==="MultiPolygon"){const T=Qo(d.coordinates,y,x),S=Wa(c.geometry(),g,y,x);if(!Dr(g,y))return!1;for(const P of S)if(!yo(P,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const T=Jo(d.coordinates,y,x),S=$l(c.geometry(),g,y,x);if(!Dr(g,y))return!1;for(const P of S)if(!Ws(P,T))return!1}if(d.type==="MultiPolygon"){const T=Qo(d.coordinates,y,x),S=$l(c.geometry(),g,y,x);if(!Dr(g,y))return!1;for(const P of S)if(!zr(P,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function j(a){if(a instanceof Ut&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ts)return!1;let r=!0;return a.eachChild(c=>{r&&!j(c)&&(r=!1)}),r}function X(a){if(a instanceof Ut&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(c=>{r&&!X(c)&&(r=!1)}),r}function ce(a,r){if(a instanceof Ut&&r.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(d=>{c&&!ce(d,r)&&(c=!1)}),c}class Se{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(r.length!==2||typeof r[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=r[1];return c.scope.has(d)?new Se(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Ne{constructor(r,c=[],d,g=new Li,y=[]){this.registry=r,this.path=c,this.key=c.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=y,this.expectedType=d}parse(r,c,d,g,y={}){return c?this.concat(c,d,g)._parse(r,y):this._parse(r,y)}_parse(r,c){function d(g,y,x){return x==="assert"?new dt(y,[g]):x==="coerce"?new vt(y,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let x=y.parse(r,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,S=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||S.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(T.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(T,S))return null}else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"coerce");else x=d(x,T,c.typeAnnotation||"assert")}if(!(x instanceof lt)&&x.type.kind!=="resolvedImage"&&ot(x)){const T=new Ot;try{x=new lt(x.type,x.evaluate(T))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,d){const g=typeof r=="number"?this.path.concat(r):this.path,y=d?this.scope.concat(d):this.scope;return new Ne(this.registry,g,c||null,y,this.errors)}error(r,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new ki(d,r))}checkSubtype(r,c){const d=vr(r,c);return d&&this.error(d),d}}function ot(a){if(a instanceof Se)return ot(a.boundExpression);if(a instanceof Ut&&a.name==="error"||a instanceof un||a instanceof Ts)return!1;const r=a instanceof vt||a instanceof dt;let c=!0;return a.eachChild(d=>{c=r?c&&ot(d):c&&d instanceof lt}),!!c&&j(a)&&ce(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ft(a,r){const c=a.length-1;let d,g,y=0,x=c,T=0;for(;y<=x;)if(T=Math.floor((y+x)/2),d=a[T],g=a[T+1],d<=r){if(T===c||r<g)return T;y=T+1}else{if(!(d>r))throw new Ye("Input is not a number.");x=T-1}return 0}class En{constructor(r,c,d){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(r[1],1,$e);if(!d)return null;const g=[];let y=null;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);for(let x=1;x<r.length;x+=2){const T=x===1?-1/0:r[x],S=r[x+1],P=x,D=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const O=c.parse(S,D,y);if(!O)return null;y=y||O.type,g.push([T,O])}return new En(y,d,g)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=c[0])return d[0].evaluate(r);const y=c.length;return g>=c[y-1]?d[y-1].evaluate(r):d[Ft(c,g)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function kt(a,r,c){return a*(1-c)+r*c}var Fn=Object.freeze({__proto__:null,number:kt,color:function(a,r,c){return new Z(kt(a.r,r.r,c),kt(a.g,r.g,c),kt(a.b,r.b,c),kt(a.a,r.a,c))},array:function(a,r,c){return a.map((d,g)=>kt(d,r[g],c))},padding:function(a,r,c){const d=a.values,g=r.values;return new ae([kt(d[0],g[0],c),kt(d[1],g[1],c),kt(d[2],g[2],c),kt(d[3],g[3],c)])}});const rr=.95047,Md=1.08883,gu=4/29,Hl=6/29,kd=3*Hl*Hl,Nm=Math.PI/180,Um=180/Math.PI;function _u(a){return a>.008856451679035631?Math.pow(a,1/3):a/kd+gu}function yu(a){return a>Hl?a*a*a:kd*(a-gu)}function vu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function xu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Kt(a){const r=xu(a.r),c=xu(a.g),d=xu(a.b),g=_u((.4124564*r+.3575761*c+.1804375*d)/rr),y=_u((.2126729*r+.7151522*c+.072175*d)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-_u((.0193339*r+.119192*c+.9503041*d)/Md)),alpha:a.a}}function Ld(a){let r=(a.l+16)/116,c=isNaN(a.a)?r:r+a.a/500,d=isNaN(a.b)?r:r-a.b/200;return r=1*yu(r),c=rr*yu(c),d=Md*yu(d),new Z(vu(3.2404542*c-1.5371385*r-.4985314*d),vu(-.969266*c+1.8760108*r+.041556*d),vu(.0556434*c-.2040259*r+1.0572252*d),a.alpha)}function Vm(a,r,c){const d=r-a;return a+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const qa={forward:Kt,reverse:Ld,interpolate:function(a,r,c){return{l:kt(a.l,r.l,c),a:kt(a.a,r.a,c),b:kt(a.b,r.b,c),alpha:kt(a.alpha,r.alpha,c)}}},Za={forward:function(a){const{l:r,a:c,b:d}=Kt(a),g=Math.atan2(d,c)*Um;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Nm,c=a.c;return Ld({l:a.l,a:Math.cos(r)*c,b:Math.sin(r)*c,alpha:a.alpha})},interpolate:function(a,r,c){return{h:Vm(a.h,r.h,c),c:kt(a.c,r.c,c),l:kt(a.l,r.l,c),alpha:kt(a.alpha,r.alpha,c)}}};var Rd=Object.freeze({__proto__:null,lab:qa,hcl:Za});class sr{constructor(r,c,d,g,y){this.type=r,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[x,T]of y)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(r,c,d,g){let y=0;if(r.name==="exponential")y=bu(c,r.base,d,g);else if(r.name==="linear")y=bu(c,1,d,g);else if(r.name==="cubic-bezier"){const x=r.controlPoints;y=new b(x[0],x[1],x[2],x[3]).solve(bu(c,1,d,g))}return y}static parse(r,c){let[d,g,y,...x]=r;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(D=>typeof D!="number"||D<0||D>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(y=c.parse(y,2,$e),!y)return null;const T=[];let S=null;d==="interpolate-hcl"||d==="interpolate-lab"?S=Xn:c.expectedType&&c.expectedType.kind!=="value"&&(S=c.expectedType);for(let P=0;P<x.length;P+=2){const D=x[P],O=x[P+1],N=P+3,G=P+4;if(typeof D!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(T.length&&T[T.length-1][0]>=D)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const H=c.parse(O,G,S);if(!H)return null;S=S||H.type,T.push([D,H])}return S.kind==="number"||S.kind==="color"||S.kind==="padding"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new sr(S,d,g,y,T):c.error(`Type ${Qt(S)} is not interpolatable.`)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=c[0])return d[0].evaluate(r);const y=c.length;if(g>=c[y-1])return d[y-1].evaluate(r);const x=Ft(c,g),T=sr.interpolationFactor(this.interpolation,g,c[x],c[x+1]),S=d[x].evaluate(r),P=d[x+1].evaluate(r);return this.operator==="interpolate"?Fn[this.type.kind.toLowerCase()](S,P,T):this.operator==="interpolate-hcl"?Za.reverse(Za.interpolate(Za.forward(S),Za.forward(P),T)):qa.reverse(qa.interpolate(qa.forward(S),qa.forward(P),T))}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function bu(a,r,c,d){const g=d-c,y=a-c;return g===0?0:r===1?y/g:(Math.pow(r,y)-1)/(Math.pow(r,g)-1)}class Wl{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const y=[];for(const T of r.slice(1)){const S=c.parse(T,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!S)return null;d=d||S.type,y.push(S)}if(!d)throw new Error("No output type");const x=g&&y.some(T=>vr(g,T.type));return new Wl(x?At:d,y)}evaluate(r){let c,d=null,g=0;for(const y of this.args)if(g++,d=y.evaluate(r),d&&d instanceof fe&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),d!==null)break;return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class ql{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let y=1;y<r.length-1;y+=2){const x=r[y];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=c.parse(r[y+1],y+1);if(!T)return null;d.push([x,T])}const g=c.parse(r[r.length-1],r.length-1,c.expectedType,d);return g?new ql(d,g):null}outputDefined(){return this.result.outputDefined()}}class wu{constructor(r,c,d){this.type=r,this.index=c,this.input=d}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,$e),g=c.parse(r[2],2,ri(c.expectedType||At));return d&&g?new wu(g.type.itemType,d,g):null}evaluate(r){const c=this.index.evaluate(r),d=this.input.evaluate(r);if(c<0)throw new Ye(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new Ye(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new Ye(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Eu{constructor(r,c){this.type=It,this.needle=r,this.haystack=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,At);return d&&g?xr(d.type,[It,Pt,$e,ss,At])?new Eu(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(d.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!d)return!1;if(!Es(c,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(Ie(c))} instead.`);if(!Es(d,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${Qt(Ie(d))} instead.`);return d.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Zl{constructor(r,c,d){this.type=$e,this.needle=r,this.haystack=c,this.fromIndex=d}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,At);if(!d||!g)return null;if(!xr(d.type,[It,Pt,$e,ss,At]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,$e);return y?new Zl(d,g,y):null}return new Zl(d,g)}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!Es(c,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(Ie(c))} instead.`);if(!Es(d,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${Qt(Ie(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Tu{constructor(r,c,d,g,y,x){this.inputType=r,this.type=c,this.input=d,this.cases=g,this.outputs=y,this.otherwise=x}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const y={},x=[];for(let P=2;P<r.length-1;P+=2){let D=r[P];const O=r[P+1];Array.isArray(D)||(D=[D]);const N=c.concat(P);if(D.length===0)return N.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return N.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,Ie(H)))return null}else d=Ie(H);if(y[String(H)]!==void 0)return N.error("Branch labels must be unique.");y[String(H)]=x.length}const G=c.parse(O,P,g);if(!G)return null;g=g||G.type,x.push(G)}const T=c.parse(r[1],1,At);if(!T)return null;const S=c.parse(r[r.length-1],r.length-1,g);return S?T.type.kind!=="value"&&c.concat(1).checkSubtype(d,T.type)?null:new Tu(d,g,T,y,x,S):null}evaluate(r){const c=this.input.evaluate(r);return(Ie(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Su{constructor(r,c,d){this.type=r,this.branches=c,this.otherwise=d}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let x=1;x<r.length-1;x+=2){const T=c.parse(r[x],x,It);if(!T)return null;const S=c.parse(r[x+1],x+1,d);if(!S)return null;g.push([T,S]),d=d||S.type}const y=c.parse(r[r.length-1],r.length-1,d);if(!y)return null;if(!d)throw new Error("Can't infer output type");return new Su(d,g,y)}evaluate(r){for(const[c,d]of this.branches)if(c.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,d]of this.branches)r(c),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Xl{constructor(r,c,d,g){this.type=r,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,$e);if(!d||!g)return null;if(!xr(d.type,[ri(At),Pt,At]))return c.error(`Expected first argument to be of type array or string, but found ${Qt(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,$e);return y?new Xl(d.type,d,g,y):null}return new Xl(d.type,d,g)}evaluate(r){const c=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!Es(c,["string","array"]))throw new Ye(`Expected first argument to be of type array or string, but found ${Qt(Ie(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return c.slice(d,g)}return c.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Dd(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function zd(a,r,c,d){return d.compare(r,c)===0}function ta(a,r,c){const d=a!=="=="&&a!=="!=";return class $2{constructor(y,x,T){this.type=It,this.lhs=y,this.rhs=x,this.collator=T,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}static parse(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");const T=y[0];let S=x.parse(y[1],1,At);if(!S)return null;if(!Dd(T,S.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${Qt(S.type)}'.`);let P=x.parse(y[2],2,At);if(!P)return null;if(!Dd(T,P.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${Qt(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${Qt(S.type)}' and '${Qt(P.type)}'.`);d&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new dt(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new dt(S.type,[P])));let D=null;if(y.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(y[3],3,ir),!D)return null}return new $2(S,P,D)}evaluate(y){const x=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const S=Ie(x),P=Ie(T);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new Ye(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const S=Ie(x),P=Ie(T);if(S.kind!=="string"||P.kind!=="string")return r(y,x,T)}return this.collator?c(y,x,T,this.collator.evaluate(y)):r(y,x,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const jm=ta("==",function(a,r,c){return r===c},zd),Gm=ta("!=",function(a,r,c){return r!==c},function(a,r,c,d){return!zd(0,r,c,d)}),$m=ta("<",function(a,r,c){return r<c},function(a,r,c,d){return d.compare(r,c)<0}),Hm=ta(">",function(a,r,c){return r>c},function(a,r,c,d){return d.compare(r,c)>0}),Wm=ta("<=",function(a,r,c){return r<=c},function(a,r,c,d){return d.compare(r,c)<=0}),qm=ta(">=",function(a,r,c){return r>=c},function(a,r,c,d){return d.compare(r,c)>=0});class Au{constructor(r,c,d,g,y){this.type=Pt,this.number=r,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,c){if(r.length!==3)return c.error("Expected two arguments.");const d=c.parse(r[1],1,$e);if(!d)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=c.parse(g.locale,1,Pt),!y))return null;let x=null;if(g.currency&&(x=c.parse(g.currency,1,Pt),!x))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,$e),!T))return null;let S=null;return g["max-fraction-digits"]&&(S=c.parse(g["max-fraction-digits"],1,$e),!S)?null:new Au(d,y,x,T,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class Yl{constructor(r){this.type=jn,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let y=!1;for(let x=1;x<=r.length-1;++x){const T=r[x];if(y&&typeof T=="object"&&!Array.isArray(T)){y=!1;let S=null;if(T["font-scale"]&&(S=c.parse(T["font-scale"],1,$e),!S))return null;let P=null;if(T["text-font"]&&(P=c.parse(T["text-font"],1,ri(Pt)),!P))return null;let D=null;if(T["text-color"]&&(D=c.parse(T["text-color"],1,Xn),!D))return null;const O=g[g.length-1];O.scale=S,O.font=P,O.textColor=D}else{const S=c.parse(r[x],1,At);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new Yl(g)}evaluate(r){return new ue(this.sections.map(c=>{const d=c.content.evaluate(r);return Ie(d)===Mn?new de("",d,null,null,null):new de(rt(d),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}}class Iu{constructor(r){this.type=Mn,this.input=r}static parse(r,c){if(r.length!==2)return c.error("Expected two arguments.");const d=c.parse(r[1],1,Pt);return d?new Iu(d):c.error("No image name provided.")}evaluate(r){const c=this.input.evaluate(r),d=fe.fromString(c);return d&&r.availableImages&&(d.available=r.availableImages.indexOf(c)>-1),d}eachChild(r){r(this.input)}outputDefined(){return!1}}class Pu{constructor(r){this.type=$e,this.input=r}static parse(r,c){if(r.length!==2)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=c.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Qt(d.type)} instead.`):new Pu(d):null}evaluate(r){const c=this.input.evaluate(r);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ye(`Expected value to be of type string or array, but found ${Qt(Ie(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const na={"==":jm,"!=":Gm,">":Hm,"<":$m,">=":qm,"<=":Wm,array:dt,at:wu,boolean:dt,case:Su,coalesce:Wl,collator:un,format:Yl,image:Iu,in:Eu,"index-of":Zl,interpolate:sr,"interpolate-hcl":sr,"interpolate-lab":sr,length:Pu,let:ql,literal:lt,match:Tu,number:dt,"number-format":Au,object:dt,slice:Xl,step:En,string:dt,"to-boolean":vt,"to-color":vt,"to-number":vt,"to-string":vt,var:Se,within:Ts};function Od(a,[r,c,d,g]){r=r.evaluate(a),c=c.evaluate(a),d=d.evaluate(a);const y=g?g.evaluate(a):1,x=Pe(r,c,d,y);if(x)throw new Ye(x);return new Z(r/255*y,c/255*y,d/255*y,y)}function Fd(a,r){return a in r}function Kl(a,r){const c=r[a];return c===void 0?null:c}function vo(a){return{type:a}}function Bd(a){return{result:"success",value:a}}function ia(a){return{result:"error",value:a}}function mn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Nd(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Gt(a){return!!a.expression&&a.expression.interpolated}function Jt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function dn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function yn(a){return a}function Xa(a,r){const c=r.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",g=d||!(d||a.property!==void 0),y=a.type||(Gt(r)?"exponential":"interval");if(c||r.type==="padding"){const P=c?Z.parse:ae.parse;(a=wi({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],P(D[1])])),a.default=P(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!Rd[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let x,T,S;if(y==="exponential")x=Ud;else if(y==="interval")x=Xm;else if(y==="categorical"){x=Zm,T=Object.create(null);for(const P of a.stops)T[P[0]]=P[1];S=typeof a.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=Ym}if(d){const P={},D=[];for(let G=0;G<a.stops.length;G++){const H=a.stops[G],oe=H[0].zoom;P[oe]===void 0&&(P[oe]={zoom:oe,type:a.type,property:a.property,default:a.default,stops:[]},D.push(oe)),P[oe].stops.push([H[0].value,H[1]])}const O=[];for(const G of D)O.push([P[G].zoom,Xa(P[G],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:sr.interpolationFactor.bind(void 0,N),zoomStops:O.map(G=>G[0]),evaluate:({zoom:G},H)=>Ud({stops:O,base:a.base},r,G).evaluate(G,H)}}if(g){const P=y==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:sr.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(D=>D[0]),evaluate:({zoom:D})=>x(a,r,D,T,S)}}return{kind:"source",evaluate(P,D){const O=D&&D.properties?D.properties[a.property]:void 0;return O===void 0?ra(a.default,r.default):x(a,r,O,T,S)}}}function ra(a,r,c){return a!==void 0?a:r!==void 0?r:c!==void 0?c:void 0}function Zm(a,r,c,d,g){return ra(typeof c===g?d[c]:void 0,a.default,r.default)}function Xm(a,r,c){if(Jt(c)!=="number")return ra(a.default,r.default);const d=a.stops.length;if(d===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[d-1][0])return a.stops[d-1][1];const g=Ft(a.stops.map(y=>y[0]),c);return a.stops[g][1]}function Ud(a,r,c){const d=a.base!==void 0?a.base:1;if(Jt(c)!=="number")return ra(a.default,r.default);const g=a.stops.length;if(g===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[g-1][0])return a.stops[g-1][1];const y=Ft(a.stops.map(D=>D[0]),c),x=function(D,O,N,G){const H=G-N,oe=D-N;return H===0?0:O===1?oe/H:(Math.pow(O,oe)-1)/(Math.pow(O,H)-1)}(c,d,a.stops[y][0],a.stops[y+1][0]),T=a.stops[y][1],S=a.stops[y+1][1];let P=Fn[r.type]||yn;if(a.colorSpace&&a.colorSpace!=="rgb"){const D=Rd[a.colorSpace];P=(O,N)=>D.reverse(D.interpolate(D.forward(O),D.forward(N),x))}return typeof T.evaluate=="function"?{evaluate(...D){const O=T.evaluate.apply(void 0,D),N=S.evaluate.apply(void 0,D);if(O!==void 0&&N!==void 0)return P(O,N,x)}}:P(T,S,x)}function Ym(a,r,c){switch(r.type){case"color":c=Z.parse(c);break;case"formatted":c=ue.fromString(c.toString());break;case"resolvedImage":c=fe.fromString(c.toString());break;case"padding":c=ae.parse(c);break;default:Jt(c)===r.type||r.type==="enum"&&r.values[c]||(c=void 0)}return ra(c,a.default,r.default)}Ut.register(na,{error:[{kind:"error"},[Pt],(a,[r])=>{throw new Ye(r.evaluate(a))}],typeof:[Pt,[At],(a,[r])=>Qt(Ie(r.evaluate(a)))],"to-rgba":[ri($e,4),[Xn],(a,[r])=>r.evaluate(a).toArray()],rgb:[Xn,[$e,$e,$e],Od],rgba:[Xn,[$e,$e,$e,$e],Od],has:{type:It,overloads:[[[Pt],(a,[r])=>Fd(r.evaluate(a),a.properties())],[[Pt,Rr],(a,[r,c])=>Fd(r.evaluate(a),c.evaluate(a))]]},get:{type:At,overloads:[[[Pt],(a,[r])=>Kl(r.evaluate(a),a.properties())],[[Pt,Rr],(a,[r,c])=>Kl(r.evaluate(a),c.evaluate(a))]]},"feature-state":[At,[Pt],(a,[r])=>Kl(r.evaluate(a),a.featureState||{})],properties:[Rr,[],a=>a.properties()],"geometry-type":[Pt,[],a=>a.geometryType()],id:[At,[],a=>a.id()],zoom:[$e,[],a=>a.globals.zoom],"heatmap-density":[$e,[],a=>a.globals.heatmapDensity||0],"line-progress":[$e,[],a=>a.globals.lineProgress||0],accumulated:[At,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[$e,vo($e),(a,r)=>{let c=0;for(const d of r)c+=d.evaluate(a);return c}],"*":[$e,vo($e),(a,r)=>{let c=1;for(const d of r)c*=d.evaluate(a);return c}],"-":{type:$e,overloads:[[[$e,$e],(a,[r,c])=>r.evaluate(a)-c.evaluate(a)],[[$e],(a,[r])=>-r.evaluate(a)]]},"/":[$e,[$e,$e],(a,[r,c])=>r.evaluate(a)/c.evaluate(a)],"%":[$e,[$e,$e],(a,[r,c])=>r.evaluate(a)%c.evaluate(a)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(a,[r,c])=>Math.pow(r.evaluate(a),c.evaluate(a))],sqrt:[$e,[$e],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))],log2:[$e,[$e],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[$e,[$e],(a,[r])=>Math.sin(r.evaluate(a))],cos:[$e,[$e],(a,[r])=>Math.cos(r.evaluate(a))],tan:[$e,[$e],(a,[r])=>Math.tan(r.evaluate(a))],asin:[$e,[$e],(a,[r])=>Math.asin(r.evaluate(a))],acos:[$e,[$e],(a,[r])=>Math.acos(r.evaluate(a))],atan:[$e,[$e],(a,[r])=>Math.atan(r.evaluate(a))],min:[$e,vo($e),(a,r)=>Math.min(...r.map(c=>c.evaluate(a)))],max:[$e,vo($e),(a,r)=>Math.max(...r.map(c=>c.evaluate(a)))],abs:[$e,[$e],(a,[r])=>Math.abs(r.evaluate(a))],round:[$e,[$e],(a,[r])=>{const c=r.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[$e,[$e],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[$e,[$e],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[It,[Pt,At],(a,[r,c])=>a.properties()[r.value]===c.value],"filter-id-==":[It,[At],(a,[r])=>a.id()===r.value],"filter-type-==":[It,[Pt],(a,[r])=>a.geometryType()===r.value],"filter-<":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<d}],"filter->":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>d}],"filter-<=":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<=d}],"filter->=":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>=d}],"filter-has":[It,[At],(a,[r])=>r.value in a.properties()],"filter-has-id":[It,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[It,[ri(Pt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[It,[ri(At)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[It,[Pt,ri(At)],(a,[r,c])=>c.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[It,[Pt,ri(At)],(a,[r,c])=>function(d,g,y,x){for(;y<=x;){const T=y+x>>1;if(g[T]===d)return!0;g[T]>d?x=T-1:y=T+1}return!1}(a.properties()[r.value],c.value,0,c.value.length-1)],all:{type:It,overloads:[[[It,It],(a,[r,c])=>r.evaluate(a)&&c.evaluate(a)],[vo(It),(a,r)=>{for(const c of r)if(!c.evaluate(a))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(a,[r,c])=>r.evaluate(a)||c.evaluate(a)],[vo(It),(a,r)=>{for(const c of r)if(c.evaluate(a))return!0;return!1}]]},"!":[It,[It],(a,[r])=>!r.evaluate(a)],"is-supported-script":[It,[Pt],(a,[r])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(r.evaluate(a))}],upcase:[Pt,[Pt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Pt,[Pt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Pt,vo(At),(a,r)=>r.map(c=>rt(c.evaluate(a))).join("")],"resolved-locale":[Pt,[ir],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Jl{constructor(r,c){this.expression=r,this._warningHistory={},this._evaluator=new Ot,this._defaultValue=c?function(d){return d.type==="color"&&dn(d.default)?new Z(0,0,0,0):d.type==="color"?Z.parse(d.default)||null:d.type==="padding"?ae.parse(d.default)||null:d.default===void 0?null:d.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,c,d,g,y,x){this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ye(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ya(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in na}function Ka(a,r){const c=new Ne(na,[],r?function(g){const y={color:Xn,string:Pt,number:$e,enum:Pt,boolean:It,formatted:jn,padding:Gs,resolvedImage:Mn};return g.type==="array"?ri(y[g.value]||At,g.length):y[g.type]}(r):void 0),d=c.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Bd(new Jl(d,r)):ia(c.errors)}class Ja{constructor(r,c){this.kind=r,this._styleExpression=c,this.isStateDependent=r!=="constant"&&!X(c.expression)}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,g,y,x)}evaluate(r,c,d,g,y,x){return this._styleExpression.evaluate(r,c,d,g,y,x)}}class Cu{constructor(r,c,d,g){this.kind=r,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=r!=="camera"&&!X(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,g,y,x)}evaluate(r,c,d,g,y,x){return this._styleExpression.evaluate(r,c,d,g,y,x)}interpolationFactor(r,c,d){return this.interpolationType?sr.interpolationFactor(this.interpolationType,r,c,d):0}}function Vd(a,r){const c=Ka(a,r);if(c.result==="error")return c;const d=c.value.expression,g=j(d);if(!g&&!mn(r))return ia([new ki("","data expressions not supported")]);const y=ce(d,["zoom"]);if(!y&&!Nd(r))return ia([new ki("","zoom expressions not supported")]);const x=ec(d);return x||y?x instanceof ki?ia([x]):x instanceof sr&&!Gt(r)?ia([new ki("",'"interpolate" expressions cannot be used with this property')]):Bd(x?new Cu(g?"camera":"composite",c.value,x.labels,x instanceof sr?x.interpolation:void 0):new Ja(g?"constant":"source",c.value)):ia([new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ql{constructor(r,c){this._parameters=r,this._specification=c,wi(this,Xa(this._parameters,this._specification))}static deserialize(r){return new Ql(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ec(a){let r=null;if(a instanceof ql)r=ec(a.result);else if(a instanceof Wl){for(const c of a.args)if(r=ec(c),r)break}else(a instanceof En||a instanceof sr)&&a.input instanceof Ut&&a.input.name==="zoom"&&(r=a);return r instanceof ki||a.eachChild(c=>{const d=ec(c);d instanceof ki?r=d:!r&&d?r=new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&d&&r!==d&&(r=new ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Or(a){const r=a.key,c=a.value,d=a.valueSpec||{},g=a.objectElementValidators||{},y=a.style,x=a.styleSpec;let T=[];const S=Jt(c);if(S!=="object")return[new He(r,c,`object expected, ${S} found`)];for(const P in c){const D=P.split(".")[0],O=d[D]||d["*"];let N;if(g[D])N=g[D];else if(d[D])N=ar;else if(g["*"])N=g["*"];else{if(!d["*"]){T.push(new He(r,c[P],`unknown property "${P}"`));continue}N=ar}T=T.concat(N({key:(r&&`${r}.`)+P,value:c[P],valueSpec:O,style:y,styleSpec:x,object:c,objectKey:P},c))}for(const P in d)g[P]||d[P].required&&d[P].default===void 0&&c[P]===void 0&&T.push(new He(r,c,`missing required property "${P}"`));return T}function jd(a){const r=a.value,c=a.valueSpec,d=a.style,g=a.styleSpec,y=a.key,x=a.arrayElementValidator||ar;if(Jt(r)!=="array")return[new He(y,r,`array expected, ${Jt(r)} found`)];if(c.length&&r.length!==c.length)return[new He(y,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new He(y,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Jt(c.value)==="object"&&(T=c.value);let S=[];for(let P=0;P<r.length;P++)S=S.concat(x({array:r,arrayIndex:P,value:r[P],valueSpec:T,style:d,styleSpec:g,key:`${y}[${P}]`}));return S}function Mu(a){const r=a.key,c=a.value,d=a.valueSpec;let g=Jt(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new He(r,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new He(r,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new He(r,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function Gd(a){const r=a.valueSpec,c=Nt(a.value.type);let d,g,y,x={};const T=c!=="categorical"&&a.value.property===void 0,S=!T,P=Jt(a.value.stops)==="array"&&Jt(a.value.stops[0])==="array"&&Jt(a.value.stops[0][0])==="object",D=Or({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(G){if(c==="identity")return[new He(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const oe=G.value;return H=H.concat(jd({key:G.key,value:oe,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:O})),Jt(oe)==="array"&&oe.length===0&&H.push(new He(G.key,oe,"array must have at least one stop")),H},default:function(G){return ar({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return c==="identity"&&T&&D.push(new He(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||D.push(new He(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!Gt(a.valueSpec)&&D.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(S&&!mn(a.valueSpec)?D.push(new He(a.key,a.value,"property functions not supported")):T&&!Nd(a.valueSpec)&&D.push(new He(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!P||a.value.property!==void 0||D.push(new He(a.key,a.value,'"property" property is required')),D;function O(G){let H=[];const oe=G.value,se=G.key;if(Jt(oe)!=="array")return[new He(se,oe,`array expected, ${Jt(oe)} found`)];if(oe.length!==2)return[new He(se,oe,`array length 2 expected, length ${oe.length} found`)];if(P){if(Jt(oe[0])!=="object")return[new He(se,oe,`object expected, ${Jt(oe[0])} found`)];if(oe[0].zoom===void 0)return[new He(se,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new He(se,oe,"object stop key must have value")];if(y&&y>Nt(oe[0].zoom))return[new He(se,oe[0].zoom,"stop zoom values must appear in ascending order")];Nt(oe[0].zoom)!==y&&(y=Nt(oe[0].zoom),g=void 0,x={}),H=H.concat(Or({key:`${se}[0]`,value:oe[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Mu,value:N}}))}else H=H.concat(N({key:`${se}[0]`,value:oe[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},oe));return Ya(Gi(oe[1]))?H.concat([new He(`${se}[1]`,oe[1],"expressions are not allowed in function stops.")]):H.concat(ar({key:`${se}[1]`,value:oe[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function N(G,H){const oe=Jt(G.value),se=Nt(G.value),ve=G.value!==null?G.value:H;if(d){if(oe!==d)return[new He(G.key,ve,`${oe} stop domain type must match previous stop domain type ${d}`)]}else d=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new He(G.key,ve,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&c!=="categorical"){let Te=`number expected, ${oe} found`;return mn(r)&&c===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(G.key,ve,Te)]}return c!=="categorical"||oe!=="number"||isFinite(se)&&Math.floor(se)===se?c!=="categorical"&&oe==="number"&&g!==void 0&&se<g?[new He(G.key,ve,"stop domain values must appear in ascending order")]:(g=se,c==="categorical"&&se in x?[new He(G.key,ve,"stop domain values must be unique")]:(x[se]=!0,[])):[new He(G.key,ve,`integer expected, found ${se}`)]}}function xo(a){const r=(a.expressionContext==="property"?Vd:Ka)(Gi(a.value),a.valueSpec);if(r.result==="error")return r.value.map(d=>new He(`${a.key}${d.key}`,a.value,d.message));const c=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new He(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!X(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!X(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ce(c,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!j(c))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qa(a){const r=a.key,c=a.value,d=a.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(Nt(c))===-1&&g.push(new He(r,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(Nt(c))===-1&&g.push(new He(r,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function sa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!sa(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Km={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function tc(a){if(a==null)return{filter:()=>!0,needGeometry:!1};sa(a)||(a=el(a));const r=Ka(a,Km);if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>r.value.evaluate(c,d,{},g),needGeometry:Hd(a)}}function $d(a,r){return a<r?-1:a>r?1:0}function Hd(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(Hd(a[r]))return!0;return!1}function el(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?ku(a[1],a[2],"=="):r==="!="?oa(ku(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ku(a[1],a[2],r):r==="any"?(c=a.slice(1),["any"].concat(c.map(el))):r==="all"?["all"].concat(a.slice(1).map(el)):r==="none"?["all"].concat(a.slice(1).map(el).map(oa)):r==="in"?nc(a[1],a.slice(2)):r==="!in"?oa(nc(a[1],a.slice(2))):r==="has"?tl(a[1]):r==="!has"?oa(tl(a[1])):r!=="within"||a;var c}function ku(a,r,c){switch(a){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,a,r]}}function nc(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",a,["literal",r.sort($d)]]:["filter-in-small",a,["literal",r]]}}function tl(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function oa(a){return["!",a]}function nl(a){return sa(Gi(a.value))?xo(wi({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wd(a)}function Wd(a){const r=a.value,c=a.key;if(Jt(r)!=="array")return[new He(c,r,`array expected, ${Jt(r)} found`)];const d=a.styleSpec;let g,y=[];if(r.length<1)return[new He(c,r,"filter array must have at least 1 element")];switch(y=y.concat(Qa({key:`${c}[0]`,value:r[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),Nt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Nt(r[1])==="$type"&&y.push(new He(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new He(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Jt(r[1]),g!=="string"&&y.push(new He(`${c}[1]`,r[1],`string expected, ${g} found`)));for(let x=2;x<r.length;x++)g=Jt(r[x]),Nt(r[1])==="$type"?y=y.concat(Qa({key:`${c}[${x}]`,value:r[x],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new He(`${c}[${x}]`,r[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)y=y.concat(Wd({key:`${c}[${x}]`,value:r[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Jt(r[1]),r.length!==2?y.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new He(`${c}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Jt(r[1]),r.length!==2?y.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new He(`${c}[1]`,r[1],`object expected, ${g} found`))}return y}function il(a,r){const c=a.key,d=a.style,g=a.styleSpec,y=a.value,x=a.objectKey,T=g[`${r}_${a.layerType}`];if(!T)return[];const S=x.match(/^(.*)-transition$/);if(r==="paint"&&S&&T[S[1]]&&T[S[1]].transition)return ar({key:c,value:y,valueSpec:g.transition,style:d,styleSpec:g});const P=a.valueSpec||T[x];if(!P)return[new He(c,y,`unknown property "${x}"`)];let D;if(Jt(y)==="string"&&mn(P)&&!P.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new He(c,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return a.layerType==="symbol"&&(x==="text-field"&&d&&!d.glyphs&&O.push(new He(c,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&dn(Gi(y))&&Nt(y.type)==="identity"&&O.push(new He(c,y,'"text-font" does not support identity functions'))),O.concat(ar({key:a.key,value:y,valueSpec:P,style:d,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:x}))}function qd(a){return il(a,"paint")}function Zd(a){return il(a,"layout")}function Xd(a){let r=[];const c=a.value,d=a.key,g=a.style,y=a.styleSpec;c.type||c.ref||r.push(new He(d,c,'either "type" or "ref" is required'));let x=Nt(c.type);const T=Nt(c.ref);if(c.id){const S=Nt(c.id);for(let P=0;P<a.arrayIndex;P++){const D=g.layers[P];Nt(D.id)===S&&r.push(new He(d,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(P=>{P in c&&r.push(new He(d,c[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{Nt(P.id)===T&&(S=P)}),S?S.ref?r.push(new He(d,c.ref,"ref cannot reference another ref layer")):x=Nt(S.type):r.push(new He(d,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const S=g.sources&&g.sources[c.source],P=S&&Nt(S.type);S?P==="vector"&&x==="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a raster source`)):P==="raster"&&x!=="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a vector source`)):P!=="vector"||c["source-layer"]?P==="raster-dem"&&x!=="hillshade"?r.push(new He(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||P==="geojson"&&S.lineMetrics||r.push(new He(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new He(d,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new He(d,c.source,`source "${c.source}" not found`))}else r.push(new He(d,c,'missing required property "source"'));return r=r.concat(Or({key:d,value:c,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${d}.type`,value:c.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"}),filter:nl,layout:S=>Or({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>Zd(wi({layerType:x},P))}}),paint:S=>Or({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>qd(wi({layerType:x},P))}})}})),r}function aa(a){const r=a.value,c=a.key,d=Jt(r);return d!=="string"?[new He(c,r,`string expected, ${d} found`)]:[]}const Yd={promoteId:function({key:a,value:r}){if(Jt(r)==="string")return aa({key:a,value:r});{const c=[];for(const d in r)c.push(...aa({key:`${a}.${d}`,value:r[d]}));return c}}};function rl(a){const r=a.value,c=a.key,d=a.styleSpec,g=a.style;if(!r.type)return[new He(c,r,'"type" is required')];const y=Nt(r.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=Or({key:c,value:r,valueSpec:d[`source_${y.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Yd}),x;case"geojson":if(x=Or({key:c,value:r,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Yd}),r.cluster)for(const T in r.clusterProperties){const[S,P]=r.clusterProperties[T],D=typeof S=="string"?[S,["accumulated"],["get",T]]:S;x.push(...xo({key:`${c}.${T}.map`,value:P,expressionContext:"cluster-map"})),x.push(...xo({key:`${c}.${T}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return x;case"video":return Or({key:c,value:r,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return Or({key:c,value:r,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new He(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qa({key:`${c}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function sl(a){const r=a.value,c=a.styleSpec,d=c.light,g=a.style;let y=[];const x=Jt(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new He("light",r,`object expected, ${x} found`)]),y;for(const T in r){const S=T.match(/^(.*)-transition$/);y=y.concat(S&&d[S[1]]&&d[S[1]].transition?ar({key:T,value:r[T],valueSpec:c.transition,style:g,styleSpec:c}):d[T]?ar({key:T,value:r[T],valueSpec:d[T],style:g,styleSpec:c}):[new He(T,r[T],`unknown property "${T}"`)])}return y}function or(a){const r=a.value,c=a.styleSpec,d=c.terrain,g=a.style;let y=[];const x=Jt(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new He("terrain",r,`object expected, ${x} found`)]),y;for(const T in r)y=y.concat(d[T]?ar({key:T,value:r[T],valueSpec:d[T],style:g,styleSpec:c}):[new He(T,r[T],`unknown property "${T}"`)]);return y}const ol={"*":()=>[],array:jd,boolean:function(a){const r=a.value,c=a.key,d=Jt(r);return d!=="boolean"?[new He(c,r,`boolean expected, ${d} found`)]:[]},number:Mu,color:function(a){const r=a.key,c=a.value,d=Jt(c);return d!=="string"?[new He(r,c,`color expected, ${d} found`)]:Hs(c)===null?[new He(r,c,`color expected, "${c}" found`)]:[]},constants:rs,enum:Qa,filter:nl,function:Gd,layer:Xd,object:Or,source:rl,light:sl,terrain:or,string:aa,formatted:function(a){return aa(a).length===0?[]:xo(a)},resolvedImage:function(a){return aa(a).length===0?[]:xo(a)},padding:function(a){const r=a.key,c=a.value;if(Jt(c)==="array"){if(c.length<1||c.length>4)return[new He(r,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let y=0;y<c.length;y++)g=g.concat(ar({key:`${r}[${y}]`,value:c[y],valueSpec:d}));return g}return Mu({key:r,value:c,valueSpec:{}})}};function ar(a){const r=a.value,c=a.valueSpec,d=a.styleSpec;return c.expression&&dn(Nt(r))?Gd(a):c.expression&&Ya(Gi(r))?xo(a):c.type&&ol[c.type]?ol[c.type](a):Or(wi({},a,{valueSpec:c.type?d[c.type]:c}))}function Jm(a){const r=a.value,c=a.key,d=aa(a);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{range}" token'))),d}function qs(a,r=Me){let c=[];return c=c.concat(ar({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Jm,"*":()=>[]}})),a.constants&&(c=c.concat(rs({key:"constants",value:a.constants,style:a,styleSpec:r}))),Kd(c)}function Kd(a){return[].concat(a).sort((r,c)=>r.line-c.line)}function Ss(a){return function(...r){return Kd(a.apply(this,r))}}qs.source=Ss(rl),qs.light=Ss(sl),qs.terrain=Ss(or),qs.layer=Ss(Xd),qs.filter=Ss(nl),qs.paintProperty=Ss(qd),qs.layoutProperty=Ss(Zd);const al=qs,Lu=al.light,Qm=al.paintProperty,eg=al.layoutProperty;function ic(a,r){let c=!1;if(r&&r.length)for(const d of r)a.fire(new js(new Error(d.message))),c=!0;return c}class ll{constructor(r,c,d){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(c=x[1])+2*(d=x[2]);for(let S=0;S<this.d*this.d;S++){const P=x[3+S],D=x[3+S+1];g.push(P===D?null:x.subarray(P,D))}const T=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=d,this.scale=c/r,this.uid=0;const y=d/c*r;this.min=-y,this.max=r+y}insert(r,c,d,g,y){this._forEachCell(c,d,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,c,d,g,y,x){this.cells[y].push(x)}query(r,c,d,g,y){const x=this.min,T=this.max;if(r<=x&&c<=x&&T<=d&&T<=g&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(r,c,d,g,this._queryCell,S,{},y),S}}_queryCell(r,c,d,g,y,x,T,S){const P=this.cells[y];if(P!==null){const D=this.keys,O=this.bboxes;for(let N=0;N<P.length;N++){const G=P[N];if(T[G]===void 0){const H=4*G;(S?S(O[H+0],O[H+1],O[H+2],O[H+3]):r<=O[H+2]&&c<=O[H+3]&&d>=O[H+0]&&g>=O[H+1])?(T[G]=!0,x.push(D[G])):T[G]=!1}}}}_forEachCell(r,c,d,g,y,x,T,S){const P=this._convertToCellCoord(r),D=this._convertToCellCoord(c),O=this._convertToCellCoord(d),N=this._convertToCellCoord(g);for(let G=P;G<=O;G++)for(let H=D;H<=N;H++){const oe=this.d*H+G;if((!S||S(this._convertFromCellCoord(G),this._convertFromCellCoord(H),this._convertFromCellCoord(G+1),this._convertFromCellCoord(H+1)))&&y.call(this,r,c,d,g,oe,x,T,S))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,c=3+this.cells.length+1+1;let d=0;for(let x=0;x<this.cells.length;x++)d+=this.cells[x].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=c;for(let x=0;x<r.length;x++){const T=r[x];g[3+x]=y,g.set(T,y),y+=T.length}return g[3+r.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+r.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(r,c){const d=r.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(r){return new ll(r.buffer)}}const As={};function st(a,r,c={}){if(As[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),As[a]={klass:r,omit:c.omit||[],shallow:c.shallow||[]}}st("Object",Object),st("TransferableGridIndex",ll),st("Color",Z),st("Error",Error),st("AJAXError",Zn),st("ResolvedImage",fe),st("StylePropertyFunction",Ql),st("StyleExpression",Jl,{omit:["_evaluator"]}),st("ZoomDependentExpression",Cu),st("ZoomConstantExpression",Ja),st("CompoundExpression",Ut,{omit:["_evaluate"]});for(const a in na)na[a]._classRegistryKey||st(`Expression_${a}`,na[a]);function Jd(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function bo(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Jd(a)||zt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return r&&r.push(c.buffer),c}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const d of a)c.push(bo(d,r));return c}if(typeof a=="object"){const c=a.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!As[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(a,r):{};if(c.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in a){if(!a.hasOwnProperty(y)||As[d].omit.indexOf(y)>=0)continue;const x=a[y];g[y]=As[d].shallow.indexOf(y)>=0?x:bo(x,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof a)}function Zs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Jd(a)||zt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Zs);if(typeof a=="object"){const r=a.$name||"Object";if(!As[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:c}=As[r];if(!c)throw new Error(`can't deserialize unregistered class ${r}`);if(c.deserialize)return c.deserialize(a);const d=Object.create(c.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const y=a[g];d[g]=As[r].shallow.indexOf(g)>=0?y:Zs(y)}return d}throw new Error("can't deserialize object of type "+typeof a)}class Ru{constructor(){this.first=!0}update(r,c){const d=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=d,!0))}}const Ke={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function rc(a){for(const r of a)if(zu(r.charCodeAt(0)))return!0;return!1}function tg(a){for(const r of a)if(!Du(r.charCodeAt(0)))return!1;return!0}function Du(a){return!(Ke.Arabic(a)||Ke["Arabic Supplement"](a)||Ke["Arabic Extended-A"](a)||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a))}function zu(a){return!(a!==746&&a!==747&&(a<4352||!(Ke["Bopomofo Extended"](a)||Ke.Bopomofo(a)||Ke["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ke["CJK Compatibility Ideographs"](a)||Ke["CJK Compatibility"](a)||Ke["CJK Radicals Supplement"](a)||Ke["CJK Strokes"](a)||!(!Ke["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ke["CJK Unified Ideographs Extension A"](a)||Ke["CJK Unified Ideographs"](a)||Ke["Enclosed CJK Letters and Months"](a)||Ke["Hangul Compatibility Jamo"](a)||Ke["Hangul Jamo Extended-A"](a)||Ke["Hangul Jamo Extended-B"](a)||Ke["Hangul Jamo"](a)||Ke["Hangul Syllables"](a)||Ke.Hiragana(a)||Ke["Ideographic Description Characters"](a)||Ke.Kanbun(a)||Ke["Kangxi Radicals"](a)||Ke["Katakana Phonetic Extensions"](a)||Ke.Katakana(a)&&a!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ke["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](a)||Ke["Unified Canadian Aboriginal Syllabics Extended"](a)||Ke["Vertical Forms"](a)||Ke["Yijing Hexagram Symbols"](a)||Ke["Yi Syllables"](a)||Ke["Yi Radicals"](a))))}function Qd(a){return!(zu(a)||function(r){return!!(Ke["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ke["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ke["Letterlike Symbols"](r)||Ke["Number Forms"](r)||Ke["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ke["Control Pictures"](r)&&r!==9251||Ke["Optical Character Recognition"](r)||Ke["Enclosed Alphanumerics"](r)||Ke["Geometric Shapes"](r)||Ke["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ke["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ke["CJK Symbols and Punctuation"](r)||Ke.Katakana(r)||Ke["Private Use Area"](r)||Ke["CJK Compatibility Forms"](r)||Ke["Small Form Variants"](r)||Ke["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function ef(a){return a>=1424&&a<=2303||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a)}function ng(a,r){return!(!r&&ef(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ke.Khmer(a))}function tf(a){for(const r of a)if(ef(r.charCodeAt(0)))return!0;return!1}const Ou="deferred",Fu="loading",Bu="loaded";let Nu=null,$i="unavailable",Xs=null;const nf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&($i="error"),Nu&&Nu(a)};function la(){Uu.fire(new Lr("pluginStateChange",{pluginStatus:$i,pluginURL:Xs}))}const Uu=new yr,cl=function(){return $i},rf=function(){if($i!==Ou||!Xs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$i=Fu,la(),Xs&&ji({url:Xs},a=>{a?nf(a):($i=Bu,la())})},br={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$i===Bu||br.applyArabicShaping!=null,isLoading:()=>$i===Fu,setState(a){if(!Be())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");$i=a.pluginStatus,Xs=a.pluginURL},isParsed(){if(!Be())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return br.applyArabicShaping!=null&&br.processBidirectionalText!=null&&br.processStyledBidirectionalText!=null},getPluginURL(){if(!Be())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Xs}};class vn{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ru,this.transition={})}isSupportedScript(r){return function(c,d){for(const g of c)if(!ng(g.charCodeAt(0),d))return!1;return!0}(r,br.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,c=r-Math.floor(r),d=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class ul{constructor(r,c){this.property=r,this.value=c,this.expression=function(d,g){if(dn(d))return new Ql(d,g);if(Ya(d)){const y=Vd(d,g);if(y.result==="error")throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=d;return g.type==="color"&&typeof d=="string"?y=Z.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)||(y=ae.parse(d)),{kind:"constant",evaluate:()=>y}}}(c===void 0?r.specification.default:c,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,c,d){return this.property.possiblyEvaluate(this,r,c,d)}}class sc{constructor(r){this.property=r,this.value=new ul(r,void 0)}transitioned(r,c){return new of(this.property,this.value,c,Q({},r.transition,this.transition),r.now)}untransitioned(){return new of(this.property,this.value,null,{},0)}}class sf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return J(this._values[r].value.value)}setValue(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new sc(this._values[r].property)),this._values[r].value=new ul(this._values[r].property,c===null?void 0:J(c))}getTransition(r){return J(this._values[r].transition)}setTransition(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new sc(this._values[r].property)),this._values[r].transition=J(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d);const g=this.getTransition(c);g!==void 0&&(r[`${c}-transition`]=g)}return r}transitioned(r,c){const d=new af(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(r,c._values[g]);return d}untransitioned(){const r=new af(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}}class of{constructor(r,c,d,g,y){this.property=r,this.value=c,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(r,c,d){const g=r.now||0,y=this.value.possiblyEvaluate(r,c,d),x=this.prior;if(x){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return x.possiblyEvaluate(r,c,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,c,d),y,function(S){if(S<=0)return 0;if(S>=1)return 1;const P=S*S,D=P*S;return 4*(S<.5?D:3*(S-P)+D-.75)}(T))}}return y}}class af{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,d){const g=new hl(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,c,d);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class ig{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return J(this._values[r].value)}setValue(r,c){this._values[r]=new ul(this._values[r].property,c===null?void 0:J(c))}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d)}return r}possiblyEvaluate(r,c,d){const g=new hl(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,c,d);return g}}class as{constructor(r,c,d){this.property=r,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,c,d,g){return this.property.evaluate(this.value,this.parameters,r,c,d,g)}}class hl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ht{constructor(r){this.specification=r}possiblyEvaluate(r,c){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(c)}interpolate(r,c,d){const g=Fn[this.specification.type];return g?g(r,c,d):r}}class bt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,d,g){return new as(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(c,null,{},d,g)}:r.expression,c)}interpolate(r,c,d){if(r.value.kind!=="constant"||c.value.kind!=="constant")return r;if(r.value.value===void 0||c.value.value===void 0)return new as(this,{kind:"constant",value:void 0},r.parameters);const g=Fn[this.specification.type];return g?new as(this,{kind:"constant",value:g(r.value.value,c.value.value,d)},r.parameters):r}evaluate(r,c,d,g,y,x){return r.kind==="constant"?r.value:r.evaluate(c,d,g,y,x)}}class ca extends bt{possiblyEvaluate(r,c,d,g){if(r.value===void 0)return new as(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){const y=r.expression.evaluate(c,null,{},d,g),x=r.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,T=this._calculate(x,x,x,c);return new as(this,{kind:"constant",value:T},c)}if(r.expression.kind==="camera"){const y=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new as(this,{kind:"constant",value:y},c)}return new as(this,r.expression,c)}evaluate(r,c,d,g,y,x){if(r.kind==="source"){const T=r.evaluate(c,d,g,y,x);return this._calculate(T,T,T,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},d,g),r.evaluate({zoom:Math.floor(c.zoom)},d,g),r.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):r.value}_calculate(r,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class Vu{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const y=r.expression.evaluate(c,null,{},d,g);return this._calculate(y,y,y,c)}return this._calculate(r.expression.evaluate(new vn(Math.floor(c.zoom-1),c)),r.expression.evaluate(new vn(Math.floor(c.zoom),c)),r.expression.evaluate(new vn(Math.floor(c.zoom+1),c)),c)}}_calculate(r,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class Ys{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,g){return!!r.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class fi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in r){const d=r[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new ul(d,void 0),y=this.defaultTransitionablePropertyValues[c]=new sc(d);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}st("DataDrivenProperty",bt),st("DataConstantProperty",ht),st("CrossFadedDataDrivenProperty",ca),st("CrossFadedProperty",Vu),st("ColorRampProperty",Ys);const Ks="-transition";class ls extends yr{constructor(r,c){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new ig(c.layout)),c.paint)){this._transitionablePaint=new sf(c.paint);for(const d in r.paint)this.setPaintProperty(d,r.paint[d],{validate:!1});for(const d in r.layout)this.setLayoutProperty(d,r.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hl(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c,d={}){c!=null&&this._validate(eg,`layers.${this.id}.layout.${r}`,r,c,d)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)}getPaintProperty(r){return r.endsWith(Ks)?this._transitionablePaint.getTransition(r.slice(0,-Ks.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,c,d={}){if(c!=null&&this._validate(Qm,`layers.${this.id}.paint.${r}`,r,c,d))return!1;if(r.endsWith(Ks))return this._transitionablePaint.setTransition(r.slice(0,-Ks.length),c||void 0),!1;{const g=this._transitionablePaint._values[r],y=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);const S=this._transitionablePaint._values[r].value;return S.isDataDriven()||x||y||this._handleOverridablePaintPropertyUpdate(r,T,S)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,c,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),$(r,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(r,c,d,g,y={}){return(!y||y.validate!==!1)&&ic(this,r.call(al,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof as&&mn(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const lf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Js{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,c){return r._trim(),c&&(r.isTransferred=!0,c.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gn(a,r=1){let c=0,d=0;return{members:a.map(g=>{const y=lf[g.type].BYTES_PER_ELEMENT,x=c=ju(c,Math.max(r,y)),T=g.components||1;return d=Math.max(d,y),c+=y*T,{name:g.name,type:g.type,components:T,offset:x}}),size:ju(c,Math.max(d,r)),alignment:r}}function ju(a,r){return Math.ceil(a/r)*r}class wo extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.int16[g+0]=c,this.int16[g+1]=d,r}}wo.prototype.bytesPerElement=4,st("StructArrayLayout2i4",wo);class m extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=4*r;return this.int16[x+0]=c,this.int16[x+1]=d,this.int16[x+2]=g,this.int16[x+3]=y,r}}m.prototype.bytesPerElement=8,st("StructArrayLayout4i8",m);class s extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,T){const S=6*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=x,this.int16[S+5]=T,r}}s.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",s);class h extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,T){const S=4*r,P=8*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.uint8[P+4]=g,this.uint8[P+5]=y,this.uint8[P+6]=x,this.uint8[P+7]=T,r}}h.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",h);class p extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.float32[g+0]=c,this.float32[g+1]=d,r}}p.prototype.bytesPerElement=8,st("StructArrayLayout2f8",p);class _ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,T,S,P,D){const O=this.length;return this.resize(O+1),this.emplace(O,r,c,d,g,y,x,T,S,P,D)}emplace(r,c,d,g,y,x,T,S,P,D,O){const N=10*r;return this.uint16[N+0]=c,this.uint16[N+1]=d,this.uint16[N+2]=g,this.uint16[N+3]=y,this.uint16[N+4]=x,this.uint16[N+5]=T,this.uint16[N+6]=S,this.uint16[N+7]=P,this.uint16[N+8]=D,this.uint16[N+9]=O,r}}_.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",_);class v extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,T,S,P,D,O,N){const G=this.length;return this.resize(G+1),this.emplace(G,r,c,d,g,y,x,T,S,P,D,O,N)}emplace(r,c,d,g,y,x,T,S,P,D,O,N,G){const H=12*r;return this.int16[H+0]=c,this.int16[H+1]=d,this.int16[H+2]=g,this.int16[H+3]=y,this.uint16[H+4]=x,this.uint16[H+5]=T,this.uint16[H+6]=S,this.uint16[H+7]=P,this.int16[H+8]=D,this.int16[H+9]=O,this.int16[H+10]=N,this.int16[H+11]=G,r}}v.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",v);class E extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.float32[y+0]=c,this.float32[y+1]=d,this.float32[y+2]=g,r}}E.prototype.bytesPerElement=12,st("StructArrayLayout3f12",E);class A extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}A.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",A);class I extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,T,S,P){const D=this.length;return this.resize(D+1),this.emplace(D,r,c,d,g,y,x,T,S,P)}emplace(r,c,d,g,y,x,T,S,P,D){const O=10*r,N=5*r;return this.int16[O+0]=c,this.int16[O+1]=d,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=x,this.int16[O+5]=T,this.uint32[N+3]=S,this.uint16[O+8]=P,this.uint16[O+9]=D,r}}I.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",I);class k extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,T){const S=6*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=x,this.int16[S+5]=T,r}}k.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",k);class z extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,c,d,g,y)}emplace(r,c,d,g,y,x){const T=4*r,S=8*r;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[S+6]=y,this.int16[S+7]=x,r}}z.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",z);class B extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=12*r,T=3*r;return this.uint8[x+0]=c,this.uint8[x+1]=d,this.float32[T+1]=g,this.float32[T+2]=y,r}}B.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",B);class U extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.uint16[y+0]=c,this.uint16[y+1]=d,this.uint16[y+2]=g,r}}U.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",U);class ie extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve){const Te=this.length;return this.resize(Te+1),this.emplace(Te,r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve)}emplace(r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve,Te){const ge=24*r,we=12*r,De=48*r;return this.int16[ge+0]=c,this.int16[ge+1]=d,this.uint16[ge+2]=g,this.uint16[ge+3]=y,this.uint32[we+2]=x,this.uint32[we+3]=T,this.uint32[we+4]=S,this.uint16[ge+10]=P,this.uint16[ge+11]=D,this.uint16[ge+12]=O,this.float32[we+7]=N,this.float32[we+8]=G,this.uint8[De+36]=H,this.uint8[De+37]=oe,this.uint8[De+38]=se,this.uint32[we+10]=ve,this.int16[ge+22]=Te,r}}ie.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class ee extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve,Te,ge,we,De,Re,it,ct,Je,qe,Ge,Qe){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve,Te,ge,we,De,Re,it,ct,Je,qe,Ge,Qe)}emplace(r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe,se,ve,Te,ge,we,De,Re,it,ct,Je,qe,Ge,Qe,Ze){const Ue=34*r,yt=17*r;return this.int16[Ue+0]=c,this.int16[Ue+1]=d,this.int16[Ue+2]=g,this.int16[Ue+3]=y,this.int16[Ue+4]=x,this.int16[Ue+5]=T,this.int16[Ue+6]=S,this.int16[Ue+7]=P,this.uint16[Ue+8]=D,this.uint16[Ue+9]=O,this.uint16[Ue+10]=N,this.uint16[Ue+11]=G,this.uint16[Ue+12]=H,this.uint16[Ue+13]=oe,this.uint16[Ue+14]=se,this.uint16[Ue+15]=ve,this.uint16[Ue+16]=Te,this.uint16[Ue+17]=ge,this.uint16[Ue+18]=we,this.uint16[Ue+19]=De,this.uint16[Ue+20]=Re,this.uint16[Ue+21]=it,this.uint16[Ue+22]=ct,this.uint32[yt+12]=Je,this.float32[yt+13]=qe,this.float32[yt+14]=Ge,this.float32[yt+15]=Qe,this.float32[yt+16]=Ze,r}}ee.prototype.bytesPerElement=68,st("StructArrayLayout8i15ui1ul4f68",ee);class te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}te.prototype.bytesPerElement=4,st("StructArrayLayout1f4",te);class he extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.int16[y+0]=c,this.int16[y+1]=d,this.int16[y+2]=g,r}}he.prototype.bytesPerElement=6,st("StructArrayLayout3i6",he);class me extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=4*r;return this.uint32[2*r+0]=c,this.uint16[y+2]=d,this.uint16[y+3]=g,r}}me.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",me);class xe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.uint16[g+0]=c,this.uint16[g+1]=d,r}}xe.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",xe);class re extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}re.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",re);class Ee extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=4*r;return this.float32[x+0]=c,this.float32[x+1]=d,this.float32[x+2]=g,this.float32[x+3]=y,r}}Ee.prototype.bytesPerElement=16,st("StructArrayLayout4f16",Ee);class be extends Js{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xt(this.anchorPointX,this.anchorPointY)}}be.prototype.size=20;class ke extends I{get(r){return new be(this,r)}}st("CollisionBoxArray",ke);class Le extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Le.prototype.size=48;class Fe extends ie{get(r){return new Le(this,r)}}st("PlacedSymbolArray",Fe);class Ce extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ce.prototype.size=68;class et extends ee{get(r){return new Ce(this,r)}}st("SymbolInstanceArray",et);class We extends te{getoffsetX(r){return this.float32[1*r+0]}}st("GlyphOffsetArray",We);class nt extends he{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}st("SymbolLineVertexArray",nt);class Ct extends Js{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ct.prototype.size=8;class Lt extends me{get(r){return new Ct(this,r)}}st("FeatureIndexArray",Lt);class _t extends wo{}class rn extends wo{}class sn extends wo{}class $t extends s{}class Ht extends h{}class an extends p{}class si extends _{}class cs extends v{}class Fr extends E{}class us extends A{}class Qs extends k{}class wr extends B{}class Hi extends U{}class Is extends xe{}const oc=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kn}=oc;class Bt{constructor(r=[]){this.segments=r}prepareSegment(r,c,d,g){let y=this.segments[this.segments.length-1];return r>Bt.MAX_VERTEX_ARRAY_LENGTH&&ye(`Max vertices per segment is ${Bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>Bt.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,d,g){return new Bt([{vertexOffset:r,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function en(a,r){return 256*(a=C(Math.floor(a),0,255))+C(Math.floor(r),0,255)}Bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",Bt);const oi=Gn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ai={exports:{}},xn={exports:{}};xn.exports=function(a,r){var c,d,g,y,x,T,S,P;for(d=a.length-(c=3&a.length),g=r,x=3432918353,T=461845907,P=0;P<d;)S=255&a.charCodeAt(P)|(255&a.charCodeAt(++P))<<8|(255&a.charCodeAt(++P))<<16|(255&a.charCodeAt(++P))<<24,++P,g=27492+(65535&(y=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*T+(((S>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&a.charCodeAt(P+2))<<16;case 2:S^=(255&a.charCodeAt(P+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&a.charCodeAt(P)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*T+(((S>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Er={exports:{}};Er.exports=function(a,r){for(var c,d=a.length,g=r^d,y=0;d>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:g^=(255&a.charCodeAt(y+2))<<16;case 2:g^=(255&a.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Eo=xn.exports,Gu=Er.exports;ai.exports=Eo,ai.exports.murmur3=Eo,ai.exports.murmur2=Gu;class ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,c,d,g){this.ids.push(cf(r)),this.positions.push(c,d,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=cf(r);let d=0,g=this.ids.length-1;for(;d<g;){const x=d+g>>1;this.ids[x]>=c?g=x:d=x+1}const y=[];for(;this.ids[d]===c;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(r,c){const d=new Float64Array(r.ids),g=new Uint32Array(r.positions);return $u(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(r){const c=new ua;return c.ids=r.ids,c.positions=r.positions,c.indexed=!0,c}}function cf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:ai.exports(String(a))}function $u(a,r,c,d){for(;c<d;){const g=a[c+d>>1];let y=c-1,x=d+1;for(;;){do y++;while(a[y]<g);do x--;while(a[x]>g);if(y>=x)break;eo(a,y,x),eo(r,3*y,3*x),eo(r,3*y+1,3*x+1),eo(r,3*y+2,3*x+2)}x-c<d-x?($u(a,r,c,x),c=x+1):($u(a,r,x+1,d),d=x)}}function eo(a,r,c){const d=a[r];a[r]=a[c],a[c]=d}st("FeaturePositionMap",ua);class To{constructor(r,c){this.gl=r.gl,this.location=c}}class So extends To{constructor(r,c){super(r,c),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class ac extends To{constructor(r,c){super(r,c),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Vv extends To{constructor(r,c){super(r,c),this.current=Z.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const OA=new Float32Array(16);function rg(a){return[en(255*a.r,255*a.g),en(255*a.b,255*a.a)]}class Hu{constructor(r,c,d){this.value=r,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(r,c,d){r.set(d.constantOr(this.value))}getBinding(r,c,d){return this.type==="color"?new Vv(r,c):new So(r,c)}}class lc{constructor(r,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=r.tlbr}setUniform(r,c,d,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&r.set(y)}getBinding(r,c,d){return d.substr(0,9)==="u_pattern"?new ac(r,c):new So(r,c)}}class Ao{constructor(r,c,d,g){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,c,d,g,y){const x=this.paintVertexArray.length,T=this.expression.evaluate(new vn(0),c,{},g,[],y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,T)}updatePaintArray(r,c,d,g){const y=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(r,c,y)}_setPaintValue(r,c,d){if(this.type==="color"){const g=rg(d);for(let y=r;y<c;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(r,c,d,g,y,x){this.expression=r,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,c,d,g,y){const x=this.expression.evaluate(new vn(this.zoom),c,{},g,[],y),T=this.expression.evaluate(new vn(this.zoom+1),c,{},g,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,x,T)}updatePaintArray(r,c,d,g){const y=this.expression.evaluate({zoom:this.zoom},d,g),x=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(r,c,y,x)}_setPaintValue(r,c,d,g){if(this.type==="color"){const y=rg(d),x=rg(g);for(let T=r;T<c;T++)this.paintVertexArray.emplace(T,y[0],y[1],x[0],x[1])}else{for(let y=r;y<c;y++)this.paintVertexArray.emplace(y,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=C(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,c,d){return new So(r,c)}}class ha{constructor(r,c,d,g,y,x){this.expression=r,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(r,c,d,g,y){this._setPaintValues(r,c,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(r,c,d,g){if(!g||!d)return;const{min:y,mid:x,max:T}=d,S=g[y],P=g[x],D=g[T];if(S&&P&&D)for(let O=r;O<c;O++)this.zoomInPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],P.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],P.pixelRatio,D.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,oi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,oi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class jv{constructor(r,c,d){this.binders={},this._buffers=[];const g=[];for(const y in r.paint._values){if(!d(y))continue;const x=r.paint.get(y);if(!(x instanceof as&&mn(x.property.specification)))continue;const T=FA(y,r.type),S=x.value,P=x.property.specification.type,D=x.property.useIntegerZoom,O=x.property.specification["property-type"],N=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=N?new lc(S.value,T):new Hu(S.value,T,P),g.push(`/u_${y}`);else if(S.kind==="source"||N){const G=Gv(y,P,"source");this.binders[y]=N?new ha(S,P,D,c,G,r.id):new Ao(S,T,P,G),g.push(`/a_${y}`)}else{const G=Gv(y,P,"composite");this.binders[y]=new Ps(S,T,P,D,c,G),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof Ao||c instanceof Ps?c.maxValue:0}populatePaintArrays(r,c,d,g,y){for(const x in this.binders){const T=this.binders[x];(T instanceof Ao||T instanceof Ps||T instanceof ha)&&T.populatePaintArray(r,c,d,g,y)}}setConstantPatternPositions(r,c){for(const d in this.binders){const g=this.binders[d];g instanceof lc&&g.setConstantPatternPositions(r,c)}}updatePaintArrays(r,c,d,g,y){let x=!1;for(const T in r){const S=c.getPositions(T);for(const P of S){const D=d.feature(P.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof Ao||N instanceof Ps||N instanceof ha)&&N.expression.isStateDependent===!0){const G=g.paint.get(O);N.expression=G.value,N.updatePaintArray(P.start,P.end,D,r[T],y),x=!0}}}}return x}defines(){const r=[];for(const c in this.binders){const d=this.binders[c];(d instanceof Hu||d instanceof lc)&&r.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Ao||d instanceof Ps)for(let g=0;g<d.paintVertexAttributes.length;g++)r.push(d.paintVertexAttributes[g].name);else if(d instanceof ha)for(let g=0;g<oi.members.length;g++)r.push(oi.members[g].name)}return r}getBinderUniforms(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Hu||d instanceof lc||d instanceof Ps)for(const g of d.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,c){const d=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof Hu||y instanceof lc||y instanceof Ps){for(const x of y.uniformNames)if(c[x]){const T=y.getBinding(r,c[x],x);d.push({name:x,property:g,binding:T})}}}return d}setUniforms(r,c,d,g){for(const{name:y,property:x,binding:T}of c)this.binders[x].setUniform(T,g,d.get(x),y)}updatePaintBuffers(r){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(r&&d instanceof ha){const g=r.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof Ao||d instanceof Ps)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(r){for(const c in this.binders){const d=this.binders[c];(d instanceof Ao||d instanceof Ps||d instanceof ha)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof Ao||c instanceof Ps||c instanceof ha)&&c.destroy()}}}class dl{constructor(r,c,d=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new jv(g,c,d);this.needsUpload=!1,this._featureMap=new ua,this._bufferOffset=0}populatePaintArrays(r,c,d,g,y,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,c,g,y,x);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,d,g){for(const y of d)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,c,y,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function FA(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function Gv(a,r,c){const d={color:{source:p,composite:Ee},number:{source:te,composite:p}},g=function(y){return{"line-pattern":{source:si,composite:si},"fill-pattern":{source:si,composite:si},"fill-extrusion-pattern":{source:si,composite:si}}[y]}(a);return g&&g[c]||d[r][c]}st("ConstantBinder",Hu),st("CrossFadedConstantBinder",lc),st("SourceExpressionBinder",Ao),st("CrossFadedCompositeBinder",ha),st("CompositeExpressionBinder",Ps),st("ProgramConfiguration",jv,{omit:["_buffers"]}),st("ProgramConfigurationSet",dl);var Jn=8192;const sg=Math.pow(2,14)-1,$v=-sg-1;function fl(a){const r=Jn/a.extent,c=a.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let y=0;y<g.length;y++){const x=g[y],T=Math.round(x.x*r),S=Math.round(x.y*r);x.x=C(T,$v,sg),x.y=C(S,$v,sg),(T<x.x||T>x.x+1||S<x.y||S>x.y+1)&&ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function pl(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?fl(a):[]}}function uf(a,r,c,d,g){a.emplaceBack(2*r+(d+1)/2,2*c+(g+1)/2)}class og{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new rn,this.indexArray=new Hi,this.segments=new Bt,this.programConfigurations=new dl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){const g=this.layers[0],y=[];let x=null,T=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:S,id:P,index:D,sourceLayerIndex:O}of r){const N=this.layers[0]._featureFilter.needGeometry,G=pl(S,N);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),G,d))continue;const H=T?x.evaluate(G,{},d):void 0,oe={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:N?G.geometry:fl(S),patterns:{},sortKey:H};y.push(oe)}T&&y.sort((S,P)=>S.sortKey-P.sortKey);for(const S of y){const{geometry:P,index:D,sourceLayerIndex:O}=S,N=r[D].feature;this.addFeature(S,P,D,d),c.featureIndex.insert(N,P,D,O,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Kn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,d,g){for(const y of c)for(const x of y){const T=x.x,S=x.y;if(T<0||T>=Jn||S<0||S>=Jn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),D=P.vertexLength;uf(this.layoutVertexArray,T,S,-1,-1),uf(this.layoutVertexArray,T,S,1,-1),uf(this.layoutVertexArray,T,S,1,1),uf(this.layoutVertexArray,T,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},g)}}function Hv(a,r){for(let c=0;c<a.length;c++)if(cc(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(cc(a,r[c]))return!0;return!!ag(a,r)}function BA(a,r,c){return!!cc(a,r)||!!lg(r,a,c)}function Wv(a,r){if(a.length===1)return Zv(r,a[0]);for(let c=0;c<r.length;c++){const d=r[c];for(let g=0;g<d.length;g++)if(cc(a,d[g]))return!0}for(let c=0;c<a.length;c++)if(Zv(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(ag(a,r[c]))return!0;return!1}function NA(a,r,c){if(a.length>1){if(ag(a,r))return!0;for(let d=0;d<r.length;d++)if(lg(r[d],a,c))return!0}for(let d=0;d<a.length;d++)if(lg(a[d],r,c))return!0;return!1}function ag(a,r){if(a.length===0||r.length===0)return!1;for(let c=0;c<a.length-1;c++){const d=a[c],g=a[c+1];for(let y=0;y<r.length-1;y++)if(UA(d,g,r[y],r[y+1]))return!0}return!1}function UA(a,r,c,d){return Ae(a,c,d)!==Ae(r,c,d)&&Ae(a,r,c)!==Ae(a,r,d)}function lg(a,r,c){const d=c*c;if(r.length===1)return a.distSqr(r[0])<d;for(let g=1;g<r.length;g++)if(qv(a,r[g-1],r[g])<d)return!0;return!1}function qv(a,r,c){const d=r.distSqr(c);if(d===0)return a.distSqr(r);const g=((a.x-r.x)*(c.x-r.x)+(a.y-r.y)*(c.y-r.y))/d;return a.distSqr(g<0?r:g>1?c:c.sub(r)._mult(g)._add(r))}function Zv(a,r){let c,d,g,y=!1;for(let x=0;x<a.length;x++){c=a[x];for(let T=0,S=c.length-1;T<c.length;S=T++)d=c[T],g=c[S],d.y>r.y!=g.y>r.y&&r.x<(g.x-d.x)*(r.y-d.y)/(g.y-d.y)+d.x&&(y=!y)}return y}function cc(a,r){let c=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const y=a[d],x=a[g];y.y>r.y!=x.y>r.y&&r.x<(x.x-y.x)*(r.y-y.y)/(x.y-y.y)+y.x&&(c=!c)}return c}function VA(a,r,c){const d=c[0],g=c[2];if(a.x<d.x&&r.x<d.x||a.x>g.x&&r.x>g.x||a.y<d.y&&r.y<d.y||a.y>g.y&&r.y>g.y)return!1;const y=Ae(a,r,c[0]);return y!==Ae(a,r,c[1])||y!==Ae(a,r,c[2])||y!==Ae(a,r,c[3])}function Wu(a,r,c){const d=r.paint.get(a).value;return d.kind==="constant"?d.value:c.programConfigurations.get(r.id).getMaxValue(a)}function hf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function df(a,r,c,d,g){if(!r[0]&&!r[1])return a;const y=xt.convert(r)._mult(g);c==="viewport"&&y._rotate(-d);const x=[];for(let T=0;T<a.length;T++)x.push(a[T].sub(y));return x}st("CircleBucket",og,{omit:["layers"]});const jA=new fi({"circle-sort-key":new bt(Me.layout_circle["circle-sort-key"])});var GA={paint:new fi({"circle-radius":new bt(Me.paint_circle["circle-radius"]),"circle-color":new bt(Me.paint_circle["circle-color"]),"circle-blur":new bt(Me.paint_circle["circle-blur"]),"circle-opacity":new bt(Me.paint_circle["circle-opacity"]),"circle-translate":new ht(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(Me.paint_circle["circle-stroke-opacity"])}),layout:jA},Wi=1e-6,qi=typeof Float32Array<"u"?Float32Array:Array;function Xv(){var a=new qi(9);return qi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function cg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Yv(a,r,c){var d=r[0],g=r[1],y=r[2],x=r[3],T=r[4],S=r[5],P=r[6],D=r[7],O=r[8],N=r[9],G=r[10],H=r[11],oe=r[12],se=r[13],ve=r[14],Te=r[15],ge=c[0],we=c[1],De=c[2],Re=c[3];return a[0]=ge*d+we*T+De*O+Re*oe,a[1]=ge*g+we*S+De*N+Re*se,a[2]=ge*y+we*P+De*G+Re*ve,a[3]=ge*x+we*D+De*H+Re*Te,a[4]=(ge=c[4])*d+(we=c[5])*T+(De=c[6])*O+(Re=c[7])*oe,a[5]=ge*g+we*S+De*N+Re*se,a[6]=ge*y+we*P+De*G+Re*ve,a[7]=ge*x+we*D+De*H+Re*Te,a[8]=(ge=c[8])*d+(we=c[9])*T+(De=c[10])*O+(Re=c[11])*oe,a[9]=ge*g+we*S+De*N+Re*se,a[10]=ge*y+we*P+De*G+Re*ve,a[11]=ge*x+we*D+De*H+Re*Te,a[12]=(ge=c[12])*d+(we=c[13])*T+(De=c[14])*O+(Re=c[15])*oe,a[13]=ge*g+we*S+De*N+Re*se,a[14]=ge*y+we*P+De*G+Re*ve,a[15]=ge*x+we*D+De*H+Re*Te,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var qu,$A=Yv;function Kv(){var a=new qi(3);return qi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Jv(a,r,c){var d=new qi(3);return d[0]=a,d[1]=r,d[2]=c,d}function ff(a,r,c){var d=r[0],g=r[1],y=r[2],x=r[3];return a[0]=c[0]*d+c[4]*g+c[8]*y+c[12]*x,a[1]=c[1]*d+c[5]*g+c[9]*y+c[13]*x,a[2]=c[2]*d+c[6]*g+c[10]*y+c[14]*x,a[3]=c[3]*d+c[7]*g+c[11]*y+c[15]*x,a}function Qv(){var a=new qi(4);return qi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function ex(a,r){const c=ff([],[a.x,a.y,0,1],r);return new xt(c[0]/c[3],c[1]/c[3])}Kv(),qu=new qi(4),qi!=Float32Array&&(qu[0]=0,qu[1]=0,qu[2]=0,qu[3]=0),Kv(),Jv(1,0,0),Jv(0,1,0),Qv(),Qv(),Xv(),function(){var a;a=new qi(2),qi!=Float32Array&&(a[0]=0,a[1]=0)}();class tx extends og{}st("HeatmapBucket",tx,{omit:["layers"]});var HA={paint:new fi({"heatmap-radius":new bt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ys(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(Me.paint_heatmap["heatmap-opacity"])})};function ug(a,{width:r,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*c*d}`)}else g=new Uint8Array(r*c*d);return a.width=r,a.height=c,a.data=g,a}function nx(a,{width:r,height:c},d){if(r===a.width&&c===a.height)return;const g=ug({},{width:r,height:c},d);hg(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,c)},d),a.width=r,a.height=c,a.data=g.data}function hg(a,r,c,d,g,y){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||c.x>a.width-g.width||c.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||d.x>r.width-g.width||d.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,T=r.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<g.height;S++){const P=((c.y+S)*a.width+c.x)*y,D=((d.y+S)*r.width+d.x)*y;for(let O=0;O<g.width*y;O++)T[D+O]=x[P+O]}return r}class Zu{constructor(r,c){ug(this,r,1,c)}resize(r){nx(this,r,1)}clone(){return new Zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,g,y){hg(r,c,d,g,y,1)}}class Br{constructor(r,c){ug(this,r,4,c)}resize(r){nx(this,r,4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,g,y){hg(r,c,d,g,y,4)}}function ix(a){const r={},c=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new Br({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const y=(x,T,S)=>{r[a.evaluationKey]=S;const P=a.expression.evaluate(r);g.data[x+T+0]=Math.floor(255*P.r/P.a),g.data[x+T+1]=Math.floor(255*P.g/P.a),g.data[x+T+2]=Math.floor(255*P.b/P.a),g.data[x+T+3]=Math.floor(255*P.a)};if(a.clips)for(let x=0,T=0;x<d;++x,T+=4*c)for(let S=0,P=0;S<c;S++,P+=4){const D=S/(c-1),{start:O,end:N}=a.clips[x];y(T,P,O*(1-D)+N*D)}else for(let x=0,T=0;x<c;x++,T+=4)y(0,T,x/(c-1));return g}st("AlphaImage",Zu),st("RGBAImage",Br);var WA={paint:new fi({"hillshade-illumination-direction":new ht(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ht(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(Me.paint_hillshade["hillshade-accent-color"])})};const qA=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ZA}=qA;var pf={exports:{}};function mf(a,r,c){c=c||2;var d,g,y,x,T,S,P,D=r&&r.length,O=D?r[0]*c:a.length,N=rx(a,0,O,c,!0),G=[];if(!N||N.next===N.prev)return G;if(D&&(N=function(oe,se,ve,Te){var ge,we,De,Re=[];for(ge=0,we=se.length;ge<we;ge++)(De=rx(oe,se[ge]*Te,ge<we-1?se[ge+1]*Te:oe.length,Te,!1))===De.next&&(De.steiner=!0),Re.push(nI(De));for(Re.sort(QA),ge=0;ge<Re.length;ge++)ve=eI(Re[ge],ve);return ve}(a,r,N,c)),a.length>80*c){d=y=a[0],g=x=a[1];for(var H=c;H<O;H+=c)(T=a[H])<d&&(d=T),(S=a[H+1])<g&&(g=S),T>y&&(y=T),S>x&&(x=S);P=(P=Math.max(y-d,x-g))!==0?32767/P:0}return Xu(N,G,c,d,g,P,0),G}function rx(a,r,c,d,g){var y,x;if(g===pg(a,r,c,d)>0)for(y=r;y<c;y+=d)x=ax(y,a[y],a[y+1],x);else for(y=c-d;y>=r;y-=d)x=ax(y,a[y],a[y+1],x);return x&&gf(x,x.next)&&(Ku(x),x=x.next),x}function ml(a,r){if(!a)return a;r||(r=a);var c,d=a;do if(c=!1,d.steiner||!gf(d,d.next)&&Bn(d.prev,d,d.next)!==0)d=d.next;else{if(Ku(d),(d=r=d.prev)===d.next)break;c=!0}while(c||d!==r);return r}function Xu(a,r,c,d,g,y,x){if(a){!x&&y&&function(D,O,N,G){var H=D;do H.z===0&&(H.z=dg(H.x,H.y,O,N,G)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,function(oe){var se,ve,Te,ge,we,De,Re,it,ct=1;do{for(ve=oe,oe=null,we=null,De=0;ve;){for(De++,Te=ve,Re=0,se=0;se<ct&&(Re++,Te=Te.nextZ);se++);for(it=ct;Re>0||it>0&&Te;)Re!==0&&(it===0||!Te||ve.z<=Te.z)?(ge=ve,ve=ve.nextZ,Re--):(ge=Te,Te=Te.nextZ,it--),we?we.nextZ=ge:oe=ge,ge.prevZ=we,we=ge;ve=Te}we.nextZ=null,ct*=2}while(De>1)}(H)}(a,d,g,y);for(var T,S,P=a;a.prev!==a.next;)if(T=a.prev,S=a.next,y?YA(a,d,g,y):XA(a))r.push(T.i/c|0),r.push(a.i/c|0),r.push(S.i/c|0),Ku(a),a=S.next,P=S.next;else if((a=S)===P){x?x===1?Xu(a=KA(ml(a),r,c),r,c,d,g,y,2):x===2&&JA(a,r,c,d,g,y):Xu(ml(a),r,c,d,g,y,1);break}}}function XA(a){var r=a.prev,c=a,d=a.next;if(Bn(r,c,d)>=0)return!1;for(var g=r.x,y=c.x,x=d.x,T=r.y,S=c.y,P=d.y,D=g<y?g<x?g:x:y<x?y:x,O=T<S?T<P?T:P:S<P?S:P,N=g>y?g>x?g:x:y>x?y:x,G=T>S?T>P?T:P:S>P?S:P,H=d.next;H!==r;){if(H.x>=D&&H.x<=N&&H.y>=O&&H.y<=G&&uc(g,T,y,S,x,P,H.x,H.y)&&Bn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function YA(a,r,c,d){var g=a.prev,y=a,x=a.next;if(Bn(g,y,x)>=0)return!1;for(var T=g.x,S=y.x,P=x.x,D=g.y,O=y.y,N=x.y,G=T<S?T<P?T:P:S<P?S:P,H=D<O?D<N?D:N:O<N?O:N,oe=T>S?T>P?T:P:S>P?S:P,se=D>O?D>N?D:N:O>N?O:N,ve=dg(G,H,r,c,d),Te=dg(oe,se,r,c,d),ge=a.prevZ,we=a.nextZ;ge&&ge.z>=ve&&we&&we.z<=Te;){if(ge.x>=G&&ge.x<=oe&&ge.y>=H&&ge.y<=se&&ge!==g&&ge!==x&&uc(T,D,S,O,P,N,ge.x,ge.y)&&Bn(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,we.x>=G&&we.x<=oe&&we.y>=H&&we.y<=se&&we!==g&&we!==x&&uc(T,D,S,O,P,N,we.x,we.y)&&Bn(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;ge&&ge.z>=ve;){if(ge.x>=G&&ge.x<=oe&&ge.y>=H&&ge.y<=se&&ge!==g&&ge!==x&&uc(T,D,S,O,P,N,ge.x,ge.y)&&Bn(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;we&&we.z<=Te;){if(we.x>=G&&we.x<=oe&&we.y>=H&&we.y<=se&&we!==g&&we!==x&&uc(T,D,S,O,P,N,we.x,we.y)&&Bn(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function KA(a,r,c){var d=a;do{var g=d.prev,y=d.next.next;!gf(g,y)&&sx(g,d,d.next,y)&&Yu(g,y)&&Yu(y,g)&&(r.push(g.i/c|0),r.push(d.i/c|0),r.push(y.i/c|0),Ku(d),Ku(d.next),d=a=y),d=d.next}while(d!==a);return ml(d)}function JA(a,r,c,d,g,y){var x=a;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&iI(x,T)){var S=ox(x,T);return x=ml(x,x.next),S=ml(S,S.next),Xu(x,r,c,d,g,y,0),void Xu(S,r,c,d,g,y,0)}T=T.next}x=x.next}while(x!==a)}function QA(a,r){return a.x-r.x}function eI(a,r){var c=function(g,y){var x,T=y,S=g.x,P=g.y,D=-1/0;do{if(P<=T.y&&P>=T.next.y&&T.next.y!==T.y){var O=T.x+(P-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(O<=S&&O>D&&(D=O,x=T.x<T.next.x?T:T.next,O===S))return x}T=T.next}while(T!==y);if(!x)return null;var N,G=x,H=x.x,oe=x.y,se=1/0;T=x;do S>=T.x&&T.x>=H&&S!==T.x&&uc(P<oe?S:D,P,H,oe,P<oe?D:S,P,T.x,T.y)&&(N=Math.abs(P-T.y)/(S-T.x),Yu(T,g)&&(N<se||N===se&&(T.x>x.x||T.x===x.x&&tI(x,T)))&&(x=T,se=N)),T=T.next;while(T!==G);return x}(a,r);if(!c)return r;var d=ox(c,a);return ml(d,d.next),ml(c,c.next)}function tI(a,r){return Bn(a.prev,a,r.prev)<0&&Bn(r.next,a,a.next)<0}function dg(a,r,c,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function nI(a){var r=a,c=a;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==a);return c}function uc(a,r,c,d,g,y,x,T){return(g-x)*(r-T)>=(a-x)*(y-T)&&(a-x)*(d-T)>=(c-x)*(r-T)&&(c-x)*(y-T)>=(g-x)*(d-T)}function iI(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&sx(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(a,r)&&(Yu(a,r)&&Yu(r,a)&&function(c,d){var g=c,y=!1,x=(c.x+d.x)/2,T=(c.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&x<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==c);return y}(a,r)&&(Bn(a.prev,a,r.prev)||Bn(a,r.prev,r))||gf(a,r)&&Bn(a.prev,a,a.next)>0&&Bn(r.prev,r,r.next)>0)}function Bn(a,r,c){return(r.y-a.y)*(c.x-r.x)-(r.x-a.x)*(c.y-r.y)}function gf(a,r){return a.x===r.x&&a.y===r.y}function sx(a,r,c,d){var g=yf(Bn(a,r,c)),y=yf(Bn(a,r,d)),x=yf(Bn(c,d,a)),T=yf(Bn(c,d,r));return g!==y&&x!==T||!(g!==0||!_f(a,c,r))||!(y!==0||!_f(a,d,r))||!(x!==0||!_f(c,a,d))||!(T!==0||!_f(c,r,d))}function _f(a,r,c){return r.x<=Math.max(a.x,c.x)&&r.x>=Math.min(a.x,c.x)&&r.y<=Math.max(a.y,c.y)&&r.y>=Math.min(a.y,c.y)}function yf(a){return a>0?1:a<0?-1:0}function Yu(a,r){return Bn(a.prev,a,a.next)<0?Bn(a,r,a.next)>=0&&Bn(a,a.prev,r)>=0:Bn(a,r,a.prev)<0||Bn(a,a.next,r)<0}function ox(a,r){var c=new fg(a.i,a.x,a.y),d=new fg(r.i,r.x,r.y),g=a.next,y=r.prev;return a.next=r,r.prev=a,c.next=g,g.prev=c,d.next=c,c.prev=d,y.next=d,d.prev=y,d}function ax(a,r,c,d){var g=new fg(a,r,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Ku(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function fg(a,r,c){this.i=a,this.x=r,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pg(a,r,c,d){for(var g=0,y=r,x=c-d;y<c;y+=d)g+=(a[x]-a[y])*(a[y+1]+a[x+1]),x=y;return g}function rI(a,r,c,d,g){lx(a,r,c||0,d||a.length-1,g||sI)}function lx(a,r,c,d,g){for(;d>c;){if(d-c>600){var y=d-c+1,x=r-c+1,T=Math.log(y),S=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*S*(y-S)/y)*(x-y/2<0?-1:1);lx(a,r,Math.max(c,Math.floor(r-x*S/y+P)),Math.min(d,Math.floor(r+(y-x)*S/y+P)),g)}var D=a[r],O=c,N=d;for(Ju(a,c,r),g(a[d],D)>0&&Ju(a,c,d);O<N;){for(Ju(a,O,N),O++,N--;g(a[O],D)<0;)O++;for(;g(a[N],D)>0;)N--}g(a[c],D)===0?Ju(a,c,N):Ju(a,++N,d),N<=r&&(c=N+1),r<=N&&(d=N-1)}}function Ju(a,r,c){var d=a[r];a[r]=a[c],a[c]=d}function sI(a,r){return a<r?-1:a>r?1:0}function mg(a,r){const c=a.length;if(c<=1)return[a];const d=[];let g,y;for(let x=0;x<c;x++){const T=Oe(a[x]);T!==0&&(a[x].area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(g&&d.push(g),g=[a[x]]):g.push(a[x]))}if(g&&d.push(g),r>1)for(let x=0;x<d.length;x++)d[x].length<=r||(rI(d[x],r,1,d[x].length-1,oI),d[x]=d[x].slice(0,r));return d}function oI(a,r){return r.area-a.area}function gg(a,r,c){const d=c.patternDependencies;let g=!1;for(const y of r){const x=y.paint.get(`${a}-pattern`);x.isConstant()||(g=!0);const T=x.constantOr(null);T&&(g=!0,d[T.to]=!0,d[T.from]=!0)}return g}function _g(a,r,c,d,g){const y=g.patternDependencies;for(const x of r){const T=x.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:d-1},c,{},g.availableImages),P=T.evaluate({zoom:d},c,{},g.availableImages),D=T.evaluate({zoom:d+1},c,{},g.availableImages);S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,D=D&&D.name?D.name:D,y[S]=!0,y[P]=!0,y[D]=!0,c.patterns[x.id]={min:S,mid:P,max:D}}}return c}pf.exports=mf,pf.exports.default=mf,mf.deviation=function(a,r,c,d){var g=r&&r.length,y=Math.abs(pg(a,0,g?r[0]*c:a.length,c));if(g)for(var x=0,T=r.length;x<T;x++)y-=Math.abs(pg(a,r[x]*c,x<T-1?r[x+1]*c:a.length,c));var S=0;for(x=0;x<d.length;x+=3){var P=d[x]*c,D=d[x+1]*c,O=d[x+2]*c;S+=Math.abs((a[P]-a[O])*(a[D+1]-a[P+1])-(a[P]-a[D])*(a[O+1]-a[P+1]))}return y===0&&S===0?0:Math.abs((S-y)/y)},mf.flatten=function(a){for(var r=a[0][0].length,c={vertices:[],holes:[],dimensions:r},d=0,g=0;g<a.length;g++){for(var y=0;y<a[g].length;y++)for(var x=0;x<r;x++)c.vertices.push(a[g][y][x]);g>0&&c.holes.push(d+=a[g-1].length)}return c};class yg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sn,this.indexArray=new Hi,this.indexArray2=new Is,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new Bt,this.segments2=new Bt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=gg("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),x=[];for(const{feature:T,id:S,index:P,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,N=pl(T,O);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d,c.availableImages):void 0,H={id:S,properties:T.properties,type:T.type,sourceLayerIndex:D,index:P,geometry:O?N.geometry:fl(T),patterns:{},sortKey:G};x.push(H)}y&&x.sort((T,S)=>T.sortKey-S.sortKey);for(const T of x){const{geometry:S,index:P,sourceLayerIndex:D}=T;if(this.hasPattern){const O=_g("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(T,S,P,d,{});c.featureIndex.insert(r[P].feature,S,P,D,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ZA),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,c,d,g,y){for(const x of mg(c,500)){let T=0;for(const G of x)T+=G.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=S.vertexLength,D=[],O=[];for(const G of x){if(G.length===0)continue;G!==x[0]&&O.push(D.length/2);const H=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),oe=H.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(oe+G.length-1,oe),D.push(G[0].x),D.push(G[0].y);for(let se=1;se<G.length;se++)this.layoutVertexArray.emplaceBack(G[se].x,G[se].y),this.indexArray2.emplaceBack(oe+se-1,oe+se),D.push(G[se].x),D.push(G[se].y);H.vertexLength+=G.length,H.primitiveLength+=G.length}const N=pf.exports(D,O);for(let G=0;G<N.length;G+=3)this.indexArray.emplaceBack(P+N[G],P+N[G+1],P+N[G+2]);S.vertexLength+=T,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}}st("FillBucket",yg,{omit:["layers","patternFeatures"]});const aI=new fi({"fill-sort-key":new bt(Me.layout_fill["fill-sort-key"])});var lI={paint:new fi({"fill-antialias":new ht(Me.paint_fill["fill-antialias"]),"fill-opacity":new bt(Me.paint_fill["fill-opacity"]),"fill-color":new bt(Me.paint_fill["fill-color"]),"fill-outline-color":new bt(Me.paint_fill["fill-outline-color"]),"fill-translate":new ht(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ca(Me.paint_fill["fill-pattern"])}),layout:aI};const cI=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),uI=Gn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hI}=cI;var da={},dI=xt,cx=hc;function hc(a,r,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=g,a.readFields(fI,this,r)}function fI(a,r,c){a==1?r.id=c.readVarint():a==2?function(d,g){for(var y=d.readVarint()+d.pos;d.pos<y;){var x=g._keys[d.readVarint()],T=g._values[d.readVarint()];g.properties[x]=T}}(c,r):a==3?r.type=c.readVarint():a==4&&(r._geometry=c.pos)}function pI(a){for(var r,c,d=0,g=0,y=a.length,x=y-1;g<y;x=g++)d+=((c=a[x]).x-(r=a[g]).x)*(r.y+c.y);return d}hc.types=["Unknown","Point","LineString","Polygon"],hc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,c=a.readVarint()+a.pos,d=1,g=0,y=0,x=0,T=[];a.pos<c;){if(g<=0){var S=a.readVarint();d=7&S,g=S>>3}if(g--,d===1||d===2)y+=a.readSVarint(),x+=a.readSVarint(),d===1&&(r&&T.push(r),r=[]),r.push(new dI(y,x));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&T.push(r),T},hc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,c=1,d=0,g=0,y=0,x=1/0,T=-1/0,S=1/0,P=-1/0;a.pos<r;){if(d<=0){var D=a.readVarint();c=7&D,d=D>>3}if(d--,c===1||c===2)(g+=a.readSVarint())<x&&(x=g),g>T&&(T=g),(y+=a.readSVarint())<S&&(S=y),y>P&&(P=y);else if(c!==7)throw new Error("unknown command "+c)}return[x,S,T,P]},hc.prototype.toGeoJSON=function(a,r,c){var d,g,y=this.extent*Math.pow(2,c),x=this.extent*a,T=this.extent*r,S=this.loadGeometry(),P=hc.types[this.type];function D(G){for(var H=0;H<G.length;H++){var oe=G[H];G[H]=[360*(oe.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+T)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(d=0;d<S.length;d++)O[d]=S[d][0];D(S=O);break;case 2:for(d=0;d<S.length;d++)D(S[d]);break;case 3:for(S=function(G){var H=G.length;if(H<=1)return[G];for(var oe,se,ve=[],Te=0;Te<H;Te++){var ge=pI(G[Te]);ge!==0&&(se===void 0&&(se=ge<0),se===ge<0?(oe&&ve.push(oe),oe=[G[Te]]):oe.push(G[Te]))}return oe&&ve.push(oe),ve}(S),d=0;d<S.length;d++)for(g=0;g<S[d].length;g++)D(S[d][g])}S.length===1?S=S[0]:P="Multi"+P;var N={type:"Feature",geometry:{type:P,coordinates:S},properties:this.properties};return"id"in this&&(N.id=this.id),N};var mI=cx,ux=hx;function hx(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(gI,this,r),this.length=this._features.length}function gI(a,r,c){a===15?r.version=c.readVarint():a===1?r.name=c.readString():a===5?r.extent=c.readVarint():a===2?r._features.push(c.pos):a===3?r._keys.push(c.readString()):a===4&&r._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var x=d.readVarint()>>3;g=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return g}(c))}hx.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new mI(this._pbf,r,this.extent,this._keys,this._values)};var _I=ux;function yI(a,r,c){if(a===3){var d=new _I(c,c.readVarint()+c.pos);d.length&&(r[d.name]=d)}}da.VectorTile=function(a,r){this.layers=a.readFields(yI,{},r)},da.VectorTileFeature=cx,da.VectorTileLayer=ux;const vI=da.VectorTileFeature.types,vg=Math.pow(2,13);function Qu(a,r,c,d,g,y,x,T){a.emplaceBack(r,c,2*Math.floor(d*vg)+x,g*vg*2,y*vg*2,Math.round(T))}class xg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.centroidVertexArray=new _t,this.indexArray=new Hi,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new Bt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.features=[],this.hasPattern=gg("fill-extrusion",this.layers,c);for(const{feature:g,id:y,index:x,sourceLayerIndex:T}of r){const S=this.layers[0]._featureFilter.needGeometry,P=pl(g,S);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),P,d))continue;const D={id:y,sourceLayerIndex:T,index:x,geometry:S?P.geometry:fl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(_g("fill-extrusion",this.layers,D,this.zoom,c)):this.addFeature(D,D.geometry,x,d,{}),c.featureIndex.insert(g,D.geometry,x,T,this.index,!0)}}addFeatures(r,c,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,c,d)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hI),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,uI.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,c,d,g,y){const x={x:0,y:0,vertexCount:0};for(const T of mg(c,500)){let S=0;for(const H of T)S+=H.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of T){if(H.length===0||bI(H))continue;let oe=0;for(let se=0;se<H.length;se++){const ve=H[se];if(se>=1){const Te=H[se-1];if(!xI(ve,Te)){P.vertexLength+4>Bt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=ve.sub(Te)._perp()._unit(),we=Te.dist(ve);oe+we>32768&&(oe=0),Qu(this.layoutVertexArray,ve.x,ve.y,ge.x,ge.y,0,0,oe),Qu(this.layoutVertexArray,ve.x,ve.y,ge.x,ge.y,0,1,oe),x.x+=2*ve.x,x.y+=2*ve.y,x.vertexCount+=2,oe+=we,Qu(this.layoutVertexArray,Te.x,Te.y,ge.x,ge.y,0,0,oe),Qu(this.layoutVertexArray,Te.x,Te.y,ge.x,ge.y,0,1,oe),x.x+=2*Te.x,x.y+=2*Te.y,x.vertexCount+=2;const De=P.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+S>Bt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),vI[r.type]!=="Polygon")continue;const D=[],O=[],N=P.vertexLength;for(const H of T)if(H.length!==0){H!==T[0]&&O.push(D.length/2);for(let oe=0;oe<H.length;oe++){const se=H[oe];Qu(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),x.x+=se.x,x.y+=se.y,x.vertexCount+=1,D.push(se.x),D.push(se.y)}}const G=pf.exports(D,O);for(let H=0;H<G.length;H+=3)this.indexArray.emplaceBack(N+G[H],N+G[H+2],N+G[H+1]);P.primitiveLength+=G.length/3,P.vertexLength+=S}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}}function xI(a,r){return a.x===r.x&&(a.x<0||a.x>Jn)||a.y===r.y&&(a.y<0||a.y>Jn)}function bI(a){return a.every(r=>r.x<0)||a.every(r=>r.x>Jn)||a.every(r=>r.y<0)||a.every(r=>r.y>Jn)}st("FillExtrusionBucket",xg,{omit:["layers","features"]});var wI={paint:new fi({"fill-extrusion-opacity":new ht(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ca(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function eh(a,r){return a.x*r.x+a.y*r.y}function dx(a,r){if(a.length===1){let c=0;const d=r[c++];let g;for(;!g||d.equals(g);)if(g=r[c++],!g)return 1/0;for(;c<r.length;c++){const y=r[c],x=a[0],T=g.sub(d),S=y.sub(d),P=x.sub(d),D=eh(T,T),O=eh(T,S),N=eh(S,S),G=eh(P,T),H=eh(P,S),oe=D*N-O*O,se=(N*G-O*H)/oe,ve=(D*H-O*G)/oe,Te=d.z*(1-se-ve)+g.z*se+y.z*ve;if(isFinite(Te))return Te}return 1/0}{let c=1/0;for(const d of r)c=Math.min(c,d.z);return c}}const EI=Gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:TI}=EI,SI=Gn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:AI}=SI,II=da.VectorTileFeature.types,PI=Math.cos(Math.PI/180*37.5),fx=Math.pow(2,14)/.5;class bg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new an,this.indexArray=new Hi,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new Bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=gg("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),x=[];for(const{feature:T,id:S,index:P,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,N=pl(T,O);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d):void 0,H={id:S,properties:T.properties,type:T.type,sourceLayerIndex:D,index:P,geometry:O?N.geometry:fl(T),patterns:{},sortKey:G};x.push(H)}y&&x.sort((T,S)=>T.sortKey-S.sortKey);for(const T of x){const{geometry:S,index:P,sourceLayerIndex:D}=T;if(this.hasPattern){const O=_g("line",this.layers,T,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(T,S,P,d,{});c.featureIndex.insert(r[P].feature,S,P,D,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,AI)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,TI),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,c,d,g,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(r,{}),S=x.get("line-cap"),P=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of c)this.addLine(O,r,T,S,P,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}addLine(r,c,d,g,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=II[c.type]==="Polygon";let S=r.length;for(;S>=2&&r[S-1].equals(r[S-2]);)S--;let P=0;for(;P<S-1&&r[P].equals(r[P+1]);)P++;if(S<(T?3:2))return;d==="bevel"&&(y=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let N,G,H,oe,se;this.e1=this.e2=-1,T&&(N=r[S-2],se=r[P].sub(N)._unit()._perp());for(let ve=P;ve<S;ve++){if(H=ve===S-1?T?r[P+1]:void 0:r[ve+1],H&&r[ve].equals(H))continue;se&&(oe=se),N&&(G=N),N=r[ve],se=H?H.sub(N)._unit()._perp():oe,oe=oe||se;let Te=oe.add(se);Te.x===0&&Te.y===0||Te._unit();const ge=oe.x*se.x+oe.y*se.y,we=Te.x*se.x+Te.y*se.y,De=we!==0?1/we:1/0,Re=2*Math.sqrt(2-2*we),it=we<PI&&G&&H,ct=oe.x*se.y-oe.y*se.x>0;if(it&&ve>P){const Ge=N.dist(G);if(Ge>2*D){const Qe=N.sub(N.sub(G)._mult(D/Ge)._round());this.updateDistance(G,Qe),this.addCurrentVertex(Qe,oe,0,0,O),G=Qe}}const Je=G&&H;let qe=Je?d:T?"butt":g;if(Je&&qe==="round"&&(De<x?qe="miter":De<=2&&(qe="fakeround")),qe==="miter"&&De>y&&(qe="bevel"),qe==="bevel"&&(De>2&&(qe="flipbevel"),De<y&&(qe="miter")),G&&this.updateDistance(G,N),qe==="miter")Te._mult(De),this.addCurrentVertex(N,Te,0,0,O);else if(qe==="flipbevel"){if(De>100)Te=se.mult(-1);else{const Ge=De*oe.add(se).mag()/oe.sub(se).mag();Te._perp()._mult(Ge*(ct?-1:1))}this.addCurrentVertex(N,Te,0,0,O),this.addCurrentVertex(N,Te.mult(-1),0,0,O)}else if(qe==="bevel"||qe==="fakeround"){const Ge=-Math.sqrt(De*De-1),Qe=ct?Ge:0,Ze=ct?0:Ge;if(G&&this.addCurrentVertex(N,oe,Qe,Ze,O),qe==="fakeround"){const Ue=Math.round(180*Re/Math.PI/20);for(let yt=1;yt<Ue;yt++){let ft=yt/Ue;if(ft!==.5){const gn=ft-.5;ft+=ft*gn*(ft-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*gn*gn+(.848013+ge*(.215638*ge-1.06021)))}const Rt=se.sub(oe)._mult(ft)._add(oe)._unit()._mult(ct?-1:1);this.addHalfVertex(N,Rt.x,Rt.y,!1,ct,0,O)}}H&&this.addCurrentVertex(N,se,-Qe,-Ze,O)}else if(qe==="butt")this.addCurrentVertex(N,Te,0,0,O);else if(qe==="square"){const Ge=G?1:-1;this.addCurrentVertex(N,Te,Ge,Ge,O)}else qe==="round"&&(G&&(this.addCurrentVertex(N,oe,0,0,O),this.addCurrentVertex(N,oe,1,1,O,!0)),H&&(this.addCurrentVertex(N,se,-1,-1,O,!0),this.addCurrentVertex(N,se,0,0,O)));if(it&&ve<S-1){const Ge=N.dist(H);if(Ge>2*D){const Qe=N.add(H.sub(N)._mult(D/Ge)._round());this.updateDistance(N,Qe),this.addCurrentVertex(Qe,se,0,0,O),N=Qe}}}}addCurrentVertex(r,c,d,g,y,x=!1){const T=c.y*g-c.x,S=-c.y-c.x*g;this.addHalfVertex(r,c.x+c.y*d,c.y-c.x*d,x,!1,d,y),this.addHalfVertex(r,T,S,x,!0,-g,y),this.distance>fx/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,c,d,g,y,x))}addHalfVertex({x:r,y:c},d,g,y,x,T,S){const P=.5*(this.lineClips?this.scaledDistance*(fx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(c<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,c){this.distance+=r.dist(c),this.updateScaledDistance()}}st("LineBucket",bg,{omit:["layers","patternFeatures"]});const CI=new fi({"line-cap":new ht(Me.layout_line["line-cap"]),"line-join":new bt(Me.layout_line["line-join"]),"line-miter-limit":new ht(Me.layout_line["line-miter-limit"]),"line-round-limit":new ht(Me.layout_line["line-round-limit"]),"line-sort-key":new bt(Me.layout_line["line-sort-key"])});var px={paint:new fi({"line-opacity":new bt(Me.paint_line["line-opacity"]),"line-color":new bt(Me.paint_line["line-color"]),"line-translate":new ht(Me.paint_line["line-translate"]),"line-translate-anchor":new ht(Me.paint_line["line-translate-anchor"]),"line-width":new bt(Me.paint_line["line-width"]),"line-gap-width":new bt(Me.paint_line["line-gap-width"]),"line-offset":new bt(Me.paint_line["line-offset"]),"line-blur":new bt(Me.paint_line["line-blur"]),"line-dasharray":new Vu(Me.paint_line["line-dasharray"]),"line-pattern":new ca(Me.paint_line["line-pattern"]),"line-gradient":new Ys(Me.paint_line["line-gradient"])}),layout:CI};const mx=new class extends bt{possiblyEvaluate(a,r){return r=new vn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,c,d){return r=Q({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,c,d)}}(px.paint.properties["line-width"].specification);function gx(a,r){return r>0?r+2*a:a}mx.useIntegerZoom=!0;const MI=Gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kI=Gn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const LI=Gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _x=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),RI=Gn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function DI(a,r,c){return a.sections.forEach(d=>{d.text=function(g,y,x){const T=y.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),br.applyArabicShaping&&(g=br.applyArabicShaping(g)),g}(d.text,r,c)}),a}Gn([{name:"triangle",components:3,type:"Uint16"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gn([{type:"Float32",name:"offsetX"}]),Gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const th={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var pi=24,wg=cn,yx=function(a,r,c,d,g){var y,x,T=8*g-d-1,S=(1<<T)-1,P=S>>1,D=-7,O=c?g-1:0,N=c?-1:1,G=a[r+O];for(O+=N,y=G&(1<<-D)-1,G>>=-D,D+=T;D>0;y=256*y+a[r+O],O+=N,D-=8);for(x=y&(1<<-D)-1,y>>=-D,D+=d;D>0;x=256*x+a[r+O],O+=N,D-=8);if(y===0)y=1-P;else{if(y===S)return x?NaN:1/0*(G?-1:1);x+=Math.pow(2,d),y-=P}return(G?-1:1)*x*Math.pow(2,y-d)},vx=function(a,r,c,d,g,y){var x,T,S,P=8*y-g-1,D=(1<<P)-1,O=D>>1,N=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=d?0:y-1,H=d?1:-1,oe=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,x=D):(x=Math.floor(Math.log(r)/Math.LN2),r*(S=Math.pow(2,-x))<1&&(x--,S*=2),(r+=x+O>=1?N/S:N*Math.pow(2,1-O))*S>=2&&(x++,S/=2),x+O>=D?(T=0,x=D):x+O>=1?(T=(r*S-1)*Math.pow(2,g),x+=O):(T=r*Math.pow(2,O-1)*Math.pow(2,g),x=0));g>=8;a[c+G]=255&T,G+=H,T/=256,g-=8);for(x=x<<g|T,P+=g;P>0;a[c+G]=255&x,G+=H,x/=256,P-=8);a[c+G-H]|=128*oe};function cn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}cn.Varint=0,cn.Fixed64=1,cn.Bytes=2,cn.Fixed32=5;var fa,Eg=4294967296,xx=1/Eg,bx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Io(a){return a.type===cn.Bytes?a.readVarint()+a.pos:a.pos+1}function dc(a,r,c){return c?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function wx(a,r,c){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=a;g--)c.buf[g+d]=c.buf[g]}function zI(a,r){for(var c=0;c<a.length;c++)r.writeVarint(a[c])}function OI(a,r){for(var c=0;c<a.length;c++)r.writeSVarint(a[c])}function FI(a,r){for(var c=0;c<a.length;c++)r.writeFloat(a[c])}function BI(a,r){for(var c=0;c<a.length;c++)r.writeDouble(a[c])}function NI(a,r){for(var c=0;c<a.length;c++)r.writeBoolean(a[c])}function UI(a,r){for(var c=0;c<a.length;c++)r.writeFixed32(a[c])}function VI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed32(a[c])}function jI(a,r){for(var c=0;c<a.length;c++)r.writeFixed64(a[c])}function GI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed64(a[c])}function vf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function fc(a,r,c){a[c]=r,a[c+1]=r>>>8,a[c+2]=r>>>16,a[c+3]=r>>>24}function Ex(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function $I(a,r,c){a===1&&c.readMessage(HI,r)}function HI(a,r,c){if(a===3){const{id:d,bitmap:g,width:y,height:x,left:T,top:S,advance:P}=c.readMessage(WI,{});r.push({id:d,bitmap:new Zu({width:y+6,height:x+6},g),metrics:{width:y,height:x,left:T,top:S,advance:P}})}}function WI(a,r,c){a===1?r.id=c.readVarint():a===2?r.bitmap=c.readBytes():a===3?r.width=c.readVarint():a===4?r.height=c.readVarint():a===5?r.left=c.readSVarint():a===6?r.top=c.readSVarint():a===7&&(r.advance=c.readVarint())}function Tx(a){let r=0,c=0;for(const x of a)r+=x.w*x.h,c=Math.max(c,x.w);a.sort((x,T)=>T.h-x.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let g=0,y=0;for(const x of a)for(let T=d.length-1;T>=0;T--){const S=d[T];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,y=Math.max(y,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===S.w&&x.h===S.h){const P=d.pop();T<d.length&&(d[T]=P)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(d.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:g,h:y,fill:r/(g*y)||0}}cn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,y=this.pos;this.type=7&d,a(g,r,this),this.pos===y&&this.skip(d)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=vf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Ex(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=vf(this.buf,this.pos)+vf(this.buf,this.pos+4)*Eg;return this.pos+=8,a},readSFixed64:function(){var a=vf(this.buf,this.pos)+Ex(this.buf,this.pos+4)*Eg;return this.pos+=8,a},readFloat:function(){var a=yx(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=yx(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,c,d=this.buf;return r=127&(c=d[this.pos++]),c<128?r:(r|=(127&(c=d[this.pos++]))<<7,c<128?r:(r|=(127&(c=d[this.pos++]))<<14,c<128?r:(r|=(127&(c=d[this.pos++]))<<21,c<128?r:function(g,y,x){var T,S,P=x.buf;if(T=(112&(S=P[x.pos++]))>>4,S<128||(T|=(127&(S=P[x.pos++]))<<3,S<128)||(T|=(127&(S=P[x.pos++]))<<10,S<128)||(T|=(127&(S=P[x.pos++]))<<17,S<128)||(T|=(127&(S=P[x.pos++]))<<24,S<128)||(T|=(1&(S=P[x.pos++]))<<31,S<128))return dc(g,T,y);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(c=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&bx?function(c,d,g){return bx.decode(c.subarray(d,g))}(this.buf,r,a):function(c,d,g){for(var y="",x=d;x<g;){var T,S,P,D=c[x],O=null,N=D>239?4:D>223?3:D>191?2:1;if(x+N>g)break;N===1?D<128&&(O=D):N===2?(192&(T=c[x+1]))==128&&(O=(31&D)<<6|63&T)<=127&&(O=null):N===3?(S=c[x+2],(192&(T=c[x+1]))==128&&(192&S)==128&&((O=(15&D)<<12|(63&T)<<6|63&S)<=2047||O>=55296&&O<=57343)&&(O=null)):N===4&&(S=c[x+2],P=c[x+3],(192&(T=c[x+1]))==128&&(192&S)==128&&(192&P)==128&&((O=(15&D)<<18|(63&T)<<12|(63&S)<<6|63&P)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,N=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),x+=N}return y}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==cn.Bytes)return a.push(this.readVarint(r));var c=Io(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==cn.Bytes)return a.push(this.readSVarint());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==cn.Bytes)return a.push(this.readBoolean());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==cn.Bytes)return a.push(this.readFloat());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==cn.Bytes)return a.push(this.readDouble());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed32());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed32());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed64());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed64());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===cn.Varint)for(;this.buf[this.pos++]>127;);else if(r===cn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===cn.Fixed32)this.pos+=4;else{if(r!==cn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),fc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),fc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),fc(this.buf,-1&a,this.pos),fc(this.buf,Math.floor(a*xx),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),fc(this.buf,-1&a,this.pos),fc(this.buf,Math.floor(a*xx),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,c){var d,g;if(r>=0?(d=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(y,x,T){T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7)}(d,0,c),function(y,x){var T=(7&y)<<4;x.buf[x.pos++]|=T|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(g,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(d,g,y){for(var x,T,S=0;S<g.length;S++){if((x=g.charCodeAt(S))>55295&&x<57344){if(!T){x>56319||S+1===g.length?(d[y++]=239,d[y++]=191,d[y++]=189):T=x;continue}if(x<56320){d[y++]=239,d[y++]=191,d[y++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(d[y++]=239,d[y++]=191,d[y++]=189,T=null);x<128?d[y++]=x:(x<2048?d[y++]=x>>6|192:(x<65536?d[y++]=x>>12|224:(d[y++]=x>>18|240,d[y++]=x>>12&63|128),d[y++]=x>>6&63|128),d[y++]=63&x|128)}return y}(this.buf,a,this.pos);var c=this.pos-r;c>=128&&wx(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),vx(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),vx(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var c=0;c<r;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,r){this.pos++;var c=this.pos;a(r,this);var d=this.pos-c;d>=128&&wx(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,r,c){this.writeTag(a,cn.Bytes),this.writeRawMessage(r,c)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,zI,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,OI,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,NI,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,FI,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,BI,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,UI,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,VI,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,jI,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,GI,r)},writeBytesField:function(a,r){this.writeTag(a,cn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,cn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,cn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class Tg{constructor(r,{pixelRatio:c,version:d,stretchX:g,stretchY:y,content:x}){this.paddedRect=r,this.pixelRatio=c,this.stretchX=g,this.stretchY=y,this.content=x,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Sx{constructor(r,c){const d={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,d,y),this.addImages(c,g,y);const{w:x,h:T}=Tx(y),S=new Br({width:x||1,height:T||1});for(const P in r){const D=r[P],O=d[P].paddedRect;Br.copy(D.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const P in c){const D=c[P],O=g[P].paddedRect,N=O.x+1,G=O.y+1,H=D.data.width,oe=D.data.height;Br.copy(D.data,S,{x:0,y:0},{x:N,y:G},D.data),Br.copy(D.data,S,{x:0,y:oe-1},{x:N,y:G-1},{width:H,height:1}),Br.copy(D.data,S,{x:0,y:0},{x:N,y:G+oe},{width:H,height:1}),Br.copy(D.data,S,{x:H-1,y:0},{x:N-1,y:G},{width:1,height:oe}),Br.copy(D.data,S,{x:0,y:0},{x:N+H,y:G},{width:1,height:oe})}this.image=S,this.iconPositions=d,this.patternPositions=g}addImages(r,c,d){for(const g in r){const y=r[g],x={x:0,y:0,w:y.data.width+2,h:y.data.height+2};d.push(x),c[g]=new Tg(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,c){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in r.updatedImages)this.patchUpdatedImage(this.iconPositions[d],r.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],r.getImage(d),c)}patchUpdatedImage(r,c,d){if(!r||!c||r.version===c.version)return;r.version=c.version;const[g,y]=r.tl;d.update(c.data,void 0,{x:g,y})}}st("ImagePosition",Tg),st("ImageAtlas",Sx),l.WritingMode=void 0,(fa=l.WritingMode||(l.WritingMode={}))[fa.none=0]="none",fa[fa.horizontal=1]="horizontal",fa[fa.vertical=2]="vertical",fa[fa.horizontalOnly=3]="horizontalOnly";const xf=-17;class nh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,c){const d=new nh;return d.scale=r||1,d.fontStack=c,d}static forImage(r){const c=new nh;return c.imageName=r,c}}class pc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c){const d=new pc;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?d.addImageSection(y):d.addTextSection(y,c)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let c="";for(let d=0;d<r.length;d++){const g=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;c+=g&&Qd(g)&&!th[r[d+1]]||y&&Qd(y)&&!th[r[d-1]]||!th[r[d]]?r[d]:th[r[d]]}return c}(this.text)}trim(){let r=0;for(let d=0;d<this.text.length&&wf[this.text.charCodeAt(d)];d++)r++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&wf[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const d=new pc;return d.text=this.text.substring(r,c),d.sectionIndex=this.sectionIndex.slice(r,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push(nh.forText(r.scale,r.fontStack||c));const d=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(d)}addImageSection(r){const c=r.image?r.image.name:"";if(c.length===0)return void ye("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(nh.forImage(c)),this.sectionIndex.push(this.sections.length-1)):ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bf(a,r,c,d,g,y,x,T,S,P,D,O,N,G,H,oe){const se=pc.fromFeature(a,g);let ve;O===l.WritingMode.vertical&&se.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:ge}=br;if(Te&&se.sections.length===1){ve=[];const Re=Te(se.toString(),Sg(se,P,y,r,d,G,H));for(const it of Re){const ct=new pc;ct.text=it,ct.sections=se.sections;for(let Je=0;Je<it.length;Je++)ct.sectionIndex.push(0);ve.push(ct)}}else if(ge){ve=[];const Re=ge(se.text,se.sectionIndex,Sg(se,P,y,r,d,G,H));for(const it of Re){const ct=new pc;ct.text=it[0],ct.sectionIndex=it[1],ct.sections=se.sections,ve.push(ct)}}else ve=function(Re,it){const ct=[],Je=Re.text;let qe=0;for(const Ge of it)ct.push(Re.substring(qe,Ge)),qe=Ge;return qe<Je.length&&ct.push(Re.substring(qe,Je.length)),ct}(se,Sg(se,P,y,r,d,G,H));const we=[],De={positionedLines:we,text:se.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Re,it,ct,Je,qe,Ge,Qe,Ze,Ue,yt,ft,Rt){let gn=0,bn=xf,Qn=0,Ur=0;const Ei=Ze==="right"?1:Ze==="left"?0:.5;let $n=0;for(const Hn of qe){Hn.trim();const Si=Hn.getMaxScale(),Di=(Si-1)*pi,Zi={positionedGlyphs:[],lineOffset:0};Re.positionedLines[$n]=Zi;const cr=Zi.positionedGlyphs;let ur=0;if(!Hn.length()){bn+=Ge,++$n;continue}for(let ci=0;ci<Hn.length();ci++){const Vt=Hn.getSection(ci),Tr=Hn.getSectionIndex(ci),Ai=Hn.getCharCode(ci);let zi=0,hs=null,Cs=null,Ms=null,Co=pi;const ds=!(Ue===l.WritingMode.horizontal||!ft&&!zu(Ai)||ft&&(wf[Ai]||(li=Ai,Ke.Arabic(li)||Ke["Arabic Supplement"](li)||Ke["Arabic Extended-A"](li)||Ke["Arabic Presentation Forms-A"](li)||Ke["Arabic Presentation Forms-B"](li))));if(Vt.imageName){const Vr=Je[Vt.imageName];if(!Vr)continue;Ms=Vt.imageName,Re.iconsInText=Re.iconsInText||!0,Cs=Vr.paddedRect;const hr=Vr.displaySize;Vt.scale=Vt.scale*pi/Rt,hs={width:hr[0],height:hr[1],left:1,top:-3,advance:ds?hr[1]:hr[0]},zi=Di+(pi-hr[1]*Vt.scale),Co=hs.advance;const Mo=ds?hr[0]*Vt.scale-pi*Si:hr[1]*Vt.scale-pi*Si;Mo>0&&Mo>ur&&(ur=Mo)}else{const Vr=ct[Vt.fontStack],hr=Vr&&Vr[Ai];if(hr&&hr.rect)Cs=hr.rect,hs=hr.metrics;else{const Mo=it[Vt.fontStack],sh=Mo&&Mo[Ai];if(!sh)continue;hs=sh.metrics}zi=(Si-Vt.scale)*pi}ds?(Re.verticalizable=!0,cr.push({glyph:Ai,imageName:Ms,x:gn,y:bn+zi,vertical:ds,scale:Vt.scale,fontStack:Vt.fontStack,sectionIndex:Tr,metrics:hs,rect:Cs}),gn+=Co*Vt.scale+yt):(cr.push({glyph:Ai,imageName:Ms,x:gn,y:bn+zi,vertical:ds,scale:Vt.scale,fontStack:Vt.fontStack,sectionIndex:Tr,metrics:hs,rect:Cs}),gn+=hs.advance*Vt.scale+yt)}cr.length!==0&&(Qn=Math.max(gn-yt,Qn),XI(cr,0,cr.length-1,Ei,ur)),gn=0;const Tn=Ge*Si+ur;Zi.lineOffset=Math.max(ur,Di),bn+=Tn,Ur=Math.max(Tn,Ur),++$n}var li;const Ti=bn-xf,{horizontalAlign:Ri,verticalAlign:lr}=Ag(Qe);(function(Hn,Si,Di,Zi,cr,ur,Tn,ci,Vt){const Tr=(Si-Di)*cr;let Ai=0;Ai=ur!==Tn?-ci*Zi-xf:(-Zi*Vt+.5)*Tn;for(const zi of Hn)for(const hs of zi.positionedGlyphs)hs.x+=Tr,hs.y+=Ai})(Re.positionedLines,Ei,Ri,lr,Qn,Ur,Ge,Ti,qe.length),Re.top+=-lr*Ti,Re.bottom=Re.top+Ti,Re.left+=-Ri*Qn,Re.right=Re.left+Qn}(De,r,c,d,ve,x,T,S,O,P,N,oe),!function(Re){for(const it of Re)if(it.positionedGlyphs.length!==0)return!1;return!0}(we)&&De}const wf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ax(a,r,c,d,g,y){if(r.imageName){const x=d[r.imageName];return x?x.displaySize[0]*r.scale*pi/y+g:0}{const x=c[r.fontStack],T=x&&x[a];return T?T.metrics.advance*r.scale+g:0}}function Ix(a,r,c,d){const g=Math.pow(a-r,2);return d?a<r?g/2:2*g:g+Math.abs(c)*c}function ZI(a,r,c){let d=0;return a===10&&(d-=1e4),c&&(d+=150),a!==40&&a!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function Px(a,r,c,d,g,y){let x=null,T=Ix(r,c,g,y);for(const S of d){const P=Ix(r-S.x,c,g,y)+S.badness;P<=T&&(x=S,T=P)}return{index:a,x:r,priorBreak:x,badness:T}}function Cx(a){return a?Cx(a.priorBreak).concat(a.index):[]}function Sg(a,r,c,d,g,y,x){if(y!=="point")return[];if(!a)return[];const T=[],S=function(N,G,H,oe,se,ve){let Te=0;for(let ge=0;ge<N.length();ge++){const we=N.getSection(ge);Te+=Ax(N.getCharCode(ge),we,oe,se,G,ve)}return Te/Math.max(1,Math.ceil(Te/H))}(a,r,c,d,g,x),P=a.text.indexOf("")>=0;let D=0;for(let N=0;N<a.length();N++){const G=a.getSection(N),H=a.getCharCode(N);if(wf[H]||(D+=Ax(H,G,d,g,r,x)),N<a.length()-1){const oe=!((O=H)<11904||!(Ke["Bopomofo Extended"](O)||Ke.Bopomofo(O)||Ke["CJK Compatibility Forms"](O)||Ke["CJK Compatibility Ideographs"](O)||Ke["CJK Compatibility"](O)||Ke["CJK Radicals Supplement"](O)||Ke["CJK Strokes"](O)||Ke["CJK Symbols and Punctuation"](O)||Ke["CJK Unified Ideographs Extension A"](O)||Ke["CJK Unified Ideographs"](O)||Ke["Enclosed CJK Letters and Months"](O)||Ke["Halfwidth and Fullwidth Forms"](O)||Ke.Hiragana(O)||Ke["Ideographic Description Characters"](O)||Ke["Kangxi Radicals"](O)||Ke["Katakana Phonetic Extensions"](O)||Ke.Katakana(O)||Ke["Vertical Forms"](O)||Ke["Yi Radicals"](O)||Ke["Yi Syllables"](O)));(qI[H]||oe||G.imageName)&&T.push(Px(N+1,D,S,T,ZI(H,a.getCharCode(N+1),oe&&P),!1))}}var O;return Cx(Px(a.length(),D,S,T,0,!0))}function Ag(a){let r=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function XI(a,r,c,d,g){if(!d&&!g)return;const y=a[c],x=(a[c].x+y.metrics.advance*y.scale)*d;for(let T=r;T<=c;T++)a[T].x-=x,a[T].y+=g}function YI(a,r,c){const{horizontalAlign:d,verticalAlign:g}=Ag(c),y=r[0]-a.displaySize[0]*d,x=r[1]-a.displaySize[1]*g;return{image:a,top:x,bottom:x+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function Mx(a,r,c,d,g,y){const x=a.image;let T;if(x.content){const se=x.content,ve=x.pixelRatio||1;T=[se[0]/ve,se[1]/ve,x.displaySize[0]-se[2]/ve,x.displaySize[1]-se[3]/ve]}const S=r.left*y,P=r.right*y;let D,O,N,G;c==="width"||c==="both"?(G=g[0]+S-d[3],O=g[0]+P+d[1]):(G=g[0]+(S+P-x.displaySize[0])/2,O=G+x.displaySize[0]);const H=r.top*y,oe=r.bottom*y;return c==="height"||c==="both"?(D=g[1]+H-d[0],N=g[1]+oe+d[2]):(D=g[1]+(H+oe-x.displaySize[1])/2,N=D+x.displaySize[1]),{image:x,top:D,right:O,bottom:N,left:G,collisionPadding:T}}const Po=128;function kx(a,r){const{expression:c}=r;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new vn(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let x=y;for(;x<d.length&&d[x]<a+1;)x++;x=Math.min(d.length-1,x);const T=d[y],S=d[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:S,minSize:c.evaluate(new vn(T)),maxSize:c.evaluate(new vn(S)),interpolationType:g}}}class pa extends xt{constructor(r,c,d,g){super(r,c),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new pa(this.x,this.y,this.angle,this.segment)}}function Lx(a,r,c,d,g){if(r.segment===void 0)return!0;let y=r,x=r.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=a[x].dist(y),y=a[x]}T+=a[x].dist(a[x+1]),x++;const S=[];let P=0;for(;T<c/2;){const D=a[x],O=a[x+1];if(!O)return!1;let N=a[x-1].angleTo(D)-D.angleTo(O);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:T,angleDelta:N}),P+=N;T-S[0].distance>d;)P-=S.shift().angleDelta;if(P>g)return!1;x++,T+=D.dist(O)}return!0}function Rx(a){let r=0;for(let c=0;c<a.length-1;c++)r+=a[c].dist(a[c+1]);return r}function Dx(a,r,c){return a?.6*r*c:0}function zx(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function KI(a,r,c,d,g,y){const x=Dx(c,g,y),T=zx(c,d)*y;let S=0;const P=Rx(a)/2;for(let D=0;D<a.length-1;D++){const O=a[D],N=a[D+1],G=O.dist(N);if(S+G>P){const H=(P-S)/G,oe=kt(O.x,N.x,H),se=kt(O.y,N.y,H),ve=new pa(oe,se,N.angleTo(O),D);return ve._round(),!x||Lx(a,ve,T,x,r)?ve:void 0}S+=G}}function JI(a,r,c,d,g,y,x,T,S){const P=Dx(d,y,x),D=zx(d,g),O=D*x,N=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return r-O<r/4&&(r=O+r/4),Ox(a,N?r/2*T%r:(D/2+2*y)*x*T%r,r,P,c,O,N,!1,S)}function Ox(a,r,c,d,g,y,x,T,S){const P=y/2,D=Rx(a);let O=0,N=r-c,G=[];for(let H=0;H<a.length-1;H++){const oe=a[H],se=a[H+1],ve=oe.dist(se),Te=se.angleTo(oe);for(;N+c<O+ve;){N+=c;const ge=(N-O)/ve,we=kt(oe.x,se.x,ge),De=kt(oe.y,se.y,ge);if(we>=0&&we<S&&De>=0&&De<S&&N-P>=0&&N+P<=D){const Re=new pa(we,De,Te,H);Re._round(),d&&!Lx(a,Re,y,d,g)||G.push(Re)}}O+=ve}return T||G.length||x||(G=Ox(a,O/2,c,d,g,y,x,!0,S)),G}function Fx(a,r,c,d,g){const y=[];for(let x=0;x<a.length;x++){const T=a[x];let S;for(let P=0;P<T.length-1;P++){let D=T[P],O=T[P+1];D.x<r&&O.x<r||(D.x<r?D=new xt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<r&&(O=new xt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<c&&O.y<c||(D.y<c?D=new xt(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round():O.y<c&&(O=new xt(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round()),D.x>=d&&O.x>=d||(D.x>=d?D=new xt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=d&&(O=new xt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=g&&O.y>=g||(D.y>=g?D=new xt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round():O.y>=g&&(O=new xt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round()),S&&D.equals(S[S.length-1])||(S=[D],y.push(S)),S.push(O)))))}}return y}function Bx(a,r,c,d){const g=[],y=a.image,x=y.pixelRatio,T=y.paddedRect.w-2,S=y.paddedRect.h-2,P=a.right-a.left,D=a.bottom-a.top,O=y.stretchX||[[0,T]],N=y.stretchY||[[0,S]],G=(Ge,Qe)=>Ge+Qe[1]-Qe[0],H=O.reduce(G,0),oe=N.reduce(G,0),se=T-H,ve=S-oe;let Te=0,ge=H,we=0,De=oe,Re=0,it=se,ct=0,Je=ve;if(y.content&&d){const Ge=y.content;Te=Ef(O,0,Ge[0]),we=Ef(N,0,Ge[1]),ge=Ef(O,Ge[0],Ge[2]),De=Ef(N,Ge[1],Ge[3]),Re=Ge[0]-Te,ct=Ge[1]-we,it=Ge[2]-Ge[0]-ge,Je=Ge[3]-Ge[1]-De}const qe=(Ge,Qe,Ze,Ue)=>{const yt=Tf(Ge.stretch-Te,ge,P,a.left),ft=Sf(Ge.fixed-Re,it,Ge.stretch,H),Rt=Tf(Qe.stretch-we,De,D,a.top),gn=Sf(Qe.fixed-ct,Je,Qe.stretch,oe),bn=Tf(Ze.stretch-Te,ge,P,a.left),Qn=Sf(Ze.fixed-Re,it,Ze.stretch,H),Ur=Tf(Ue.stretch-we,De,D,a.top),Ei=Sf(Ue.fixed-ct,Je,Ue.stretch,oe),$n=new xt(yt,Rt),li=new xt(bn,Rt),Ti=new xt(bn,Ur),Ri=new xt(yt,Ur),lr=new xt(ft/x,gn/x),Hn=new xt(Qn/x,Ei/x),Si=r*Math.PI/180;if(Si){const cr=Math.sin(Si),ur=Math.cos(Si),Tn=[ur,-cr,cr,ur];$n._matMult(Tn),li._matMult(Tn),Ri._matMult(Tn),Ti._matMult(Tn)}const Di=Ge.stretch+Ge.fixed,Zi=Qe.stretch+Qe.fixed;return{tl:$n,tr:li,bl:Ri,br:Ti,tex:{x:y.paddedRect.x+1+Di,y:y.paddedRect.y+1+Zi,w:Ze.stretch+Ze.fixed-Di,h:Ue.stretch+Ue.fixed-Zi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Hn,minFontScaleX:it/x/P,minFontScaleY:Je/x/D,isSDF:c}};if(d&&(y.stretchX||y.stretchY)){const Ge=Nx(O,se,H),Qe=Nx(N,ve,oe);for(let Ze=0;Ze<Ge.length-1;Ze++){const Ue=Ge[Ze],yt=Ge[Ze+1];for(let ft=0;ft<Qe.length-1;ft++)g.push(qe(Ue,Qe[ft],yt,Qe[ft+1]))}}else g.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:S+1}));return g}function Ef(a,r,c){let d=0;for(const g of a)d+=Math.max(r,Math.min(c,g[1]))-Math.max(r,Math.min(c,g[0]));return d}function Nx(a,r,c){const d=[{fixed:-1,stretch:0}];for(const[g,y]of a){const x=d[d.length-1];d.push({fixed:g-x.stretch,stretch:x.stretch}),d.push({fixed:g-x.stretch,stretch:x.stretch+(y-g)})}return d.push({fixed:r+1,stretch:c}),d}function Tf(a,r,c,d){return a/r*c+d}function Sf(a,r,c,d){return a-r*c/d}st("Anchor",pa);class Af{constructor(r,c,d,g,y,x,T,S,P,D){if(this.boxStartIndex=r.length,P){let O=x.top,N=x.bottom;const G=x.collisionPadding;G&&(O-=G[1],N+=G[3]);let H=N-O;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let O=x.top*T-S[0],N=x.bottom*T+S[2],G=x.left*T-S[3],H=x.right*T+S[1];const oe=x.collisionPadding;if(oe&&(G-=oe[0]*T,O-=oe[1]*T,H+=oe[2]*T,N+=oe[3]*T),D){const se=new xt(G,O),ve=new xt(H,O),Te=new xt(G,N),ge=new xt(H,N),we=D*Math.PI/180;se._rotate(we),ve._rotate(we),Te._rotate(we),ge._rotate(we),G=Math.min(se.x,ve.x,Te.x,ge.x),H=Math.max(se.x,ve.x,Te.x,ge.x),O=Math.min(se.y,ve.y,Te.y,ge.y),N=Math.max(se.y,ve.y,Te.y,ge.y)}r.emplaceBack(c.x,c.y,G,O,H,N,d,g,y)}this.boxEndIndex=r.length}}class QI{constructor(r=[],c=eP){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:d}=this,g=c[r];for(;r>0;){const y=r-1>>1,x=c[y];if(d(g,x)>=0)break;c[r]=x,r=y}c[r]=g}_down(r){const{data:c,compare:d}=this,g=this.length>>1,y=c[r];for(;r<g;){let x=1+(r<<1),T=c[x];const S=x+1;if(S<this.length&&d(c[S],T)<0&&(x=S,T=c[S]),d(T,y)>=0)break;c[r]=T,r=x}c[r]=y}}function eP(a,r){return a<r?-1:a>r?1:0}function tP(a,r=1,c=!1){let d=1/0,g=1/0,y=-1/0,x=-1/0;const T=a[0];for(let G=0;G<T.length;G++){const H=T[G];(!G||H.x<d)&&(d=H.x),(!G||H.y<g)&&(g=H.y),(!G||H.x>y)&&(y=H.x),(!G||H.y>x)&&(x=H.y)}const S=Math.min(y-d,x-g);let P=S/2;const D=new QI([],nP);if(S===0)return new xt(d,g);for(let G=d;G<y;G+=S)for(let H=g;H<x;H+=S)D.push(new mc(G+P,H+P,P,a));let O=function(G){let H=0,oe=0,se=0;const ve=G[0];for(let Te=0,ge=ve.length,we=ge-1;Te<ge;we=Te++){const De=ve[Te],Re=ve[we],it=De.x*Re.y-Re.x*De.y;oe+=(De.x+Re.x)*it,se+=(De.y+Re.y)*it,H+=3*it}return new mc(oe/H,se/H,0,G)}(a),N=D.length;for(;D.length;){const G=D.pop();(G.d>O.d||!O.d)&&(O=G,c&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,N)),G.max-O.d<=r||(P=G.h/2,D.push(new mc(G.p.x-P,G.p.y-P,P,a)),D.push(new mc(G.p.x+P,G.p.y-P,P,a)),D.push(new mc(G.p.x-P,G.p.y+P,P,a)),D.push(new mc(G.p.x+P,G.p.y+P,P,a)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${O.d}`)),O.p}function nP(a,r){return r.max-a.max}function mc(a,r,c,d){this.p=new xt(a,r),this.h=c,this.d=function(g,y){let x=!1,T=1/0;for(let S=0;S<y.length;S++){const P=y[S];for(let D=0,O=P.length,N=O-1;D<O;N=D++){const G=P[D],H=P[N];G.y>g.y!=H.y>g.y&&g.x<(H.x-G.x)*(g.y-G.y)/(H.y-G.y)+G.x&&(x=!x),T=Math.min(T,qv(g,G,H))}}return(x?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const Ig=Number.POSITIVE_INFINITY;function Ux(a,r){return r[1]!==Ig?function(c,d,g){let y=0,x=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(c){case"top-right":case"bottom-right":case"right":y=-d;break;case"top-left":case"bottom-left":case"left":y=d}return[y,x]}(a,r[0],r[1]):function(c,d){let g=0,y=0;d<0&&(d=0);const x=d/Math.sqrt(2);switch(c){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-d;break;case"top":y=d-7}switch(c){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=d;break;case"right":g=-d}return[g,y]}(a,r[0])}function Pg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function iP(a,r,c,d,g,y,x,T,S,P,D){let O=y.textMaxSize.evaluate(r,{});O===void 0&&(O=x);const N=a.layers[0].layout,G=N.get("icon-offset").evaluate(r,{},D),H=jx(c.horizontal),oe=x/24,se=a.tilePixelRatio*oe,ve=a.tilePixelRatio*O/24,Te=a.tilePixelRatio*T,ge=a.tilePixelRatio*N.get("symbol-spacing"),we=N.get("text-padding")*a.tilePixelRatio,De=function(Ue,yt,ft,Rt=1){const gn=Ue.get("icon-padding").evaluate(yt,{},ft),bn=gn&&gn.values;return[bn[0]*Rt,bn[1]*Rt,bn[2]*Rt,bn[3]*Rt]}(N,r,D,a.tilePixelRatio),Re=N.get("text-max-angle")/180*Math.PI,it=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",ct=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Je=N.get("symbol-placement"),qe=ge/2,Ge=N.get("icon-text-fit");let Qe;d&&Ge!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(Qe=Mx(d,c.vertical,Ge,N.get("icon-text-fit-padding"),G,oe)),H&&(d=Mx(d,H,Ge,N.get("icon-text-fit-padding"),G,oe)));const Ze=(Ue,yt)=>{yt.x<0||yt.x>=Jn||yt.y<0||yt.y>=Jn||function(ft,Rt,gn,bn,Qn,Ur,Ei,$n,li,Ti,Ri,lr,Hn,Si,Di,Zi,cr,ur,Tn,ci,Vt,Tr,Ai,zi,hs){const Cs=ft.addToLineVertexArray(Rt,gn);let Ms,Co,ds,Vr,hr=0,Mo=0,sh=0,r1=0,Bg=-1,Ng=-1;const ko={};let s1=ai.exports(""),Ug=0,Vg=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ug,Vg]=$n.layout.get("text-offset").evaluate(Vt,{},zi).map(dr=>dr*pi):(Ug=$n.layout.get("text-radial-offset").evaluate(Vt,{},zi)*pi,Vg=Ig),ft.allowVerticalPlacement&&bn.vertical){const dr=$n.layout.get("text-rotate").evaluate(Vt,{},zi)+90;ds=new Af(li,Rt,Ti,Ri,lr,bn.vertical,Hn,Si,Di,dr),Ei&&(Vr=new Af(li,Rt,Ti,Ri,lr,Ei,cr,ur,Di,dr))}if(Qn){const dr=$n.layout.get("icon-rotate").evaluate(Vt,{}),to=$n.layout.get("icon-text-fit")!=="none",oh=Bx(Qn,dr,Ai,to),ah=Ei?Bx(Ei,dr,Ai,to):void 0;Co=new Af(li,Rt,Ti,Ri,lr,Qn,cr,ur,!1,dr),hr=4*oh.length;const l1=ft.iconSizeData;let _l=null;l1.kind==="source"?(_l=[Po*$n.layout.get("icon-size").evaluate(Vt,{})],_l[0]>ma&&ye(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):l1.kind==="composite"&&(_l=[Po*Tr.compositeIconSizes[0].evaluate(Vt,{},zi),Po*Tr.compositeIconSizes[1].evaluate(Vt,{},zi)],(_l[0]>ma||_l[1]>ma)&&ye(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,oh,_l,ci,Tn,Vt,l.WritingMode.none,Rt,Cs.lineStartIndex,Cs.lineLength,-1,zi),Bg=ft.icon.placedSymbolArray.length-1,ah&&(Mo=4*ah.length,ft.addSymbols(ft.icon,ah,_l,ci,Tn,Vt,l.WritingMode.vertical,Rt,Cs.lineStartIndex,Cs.lineLength,-1,zi),Ng=ft.icon.placedSymbolArray.length-1)}const o1=Object.keys(bn.horizontal);for(const dr of o1){const to=bn.horizontal[dr];if(!Ms){s1=ai.exports(to.text);const ah=$n.layout.get("text-rotate").evaluate(Vt,{},zi);Ms=new Af(li,Rt,Ti,Ri,lr,to,Hn,Si,Di,ah)}const oh=to.positionedLines.length===1;if(sh+=Vx(ft,Rt,to,Ur,$n,Di,Vt,Zi,Cs,bn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,oh?o1:[dr],ko,Bg,Tr,zi),oh)break}bn.vertical&&(r1+=Vx(ft,Rt,bn.vertical,Ur,$n,Di,Vt,Zi,Cs,l.WritingMode.vertical,["vertical"],ko,Ng,Tr,zi));const gP=Ms?Ms.boxStartIndex:ft.collisionBoxArray.length,_P=Ms?Ms.boxEndIndex:ft.collisionBoxArray.length,yP=ds?ds.boxStartIndex:ft.collisionBoxArray.length,vP=ds?ds.boxEndIndex:ft.collisionBoxArray.length,xP=Co?Co.boxStartIndex:ft.collisionBoxArray.length,bP=Co?Co.boxEndIndex:ft.collisionBoxArray.length,wP=Vr?Vr.boxStartIndex:ft.collisionBoxArray.length,EP=Vr?Vr.boxEndIndex:ft.collisionBoxArray.length;let ks=-1;const kf=(dr,to)=>dr&&dr.circleDiameter?Math.max(dr.circleDiameter,to):to;ks=kf(Ms,ks),ks=kf(ds,ks),ks=kf(Co,ks),ks=kf(Vr,ks);const a1=ks>-1?1:0;a1&&(ks*=hs/pi),ft.glyphOffsetArray.length>=gc.MAX_GLYPHS&&ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vt.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,Vt.sortKey),ft.symbolInstances.emplaceBack(Rt.x,Rt.y,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical||-1,Bg,Ng,s1,gP,_P,yP,vP,xP,bP,wP,EP,Ti,sh,r1,hr,Mo,a1,0,Hn,Ug,Vg,ks)}(a,yt,Ue,c,d,g,Qe,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,se,[we,we,we,we],it,S,Te,De,ct,G,r,y,P,D,x)};if(Je==="line")for(const Ue of Fx(r.geometry,0,0,Jn,Jn)){const yt=JI(Ue,ge,Re,c.vertical||H,d,24,ve,a.overscaling,Jn);for(const ft of yt){const Rt=H;Rt&&rP(a,Rt.text,qe,ft)||Ze(Ue,ft)}}else if(Je==="line-center"){for(const Ue of r.geometry)if(Ue.length>1){const yt=KI(Ue,Re,c.vertical||H,d,24,ve);yt&&Ze(Ue,yt)}}else if(r.type==="Polygon")for(const Ue of mg(r.geometry,0)){const yt=tP(Ue,16);Ze(Ue[0],new pa(yt.x,yt.y,0))}else if(r.type==="LineString")for(const Ue of r.geometry)Ze(Ue,new pa(Ue[0].x,Ue[0].y,0));else if(r.type==="Point")for(const Ue of r.geometry)for(const yt of Ue)Ze([yt],new pa(yt.x,yt.y,0))}const ma=32640;function Vx(a,r,c,d,g,y,x,T,S,P,D,O,N,G,H){const oe=function(Te,ge,we,De,Re,it,ct,Je){const qe=De.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Ge=[];for(const Qe of ge.positionedLines)for(const Ze of Qe.positionedGlyphs){if(!Ze.rect)continue;const Ue=Ze.rect||{};let yt=4,ft=!0,Rt=1,gn=0;const bn=(Re||Je)&&Ze.vertical,Qn=Ze.metrics.advance*Ze.scale/2;if(Je&&ge.verticalizable){const Tn=(Ze.scale-1)*pi,ci=(pi-Ze.metrics.width*Ze.scale)/2;gn=Qe.lineOffset/2-(Ze.imageName?-ci:Tn)}if(Ze.imageName){const Tn=ct[Ze.imageName];ft=Tn.sdf,Rt=Tn.pixelRatio,yt=1/Rt}const Ur=Re?[Ze.x+Qn,Ze.y]:[0,0];let Ei=Re?[0,0]:[Ze.x+Qn+we[0],Ze.y+we[1]-gn],$n=[0,0];bn&&($n=Ei,Ei=[0,0]);const li=(Ze.metrics.left-yt)*Ze.scale-Qn+Ei[0],Ti=(-Ze.metrics.top-yt)*Ze.scale+Ei[1],Ri=li+Ue.w*Ze.scale/Rt,lr=Ti+Ue.h*Ze.scale/Rt,Hn=new xt(li,Ti),Si=new xt(Ri,Ti),Di=new xt(li,lr),Zi=new xt(Ri,lr);if(bn){const Tn=new xt(-Qn,Qn-xf),ci=-Math.PI/2,Vt=12-Qn,Tr=new xt(22-Vt,-(Ze.imageName?Vt:0)),Ai=new xt(...$n);Hn._rotateAround(ci,Tn)._add(Tr)._add(Ai),Si._rotateAround(ci,Tn)._add(Tr)._add(Ai),Di._rotateAround(ci,Tn)._add(Tr)._add(Ai),Zi._rotateAround(ci,Tn)._add(Tr)._add(Ai)}if(qe){const Tn=Math.sin(qe),ci=Math.cos(qe),Vt=[ci,-Tn,Tn,ci];Hn._matMult(Vt),Si._matMult(Vt),Di._matMult(Vt),Zi._matMult(Vt)}const cr=new xt(0,0),ur=new xt(0,0);Ge.push({tl:Hn,tr:Si,bl:Di,br:Zi,tex:Ue,writingMode:ge.writingMode,glyphOffset:Ur,sectionIndex:Ze.sectionIndex,isSDF:ft,pixelOffsetTL:cr,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}return Ge}(0,c,T,g,y,x,d,a.allowVerticalPlacement),se=a.textSizeData;let ve=null;se.kind==="source"?(ve=[Po*g.layout.get("text-size").evaluate(x,{})],ve[0]>ma&&ye(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ve=[Po*G.compositeTextSizes[0].evaluate(x,{},H),Po*G.compositeTextSizes[1].evaluate(x,{},H)],(ve[0]>ma||ve[1]>ma)&&ye(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,oe,ve,T,y,x,P,r,S.lineStartIndex,S.lineLength,N,H);for(const Te of D)O[Te]=a.text.placedSymbolArray.length-1;return 4*oe.length}function jx(a){for(const r in a)return a[r];return null}function rP(a,r,c,d){const g=a.compareText;if(r in g){const y=g[r];for(let x=y.length-1;x>=0;x--)if(d.dist(y[x])<c)return!0}else g[r]=[];return g[r].push(d),!1}const sP=da.VectorTileFeature.types,oP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function If(a,r,c,d,g,y,x,T,S,P,D,O,N){const G=T?Math.min(ma,Math.round(T[0])):0,H=T?Math.min(ma,Math.round(T[1])):0;a.emplaceBack(r,c,Math.round(32*d),Math.round(32*g),y,x,(G<<1)+(S?1:0),H,16*P,16*D,256*O,256*N)}function Cg(a,r,c){a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c)}function aP(a){for(const r of a.sections)if(tf(r.text))return!0;return!1}class Mg{constructor(r){this.layoutVertexArray=new cs,this.indexArray=new Hi,this.programConfigurations=r,this.segments=new Bt,this.dynamicLayoutVertexArray=new Fr,this.opacityVertexArray=new us,this.placedSymbolArray=new Fe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,MI.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,kI.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,oP,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",Mg);class kg{constructor(r,c,d){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Bt,this.collisionVertexArray=new wr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,LI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",kg);class gc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cg([]),this.placementViewportMatrix=cg([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kx(this.zoom,c["text-size"]),this.iconSizeData=kx(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=Rg(d,"text-overlap","text-allow-overlap")!=="never"||Rg(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(x=>l.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new Mg(new dl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Mg(new dl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new We,this.lineVertexArray=new nt,this.symbolInstances=new et}calculateGlyphDependencies(r,c,d,g,y){for(let x=0;x<r.length;x++)if(c[r.charCodeAt(x)]=!0,(d||g)&&y){const T=th[r.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(r,c,d){const g=this.layers[0],y=g.layout,x=y.get("text-font"),T=y.get("text-field"),S=y.get("icon-image"),P=(T.value.kind!=="constant"||T.value.value instanceof ue&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!P&&!D)return;const N=c.iconDependencies,G=c.glyphDependencies,H=c.availableImages,oe=new vn(this.zoom);for(const{feature:se,id:ve,index:Te,sourceLayerIndex:ge}of r){const we=g._featureFilter.needGeometry,De=pl(se,we);if(!g._featureFilter.filter(oe,De,d))continue;let Re,it;if(we||(De.geometry=fl(se)),P){const Je=g.getValueAndResolveTokens("text-field",De,d,H),qe=ue.factory(Je);aP(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||cl()==="unavailable"||this.hasRTLText&&br.isParsed())&&(Re=DI(qe,g,De))}if(D){const Je=g.getValueAndResolveTokens("icon-image",De,d,H);it=Je instanceof fe?Je:fe.fromString(Je)}if(!Re&&!it)continue;const ct=this.sortFeaturesByKey?O.evaluate(De,{},d):void 0;if(this.features.push({id:ve,text:Re,icon:it,index:Te,sourceLayerIndex:ge,geometry:De.geometry,properties:se.properties,type:sP[se.type],sortKey:ct}),it&&(N[it.name]=!0),Re){const Je=x.evaluate(De,{},d).join(","),qe=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const Ge of Re.sections)if(Ge.image)N[Ge.image.name]=!0;else{const Qe=rc(Re.toString()),Ze=Ge.fontStack||Je,Ue=G[Ze]=G[Ze]||{};this.calculateGlyphDependencies(Ge.text,Ue,qe,this.allowVerticalPlacement,Qe)}}}y.get("symbol-placement")==="line"&&(this.features=function(se){const ve={},Te={},ge=[];let we=0;function De(Je){ge.push(se[Je]),we++}function Re(Je,qe,Ge){const Qe=Te[Je];return delete Te[Je],Te[qe]=Qe,ge[Qe].geometry[0].pop(),ge[Qe].geometry[0]=ge[Qe].geometry[0].concat(Ge[0]),Qe}function it(Je,qe,Ge){const Qe=ve[qe];return delete ve[qe],ve[Je]=Qe,ge[Qe].geometry[0].shift(),ge[Qe].geometry[0]=Ge[0].concat(ge[Qe].geometry[0]),Qe}function ct(Je,qe,Ge){const Qe=Ge?qe[0][qe[0].length-1]:qe[0][0];return`${Je}:${Qe.x}:${Qe.y}`}for(let Je=0;Je<se.length;Je++){const qe=se[Je],Ge=qe.geometry,Qe=qe.text?qe.text.toString():null;if(!Qe){De(Je);continue}const Ze=ct(Qe,Ge),Ue=ct(Qe,Ge,!0);if(Ze in Te&&Ue in ve&&Te[Ze]!==ve[Ue]){const yt=it(Ze,Ue,Ge),ft=Re(Ze,Ue,ge[yt].geometry);delete ve[Ze],delete Te[Ue],Te[ct(Qe,ge[ft].geometry,!0)]=ft,ge[yt].geometry=null}else Ze in Te?Re(Ze,Ue,Ge):Ue in ve?it(Ze,Ue,Ge):(De(Je),ve[Ze]=we-1,Te[Ue]=we-1)}return ge.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ve)=>se.sortKey-ve.sortKey)}update(r,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(r,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const d=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(c[r.segment+1]),y=r.dist(c[r.segment]);const x={};for(let T=r.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=r.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const S=x[T];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,c,d,g,y,x,T,S,P,D,O,N){const G=r.indexArray,H=r.layoutVertexArray,oe=r.segments.prepareSegment(4*c.length,H,G,this.canOverlap?x.sortKey:void 0),se=this.glyphOffsetArray.length,ve=oe.vertexLength,Te=this.allowVerticalPlacement&&T===l.WritingMode.vertical?Math.PI/2:0,ge=x.text&&x.text.sections;for(let we=0;we<c.length;we++){const{tl:De,tr:Re,bl:it,br:ct,tex:Je,pixelOffsetTL:qe,pixelOffsetBR:Ge,minFontScaleX:Qe,minFontScaleY:Ze,glyphOffset:Ue,isSDF:yt,sectionIndex:ft}=c[we],Rt=oe.vertexLength,gn=Ue[1];If(H,S.x,S.y,De.x,gn+De.y,Je.x,Je.y,d,yt,qe.x,qe.y,Qe,Ze),If(H,S.x,S.y,Re.x,gn+Re.y,Je.x+Je.w,Je.y,d,yt,Ge.x,qe.y,Qe,Ze),If(H,S.x,S.y,it.x,gn+it.y,Je.x,Je.y+Je.h,d,yt,qe.x,Ge.y,Qe,Ze),If(H,S.x,S.y,ct.x,gn+ct.y,Je.x+Je.w,Je.y+Je.h,d,yt,Ge.x,Ge.y,Qe,Ze),Cg(r.dynamicLayoutVertexArray,S,Te),G.emplaceBack(Rt,Rt+1,Rt+2),G.emplaceBack(Rt+1,Rt+2,Rt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),we!==c.length-1&&ft===c[we+1].sectionIndex||r.programConfigurations.populatePaintArrays(H.length,x,x.index,{},N,ge&&ge[ft])}r.placedSymbolArray.emplaceBack(S.x,S.y,se,this.glyphOffsetArray.length-se,ve,P,D,S.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,O)}_addCollisionDebugVertex(r,c,d,g,y,x){return c.emplaceBack(0,0),r.emplaceBack(d.x,d.y,g,y,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,c,d,g,y,x,T){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),P=S.vertexLength,D=y.layoutVertexArray,O=y.collisionVertexArray,N=T.anchorX,G=T.anchorY;this._addCollisionDebugVertex(D,O,x,N,G,new xt(r,c)),this._addCollisionDebugVertex(D,O,x,N,G,new xt(d,c)),this._addCollisionDebugVertex(D,O,x,N,G,new xt(d,g)),this._addCollisionDebugVertex(D,O,x,N,G,new xt(r,g)),S.vertexLength+=4;const H=y.indexArray;H.emplaceBack(P,P+1),H.emplaceBack(P+1,P+2),H.emplaceBack(P+2,P+3),H.emplaceBack(P+3,P),S.primitiveLength+=4}addDebugCollisionBoxes(r,c,d,g){for(let y=r;y<c;y++){const x=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kg(Qs,_x.members,Is),this.iconCollisionBox=new kg(Qs,_x.members,Is);for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(r,c,d,g,y,x,T,S,P){const D={};for(let O=c;O<d;O++){const N=r.get(O);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let O=g;O<y;O++){const N=r.get(O);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let O=x;O<T;O++){const N=r.get(O);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let O=S;O<P;O++){const N=r.get(O);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,c){const d=r.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<g;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(r),d=Math.cos(r),g=[],y=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const S=this.symbolInstances.get(T);g.push(0|Math.round(c*S.anchorX+d*S.anchorY)),y.push(S.featureIndex)}return x.sort((T,S)=>g[T]-g[S]||y[S]-y[T]),x}addToSortKeyRanges(r,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,y,x)=>{g>=0&&x.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}st("SymbolBucket",gc,{omit:["layers","collisionBoxArray","features","compareText"]}),gc.MAX_GLYPHS=65535,gc.addDynamicAttributes=Cg;const lP=new fi({"symbol-placement":new ht(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(Me.layout_symbol["icon-size"]),"icon-text-fit":new ht(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(Me.layout_symbol["icon-image"]),"icon-rotate":new bt(Me.layout_symbol["icon-rotate"]),"icon-padding":new bt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(Me.layout_symbol["icon-offset"]),"icon-anchor":new bt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(Me.layout_symbol["text-rotation-alignment"]),"text-field":new bt(Me.layout_symbol["text-field"]),"text-font":new bt(Me.layout_symbol["text-font"]),"text-size":new bt(Me.layout_symbol["text-size"]),"text-max-width":new bt(Me.layout_symbol["text-max-width"]),"text-line-height":new ht(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new bt(Me.layout_symbol["text-justify"]),"text-radial-offset":new bt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new bt(Me.layout_symbol["text-anchor"]),"text-max-angle":new ht(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(Me.layout_symbol["text-writing-mode"]),"text-rotate":new bt(Me.layout_symbol["text-rotate"]),"text-padding":new ht(Me.layout_symbol["text-padding"]),"text-keep-upright":new ht(Me.layout_symbol["text-keep-upright"]),"text-transform":new bt(Me.layout_symbol["text-transform"]),"text-offset":new bt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new ht(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(Me.layout_symbol["text-ignore-placement"]),"text-optional":new ht(Me.layout_symbol["text-optional"])});var Lg={paint:new fi({"icon-opacity":new bt(Me.paint_symbol["icon-opacity"]),"icon-color":new bt(Me.paint_symbol["icon-color"]),"icon-halo-color":new bt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(Me.paint_symbol["text-opacity"]),"text-color":new bt(Me.paint_symbol["text-color"],{runtimeType:Xn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new bt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new bt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(Me.paint_symbol["text-halo-blur"]),"text-translate":new ht(Me.paint_symbol["text-translate"]),"text-translate-anchor":new ht(Me.paint_symbol["text-translate-anchor"])}),layout:lP};class Gx{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:ss,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",Gx,{omit:["defaultValue"]});class Pf extends ls{constructor(r){super(r,Lg)}recalculate(r,c){if(super.recalculate(r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const y of d)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,c,d,g){const y=this.layout.get(r).evaluate(c,{},d,g),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||Ya(x.value)||!y?y:function(T,S){return S.replace(/{([^{}]+)}/g,(P,D)=>D in T?String(T[D]):"")}(c.properties,y)}createBucket(r){return new gc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Lg.paint.overridableProperties){if(!Pf.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),d=new Gx(c),g=new Jl(d,c.property.specification);let y=null;y=c.value.kind==="constant"||c.value.kind==="source"?new Ja("source",g):new Cu("composite",g,c.value.zoomStops),this.paint._values[r]=new as(c.property,y,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Pf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const d=r.get("text-field"),g=Lg.paint.properties[c];let y=!1;const x=T=>{for(const S of T)if(g.overrides&&g.overrides.hasOverride(S))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ue)x(d.value.value.sections);else if(d.value.kind==="source"){const T=P=>{y||(P instanceof lt&&Ie(P.value)===jn?x(P.value.sections):P instanceof Yl?x(P.sections):P.eachChild(T))},S=d.value;S._styleExpression&&T(S._styleExpression.expression)}return y}}function Rg(a,r,c){let d="never";const g=a.get(r);return g?d=g:a.get(c)&&(d="always"),d}var cP={paint:new fi({"background-color":new ht(Me.paint_background["background-color"]),"background-pattern":new Vu(Me.paint_background["background-pattern"]),"background-opacity":new ht(Me.paint_background["background-opacity"])})},uP={paint:new fi({"raster-opacity":new ht(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(Me.paint_raster["raster-saturation"]),"raster-contrast":new ht(Me.paint_raster["raster-contrast"]),"raster-resampling":new ht(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(Me.paint_raster["raster-fade-duration"])})};class hP extends ls{constructor(r){super(r,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const dP={circle:class extends ls{constructor(a){super(a,GA)}createBucket(a){return new og(a)}queryRadius(a){const r=a;return Wu("circle-radius",this,r)+Wu("circle-stroke-width",this,r)+hf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x,T){const S=df(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),P=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c),D=this.paint.get("circle-pitch-alignment")==="map",O=D?S:function(G,H){return G.map(oe=>ex(oe,H))}(S,T),N=D?P*x:P;for(const G of d)for(const H of G){const oe=D?H:ex(H,T);let se=N;const ve=ff([],[H.x,H.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=ve[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=y.cameraToCenterDistance/ve[3]),BA(O,oe,se))return!0}return!1}},heatmap:class extends ls{constructor(a){super(a,HA),this._updateColorRamp()}createBucket(a){return new tx(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ix({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ls{constructor(a){super(a,WA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ls{constructor(a){super(a,lI)}recalculate(a,r){super.recalculate(a,r);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new yg(a)}queryRadius(){return hf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x){return Wv(df(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),d)}isTileClipped(){return!0}},"fill-extrusion":class extends ls{constructor(a){super(a,wI)}createBucket(a){return new xg(a)}queryRadius(){return hf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,c,d,g,y,x,T){const S=df(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),P=this.paint.get("fill-extrusion-height").evaluate(r,c),D=this.paint.get("fill-extrusion-base").evaluate(r,c),O=function(G,H,oe,se){const ve=[];for(const Te of G){const ge=[Te.x,Te.y,0,1];ff(ge,ge,H),ve.push(new xt(ge[0]/ge[3],ge[1]/ge[3]))}return ve}(S,T),N=function(G,H,oe,se){const ve=[],Te=[],ge=se[8]*H,we=se[9]*H,De=se[10]*H,Re=se[11]*H,it=se[8]*oe,ct=se[9]*oe,Je=se[10]*oe,qe=se[11]*oe;for(const Ge of G){const Qe=[],Ze=[];for(const Ue of Ge){const yt=Ue.x,ft=Ue.y,Rt=se[0]*yt+se[4]*ft+se[12],gn=se[1]*yt+se[5]*ft+se[13],bn=se[2]*yt+se[6]*ft+se[14],Qn=se[3]*yt+se[7]*ft+se[15],Ur=bn+De,Ei=Qn+Re,$n=Rt+it,li=gn+ct,Ti=bn+Je,Ri=Qn+qe,lr=new xt((Rt+ge)/Ei,(gn+we)/Ei);lr.z=Ur/Ei,Qe.push(lr);const Hn=new xt($n/Ri,li/Ri);Hn.z=Ti/Ri,Ze.push(Hn)}ve.push(Qe),Te.push(Ze)}return[ve,Te]}(d,D,P,T);return function(G,H,oe){let se=1/0;Wv(oe,H)&&(se=dx(oe,H[0]));for(let ve=0;ve<H.length;ve++){const Te=H[ve],ge=G[ve];for(let we=0;we<Te.length-1;we++){const De=Te[we],Re=[De,Te[we+1],ge[we+1],ge[we],De];Hv(oe,Re)&&(se=Math.min(se,dx(oe,Re)))}}return se!==1/0&&se}(N[0],N[1],O)}},line:class extends ls{constructor(a){super(a,px),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=mx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new bg(a)}queryRadius(a){const r=a,c=gx(Wu("line-width",this,r),Wu("line-gap-width",this,r)),d=Wu("line-offset",this,r);return c/2+Math.abs(d)+hf(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x){const T=df(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),S=x/2*gx(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),P=this.paint.get("line-offset").evaluate(r,c);return P&&(d=function(D,O){const N=[];for(let G=0;G<D.length;G++){const H=D[G],oe=[];for(let se=0;se<H.length;se++){const ve=H[se-1],Te=H[se],ge=H[se+1],we=se===0?new xt(0,0):Te.sub(ve)._unit()._perp(),De=se===H.length-1?new xt(0,0):ge.sub(Te)._unit()._perp(),Re=we._add(De)._unit(),it=Re.x*De.x+Re.y*De.y;it!==0&&Re._mult(1/it),oe.push(Re._mult(O)._add(Te))}N.push(oe)}return N}(d,P*x)),function(D,O,N){for(let G=0;G<O.length;G++){const H=O[G];if(D.length>=3){for(let oe=0;oe<H.length;oe++)if(cc(D,H[oe]))return!0}if(NA(D,H,N))return!0}return!1}(T,d,S)}isTileClipped(){return!0}},symbol:Pf,background:class extends ls{constructor(a){super(a,cP)}},raster:class extends ls{constructor(a){super(a,uP)}}};class fP{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const $x=63710088e-1;class Ln{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ln(W(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,d=this.lat*c,g=r.lat*c,y=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((r.lng-this.lng)*c);return $x*Math.acos(Math.min(y,1))}toBounds(r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new gl(new Ln(this.lng-d,this.lat-c),new Ln(this.lng+d,this.lat+c))}static convert(r){if(r instanceof Ln)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ln(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ln(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class gl{constructor(r,c){r&&(c?this.setSouthWest(r).setNorthEast(c):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Ln?new Ln(r.lng,r.lat):Ln.convert(r),this}setSouthWest(r){return this._sw=r instanceof Ln?new Ln(r.lng,r.lat):Ln.convert(r),this}extend(r){const c=this._sw,d=this._ne;let g,y;if(r instanceof Ln)g=r,y=r;else{if(!(r instanceof gl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(gl.convert(r)):this.extend(Ln.convert(r)):this;if(g=r._sw,y=r._ne,!g||!y)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new Ln(g.lng,g.lat),this._ne=new Ln(y.lng,y.lat)),this}getCenter(){return new Ln((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ln(this.getWest(),this.getNorth())}getSouthEast(){return new Ln(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:c,lat:d}=Ln.convert(r);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(r){return r instanceof gl?r:r&&new gl(r)}}const Hx=2*Math.PI*$x;function Wx(a){return Hx*Math.cos(a*Math.PI/180)}function qx(a){return(180+a)/360}function Zx(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Xx(a,r){return a/Wx(r)}function Dg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Cf{constructor(r,c,d=0){this.x=+r,this.y=+c,this.z=+d}static fromLngLat(r,c=0){const d=Ln.convert(r);return new Cf(qx(d.lng),Zx(d.lat),Xx(c,d.lat))}toLngLat(){return new Ln(360*this.x-180,Dg(this.y))}toAltitude(){return this.z*Wx(Dg(this.y))}meterInMercatorCoordinateUnits(){return 1/Hx*(r=Dg(this.y),1/Math.cos(r*Math.PI/180));var r}}function Yx(a,r,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[a*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}class zg{constructor(r,c,d){if(r<0||r>25||d<0||d>=Math.pow(2,r)||c<0||c>=Math.pow(2,r))throw new Error(`x=${c}, y=${d}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=c,this.y=d,this.key=ih(0,r,r,c,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,c,d){const g=(x=this.y,T=this.z,S=Yx(256*(y=this.x),256*(x=Math.pow(2,T)-x-1),T),P=Yx(256*(y+1),256*(x+1),T),S[0]+","+S[1]+","+P[0]+","+P[1]);var y,x,T,S,P;const D=function(O,N,G){let H,oe="";for(let se=O;se>0;se--)H=1<<se-1,oe+=(N&H?1:0)+(G&H?2:0);return oe}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const c=this.z-r.z;return c>0&&r.x===this.x>>c&&r.y===this.y>>c}getTilePoint(r){const c=Math.pow(2,this.z);return new xt((r.x*c-this.x)*Jn,(r.y*c-this.y)*Jn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kx{constructor(r,c){this.wrap=r,this.canonical=c,this.key=ih(r,c.z,c.z,c.x,c.y)}}class Nr{constructor(r,c,d,g,y){if(r<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${d}`);this.overscaledZ=r,this.wrap=c,this.canonical=new zg(d,+g,+y),this.key=ih(c,r,d,g,y)}clone(){return new Nr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-r;return r>this.canonical.z?new Nr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Nr(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-r;return r>this.canonical.z?ih(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y):ih(this.wrap*+c,r,r,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new Nr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Nr(c,this.wrap,c,d,g),new Nr(c,this.wrap,c,d+1,g),new Nr(c,this.wrap,c,d,g+1),new Nr(c,this.wrap,c,d+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Nr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Nr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Cf(r.x-this.wrap,r.y))}}function ih(a,r,c,d,g){(a*=2)<0&&(a=-1*a-1);const y=1<<c;return(y*y*a+y*g+d).toString(36)+c.toString(36)+r.toString(36)}st("CanonicalTileID",zg),st("OverscaledTileID",Nr,{omit:["posMatrix"]});class Jx{constructor(r,c,d){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void ye(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const g=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=d||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let x=0;x<g;x++){const T=this.get(y,x);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(r,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(r,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(d[g],d[g+1],d[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}_unpackMapbox(r,c,d){return(256*r*256+256*c+d)/10-1e4}_unpackTerrarium(r,c,d){return 256*r+c+d/256-32768}getPixels(){return new Br({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,c,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,y=c*this.dim+this.dim,x=d*this.dim,T=d*this.dim+this.dim;switch(c){case-1:g=y-1;break;case 1:y=g+1}switch(d){case-1:x=T-1;break;case 1:T=x+1}const S=-c*this.dim,P=-d*this.dim;for(let D=x;D<T;D++)for(let O=g;O<y;O++)this.data[this._idx(O,D)]=r.data[this._idx(O+S,D+P)]}}st("DEMData",Jx);class Qx{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const d=r[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class e1{constructor(r,c,d,g,y){this.type="Feature",this._vectorTileFeature=r,r._z=c,r._x=d,r._y=g,this.properties=r.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(r[c]=this[c]);return r}}class t1{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ll(Jn,16,0),this.grid3D=new ll(Jn,16,0),this.featureIndexArray=new Lt,this.promoteId=c}insert(r,c,d,g,y,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,y);const S=x?this.grid3D:this.grid;for(let P=0;P<c.length;P++){const D=c[P],O=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const G=D[N];O[0]=Math.min(O[0],G.x),O[1]=Math.min(O[1],G.y),O[2]=Math.max(O[2],G.x),O[3]=Math.max(O[3],G.y)}O[0]<Jn&&O[1]<Jn&&O[2]>=0&&O[3]>=0&&S.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new da.VectorTile(new wg(this.rawTileData)).layers,this.sourceLayerCoder=new Qx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,c,d,g){this.loadVTLayers();const y=r.params||{},x=Jn/r.tileSize/r.scale,T=tc(y.filter),S=r.queryGeometry,P=r.queryPadding*x,D=i1(S),O=this.grid.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P),N=i1(r.cameraQueryGeometry),G=this.grid3D.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P,(se,ve,Te,ge)=>function(we,De,Re,it,ct){for(const qe of we)if(De<=qe.x&&Re<=qe.y&&it>=qe.x&&ct>=qe.y)return!0;const Je=[new xt(De,Re),new xt(De,ct),new xt(it,ct),new xt(it,Re)];if(we.length>2){for(const qe of Je)if(cc(we,qe))return!0}for(let qe=0;qe<we.length-1;qe++)if(VA(we[qe],we[qe+1],Je))return!0;return!1}(r.cameraQueryGeometry,se-P,ve-P,Te+P,ge+P));for(const se of G)O.push(se);O.sort(pP);const H={};let oe;for(let se=0;se<O.length;se++){const ve=O[se];if(ve===oe)continue;oe=ve;const Te=this.featureIndexArray.get(ve);let ge=null;this.loadMatchingFeature(H,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,T,y.layers,y.availableImages,c,d,g,(we,De,Re)=>(ge||(ge=fl(we)),De.queryIntersectsFeature(S,we,Re,ge,this.z,r.transform,x,r.pixelPosMatrix)))}return H}loadMatchingFeature(r,c,d,g,y,x,T,S,P,D,O){const N=this.bucketLayerIDs[c];if(x&&!function(se,ve){for(let Te=0;Te<se.length;Te++)if(ve.indexOf(se[Te])>=0)return!0;return!1}(x,N))return;const G=this.sourceLayerCoder.decode(d),H=this.vtLayers[G].feature(g);if(y.needGeometry){const se=pl(H,!0);if(!y.filter(new vn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!y.filter(new vn(this.tileID.overscaledZ),H))return;const oe=this.getId(H,G);for(let se=0;se<N.length;se++){const ve=N[se];if(x&&x.indexOf(ve)<0)continue;const Te=S[ve];if(!Te)continue;let ge={};oe&&D&&(ge=D.getState(Te.sourceLayer||"_geojsonTileLayer",oe));const we=Q({},P[ve]);we.paint=n1(we.paint,Te.paint,H,ge,T),we.layout=n1(we.layout,Te.layout,H,ge,T);const De=!O||O(H,Te,ge);if(!De)continue;const Re=new e1(H,this.z,this.x,this.y,oe);Re.layer=we;let it=r[ve];it===void 0&&(it=r[ve]=[]),it.push({featureIndex:g,feature:Re,intersectionZ:De})}}lookupSymbolFeatures(r,c,d,g,y,x,T,S){const P={};this.loadVTLayers();const D=tc(y);for(const O of r)this.loadMatchingFeature(P,d,g,O,D,x,T,S,c);return P}hasLayer(r){for(const c of this.bucketLayerIDs)for(const d of c)if(r===d)return!0;return!1}getId(r,c){let d=r.id;return this.promoteId&&(d=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function n1(a,r,c,d,g){return K(a,(y,x)=>{const T=r instanceof hl?r.get(x):null;return T&&T.evaluate?T.evaluate(c,d,g):T})}function i1(a){let r=1/0,c=1/0,d=-1/0,g=-1/0;for(const y of a)r=Math.min(r,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),g=Math.max(g,y.y);return{minX:r,minY:c,maxX:d,maxY:g}}function pP(a,r){return r-a}var Og;st("FeatureIndex",t1,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Og=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Og.load="load",Og.fullLoad="fullLoad";let Mf=null,rh=[];const Fg=1e3/30,mP={mark(a){performance.mark(a)},frame(a){const r=a;Mf!=null&&rh.push(r-Mf),Mf=r},clearMetrics(){Mf=null,rh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,c=rh.length,d=1/(rh.reduce((y,x)=>y+x,0)/c/1e3),g=rh.filter(y=>y>Fg).reduce((y,x)=>y+(x-Fg)/Fg,0);return{loadTime:a,fullLoadTime:r,fps:d,percentDroppedFrames:g/(c+g)*100}}};l.AJAXError=Zn,l.ARRAY_TYPE=qi,l.Actor=class{constructor(a,r,c){this.target=a,this.parent=r,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_e(["receive","process"],this),this.invoker=new fP(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Be()?a:window}send(a,r,c,d,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[y]=c);const x=qt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:bo(r,x)},x),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const r=a.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[c];const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d()}else Be()||r.mustQueue?(this.tasks[c]=r,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const c=this.callbacks[a];delete this.callbacks[a],c&&(r.error?c(Zs(r.error)):c(null,Zs(r.data)))}else{let c=!1;const d=qt(this.globalScope)?void 0:[],g=r.hasCallback?(T,S)=>{c=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:T?bo(T):null,data:bo(S,d)},d)}:T=>{c=!0};let y=null;const x=Zs(r.data);if(this.parent[r.type])y=this.parent[r.type](r.sourceMapId,x,g);else if(this.parent.getWorkerSource){const T=r.type.split(".");y=this.parent.getWorkerSource(r.sourceMapId,T[0],x.source)[T[1]](x,g)}else g(new Error(`Could not find function ${r.type}`));!c&&y&&y.cancel&&(this.cancelCallbacks[a]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Zu,l.CanonicalTileID=zg,l.CollisionBoxArray=ke,l.CollisionCircleLayoutArray=class extends z{},l.Color=Z,l.DEMData=Jx,l.DataConstantProperty=ht,l.DictionaryCoder=Qx,l.EXTENT=Jn,l.ErrorEvent=js,l.EvaluationParameters=vn,l.Event=Lr,l.Evented=yr,l.FeatureIndex=t1,l.FillBucket=yg,l.FillExtrusionBucket=xg,l.GeoJSONFeature=e1,l.ImageAtlas=Sx,l.ImagePosition=Tg,l.LineBucket=bg,l.LineStripIndexArray=class extends re{},l.LngLat=Ln,l.LngLatBounds=gl,l.MercatorCoordinate=Cf,l.ONE_EM=pi,l.OverscaledTileID=Nr,l.PerformanceUtils=mP,l.PosArray=_t,l.Properties=fi,l.QuadTriangleArray=class extends U{},l.RGBAImage=Br,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=Ci,l.SegmentVector=Bt,l.SymbolBucket=gc,l.Transitionable=sf,l.TriangleIndexArray=Hi,l.Uniform1f=So,l.Uniform1i=class extends To{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends To{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends To{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=ac,l.UniformColor=Vv,l.UniformMatrix4f=class extends To{constructor(a,r){super(a,r),this.current=OA}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=Kx,l.ValidationError=He,l.ZoomHistory=Ru,l.add=function(a,r,c){return a[0]=r[0]+c[0],a[1]=r[1]+c[1],a[2]=r[2]+c[2],a},l.addDynamicAttributes=Cg,l.asyncAll=function(a,r,c){if(!a.length)return c(null,[]);let d=a.length;const g=new Array(a.length);let y=null;a.forEach((x,T)=>{r(x,(S,P)=>{S&&(y=S),g[T]=P,--d==0&&c(y,g)})})},l.bezier=M,l.bindAll=_e,l.cacheEntryPossiblyAdded=function(a){xi++,xi>nr&&(a.getActor().send("enforceCacheSizeLimit",nn),xi=0)},l.clamp=C,l.clearTileCache=function(a){const r=caches.delete(wt);a&&r.catch(a).then(()=>a())},l.clipLine=Fx,l.clone=function(a){var r=new qi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=J,l.clone$2=function(a){var r=new qi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=RI,l.config=tt,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new qi(16);return qi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=Xv,l.createExpression=Ka,l.createFilter=tc,l.createLayout=Gn,l.createStyleLayer=function(a){return a.type==="custom"?new hP(a):new dP[a.type](a)},l.cross=function(a,r,c){var d=r[0],g=r[1],y=r[2],x=c[0],T=c[1],S=c[2];return a[0]=g*S-y*T,a[1]=y*x-d*S,a[2]=d*T-g*x,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=L,l.emitValidationErrors=ic,l.enforceCacheSizeLimit=function(a){ni(),St&&St.then(r=>{r.keys().then(c=>{for(let d=0;d<c.length-a;d++)r.delete(c[d])})})},l.equals=function(a,r){var c=a[0],d=a[1],g=a[2],y=a[3],x=a[4],T=a[5],S=a[6],P=a[7],D=a[8],O=a[9],N=a[10],G=a[11],H=a[12],oe=a[13],se=a[14],ve=a[15],Te=r[0],ge=r[1],we=r[2],De=r[3],Re=r[4],it=r[5],ct=r[6],Je=r[7],qe=r[8],Ge=r[9],Qe=r[10],Ze=r[11],Ue=r[12],yt=r[13],ft=r[14],Rt=r[15];return Math.abs(c-Te)<=Wi*Math.max(1,Math.abs(c),Math.abs(Te))&&Math.abs(d-ge)<=Wi*Math.max(1,Math.abs(d),Math.abs(ge))&&Math.abs(g-we)<=Wi*Math.max(1,Math.abs(g),Math.abs(we))&&Math.abs(y-De)<=Wi*Math.max(1,Math.abs(y),Math.abs(De))&&Math.abs(x-Re)<=Wi*Math.max(1,Math.abs(x),Math.abs(Re))&&Math.abs(T-it)<=Wi*Math.max(1,Math.abs(T),Math.abs(it))&&Math.abs(S-ct)<=Wi*Math.max(1,Math.abs(S),Math.abs(ct))&&Math.abs(P-Je)<=Wi*Math.max(1,Math.abs(P),Math.abs(Je))&&Math.abs(D-qe)<=Wi*Math.max(1,Math.abs(D),Math.abs(qe))&&Math.abs(O-Ge)<=Wi*Math.max(1,Math.abs(O),Math.abs(Ge))&&Math.abs(N-Qe)<=Wi*Math.max(1,Math.abs(N),Math.abs(Qe))&&Math.abs(G-Ze)<=Wi*Math.max(1,Math.abs(G),Math.abs(Ze))&&Math.abs(H-Ue)<=Wi*Math.max(1,Math.abs(H),Math.abs(Ue))&&Math.abs(oe-yt)<=Wi*Math.max(1,Math.abs(oe),Math.abs(yt))&&Math.abs(se-ft)<=Wi*Math.max(1,Math.abs(se),Math.abs(ft))&&Math.abs(ve-Rt)<=Wi*Math.max(1,Math.abs(ve),Math.abs(Rt))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:c},{lowerSize:d,upperSize:g}){return a.kind==="source"?d/Po:a.kind==="composite"?kt(d/Po,g/Po,c):r},l.evaluateSizeForZoom=function(a,r){let c=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:x}=a,T=g?C(sr.interpolationFactor(g,r,y,x),0,1):0;a.kind==="camera"?d=kt(a.minSize,a.maxSize,T):c=T}return{uSizeT:c,uSize:d}},l.evaluateVariableOffset=Ux,l.evented=Uu,l.exported=ti,l.exported$1=ii,l.extend=Q,l.filterObject=$,l.fromRotation=function(a,r){var c=Math.sin(r),d=Math.cos(r);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=Ag,l.getAnchorJustification=Pg,l.getArrayBuffer=ji,l.getImage=is,l.getJSON=function(a,r){return hi(Q(a,{type:"json"}),r)},l.getOverlapMode=Rg,l.getRTLTextPluginStatus=cl,l.getReferrer=Mr,l.getVideo=function(a,r){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){r(null,c)};for(let d=0;d<a.length;d++){const g=window.document.createElement("source");Vs(a[d])||(c.crossOrigin="Anonymous"),g.src=a[d],c.appendChild(g)}return{cancel:()=>{}}},l.identity=cg,l.invert=function(a,r){var c=r[0],d=r[1],g=r[2],y=r[3],x=r[4],T=r[5],S=r[6],P=r[7],D=r[8],O=r[9],N=r[10],G=r[11],H=r[12],oe=r[13],se=r[14],ve=r[15],Te=c*T-d*x,ge=c*S-g*x,we=c*P-y*x,De=d*S-g*T,Re=d*P-y*T,it=g*P-y*S,ct=D*oe-O*H,Je=D*se-N*H,qe=D*ve-G*H,Ge=O*se-N*oe,Qe=O*ve-G*oe,Ze=N*ve-G*se,Ue=Te*Ze-ge*Qe+we*Ge+De*qe-Re*Je+it*ct;return Ue?(a[0]=(T*Ze-S*Qe+P*Ge)*(Ue=1/Ue),a[1]=(g*Qe-d*Ze-y*Ge)*Ue,a[2]=(oe*it-se*Re+ve*De)*Ue,a[3]=(N*Re-O*it-G*De)*Ue,a[4]=(S*qe-x*Ze-P*Je)*Ue,a[5]=(c*Ze-g*qe+y*Je)*Ue,a[6]=(se*we-H*it-ve*ge)*Ue,a[7]=(D*it-N*we+G*ge)*Ue,a[8]=(x*Qe-T*qe+P*ct)*Ue,a[9]=(d*qe-c*Qe-y*ct)*Ue,a[10]=(H*Re-oe*we+ve*Te)*Ue,a[11]=(O*we-D*Re-G*Te)*Ue,a[12]=(T*Je-x*Ge-S*ct)*Ue,a[13]=(c*Ge-d*Je+g*ct)*Ue,a[14]=(oe*ge-H*De-se*Te)*Ue,a[15]=(D*De-O*ge+N*Te)*Ue,a):null},l.isImageBitmap=zt,l.isSafari=qt,l.isWorker=Be,l.keysDifference=function(a,r){const c=[];for(const d in a)d in r||c.push(d);return c},l.lazyLoadRTLTextPlugin=function(){br.isLoading()||br.isLoaded()||cl()!=="deferred"||rf()},l.makeRequest=hi,l.mapObject=K,l.mercatorXfromLng=qx,l.mercatorYfromLat=Zx,l.mercatorZfromAltitude=Xx,l.mul=$A,l.mul$1=function(a,r,c){return a[0]=r[0]*c[0],a[1]=r[1]*c[1],a[2]=r[2]*c[2],a[3]=r[3]*c[3],a},l.multiply=Yv,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var c=r[0],d=r[1],g=r[2],y=c*c+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=r[0]*y,a[1]=r[1]*y,a[2]=r[2]*y,a},l.number=kt,l.ortho=function(a,r,c,d,g,y,x){var T=1/(r-c),S=1/(d-g),P=1/(y-x);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(r+c)*T,a[13]=(g+d)*S,a[14]=(x+y)*P,a[15]=1,a},l.parseCacheControl=Xe,l.parseGlyphPbf=function(a){return new wg(a).readFields($I,[])},l.pbf=wg,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Jn/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,c=a.bucket.layers[0]._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new vn(a.bucket.zoom+1),a.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new vn(a.bucket.zoom+1),a.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new vn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=a.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new vn(S),a.canonical),c["text-size"].possiblyEvaluate(new vn(P),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=a.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new vn(S),a.canonical),c["icon-size"].possiblyEvaluate(new vn(P),a.canonical)]}const g=r.get("text-line-height")*pi,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),T=r.get("text-size");for(const S of a.bucket.features){const P=r.get("text-font").evaluate(S,{},a.canonical).join(","),D=T.evaluate(S,{},a.canonical),O=d.layoutTextSize.evaluate(S,{},a.canonical),N=d.layoutIconSize.evaluate(S,{},a.canonical),G={horizontal:{},vertical:void 0},H=S.text;let oe,se=[0,0];if(H){const ge=H.toString(),we=r.get("text-letter-spacing").evaluate(S,{},a.canonical)*pi,De=tg(ge)?we:0,Re=r.get("text-anchor").evaluate(S,{},a.canonical),it=r.get("text-variable-anchor");if(!it){const Qe=r.get("text-radial-offset").evaluate(S,{},a.canonical);se=Qe?Ux(Re,[Qe*pi,Ig]):r.get("text-offset").evaluate(S,{},a.canonical).map(Ze=>Ze*pi)}let ct=y?"center":r.get("text-justify").evaluate(S,{},a.canonical);const Je=r.get("symbol-placement"),qe=Je==="point"?r.get("text-max-width").evaluate(S,{},a.canonical)*pi:0,Ge=()=>{a.bucket.allowVerticalPlacement&&rc(ge)&&(G.vertical=bf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,qe,g,Re,"left",De,se,l.WritingMode.vertical,!0,Je,O,D))};if(!y&&it){const Qe=ct==="auto"?it.map(Ue=>Pg(Ue)):[ct];let Ze=!1;for(let Ue=0;Ue<Qe.length;Ue++){const yt=Qe[Ue];if(!G.horizontal[yt])if(Ze)G.horizontal[yt]=G.horizontal[0];else{const ft=bf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,qe,g,"center",yt,De,se,l.WritingMode.horizontal,!1,Je,O,D);ft&&(G.horizontal[yt]=ft,Ze=ft.positionedLines.length===1)}}Ge()}else{ct==="auto"&&(ct=Pg(Re));const Qe=bf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,qe,g,Re,ct,De,se,l.WritingMode.horizontal,!1,Je,O,D);Qe&&(G.horizontal[ct]=Qe),Ge(),rc(ge)&&y&&x&&(G.vertical=bf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,qe,g,Re,ct,De,se,l.WritingMode.vertical,!1,Je,O,D))}}let ve=!1;if(S.icon&&S.icon.name){const ge=a.imageMap[S.icon.name];ge&&(oe=YI(a.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},a.canonical),r.get("icon-anchor").evaluate(S,{},a.canonical)),ve=!!ge.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Te=jx(G.horizontal)||G.vertical;a.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||oe)&&iP(a.bucket,S,G,oe,a.imageMap,d,O,N,se,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,c,d,g){var y,x=1/Math.tan(r/2);return a[0]=x/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+d)*(y=1/(d-g)),a[14]=2*g*d*y):(a[10]=-1,a[14]=-2*d),a},l.pick=function(a,r){const c={};for(let d=0;d<r.length;d++){const g=r[d];g in a&&(c[g]=a[g])}return c},l.plugin=br,l.pointGeometry=xt,l.polygonIntersectsPolygon=Hv,l.potpack=Tx,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=st,l.registerForPluginStateChange=function(a){return a({pluginStatus:$i,pluginURL:Xs}),Uu.on("pluginStateChange",a),a},l.renderColorRamp=ix,l.rotateX=function(a,r,c){var d=Math.sin(c),g=Math.cos(c),y=r[4],x=r[5],T=r[6],S=r[7],P=r[8],D=r[9],O=r[10],N=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=y*g+P*d,a[5]=x*g+D*d,a[6]=T*g+O*d,a[7]=S*g+N*d,a[8]=P*g-y*d,a[9]=D*g-x*d,a[10]=O*g-T*d,a[11]=N*g-S*d,a},l.rotateZ=function(a,r,c){var d=Math.sin(c),g=Math.cos(c),y=r[0],x=r[1],T=r[2],S=r[3],P=r[4],D=r[5],O=r[6],N=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=y*g+P*d,a[1]=x*g+D*d,a[2]=T*g+O*d,a[3]=S*g+N*d,a[4]=P*g-y*d,a[5]=D*g-x*d,a[6]=O*g-T*d,a[7]=N*g-S*d,a},l.scale=function(a,r,c){var d=c[0],g=c[1],y=c[2];return a[0]=r[0]*d,a[1]=r[1]*d,a[2]=r[2]*d,a[3]=r[3]*d,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*y,a[9]=r[9]*y,a[10]=r[10]*y,a[11]=r[11]*y,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,c){return a[0]=r[0]*c,a[1]=r[1]*c,a[2]=r[2]*c,a},l.setCacheLimits=function(a,r){nn=a,nr=r},l.setRTLTextPlugin=function(a,r,c=!1){if($i===Ou||$i===Fu||$i===Bu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xs=ti.resolveURL(a),$i=Ou,Nu=r,la(),c||rf()},l.spec=Me,l.sphericalToCartesian=function([a,r,c]){return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(c),y:a*Math.sin(r)*Math.sin(c),z:a*Math.cos(c)}},l.sqrLen=function(a){var r=a[0],c=a[1];return r*r+c*c},l.sub=function(a,r,c){return a[0]=r[0]-c[0],a[1]=r[1]-c[1],a[2]=r[2]-c[2],a},l.toEvaluationFeature=pl,l.transformMat3=function(a,r,c){var d=r[0],g=r[1],y=r[2];return a[0]=d*c[0]+g*c[3]+y*c[6],a[1]=d*c[1]+g*c[4]+y*c[7],a[2]=d*c[2]+g*c[5]+y*c[8],a},l.transformMat4=ff,l.transformMat4$1=function(a,r,c){var d=r[0],g=r[1];return a[0]=c[0]*d+c[4]*g+c[12],a[1]=c[1]*d+c[5]*g+c[13],a},l.translate=function(a,r,c){var d,g,y,x,T,S,P,D,O,N,G,H,oe=c[0],se=c[1],ve=c[2];return r===a?(a[12]=r[0]*oe+r[4]*se+r[8]*ve+r[12],a[13]=r[1]*oe+r[5]*se+r[9]*ve+r[13],a[14]=r[2]*oe+r[6]*se+r[10]*ve+r[14],a[15]=r[3]*oe+r[7]*se+r[11]*ve+r[15]):(g=r[1],y=r[2],x=r[3],T=r[4],S=r[5],P=r[6],D=r[7],O=r[8],N=r[9],G=r[10],H=r[11],a[0]=d=r[0],a[1]=g,a[2]=y,a[3]=x,a[4]=T,a[5]=S,a[6]=P,a[7]=D,a[8]=O,a[9]=N,a[10]=G,a[11]=H,a[12]=d*oe+T*se+O*ve+r[12],a[13]=g*oe+S*se+N*ve+r[13],a[14]=y*oe+P*se+G*ve+r[14],a[15]=x*oe+D*se+H*ve+r[15]),a},l.triggerPluginCompletionEvent=nf,l.unicodeBlockLookup=Ke,l.uniqueId=function(){return ne++},l.validateCustomStyleLayer=function(a){const r=[],c=a.id;return c===void 0&&r.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=Lu,l.validateStyle=al,l.vectorTile=da,l.warnOnce=ye,l.wrap=W}),u(["./shared"],function(l){function b(Y){const R=typeof Y;if(R==="number"||R==="boolean"||R==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let Z="[";for(const le of Y)Z+=`${b(le)},`;return`${Z}]`}const F=Object.keys(Y).sort();let q="{";for(let Z=0;Z<F.length;Z++)q+=`${JSON.stringify(F[Z])}:${b(Y[F[Z]])},`;return`${q}}`}function w(Y){let R="";for(const F of l.refProperties)R+=`/${b(Y[F])}`;return R}class M{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const Z of R){this._layerConfigs[Z.id]=Z;const le=this._layers[Z.id]=l.createStyleLayer(Z);le._featureFilter=l.createFilter(le.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of F)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const q=function(Z,le){const de={};for(let ae=0;ae<Z.length;ae++){const fe=le&&le[Z[ae].id]||w(Z[ae]);le&&(le[Z[ae].id]=fe);let Pe=de[fe];Pe||(Pe=de[fe]=[]),Pe.push(Z[ae])}const ue=[];for(const ae in de)ue.push(de[ae]);return ue}(Object.values(this._layerConfigs),this.keyCache);for(const Z of q){const le=Z.map(ze=>this._layers[ze.id]),de=le[0];if(de.visibility==="none")continue;const ue=de.source||"";let ae=this.familiesBySource[ue];ae||(ae=this.familiesBySource[ue]={});const fe=de.sourceLayer||"_geojsonTileLayer";let Pe=ae[fe];Pe||(Pe=ae[fe]=[]),Pe.push(le)}}}class L{constructor(R){const F={},q=[];for(const ue in R){const ae=R[ue],fe=F[ue]={};for(const Pe in ae){const ze=ae[+Pe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ie={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};q.push(Ie),fe[Pe]={rect:Ie,metrics:ze.metrics}}}const{w:Z,h:le}=l.potpack(q),de=new l.AlphaImage({width:Z||1,height:le||1});for(const ue in R){const ae=R[ue];for(const fe in ae){const Pe=ae[+fe];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const ze=F[ue][fe].rect;l.AlphaImage.copy(Pe.bitmap,de,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Pe.bitmap)}}this.image=de,this.positions=F}}l.register("GlyphAtlas",L);class C{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,q,Z,le){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const de=new l.DictionaryCoder(Object.keys(R.layers).sort()),ue=new l.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const ae={},fe={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},Pe=F.familiesBySource[this.source];for(const vt in Pe){const Tt=R.layers[vt];if(!Tt)continue;Tt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ot=de.encode(vt),Ut=[];for(let un=0;un<Tt.length;un++){const hn=Tt.feature(un),Yn=ue.getId(hn,vt);Ut.push({feature:hn,id:Yn,index:un,sourceLayerIndex:Ot})}for(const un of Pe[vt]){const hn=un[0];hn.source!==this.source&&l.warnOnce(`layer.source = ${hn.source} does not equal this.source = ${this.source}`),hn.minzoom&&this.zoom<Math.floor(hn.minzoom)||hn.maxzoom&&this.zoom>=hn.maxzoom||hn.visibility!=="none"&&(W(un,this.zoom,q),(ae[hn.id]=hn.createBucket({index:ue.bucketLayerIDs.length,layers:un,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ot,sourceID:this.source})).populate(Ut,fe,this.tileID.canonical),ue.bucketLayerIDs.push(un.map(Yn=>Yn.id)))}}let ze,Ie,rt,lt;const Ye=l.mapObject(fe.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(Ye).length?Z.send("getGlyphs",{uid:this.uid,stacks:Ye},(vt,Tt)=>{ze||(ze=vt,Ie=Tt,Mt.call(this))}):Ie={};const gt=Object.keys(fe.iconDependencies);gt.length?Z.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(vt,Tt)=>{ze||(ze=vt,rt=Tt,Mt.call(this))}):rt={};const dt=Object.keys(fe.patternDependencies);function Mt(){if(ze)return le(ze);if(Ie&&rt&&lt){const vt=new L(Ie),Tt=new l.ImageAtlas(rt,lt);for(const Ot in ae){const Ut=ae[Ot];Ut instanceof l.SymbolBucket?(W(Ut.layers,this.zoom,q),l.performSymbolLayout({bucket:Ut,glyphMap:Ie,glyphPositions:vt.positions,imageMap:rt,imagePositions:Tt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ut.hasPattern&&(Ut instanceof l.LineBucket||Ut instanceof l.FillBucket||Ut instanceof l.FillExtrusionBucket)&&(W(Ut.layers,this.zoom,q),Ut.addFeatures(fe,this.tileID.canonical,Tt.patternPositions))}this.status="done",le(null,{buckets:Object.values(ae).filter(Ot=>!Ot.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,imageAtlas:Tt,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?rt:null,glyphPositions:this.returnDependencies?vt.positions:null})}}dt.length?Z.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"},(vt,Tt)=>{ze||(ze=vt,lt=Tt,Mt.call(this))}):lt={},Mt.call(this)}}function W(Y,R,F){const q=new l.EvaluationParameters(R);for(const Z of Y)Z.recalculate(q,F)}function Q(Y,R){const F=l.getArrayBuffer(Y.request,(q,Z,le,de)=>{q?R(q):Z&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(Z)),rawData:Z,cacheControl:le,expires:de})});return()=>{F.cancel(),R()}}class ne{constructor(R,F,q,Z){this.actor=R,this.layerIndex=F,this.availableImages=q,this.loadVectorData=Z||Q,this.loading={},this.loaded={}}loadTile(R,F){const q=R.uid;this.loading||(this.loading={});const Z=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),le=this.loading[q]=new C(R);le.abort=this.loadVectorData(R,(de,ue)=>{if(delete this.loading[q],de||!ue)return le.status="done",this.loaded[q]=le,F(de);const ae=ue.rawData,fe={};ue.expires&&(fe.expires=ue.expires),ue.cacheControl&&(fe.cacheControl=ue.cacheControl);const Pe={};if(Z){const ze=Z.finish();ze&&(Pe.resourceTiming=JSON.parse(JSON.stringify(ze)))}le.vectorTile=ue.vectorTile,le.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(ze,Ie)=>{if(ze||!Ie)return F(ze);F(null,l.extend({rawTileData:ae.slice(0)},Ie,fe,Pe))}),this.loaded=this.loaded||{},this.loaded[q]=le})}reloadTile(R,F){const q=this.loaded,Z=R.uid,le=this;if(q&&q[Z]){const de=q[Z];de.showCollisionBoxes=R.showCollisionBoxes;const ue=(ae,fe)=>{const Pe=de.reloadCallback;Pe&&(delete de.reloadCallback,de.parse(de.vectorTile,le.layerIndex,this.availableImages,le.actor,Pe)),F(ae,fe)};de.status==="parsing"?de.reloadCallback=ue:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}}abortTile(R,F){const q=this.loading,Z=R.uid;q&&q[Z]&&q[Z].abort&&(q[Z].abort(),delete q[Z]),F()}removeTile(R,F){const q=this.loaded,Z=R.uid;q&&q[Z]&&delete q[Z],F()}}class _e{constructor(){this.loaded={}}loadTile(R,F){const{uid:q,encoding:Z,rawImageData:le}=R,de=l.isImageBitmap(le)?this.getImageData(le):le,ue=new l.DEMData(q,de,Z);this.loaded=this.loaded||{},this.loaded[q]=ue,F(null,ue)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,q=R.uid;F&&F[q]&&delete F[q]}}var K=function Y(R,F){var q,Z=R&&R.type;if(Z==="FeatureCollection")for(q=0;q<R.features.length;q++)Y(R.features[q],F);else if(Z==="GeometryCollection")for(q=0;q<R.geometries.length;q++)Y(R.geometries[q],F);else if(Z==="Feature")Y(R.geometry,F);else if(Z==="Polygon")$(R.coordinates,F);else if(Z==="MultiPolygon")for(q=0;q<R.coordinates.length;q++)$(R.coordinates[q],F);return R};function $(Y,R){if(Y.length!==0){J(Y[0],R);for(var F=1;F<Y.length;F++)J(Y[F],!R)}}function J(Y,R){for(var F=0,q=0,Z=0,le=Y.length,de=le-1;Z<le;de=Z++){var ue=(Y[Z][0]-Y[de][0])*(Y[de][1]+Y[Z][1]),ae=F+ue;q+=Math.abs(F)>=Math.abs(ue)?F-ae+ue:ue-ae+F,F=ae}F+q>=0!=!!R&&Y.reverse()}const pe=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ye{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new l.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const q=[];for(const Z of F)q.push(new l.pointGeometry(Z[0],Z[1]));R.push(q)}return R}}toGeoJSON(R,F,q){return pe.call(this,R,F,q)}}class Ae{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new ye(this._features[R])}}var Oe={exports:{}},Be=l.pointGeometry,Xe=l.vectorTile.VectorTileFeature,je=mt;function mt(Y,R){this.options=R||{},this.features=Y,this.length=Y.length}function Dt(Y,R){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=R||4096}mt.prototype.feature=function(Y){return new Dt(this.features[Y],this.options.extent)},Dt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var R=0;R<Y.length;R++){for(var F=Y[R],q=[],Z=0;Z<F.length;Z++)q.push(new Be(F[Z][0],F[Z][1]));this.geometry.push(q)}return this.geometry},Dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,R=1/0,F=-1/0,q=1/0,Z=-1/0,le=0;le<Y.length;le++)for(var de=Y[le],ue=0;ue<de.length;ue++){var ae=de[ue];R=Math.min(R,ae.x),F=Math.max(F,ae.x),q=Math.min(q,ae.y),Z=Math.max(Z,ae.y)}return[R,q,F,Z]},Dt.prototype.toGeoJSON=Xe.prototype.toGeoJSON;var qt=l.pbf,zt=je;function ti(Y){var R=new qt;return function(F,q){for(var Z in F.layers)q.writeMessage(3,xt,F.layers[Z])}(Y,R),R.finish()}function xt(Y,R){var F;R.writeVarintField(15,Y.version||1),R.writeStringField(1,Y.name||""),R.writeVarintField(5,Y.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Y.length;F++)q.feature=Y.feature(F),R.writeMessage(2,vi,q);var Z=q.keys;for(F=0;F<Z.length;F++)R.writeStringField(3,Z[F]);var le=q.values;for(F=0;F<le.length;F++)R.writeMessage(4,nn,le[F])}function vi(Y,R){var F=Y.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,tt,Y),R.writeVarintField(3,F.type),R.writeMessage(4,tn,F)}function tt(Y,R){var F=Y.feature,q=Y.keys,Z=Y.values,le=Y.keycache,de=Y.valuecache;for(var ue in F.properties){var ae=F.properties[ue],fe=le[ue];if(ae!==null){fe===void 0&&(q.push(ue),le[ue]=fe=q.length-1),R.writeVarint(fe);var Pe=typeof ae;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(ae=JSON.stringify(ae));var ze=Pe+":"+ae,Ie=de[ze];Ie===void 0&&(Z.push(ae),de[ze]=Ie=Z.length-1),R.writeVarint(Ie)}}}function wt(Y,R){return(R<<3)+(7&Y)}function St(Y){return Y<<1^Y>>31}function tn(Y,R){for(var F=Y.loadGeometry(),q=Y.type,Z=0,le=0,de=F.length,ue=0;ue<de;ue++){var ae=F[ue],fe=1;q===1&&(fe=ae.length),R.writeVarint(wt(1,fe));for(var Pe=q===3?ae.length-1:ae.length,ze=0;ze<Pe;ze++){ze===1&&q!==1&&R.writeVarint(wt(2,Pe-1));var Ie=ae[ze].x-Z,rt=ae[ze].y-le;R.writeVarint(St(Ie)),R.writeVarint(St(rt)),Z+=Ie,le+=rt}q===3&&R.writeVarint(wt(7,1))}}function nn(Y,R){var F=typeof Y;F==="string"?R.writeStringField(1,Y):F==="boolean"?R.writeBooleanField(7,Y):F==="number"&&(Y%1!=0?R.writeDoubleField(3,Y):Y<0?R.writeSVarintField(6,Y):R.writeVarintField(5,Y))}function nr(Y,R,F,q,Z,le){if(Z-q<=F)return;const de=q+Z>>1;ni(Y,R,de,q,Z,le%2),nr(Y,R,F,q,de-1,le+1),nr(Y,R,F,de+1,Z,le+1)}function ni(Y,R,F,q,Z,le){for(;Z>q;){if(Z-q>600){const fe=Z-q+1,Pe=F-q+1,ze=Math.log(fe),Ie=.5*Math.exp(2*ze/3),rt=.5*Math.sqrt(ze*Ie*(fe-Ie)/fe)*(Pe-fe/2<0?-1:1);ni(Y,R,F,Math.max(q,Math.floor(F-Pe*Ie/fe+rt)),Math.min(Z,Math.floor(F+(fe-Pe)*Ie/fe+rt)),le)}const de=R[2*F+le];let ue=q,ae=Z;for(xi(Y,R,q,F),R[2*Z+le]>de&&xi(Y,R,q,Z);ue<ae;){for(xi(Y,R,ue,ae),ue++,ae--;R[2*ue+le]<de;)ue++;for(;R[2*ae+le]>de;)ae--}R[2*q+le]===de?xi(Y,R,q,ae):(ae++,xi(Y,R,ae,Z)),ae<=F&&(q=ae+1),F<=ae&&(Z=ae-1)}}function xi(Y,R,F,q){ii(Y,F,q),ii(R,2*F,2*q),ii(R,2*F+1,2*q+1)}function ii(Y,R,F){const q=Y[R];Y[R]=Y[F],Y[F]=q}function ln(Y,R,F,q){const Z=Y-F,le=R-q;return Z*Z+le*le}Oe.exports=ti,Oe.exports.fromVectorTileJs=ti,Oe.exports.fromGeojsonVt=function(Y,R){R=R||{};var F={};for(var q in Y)F[q]=new zt(Y[q].features,R),F[q].name=q,F[q].version=R.version,F[q].extent=R.extent;return ti({layers:F})},Oe.exports.GeoJSONWrapper=zt;const bi=Y=>Y[0],Wt=Y=>Y[1];class zn{constructor(R,F=bi,q=Wt,Z=64,le=Float64Array){this.nodeSize=Z,this.points=R;const de=R.length<65536?Uint16Array:Uint32Array,ue=this.ids=new de(R.length),ae=this.coords=new le(2*R.length);for(let fe=0;fe<R.length;fe++)ue[fe]=fe,ae[2*fe]=F(R[fe]),ae[2*fe+1]=q(R[fe]);nr(ue,ae,Z,0,ue.length-1,0)}range(R,F,q,Z){return function(le,de,ue,ae,fe,Pe,ze){const Ie=[0,le.length-1,0],rt=[];let lt,Ye;for(;Ie.length;){const gt=Ie.pop(),dt=Ie.pop(),Mt=Ie.pop();if(dt-Mt<=ze){for(let Ot=Mt;Ot<=dt;Ot++)lt=de[2*Ot],Ye=de[2*Ot+1],lt>=ue&&lt<=fe&&Ye>=ae&&Ye<=Pe&&rt.push(le[Ot]);continue}const vt=Math.floor((Mt+dt)/2);lt=de[2*vt],Ye=de[2*vt+1],lt>=ue&&lt<=fe&&Ye>=ae&&Ye<=Pe&&rt.push(le[vt]);const Tt=(gt+1)%2;(gt===0?ue<=lt:ae<=Ye)&&(Ie.push(Mt),Ie.push(vt-1),Ie.push(Tt)),(gt===0?fe>=lt:Pe>=Ye)&&(Ie.push(vt+1),Ie.push(dt),Ie.push(Tt))}return rt}(this.ids,this.coords,R,F,q,Z,this.nodeSize)}within(R,F,q){return function(Z,le,de,ue,ae,fe){const Pe=[0,Z.length-1,0],ze=[],Ie=ae*ae;for(;Pe.length;){const rt=Pe.pop(),lt=Pe.pop(),Ye=Pe.pop();if(lt-Ye<=fe){for(let Tt=Ye;Tt<=lt;Tt++)ln(le[2*Tt],le[2*Tt+1],de,ue)<=Ie&&ze.push(Z[Tt]);continue}const gt=Math.floor((Ye+lt)/2),dt=le[2*gt],Mt=le[2*gt+1];ln(dt,Mt,de,ue)<=Ie&&ze.push(Z[gt]);const vt=(rt+1)%2;(rt===0?de-ae<=dt:ue-ae<=Mt)&&(Pe.push(Ye),Pe.push(gt-1),Pe.push(vt)),(rt===0?de+ae>=dt:ue+ae>=Mt)&&(Pe.push(gt+1),Pe.push(lt),Pe.push(vt))}return ze}(this.ids,this.coords,R,F,q,this.nodeSize)}}const ns={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Ci=Math.fround||(Zn=new Float32Array(1),Y=>(Zn[0]=+Y,Zn[0]));var Zn;class Mr{constructor(R){this.options=is(Object.create(ns),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:q,maxZoom:Z,nodeSize:le}=this.options;F&&console.time("total time");const de=`prepare ${R.length} points`;F&&console.time(de),this.points=R;let ue=[];for(let ae=0;ae<R.length;ae++)R[ae].geometry&&ue.push(hi(R[ae],ae));this.trees[Z+1]=new zn(ue,go,kr,le,Float32Array),F&&console.timeEnd(de);for(let ae=Z;ae>=q;ae--){const fe=+Date.now();ue=this._cluster(ue,ae),this.trees[ae]=new zn(ue,go,kr,le,Float32Array),F&&console.log("z%d: %d clusters in %dms",ae,ue.length,+Date.now()-fe)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let q=((R[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,R[1]));let le=R[2]===180?180:((R[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)q=-180,le=180;else if(q>le){const Pe=this.getClusters([q,Z,180,de],F),ze=this.getClusters([-180,Z,le,de],F);return Pe.concat(ze)}const ue=this.trees[this._limitZoom(F)],ae=ue.range(jt(q),Mi(de),jt(le),Mi(Z)),fe=[];for(const Pe of ae){const ze=ue.points[Pe];fe.push(ze.numPoints?ji(ze):this.points[ze.index])}return fe}getChildren(R){const F=this._getOriginId(R),q=this._getOriginZoom(R),Z="No cluster with the specified id.",le=this.trees[q];if(!le)throw new Error(Z);const de=le.points[F];if(!de)throw new Error(Z);const ue=this.options.radius/(this.options.extent*Math.pow(2,q-1)),ae=le.within(de.x,de.y,ue),fe=[];for(const Pe of ae){const ze=le.points[Pe];ze.parentId===R&&fe.push(ze.numPoints?ji(ze):this.points[ze.index])}if(fe.length===0)throw new Error(Z);return fe}getLeaves(R,F,q){const Z=[];return this._appendLeaves(Z,R,F=F||10,q=q||0,0),Z}getTile(R,F,q){const Z=this.trees[this._limitZoom(R)],le=Math.pow(2,R),{extent:de,radius:ue}=this.options,ae=ue/de,fe=(q-ae)/le,Pe=(q+1+ae)/le,ze={features:[]};return this._addTileFeatures(Z.range((F-ae)/le,fe,(F+1+ae)/le,Pe),Z.points,F,q,le,ze),F===0&&this._addTileFeatures(Z.range(1-ae/le,fe,1,Pe),Z.points,le,q,le,ze),F===le-1&&this._addTileFeatures(Z.range(0,fe,ae/le,Pe),Z.points,-1,q,le,ze),ze.features.length?ze:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const q=this.getChildren(R);if(F++,q.length!==1)break;R=q[0].properties.cluster_id}return F}_appendLeaves(R,F,q,Z,le){const de=this.getChildren(F);for(const ue of de){const ae=ue.properties;if(ae&&ae.cluster?le+ae.point_count<=Z?le+=ae.point_count:le=this._appendLeaves(R,ae.cluster_id,q,Z,le):le<Z?le++:R.push(ue),R.length===q)break}return le}_addTileFeatures(R,F,q,Z,le,de){for(const ue of R){const ae=F[ue],fe=ae.numPoints;let Pe,ze,Ie;if(fe)Pe=Vs(ae),ze=ae.x,Ie=ae.y;else{const Ye=this.points[ae.index];Pe=Ye.properties,ze=jt(Ye.geometry.coordinates[0]),Ie=Mi(Ye.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(ze*le-q)),Math.round(this.options.extent*(Ie*le-Z))]],tags:Pe};let lt;fe?lt=ae.id:this.options.generateId?lt=ae.index:this.points[ae.index].id&&(lt=this.points[ae.index].id),lt!==void 0&&(rt.id=lt),de.features.push(rt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const q=[],{radius:Z,extent:le,reduce:de,minPoints:ue}=this.options,ae=Z/(le*Math.pow(2,F));for(let fe=0;fe<R.length;fe++){const Pe=R[fe];if(Pe.zoom<=F)continue;Pe.zoom=F;const ze=this.trees[F+1],Ie=ze.within(Pe.x,Pe.y,ae),rt=Pe.numPoints||1;let lt=rt;for(const Ye of Ie){const gt=ze.points[Ye];gt.zoom>F&&(lt+=gt.numPoints||1)}if(lt>rt&&lt>=ue){let Ye=Pe.x*rt,gt=Pe.y*rt,dt=de&&rt>1?this._map(Pe,!0):null;const Mt=(fe<<5)+(F+1)+this.points.length;for(const vt of Ie){const Tt=ze.points[vt];if(Tt.zoom<=F)continue;Tt.zoom=F;const Ot=Tt.numPoints||1;Ye+=Tt.x*Ot,gt+=Tt.y*Ot,Tt.parentId=Mt,de&&(dt||(dt=this._map(Pe,!0)),de(dt,this._map(Tt)))}Pe.parentId=Mt,q.push(Vi(Ye/lt,gt/lt,Mt,lt,dt))}else if(q.push(Pe),lt>1)for(const Ye of Ie){const gt=ze.points[Ye];gt.zoom<=F||(gt.zoom=F,q.push(gt))}}return q}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?is({},R.properties):R.properties;const q=this.points[R.index].properties,Z=this.options.map(q);return F&&Z===q?is({},Z):Z}}function Vi(Y,R,F,q,Z){return{x:Ci(Y),y:Ci(R),zoom:1/0,id:F,parentId:-1,numPoints:q,properties:Z}}function hi(Y,R){const[F,q]=Y.geometry.coordinates;return{x:Ci(jt(F)),y:Ci(Mi(q)),zoom:1/0,index:R,parentId:-1}}function ji(Y){return{type:"Feature",id:Y.id,properties:Vs(Y),geometry:{type:"Point",coordinates:[(R=Y.x,360*(R-.5)),On(Y.y)]}};var R}function Vs(Y){const R=Y.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return is(is({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:R,point_count_abbreviated:F})}function jt(Y){return Y/360+.5}function Mi(Y){const R=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function On(Y){const R=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function is(Y,R){for(const F in R)Y[F]=R[F];return Y}function go(Y){return Y.x}function kr(Y){return Y.y}function Lr(Y,R,F,q){for(var Z,le=q,de=F-R>>1,ue=F-R,ae=Y[R],fe=Y[R+1],Pe=Y[F],ze=Y[F+1],Ie=R+3;Ie<F;Ie+=3){var rt=js(Y[Ie],Y[Ie+1],ae,fe,Pe,ze);if(rt>le)Z=Ie,le=rt;else if(rt===le){var lt=Math.abs(Ie-de);lt<ue&&(Z=Ie,ue=lt)}}le>q&&(Z-R>3&&Lr(Y,R,Z,q),Y[Z+2]=le,F-Z>3&&Lr(Y,Z,F,q))}function js(Y,R,F,q,Z,le){var de=Z-F,ue=le-q;if(de!==0||ue!==0){var ae=((Y-F)*de+(R-q)*ue)/(de*de+ue*ue);ae>1?(F=Z,q=le):ae>0&&(F+=de*ae,q+=ue*ae)}return(de=Y-F)*de+(ue=R-q)*ue}function yr(Y,R,F,q){var Z={id:Y===void 0?null:Y,type:R,geometry:F,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var de=le.geometry,ue=le.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Me(le,de);else if(ue==="Polygon"||ue==="MultiLineString")for(var ae=0;ae<de.length;ae++)Me(le,de[ae]);else if(ue==="MultiPolygon")for(ae=0;ae<de.length;ae++)for(var fe=0;fe<de[ae].length;fe++)Me(le,de[ae][fe])}(Z),Z}function Me(Y,R){for(var F=0;F<R.length;F+=3)Y.minX=Math.min(Y.minX,R[F]),Y.minY=Math.min(Y.minY,R[F+1]),Y.maxX=Math.max(Y.maxX,R[F]),Y.maxY=Math.max(Y.maxY,R[F+1])}function He(Y,R,F,q){if(R.geometry){var Z=R.geometry.coordinates,le=R.geometry.type,de=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),ue=[],ae=R.id;if(F.promoteId?ae=R.properties[F.promoteId]:F.generateId&&(ae=q||0),le==="Point")rs(Z,ue);else if(le==="MultiPoint")for(var fe=0;fe<Z.length;fe++)rs(Z[fe],ue);else if(le==="LineString")wi(Z,ue,de,!1);else if(le==="MultiLineString"){if(F.lineMetrics){for(fe=0;fe<Z.length;fe++)wi(Z[fe],ue=[],de,!1),Y.push(yr(ae,"LineString",ue,R.properties));return}Nt(Z,ue,de,!1)}else if(le==="Polygon")Nt(Z,ue,de,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(fe=0;fe<R.geometry.geometries.length;fe++)He(Y,{id:ae,geometry:R.geometry.geometries[fe],properties:R.properties},F,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<Z.length;fe++){var Pe=[];Nt(Z[fe],Pe,de,!0),ue.push(Pe)}}Y.push(yr(ae,le,ue,R.properties))}}function rs(Y,R){R.push(Gi(Y[0])),R.push(ki(Y[1])),R.push(0)}function wi(Y,R,F,q){for(var Z,le,de=0,ue=0;ue<Y.length;ue++){var ae=Gi(Y[ue][0]),fe=ki(Y[ue][1]);R.push(ae),R.push(fe),R.push(0),ue>0&&(de+=q?(Z*fe-ae*le)/2:Math.sqrt(Math.pow(ae-Z,2)+Math.pow(fe-le,2))),Z=ae,le=fe}var Pe=R.length-3;R[2]=1,Lr(R,0,Pe,F),R[Pe+2]=1,R.size=Math.abs(de),R.start=0,R.end=R.size}function Nt(Y,R,F,q){for(var Z=0;Z<Y.length;Z++){var le=[];wi(Y[Z],le,F,q),R.push(le)}}function Gi(Y){return Y/360+.5}function ki(Y){var R=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Li(Y,R,F,q,Z,le,de,ue){if(q/=R,le>=(F/=R)&&de<q)return Y;if(de<F||le>=q)return null;for(var ae=[],fe=0;fe<Y.length;fe++){var Pe=Y[fe],ze=Pe.geometry,Ie=Pe.type,rt=Z===0?Pe.minX:Pe.minY,lt=Z===0?Pe.maxX:Pe.maxY;if(rt>=F&&lt<q)ae.push(Pe);else if(!(lt<F||rt>=q)){var Ye=[];if(Ie==="Point"||Ie==="MultiPoint")ss(ze,Ye,F,q,Z);else if(Ie==="LineString")$e(ze,Ye,F,q,Z,!1,ue.lineMetrics);else if(Ie==="MultiLineString")It(ze,Ye,F,q,Z,!1);else if(Ie==="Polygon")It(ze,Ye,F,q,Z,!0);else if(Ie==="MultiPolygon")for(var gt=0;gt<ze.length;gt++){var dt=[];It(ze[gt],dt,F,q,Z,!0),dt.length&&Ye.push(dt)}if(Ye.length){if(ue.lineMetrics&&Ie==="LineString"){for(gt=0;gt<Ye.length;gt++)ae.push(yr(Pe.id,Ie,Ye[gt],Pe.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Ye.length===1?(Ie="LineString",Ye=Ye[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Ye.length===3?"Point":"MultiPoint"),ae.push(yr(Pe.id,Ie,Ye,Pe.tags))}}}return ae.length?ae:null}function ss(Y,R,F,q,Z){for(var le=0;le<Y.length;le+=3){var de=Y[le+Z];de>=F&&de<=q&&(R.push(Y[le]),R.push(Y[le+1]),R.push(Y[le+2]))}}function $e(Y,R,F,q,Z,le,de){for(var ue,ae,fe=Pt(Y),Pe=Z===0?Rr:At,ze=Y.start,Ie=0;Ie<Y.length-3;Ie+=3){var rt=Y[Ie],lt=Y[Ie+1],Ye=Y[Ie+2],gt=Y[Ie+3],dt=Y[Ie+4],Mt=Z===0?rt:lt,vt=Z===0?gt:dt,Tt=!1;de&&(ue=Math.sqrt(Math.pow(rt-gt,2)+Math.pow(lt-dt,2))),Mt<F?vt>F&&(ae=Pe(fe,rt,lt,gt,dt,F),de&&(fe.start=ze+ue*ae)):Mt>q?vt<q&&(ae=Pe(fe,rt,lt,gt,dt,q),de&&(fe.start=ze+ue*ae)):Xn(fe,rt,lt,Ye),vt<F&&Mt>=F&&(ae=Pe(fe,rt,lt,gt,dt,F),Tt=!0),vt>q&&Mt<=q&&(ae=Pe(fe,rt,lt,gt,dt,q),Tt=!0),!le&&Tt&&(de&&(fe.end=ze+ue*ae),R.push(fe),fe=Pt(Y)),de&&(ze+=ue)}var Ot=Y.length-3;rt=Y[Ot],lt=Y[Ot+1],Ye=Y[Ot+2],(Mt=Z===0?rt:lt)>=F&&Mt<=q&&Xn(fe,rt,lt,Ye),Ot=fe.length-3,le&&Ot>=3&&(fe[Ot]!==fe[0]||fe[Ot+1]!==fe[1])&&Xn(fe,fe[0],fe[1],fe[2]),fe.length&&R.push(fe)}function Pt(Y){var R=[];return R.size=Y.size,R.start=Y.start,R.end=Y.end,R}function It(Y,R,F,q,Z,le){for(var de=0;de<Y.length;de++)$e(Y[de],R,F,q,Z,le,!1)}function Xn(Y,R,F,q){Y.push(R),Y.push(F),Y.push(q)}function Rr(Y,R,F,q,Z,le){var de=(le-R)/(q-R);return Y.push(le),Y.push(F+(Z-F)*de),Y.push(1),de}function At(Y,R,F,q,Z,le){var de=(le-F)/(Z-F);return Y.push(R+(q-R)*de),Y.push(le),Y.push(1),de}function ir(Y,R){for(var F=[],q=0;q<Y.length;q++){var Z,le=Y[q],de=le.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")Z=jn(le.geometry,R);else if(de==="MultiLineString"||de==="Polygon"){Z=[];for(var ue=0;ue<le.geometry.length;ue++)Z.push(jn(le.geometry[ue],R))}else if(de==="MultiPolygon")for(Z=[],ue=0;ue<le.geometry.length;ue++){for(var ae=[],fe=0;fe<le.geometry[ue].length;fe++)ae.push(jn(le.geometry[ue][fe],R));Z.push(ae)}F.push(yr(le.id,de,Z,le.tags))}return F}function jn(Y,R){var F=[];F.size=Y.size,Y.start!==void 0&&(F.start=Y.start,F.end=Y.end);for(var q=0;q<Y.length;q+=3)F.push(Y[q]+R,Y[q+1],Y[q+2]);return F}function Gs(Y,R){if(Y.transformed)return Y;var F,q,Z,le=1<<Y.z,de=Y.x,ue=Y.y;for(F=0;F<Y.features.length;F++){var ae=Y.features[F],fe=ae.geometry,Pe=ae.type;if(ae.geometry=[],Pe===1)for(q=0;q<fe.length;q+=2)ae.geometry.push(Mn(fe[q],fe[q+1],R,le,de,ue));else for(q=0;q<fe.length;q++){var ze=[];for(Z=0;Z<fe[q].length;Z+=2)ze.push(Mn(fe[q][Z],fe[q][Z+1],R,le,de,ue));ae.geometry.push(ze)}}return Y.transformed=!0,Y}function Mn(Y,R,F,q,Z,le){return[Math.round(F*(Y*q-Z)),Math.round(F*(R*q-le))]}function ri(Y,R,F,q,Z){for(var le=R===Z.maxZoom?0:Z.tolerance/((1<<R)*Z.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:q,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<Y.length;ue++){de.numFeatures++,Qt(de,Y[ue],le,Z);var ae=Y[ue].minX,fe=Y[ue].minY,Pe=Y[ue].maxX,ze=Y[ue].maxY;ae<de.minX&&(de.minX=ae),fe<de.minY&&(de.minY=fe),Pe>de.maxX&&(de.maxX=Pe),ze>de.maxY&&(de.maxY=ze)}return de}function Qt(Y,R,F,q){var Z=R.geometry,le=R.type,de=[];if(le==="Point"||le==="MultiPoint")for(var ue=0;ue<Z.length;ue+=3)de.push(Z[ue]),de.push(Z[ue+1]),Y.numPoints++,Y.numSimplified++;else if(le==="LineString")$s(de,Z,Y,F,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(ue=0;ue<Z.length;ue++)$s(de,Z[ue],Y,F,le==="Polygon",ue===0);else if(le==="MultiPolygon")for(var ae=0;ae<Z.length;ae++){var fe=Z[ae];for(ue=0;ue<fe.length;ue++)$s(de,fe[ue],Y,F,!0,ue===0)}if(de.length){var Pe=R.tags||null;if(le==="LineString"&&q.lineMetrics){for(var ze in Pe={},R.tags)Pe[ze]=R.tags[ze];Pe.mapbox_clip_start=Z.start/Z.size,Pe.mapbox_clip_end=Z.end/Z.size}var Ie={geometry:de,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Pe};R.id!==null&&(Ie.id=R.id),Y.features.push(Ie)}}function $s(Y,R,F,q,Z,le){var de=q*q;if(q>0&&R.size<(Z?de:q))F.numPoints+=R.length/3;else{for(var ue=[],ae=0;ae<R.length;ae+=3)(q===0||R[ae+2]>de)&&(F.numSimplified++,ue.push(R[ae]),ue.push(R[ae+1])),F.numPoints++;Z&&function(fe,Pe){for(var ze=0,Ie=0,rt=fe.length,lt=rt-2;Ie<rt;lt=Ie,Ie+=2)ze+=(fe[Ie]-fe[lt])*(fe[Ie+1]+fe[lt+1]);if(ze>0===Pe)for(Ie=0,rt=fe.length;Ie<rt/2;Ie+=2){var Ye=fe[Ie],gt=fe[Ie+1];fe[Ie]=fe[rt-2-Ie],fe[Ie+1]=fe[rt-1-Ie],fe[rt-2-Ie]=Ye,fe[rt-1-Ie]=gt}}(ue,le),Y.push(ue)}}function vr(Y,R){var F=(R=this.options=function(Z,le){for(var de in le)Z[de]=le[de];return Z}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(Z,le){var de=[];if(Z.type==="FeatureCollection")for(var ue=0;ue<Z.features.length;ue++)He(de,Z.features[ue],le,ue);else He(de,Z.type==="Feature"?Z:{geometry:Z},le);return de}(Y,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(Z,le){var de=le.buffer/le.extent,ue=Z,ae=Li(Z,1,-1-de,de,0,-1,2,le),fe=Li(Z,1,1-de,2+de,0,-1,2,le);return(ae||fe)&&(ue=Li(Z,1,-de,1+de,0,-1,2,le)||[],ae&&(ue=ir(ae,1).concat(ue)),fe&&(ue=ue.concat(ir(fe,-1)))),ue}(q,R),q.length&&this.splitTile(q,0,0,0),F&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xr(Y,R,F){return 32*((1<<Y)*F+R)+Y}function Es(Y,R){const F=Y.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const q=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!q)return R(null,null);const Z=new Ae(q.features);let le=Oe.exports(Z);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),R(null,{vectorTile:Z,rawData:le.buffer})}vr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vr.prototype.splitTile=function(Y,R,F,q,Z,le,de){for(var ue=[Y,R,F,q],ae=this.options,fe=ae.debug;ue.length;){q=ue.pop(),F=ue.pop(),R=ue.pop(),Y=ue.pop();var Pe=1<<R,ze=xr(R,F,q),Ie=this.tiles[ze];if(!Ie&&(fe>1&&console.time("creation"),Ie=this.tiles[ze]=ri(Y,R,F,q,ae),this.tileCoords.push({z:R,x:F,y:q}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,q,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var rt="z"+R;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Ie.source=Y,Z){if(R===ae.maxZoom||R===Z)continue;var lt=1<<Z-R;if(F!==Math.floor(le/lt)||q!==Math.floor(de/lt))continue}else if(R===ae.indexMaxZoom||Ie.numPoints<=ae.indexMaxPoints)continue;if(Ie.source=null,Y.length!==0){fe>1&&console.time("clipping");var Ye,gt,dt,Mt,vt,Tt,Ot=.5*ae.buffer/ae.extent,Ut=.5-Ot,un=.5+Ot,hn=1+Ot;Ye=gt=dt=Mt=null,vt=Li(Y,Pe,F-Ot,F+un,0,Ie.minX,Ie.maxX,ae),Tt=Li(Y,Pe,F+Ut,F+hn,0,Ie.minX,Ie.maxX,ae),Y=null,vt&&(Ye=Li(vt,Pe,q-Ot,q+un,1,Ie.minY,Ie.maxY,ae),gt=Li(vt,Pe,q+Ut,q+hn,1,Ie.minY,Ie.maxY,ae),vt=null),Tt&&(dt=Li(Tt,Pe,q-Ot,q+un,1,Ie.minY,Ie.maxY,ae),Mt=Li(Tt,Pe,q+Ut,q+hn,1,Ie.minY,Ie.maxY,ae),Tt=null),fe>1&&console.timeEnd("clipping"),ue.push(Ye||[],R+1,2*F,2*q),ue.push(gt||[],R+1,2*F,2*q+1),ue.push(dt||[],R+1,2*F+1,2*q),ue.push(Mt||[],R+1,2*F+1,2*q+1)}}},vr.prototype.getTile=function(Y,R,F){var q=this.options,Z=q.extent,le=q.debug;if(Y<0||Y>24)return null;var de=1<<Y,ue=xr(Y,R=(R%de+de)%de,F);if(this.tiles[ue])return Gs(this.tiles[ue],Z);le>1&&console.log("drilling down to z%d-%d-%d",Y,R,F);for(var ae,fe=Y,Pe=R,ze=F;!ae&&fe>0;)fe--,Pe=Math.floor(Pe/2),ze=Math.floor(ze/2),ae=this.tiles[xr(fe,Pe,ze)];return ae&&ae.source?(le>1&&console.log("found parent tile z%d-%d-%d",fe,Pe,ze),le>1&&console.time("drilling down"),this.splitTile(ae.source,fe,Pe,ze,Y,R,F),le>1&&console.timeEnd("drilling down"),this.tiles[ue]?Gs(this.tiles[ue],Z):null):null};class Hs extends ne{constructor(R,F,q,Z){super(R,F,q,Es),Z&&(this.loadGeoJSON=Z)}loadData(R,F){var q;(q=this._pendingRequest)===null||q===void 0||q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Z=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(le,de)=>{if(delete this._pendingCallback,delete this._pendingRequest,le||!de)return F(le);if(typeof de!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{K(de,!0);try{if(R.filter){const ae=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Pe=>ae.value.evaluate({zoom:0},Pe))}}this._geoJSONIndex=R.cluster?new Mr(function({superclusterOptions:ae,clusterProperties:fe}){if(!fe||!ae)return ae;const Pe={},ze={},Ie={accumulated:null,zoom:0},rt={properties:null},lt=Object.keys(fe);for(const Ye of lt){const[gt,dt]=fe[Ye],Mt=l.createExpression(dt),vt=l.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",Ye]]:gt);Pe[Ye]=Mt.value,ze[Ye]=vt.value}return ae.map=Ye=>{rt.properties=Ye;const gt={};for(const dt of lt)gt[dt]=Pe[dt].evaluate(Ie,rt);return gt},ae.reduce=(Ye,gt)=>{rt.properties=gt;for(const dt of lt)Ie.accumulated=Ye[dt],Ye[dt]=ze[dt].evaluate(Ie,rt)},ae}(R)).load(de.features):function(ae,fe){return new vr(ae,fe)}(de,R.geojsonVtOptions)}catch(ae){return F(ae)}this.loaded={};const ue={};if(Z){const ae=Z.finish();ae&&(ue.resourceTiming={},ue.resourceTiming[R.source]=JSON.parse(JSON.stringify(ae)))}F(null,ue)}})}reloadTile(R,F){const q=this.loaded;return q&&q[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return l.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(q){F(q)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(q){F(q)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(q){F(q)}}}class os{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ne,geojson:Hs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,q)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=q},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,q){this.availableImages[R]=F;for(const Z in this.workerSources[R]){const le=this.workerSources[R][Z];for(const de in le)le[de].availableImages=F}q()}setLayers(R,F,q){this.getLayerIndex(R).replace(F),q()}updateLayers(R,F,q){this.getLayerIndex(R).update(F.layers,F.removedIds),q()}loadTile(R,F,q){this.getWorkerSource(R,F.type,F.source).loadTile(F,q)}loadDEMTile(R,F,q){this.getDEMWorkerSource(R,F.source).loadTile(F,q)}reloadTile(R,F,q){this.getWorkerSource(R,F.type,F.source).reloadTile(F,q)}abortTile(R,F,q){this.getWorkerSource(R,F.type,F.source).abortTile(F,q)}removeTile(R,F,q){this.getWorkerSource(R,F.type,F.source).removeTile(F,q)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,q){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const Z=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],Z.removeSource!==void 0?Z.removeSource(F,q):q()}loadWorkerSource(R,F,q){try{this.self.importScripts(F.url),q()}catch(Z){q(Z.toString())}}syncRTLPluginState(R,F,q){try{l.plugin.setState(F);const Z=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&Z!=null){this.self.importScripts(Z);const le=l.plugin.isParsed();q(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Z}`),le)}}catch(Z){q(Z.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new M),F}getWorkerSource(R,F,q){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][q]){const Z={send:(le,de,ue)=>{this.actor.send(le,de,ue,R)}};this.workerSources[R][F][q]=new this.workerSourceTypes[F](Z,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][q]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new _e),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new os(self)),os}),u(["./shared"],function(l){var b=w;function w(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(M[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(M[h]=function(p){var _,v=function(E){var A=document.createElement("canvas"),I=Object.create(w.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=E,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(h)),M[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var M={};function L(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!L(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(const h in m)if(!L(m[h],s[h]))return!1;return!0}return m===s}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class C{static testProp(s){if(!C.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in C.docStyle)return s[h];return s[0]}static create(s,h,p){const _=window.document.createElement(s);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(s,h){s.style[C.transformProp]=h}static addEventListener(s,h,p,_={}){s.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(s,h,p,_={}){s.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static mousePos(s,h){const p=s.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-s.clientLeft,h.clientY-p.top-s.clientTop)}static touchPos(s,h){const p=s.getBoundingClientRect(),_=[];for(let v=0;v<h.length;v++)_.push(new l.pointGeometry(h[v].clientX-p.left-s.clientLeft,h[v].clientY-p.top-s.clientTop));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);class W{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,p){const _=function(v){const E=v.match(Q);if(!E)throw new Error(`Unable to parse URL "${v}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(s);return _.path+=`${h}${p}`,function(v){const E=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${E}`}(_)}setTransformRequest(s){this._transformRequestFn=s}}const Q=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class ne{constructor(s,h,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(h,_)}update(s,h,p){const{width:_,height:v}=s,E=!(this.size&&this.size[0]===_&&this.size[1]===v||p),{context:A}=this,{gl:I}=A;if(this.useMipmap=!!(h&&h.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[_,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,s):I.texImage2D(I.TEXTURE_2D,0,this.format,_,v,0,this.format,I.UNSIGNED_BYTE,s.data);else{const{x:k,y:z}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texSubImage2D(I.TEXTURE_2D,0,k,z,I.RGBA,I.UNSIGNED_BYTE,s):I.texSubImage2D(I.TEXTURE_2D,0,k,z,_,v,I.RGBA,I.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(s,h,p){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||s),this.filter=s),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function _e(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class K extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const _ of s){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){const p=this.images[s];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let p=!0;if(!this.isLoaded())for(const _ of s)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const p={};for(const _ of s){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new l.ImagePosition(_,p);this.patterns[s]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:h,h:p}=l.potpack(s),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],A=E.x+1,I=E.y+1,k=this.images[v].data,z=k.width,B=k.height;l.RGBAImage.copy(k,_,{x:0,y:0},{x:A,y:I},{width:z,height:B}),l.RGBAImage.copy(k,_,{x:0,y:B-1},{x:A,y:I-1},{width:z,height:1}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:A,y:I+B},{width:z,height:1}),l.RGBAImage.copy(k,_,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:B}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:A+z,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),_e(p)&&this.updateImage(h,p)}}}const $=1e20;function J(m,s,h,p,_,v,E,A,I){for(let k=s;k<s+p;k++)pe(m,h*v+k,v,_,E,A,I);for(let k=h;k<h+_;k++)pe(m,k*v+s,1,p,E,A,I)}function pe(m,s,h,p,_,v,E){v[0]=0,E[0]=-$,E[1]=$,_[0]=m[s];for(let A=1,I=0,k=0;A<p;A++){_[A]=m[s+A*h];const z=A*A;do{const B=v[I];k=(_[A]-_[B]+z-B*B)/(A-B)/2}while(k<=E[I]&&--I>-1);I++,v[I]=A,E[I]=k,E[I+1]=$}for(let A=0,I=0;A<p;A++){for(;E[I+1]<A;)I++;const k=v[I],z=A-k;m[s+A*h]=_[k]+z*z}}class ye{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const p=[];for(const _ in s)for(const v of s[_])p.push({stack:_,id:v});l.asyncAll(p,({stack:_,id:v},E)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[v];if(I!==void 0)return void E(null,{stack:_,id:v,glyph:I});if(I=this._tinySDF(A,_,v),I)return A.glyphs[v]=I,void E(null,{stack:_,id:v,glyph:I});const k=Math.floor(v/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(A.ranges[k])return void E(null,{stack:_,id:v,glyph:I});let z=A.requests[k];z||(z=A.requests[k]=[],ye.loadGlyphRange(_,k,this.url,this.requestManager,(B,U)=>{if(U){for(const ie in U)this._doesCharSupportLocalGlyph(+ie)||(A.glyphs[+ie]=U[+ie]);A.ranges[k]=!0}for(const ie of z)ie(B,U);delete A.requests[k]})),z.push((B,U)=>{B?E(B):U&&E(null,{stack:_,id:v,glyph:U[v]||null})})},(_,v)=>{if(_)h(_);else if(v){const E={};for(const{stack:A,id:I,glyph:k}of v)(E[A]||(E[A]={}))[I]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](s)||l.unicodeBlockLookup["Hangul Syllables"](s)||l.unicodeBlockLookup.Hiragana(s)||l.unicodeBlockLookup.Katakana(s))}_tinySDF(s,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let v=s.tinySDF;if(!v){let A="400";/bold/i.test(h)?A="900":/medium/i.test(h)?A="500":/light/i.test(h)&&(A="200"),v=s.tinySDF=new ye.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:A})}const E=v.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}ye.loadGlyphRange=function(m,s,h,p,_){const v=256*s,E=v+255,A=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${v}-${E}`),l.ResourceType.Glyphs);l.getArrayBuffer(A,(I,k)=>{if(I)_(I);else if(k){const z={};for(const B of l.parseGlyphPbf(k))z[B.id]=B;_(null,z)}})},ye.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=h;const A=this.size=m+4*s,I=this._createCanvas(A),k=this.ctx=I.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${v} ${m}px ${_}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:v}=this.ctx.measureText(m),E=Math.ceil(h),A=Math.min(this.size-this.buffer,Math.ceil(v-_)),I=Math.min(this.size-this.buffer,E+Math.ceil(p)),k=A+2*this.buffer,z=I+2*this.buffer,B=Math.max(k*z,0),U=new Uint8ClampedArray(B),ie={data:U,width:k,height:z,glyphWidth:A,glyphHeight:I,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(A===0||I===0)return ie;const{ctx:ee,buffer:te,gridInner:he,gridOuter:me}=this;ee.clearRect(te,te,A,I),ee.fillText(m,te,te+E);const xe=ee.getImageData(te,te,A,I);me.fill($,0,B),he.fill(0,0,B);for(let re=0;re<I;re++)for(let Ee=0;Ee<A;Ee++){const be=xe.data[4*(re*A+Ee)+3]/255;if(be===0)continue;const ke=(re+te)*k+Ee+te;if(be===1)me[ke]=0,he[ke]=$;else{const Le=.5-be;me[ke]=Le>0?Le*Le:0,he[ke]=Le<0?Le*Le:0}}J(me,0,0,k,z,k,this.f,this.v,this.z),J(he,te,te,A,I,k,this.f,this.v,this.z);for(let re=0;re<B;re++){const Ee=Math.sqrt(me[re])-Math.sqrt(he[re]);U[re]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return ie}};const Ae=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,s){return l.sphericalToCartesian(m.expression.evaluate(s))}interpolate(m,s,h){return{x:l.number(m.x,s.x,h),y:l.number(m.y,s.y,h),z:l.number(m.z,s.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Oe="-transition";class Be extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable(Ae),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const p in s){const _=s[p];p.endsWith(Oe)?this._transitionable.setTransition(p.slice(0,-Oe.length),_):this._transitionable.setValue(p,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Xe{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const _=[];let v=s.length%2==1?-s[s.length-1]*p:0,E=s[0]*p,A=!0;_.push({left:v,right:E,isDash:A,zeroLength:s[0]===0});let I=s[0];for(let k=1;k<s.length;k++){A=!A;const z=s[k];v=I*p,I+=z,E=I*p,_.push({left:v,right:E,isDash:A,zeroLength:z===0})}return _}addRoundDash(s,h,p){const _=h/2;for(let v=-p;v<=p;v++){const E=this.width*(this.nextRow+p+v);let A=0,I=s[A];for(let k=0;k<this.width;k++){k/I.right>1&&(I=s[++A]);const z=Math.abs(k-I.left),B=Math.abs(k-I.right),U=Math.min(z,B);let ie;const ee=v/p*(_+1);if(I.isDash){const te=_-Math.abs(ee);ie=Math.sqrt(U*U+te*te)}else ie=_-Math.sqrt(U*U+ee*ee);this.data[E+k]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(s){for(let A=s.length-1;A>=0;--A){const I=s[A],k=s[A+1];I.zeroLength?s.splice(A,1):k&&k.isDash===I.isDash&&(k.left=I.left,s.splice(A,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let v=0,E=s[v];for(let A=0;A<this.width;A++){A/E.right>1&&(E=s[++v]);const I=Math.abs(A-E.left),k=Math.abs(A-E.right),z=Math.min(I,k);this.data[_+A]=Math.max(0,Math.min(255,(E.isDash?z:-z)+128))}}addDash(s,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let v=0;for(let A=0;A<s.length;A++)v+=s[A];if(v!==0){const A=this.width/v,I=this.getDashRanges(s,this.width,A);h?this.addRoundDash(I,A,p):this.addRegularDash(I)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=_,this.dirty=!0,E}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class je{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new je.Actor(p[_],h,this.id);v.name=`Worker ${_}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,p){l.asyncAll(this.actors,(_,v)=>{_.send(s,h,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function mt(m,s,h){const p=function(_,v){if(_)return h(_);if(v){const E=l.pick(l.extend(v,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(E.vectorLayers=v.vector_layers,E.vectorLayerIds=E.vectorLayers.map(A=>A.id)),h(null,E)}};return m.url?l.getJSON(s.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}je.Actor=l.Actor;class Dt{constructor(s,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),v=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=p&&s.x<v&&s.y>=_&&s.y<E}}class qt extends l.Evented{constructor(s,h,p,_){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Dt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(E,A){return delete s.request,s.aborted?h(null):E&&E.status!==404?h(E):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",_,v.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",_,v.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class zt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Dt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,v,E)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(_)s.state="errored",h(_);else if(v){this.map._refreshExpiredTiles&&s.setExpiryData(E);const A=this.map.painter.context,I=A.gl;s.texture=this.map.painter.getTileTexture(v.width),s.texture?s.texture.update(v,{useMipmap:!0}):(s.texture=new ne(A,v,I.RGBA,{useMipmap:!0}),s.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let ti;class xt extends zt{constructor(s,h,p,_){super(s,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(v,E){v&&(s.state="errored",h(v)),E&&(s.dem=E,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(v,E){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(v)s.state="errored",h(v);else if(E){this.map._refreshExpiredTiles&&s.setExpiryData(E),delete E.cacheControl,delete E.expires;const A=l.isImageBitmap(E)&&(ti==null&&(ti=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ti)?E:l.exported.getImageData(E,1),I={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:A,encoding:this.encoding};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",I,_.bind(this)))}}).bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,v=h.x===0?s.wrap-1:s.wrap,E=(h.x+1+p)%p,A=h.x+1===p?s.wrap+1:s.wrap,I={};return I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y+1).key]={backfilled:!1}),I}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class vi extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData("content"),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:p},_),this}_updateWorkerData(s){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:s}));let E=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(E=v.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const A={dataType:"source",sourceDataType:s};this._collectResourceTiming&&E&&E.length>0&&l.extend(A,{resourceTiming:E}),this.fire(new l.Event("data",A))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,_,(v,E)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):v?h(v):(s.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(s,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let v=1/0,E=1/0,A=-1/0,I=-1/0;for(const U of _)v=Math.min(v,U.x),E=Math.min(E,U.y),A=Math.max(A,U.x),I=Math.max(I,U.y);const k=Math.max(A-v,I-E),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,z);return new l.CanonicalTileID(z,Math.floor((v+A)/2*B),Math.floor((E+I)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class St extends wt{constructor(s,h,p,_){super(s,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ne(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class tn extends wt{constructor(s,h,p,_){super(s,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const nn={vector:qt,raster:zt,"raster-dem":xt,geojson:vi,video:St,image:wt,canvas:tn};function nr(m,s){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(s.toUnwrapped()))}function ni(m,s,h,p,_,v){const E=function(B,U,ie){if(B)for(const ee of B){const te=U[ee];if(te&&te.source===ie&&te.type==="fill-extrusion")return!0}else for(const ee in U){const te=U[ee];if(te.source===ie&&te.type==="fill-extrusion")return!0}return!1}(_&&_.layers,s,m.id),A=v.maxPitchScaleFactor(),I=m.tilesIn(p,A,E);I.sort(xi);const k=[];for(const B of I)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,h,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,_,v,A,nr(m.transform,B.tileID))});const z=function(B){const U={},ie={};for(const ee of B){const te=ee.queryResults,he=ee.wrappedTileID,me=ie[he]=ie[he]||{};for(const xe in te){const re=te[xe],Ee=me[xe]=me[xe]||{},be=U[xe]=U[xe]||[];for(const ke of re)Ee[ke.featureIndex]||(Ee[ke.featureIndex]=!0,be.push(ke))}}return U}(k);for(const B in z)z[B].forEach(U=>{const ie=U.feature,ee=m.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ee});return z}function xi(m,s){const h=m.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class ii{constructor(s,h){this.tileID=s,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.textures.forEach(h=>s.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(_,v){const E={};if(!v)return E;for(const A of _){const I=A.layerIds.map(k=>v.getLayer(k)).filter(Boolean);if(I.length!==0){A.layers=I,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(k=>I.filter(z=>z.id===k)[0]));for(const k of I)E[k.id]=A}}return E}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,_,v,E,A,I,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:A,queryPadding:this.queryPadding*k},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),v=h?h.sourceLayer:"",E=_._geojsonTileLayer||_[v];if(!E)return;const A=l.createFilter(h&&h.filter),{z:I,x:k,y:z}=this.tileID.canonical,B={z:I,x:k,y:z};for(let U=0;U<E.length;U++){const ie=E.feature(U);if(A.needGeometry){const he=l.toEvaluationFeature(ie,!0);if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const ee=p.getId(ie,v),te=new l.GeoJSONFeature(ie,I,k,z,ee);te.tile=B,s.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=l.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const v=this.buckets[_],E=v.layers[0].sourceLayer||"_geojsonTileLayer",A=p[E],I=s[E];if(!A||!I||Object.keys(I).length===0)continue;v.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=l.exported.now()+s}setDependencies(s,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const _=this.dependencies[p];if(_){for(const v of h)if(_[v])return!0}}return!1}}class ln{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const _=s.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},p)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][_];return this.data[p].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const _ of this.data[p])s(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class bi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const _=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][_]=this.stateChanges[s][_]||{},l.extend(this.stateChanges[s][_],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==_&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][_]===null){this.deletedStates[s][_]={};for(const v in this.state[s][_])p[v]||(this.deletedStates[s][_][v]=null)}else for(const v in p)this.deletedStates[s]&&this.deletedStates[s][_]&&this.deletedStates[s][_][v]===null&&delete this.deletedStates[s][_][v]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const _=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][_]!==null&&(this.deletedStates[s][_]=this.deletedStates[s][_]||{},this.deletedStates[s][_][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][_])for(p in this.deletedStates[s][_]={},this.stateChanges[s][_])this.deletedStates[s][_][p]=null;else this.deletedStates[s][_]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),_=l.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][h];if(v===null)return{};for(const E in v)delete _[E]}return _}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),l.extend(this.state[_][E],this.stateChanges[_][E]),v[E]=this.state[_][E];p[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const E in this.state[_])v[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const A of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][A];v[E]=this.state[_][E]}p[_]=p[_]||{},l.extend(p[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in s)s[_].setFeatureState(p,h)}}class Wt extends l.Evented{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,v,E,A){const I=new nn[v.type](_,v,E,A);if(I.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${I.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],I),I}(s,h,p,this),this._tiles={},this._cache=new ln(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bi}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new l.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(zn).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,_)=>{const v=p.tileID,E=_.tileID,A=new l.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new l.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||I.y-A.y||I.x-A.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(zn).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,s,h)))}_tileLoaded(s,h,p,_){if(_)return s.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=l.exported.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const v=h[_];if(s.neighboringTiles&&s.neighboringTiles[v]){const E=this.getTileByID(v);p(s,E),p(E,s)}}function p(_,v){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-_.tileID.canonical.x;const A=v.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),k=v.tileID.key;E===0&&A===0||Math.abs(A)>1||(Math.abs(E)>1&&(Math.abs(E+I)===1?E+=I:Math.abs(E-I)===1&&(E-=I)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,E,A),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,_){for(const v in this._tiles){let E=this._tiles[v];if(_[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let A=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(A=k)}let I=A;for(;I.overscaledZ>h;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){_[A.key]=A;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const _=s.scaledTo(p),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,_=Math.floor(h*p*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(k=>this._source.hasTile(k)))):p=[];const _=s.coveringZoomLevel(this._source),v=Math.max(_-Wt.maxOverzooming,this._source.minzoom),E=Math.max(_+Wt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const z of p)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);k[B.key]=B;const U=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));k[U.key]=U}p=p.concat(Object.values(k))}const A=this._updateRetainedTiles(p,_);if(ns(this._source.type)){const k={},z={},B=Object.keys(A);for(const U of B){const ie=A[U],ee=this._tiles[U];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=l.exported.now())continue;const te=this.findLoadedParent(ie,v);te&&(this._addTile(te.tileID),k[te.tileID.key]=te.tileID),z[U]=ie}this._retainLoadedChildren(z,_,E,A);for(const U in k)A[U]||(this._coveredTiles[U]=!0,A[U]=k[U]);if(h){const U={},ie={};for(const ee of p)this._tiles[ee.key].hasData()?U[ee.key]=ee:ie[ee.key]=ee;for(const ee in ie){const te=ie[ee].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&(U[te[0].key]=A[te[0].key]=te[0],U[te[1].key]=A[te[1].key]=te[1],U[te[2].key]=A[te[2].key]=te[2],U[te[3].key]=A[te[3].key]=te[3],delete ie[ee])}for(const ee in ie){const te=this.findLoadedParent(ie[ee],this._source.minzoom);if(te){U[te.tileID.key]=A[te.tileID.key]=te.tileID;for(const he in U)U[he].isChildOf(te.tileID)&&delete U[he]}}for(const ee in this._tiles)U[ee]||(this._coveredTiles[ee]=!0)}}for(const k in A)this._tiles[k].clearFadeHold();const I=l.keysDifference(this._tiles,A);for(const k of I){const z=this._tiles[k];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const p={},_={},v=Math.max(h-Wt.maxOverzooming,this._source.minzoom),E=Math.max(h+Wt.maxUnderzooming,this._source.minzoom),A={};for(const I of s){const k=this._addTile(I);p[I.key]=I,k.hasData()||h<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,h,E,p);for(const I of s){let k=this._tiles[I.key];if(k.hasData())continue;if(h+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){p[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let z=k.wasRequested();for(let B=I.overscaledZ-1;B>=v;--B){const U=I.scaledTo(B);if(_[U.key]||(_[U.key]=!0,k=this.getTile(U),!k&&z&&(k=this._addTile(U)),k&&(p[U.key]=U,z=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,_=this._tiles[s].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;_=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new ii(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const _=[],v=this.transform;if(!v)return _;const E=p?v.getCameraQueryGeometry(s):s,A=s.map(ee=>v.pointCoordinate(ee,this.terrain)),I=E.map(ee=>v.pointCoordinate(ee,this.terrain)),k=this.getIds();let z=1/0,B=1/0,U=-1/0,ie=-1/0;for(const ee of I)z=Math.min(z,ee.x),B=Math.min(B,ee.y),U=Math.max(U,ee.x),ie=Math.max(ie,ee.y);for(let ee=0;ee<k.length;ee++){const te=this._tiles[k[ee]];if(te.holdingForFade())continue;const he=te.tileID,me=Math.pow(2,v.zoom-te.tileID.overscaledZ),xe=h*te.queryPadding*l.EXTENT/te.tileSize/me,re=[he.getTilePoint(new l.MercatorCoordinate(z,B)),he.getTilePoint(new l.MercatorCoordinate(U,ie))];if(re[0].x-xe<l.EXTENT&&re[0].y-xe<l.EXTENT&&re[1].x+xe>=0&&re[1].y+xe>=0){const Ee=A.map(ke=>he.getTilePoint(ke)),be=I.map(ke=>he.getTilePoint(ke));_.push({tile:te,tileID:he,queryGeometry:Ee,cameraQueryGeometry:be,scale:me})}}return _}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ns(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const _=this._tiles[s];_&&_.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function zn(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function ns(m){return m==="raster"||m==="image"||m==="video"}Wt.maxOverzooming=10,Wt.maxUnderzooming=3;const Ci="mapboxgl_preloaded_worker_pool";class Zn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Zn.workerCount;)this.workers.push(new Worker(wo.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ci]}numActive(){return Object.keys(this.active).length}}const Mr=Math.floor(l.exported.hardwareConcurrency/2);let Vi;function hi(){return Vi||(Vi=new Zn),Vi}function ji(m,s){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in s&&(h[p]=s[p])}),h}function Vs(m){m=m.slice();const s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=ji(m[h],s[m[h].ref]));return m}Zn.workerCount=Math.max(Math.min(Mr,6),1);const jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Mi(m,s,h){h.push({command:jt.addSource,args:[m,s[m]]})}function On(m,s,h){s.push({command:jt.removeSource,args:[m]}),h[m]=!0}function is(m,s,h,p){On(m,h,p),Mi(m,s,h)}function go(m,s,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;for(p in s[h])if(Object.prototype.hasOwnProperty.call(s[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;return!0}function kr(m,s,h,p,_,v){let E;for(E in s=s||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(L(m[E],s[E])||h.push({command:v,args:[p,E,s[E],_]}));for(E in s)Object.prototype.hasOwnProperty.call(s,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(L(m[E],s[E])||h.push({command:v,args:[p,E,s[E],_]}))}function Lr(m){return m.id}function js(m,s){return m[s.id]=s,m}class yr{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,p=this._distances[h];const _=s*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const v=h-1,E=this._distances[v],A=p-E,I=A>0?(_-E)/A:0;return this.points[v].mult(1-I).add(this.points[h].mult(I))}}function Me(m,s){let h=!0;return m==="always"||m!=="never"&&s!=="never"||(h=!1),h}class He{constructor(s,h,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,_,v){this._forEachCell(h,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(s,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(s,h,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(s,h,p,_,v,E){this.circleCells[v].push(E)}_query(s,h,p,_,v,E,A){if(p<0||s>this.width||_<0||h>this.height)return[];const I=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=_){if(v)return[{key:null,x1:s,y1:h,x2:p,y2:_}];for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const z=this.circles[3*k],B=this.circles[3*k+1],U=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:z-U,y1:B-U,x2:z+U,y2:B+U})}}else this._forEachCell(s,h,p,_,this._queryCell,I,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},A);return I}query(s,h,p,_){return this._query(s,h,p,_,!1,null)}hitTest(s,h,p,_,v,E){return this._query(s,h,p,_,!0,v,E).length>0}hitTestCircle(s,h,p,_,v){const E=s-p,A=s+p,I=h-p,k=h+p;if(A<0||E>this.width||k<0||I>this.height)return!1;const z=[];return this._forEachCell(E,I,A,k,this._queryCellCircle,z,{hitTest:!0,overlapMode:_,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},v),z.length>0}_queryCell(s,h,p,_,v,E,A,I){const{seenUids:k,hitTest:z,overlapMode:B}=A,U=this.boxCells[v];if(U!==null){const ee=this.bboxes;for(const te of U)if(!k.box[te]){k.box[te]=!0;const he=4*te,me=this.boxKeys[te];if(s<=ee[he+2]&&h<=ee[he+3]&&p>=ee[he+0]&&_>=ee[he+1]&&(!I||I(me))&&(!z||!Me(B,me.overlapMode))&&(E.push({key:me,x1:ee[he],y1:ee[he+1],x2:ee[he+2],y2:ee[he+3]}),z))return!0}}const ie=this.circleCells[v];if(ie!==null){const ee=this.circles;for(const te of ie)if(!k.circle[te]){k.circle[te]=!0;const he=3*te,me=this.circleKeys[te];if(this._circleAndRectCollide(ee[he],ee[he+1],ee[he+2],s,h,p,_)&&(!I||I(me))&&(!z||!Me(B,me.overlapMode))){const xe=ee[he],re=ee[he+1],Ee=ee[he+2];if(E.push({key:me,x1:xe-Ee,y1:re-Ee,x2:xe+Ee,y2:re+Ee}),z)return!0}}}return!1}_queryCellCircle(s,h,p,_,v,E,A,I){const{circle:k,seenUids:z,overlapMode:B}=A,U=this.boxCells[v];if(U!==null){const ee=this.bboxes;for(const te of U)if(!z.box[te]){z.box[te]=!0;const he=4*te,me=this.boxKeys[te];if(this._circleAndRectCollide(k.x,k.y,k.radius,ee[he+0],ee[he+1],ee[he+2],ee[he+3])&&(!I||I(me))&&!Me(B,me.overlapMode))return E.push(!0),!0}}const ie=this.circleCells[v];if(ie!==null){const ee=this.circles;for(const te of ie)if(!z.circle[te]){z.circle[te]=!0;const he=3*te,me=this.circleKeys[te];if(this._circlesCollide(ee[he],ee[he+1],ee[he+2],k.x,k.y,k.radius)&&(!I||I(me))&&!Me(B,me.overlapMode))return E.push(!0),!0}}}_forEachCell(s,h,p,_,v,E,A,I){const k=this._convertToXCellCoord(s),z=this._convertToYCellCoord(h),B=this._convertToXCellCoord(p),U=this._convertToYCellCoord(_);for(let ie=k;ie<=B;ie++)for(let ee=z;ee<=U;ee++)if(v.call(this,s,h,p,_,this.xCellCount*ee+ie,E,A,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,_,v,E){const A=_-s,I=v-h,k=p+E;return k*k>A*A+I*I}_circleAndRectCollide(s,h,p,_,v,E,A){const I=(E-_)/2,k=Math.abs(s-(_+I));if(k>I+p)return!1;const z=(A-v)/2,B=Math.abs(h-(v+z));if(B>z+p)return!1;if(k<=I||B<=z)return!0;const U=k-I,ie=B-z;return U*U+ie*ie<=p*p}}function rs(m,s,h,p,_){const v=l.create();return s?(l.scale(v,v,[1/_,1/_,1]),h||l.rotateZ(v,v,p.angle)):l.multiply(v,p.labelPlaneMatrix,m),v}function wi(m,s,h,p,_){if(s){const v=l.clone(m);return l.scale(v,v,[_,_,1]),h||l.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function Nt(m,s,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,s)):(p=[m.x,m.y,0,1],ir(p,p,s));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Gi(m,s){return .5+m/s*.5}function ki(m,s){const h=m[0]/m[3],p=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&p>=-s[1]&&p<=s[1]}function Li(m,s,h,p,_,v,E,A,I,k){const z=p?m.textSizeData:m.iconSizeData,B=l.evaluateSizeForZoom(z,h.transform.zoom),U=[256/h.width*2+1,256/h.height*2+1],ie=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();const ee=m.lineVertexArray,te=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,he=h.transform.width/h.transform.height;let me=!1;for(let xe=0;xe<te.length;xe++){const re=te.get(xe);if(re.hidden||re.writingMode===l.WritingMode.vertical&&!me){At(re.numGlyphs,ie);continue}let Ee;if(me=!1,k?(Ee=[re.anchorX,re.anchorY,k(re.anchorX,re.anchorY),1],l.transformMat4(Ee,Ee,s)):(Ee=[re.anchorX,re.anchorY,0,1],ir(Ee,Ee,s)),!ki(Ee,U)){At(re.numGlyphs,ie);continue}const be=Gi(h.transform.cameraToCenterDistance,Ee[3]),ke=l.evaluateSizeForFeature(z,B,re),Le=E?ke/be:ke*be,Fe=new l.pointGeometry(re.anchorX,re.anchorY),Ce=Nt(Fe,_,k).point,et={},We=Pt(re,Le,!1,A,s,_,v,m.glyphOffsetArray,ee,ie,Ce,Fe,et,he,I,k);me=We.useVertical,(We.notEnoughRoom||me||We.needsFlipping&&Pt(re,Le,!0,A,s,_,v,m.glyphOffsetArray,ee,ie,Ce,Fe,et,he,I,k).notEnoughRoom)&&At(re.numGlyphs,ie)}p?m.text.dynamicLayoutVertexBuffer.updateData(ie):m.icon.dynamicLayoutVertexBuffer.updateData(ie)}function ss(m,s,h,p,_,v,E,A,I,k,z,B,U){const ie=A.glyphStartIndex+A.numGlyphs,ee=A.lineStartIndex,te=A.lineStartIndex+A.lineLength,he=s.getoffsetX(A.glyphStartIndex),me=s.getoffsetX(ie-1),xe=Xn(m*he,h,p,_,v,E,A.segment,ee,te,I,k,z,B,U);if(!xe)return null;const re=Xn(m*me,h,p,_,v,E,A.segment,ee,te,I,k,z,B,U);return re?{first:xe,last:re}:null}function $e(m,s,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Pt(m,s,h,p,_,v,E,A,I,k,z,B,U,ie,ee,te){const he=s/24,me=m.lineOffsetX*he,xe=m.lineOffsetY*he;let re;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,be=m.lineStartIndex,ke=m.lineStartIndex+m.lineLength,Le=ss(he,A,me,xe,h,z,B,m,I,v,U,ee,te);if(!Le)return{notEnoughRoom:!0};const Fe=Nt(Le.first.point,E,te).point,Ce=Nt(Le.last.point,E,te).point;if(p&&!h){const et=$e(m.writingMode,Fe,Ce,ie);if(et)return et}re=[Le.first];for(let et=m.glyphStartIndex+1;et<Ee-1;et++)re.push(Xn(he*A.getoffsetX(et),me,xe,h,z,B,m.segment,be,ke,I,v,U,ee,te));re.push(Le.last)}else{if(p&&!h){const be=Nt(B,_,te).point,ke=m.lineStartIndex+m.segment+1,Le=new l.pointGeometry(I.getx(ke),I.gety(ke)),Fe=Nt(Le,_,te),Ce=Fe.signedDistanceFromCamera>0?Fe.point:It(B,Le,be,1,_,te),et=$e(m.writingMode,be,Ce,ie);if(et)return et}const Ee=Xn(he*A.getoffsetX(m.glyphStartIndex),me,xe,h,z,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,I,v,U,ee,te);if(!Ee)return{notEnoughRoom:!0};re=[Ee]}for(const Ee of re)l.addDynamicAttributes(k,Ee.point,Ee.angle);return{}}function It(m,s,h,p,_,v){const E=Nt(m.add(m.sub(s)._unit()),_,v).point,A=h.sub(E);return h.add(A._mult(p/A.mag()))}function Xn(m,s,h,p,_,v,E,A,I,k,z,B,U,ie){const ee=p?m-s:m+s;let te=ee>0?1:-1,he=0;p&&(te*=-1,he=Math.PI),te<0&&(he+=Math.PI);let me=te>0?A+E:A+E+1,xe=_,re=_,Ee=0,be=0;const ke=Math.abs(ee),Le=[];for(;Ee+be<=ke;){if(me+=te,me<A||me>=I)return null;if(re=xe,Le.push(xe),xe=B[me],xe===void 0){const nt=new l.pointGeometry(k.getx(me),k.gety(me)),Ct=Nt(nt,z,ie);if(Ct.signedDistanceFromCamera>0)xe=B[me]=Ct.point;else{const Lt=me-te;xe=It(Ee===0?v:new l.pointGeometry(k.getx(Lt),k.gety(Lt)),nt,re,ke-Ee+1,z,ie)}}Ee+=be,be=re.dist(xe)}const Fe=(ke-Ee)/be,Ce=xe.sub(re),et=Ce.mult(Fe)._add(re);et._add(Ce._unit()._perp()._mult(h*te));const We=he+Math.atan2(xe.y-re.y,xe.x-re.x);return Le.push(et),{point:et,angle:U?We:0,path:Le}}const Rr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function At(m,s){for(let h=0;h<m;h++){const p=s.length;s.resize(p+4),s.float32.set(Rr,3*p)}}function ir(m,s,h){const p=s[0],_=s[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const jn=100;class Gs{constructor(s,h=new He(s.width+200,s.height+200,25),p=new He(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+jn,this.screenBottomBoundary=s.height+jn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,_,v,E){const A=this.projectAndGetPerspectiveRatio(_,s.anchorPointX,s.anchorPointY,E),I=p*A.perspectiveRatio,k=s.x1*I+A.point.x,z=s.y1*I+A.point.y,B=s.x2*I+A.point.x,U=s.y2*I+A.point.y;return!this.isInsideGrid(k,z,B,U)||h!=="always"&&this.grid.hitTest(k,z,B,U,h,v)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,z,B,U],offscreen:this.isOffscreen(k,z,B,U)}}placeCollisionCircles(s,h,p,_,v,E,A,I,k,z,B,U,ie,ee){const te=[],he=new l.pointGeometry(h.anchorX,h.anchorY),me=Nt(he,E,ee),xe=Gi(this.transform.cameraToCenterDistance,me.signedDistanceFromCamera),re=(z?v/xe:v*xe)/l.ONE_EM,Ee=Nt(he,A,ee).point,be=ss(re,_,h.lineOffsetX*re,h.lineOffsetY*re,!1,Ee,he,h,p,A,{},!1,ee);let ke=!1,Le=!1,Fe=!0;if(be){const Ce=.5*U*xe+ie,et=new l.pointGeometry(-100,-100),We=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),nt=new yr,Ct=be.first,Lt=be.last;let _t=[];for(let $t=Ct.path.length-1;$t>=1;$t--)_t.push(Ct.path[$t]);for(let $t=1;$t<Lt.path.length;$t++)_t.push(Lt.path[$t]);const rn=2.5*Ce;if(I){const $t=_t.map(Ht=>Nt(Ht,I,ee));_t=$t.some(Ht=>Ht.signedDistanceFromCamera<=0)?[]:$t.map(Ht=>Ht.point)}let sn=[];if(_t.length>0){const $t=_t[0].clone(),Ht=_t[0].clone();for(let an=1;an<_t.length;an++)$t.x=Math.min($t.x,_t[an].x),$t.y=Math.min($t.y,_t[an].y),Ht.x=Math.max(Ht.x,_t[an].x),Ht.y=Math.max(Ht.y,_t[an].y);sn=$t.x>=et.x&&Ht.x<=We.x&&$t.y>=et.y&&Ht.y<=We.y?[_t]:Ht.x<et.x||$t.x>We.x||Ht.y<et.y||$t.y>We.y?[]:l.clipLine([_t],et.x,et.y,We.x,We.y)}for(const $t of sn){nt.reset($t,.25*Ce);let Ht=0;Ht=nt.length<=.5*Ce?1:Math.ceil(nt.paddedLength/rn)+1;for(let an=0;an<Ht;an++){const si=an/Math.max(Ht-1,1),cs=nt.lerp(si),Fr=cs.x+jn,us=cs.y+jn;te.push(Fr,us,Ce,0);const Qs=Fr-Ce,wr=us-Ce,Hi=Fr+Ce,Is=us+Ce;if(Fe=Fe&&this.isOffscreen(Qs,wr,Hi,Is),Le=Le||this.isInsideGrid(Qs,wr,Hi,Is),s!=="always"&&this.grid.hitTestCircle(Fr,us,Ce,s,B)&&(ke=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!k&&ke||!Le||xe<this.perspectiveRatioCutoff?[]:te,offscreen:Fe,collisionDetected:ke}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,v=-1/0,E=-1/0;for(const z of s){const B=new l.pointGeometry(z.x+jn,z.y+jn);p=Math.min(p,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),E=Math.max(E,B.y),h.push(B)}const A=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),I={},k={};for(const z of A){const B=z.key;if(I[B.bucketInstanceId]===void 0&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const U=[new l.pointGeometry(z.x1,z.y1),new l.pointGeometry(z.x2,z.y1),new l.pointGeometry(z.x2,z.y2),new l.pointGeometry(z.x1,z.y2)];l.polygonIntersectsPolygon(h,U)&&(I[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(s,h,p,_,v,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:E,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,_,v,E){const A=p?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let k=0;k<s.length;k+=4)A.insertCircle(I,s[k],s[k+1],s[k+2])}projectAndGetPerspectiveRatio(s,h,p,_){let v;return _?(v=[h,p,_(h,p),1],l.transformMat4(v,v,s)):(v=[h,p,0,1],ir(v,v,s)),{point:new l.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+jn,(-v[1]/v[3]+1)/2*this.transform.height+jn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,h,p,_){return p<jn||s>=this.screenRightBoundary||_<jn||h>this.screenBottomBoundary}isInsideGrid(s,h,p,_){return p>=0&&s<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}function Mn(m,s,h){return s*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class ri{constructor(s,h,p,_){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Qt{constructor(s,h,p,_,v){this.text=new ri(s?s.text:null,h,p,v),this.icon=new ri(s?s.icon:null,h,_,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $s{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class vr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class xr{constructor(s,h,p,_,v){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class Es{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function Hs(m,s,h,p,_){const{horizontalAlign:v,verticalAlign:E}=l.getAnchorAlignment(m),A=-(v-.5)*s,I=-(E-.5)*h,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry(A+k[0]*_,I+k[1]*_)}function os(m,s,h,p,_,v){const{x1:E,x2:A,y1:I,y2:k,anchorPointX:z,anchorPointY:B}=m,U=new l.pointGeometry(s,h);return p&&U._rotate(_?v:-v),{x1:E+U.x,y1:I+U.y,x2:A+U.x,y2:k+U.y,anchorPointX:z,anchorPointY:B}}class Y{constructor(s,h,p,_,v){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new Gs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Es(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,p,_){const v=p.getBucket(h),E=p.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const A=p.collisionBoxArray,I=v.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),U=I.get("text-pitch-alignment")==="map",ie=I.get("text-rotation-alignment")==="map",ee=Mn(p,1,this.transform.zoom),te=rs(B,U,ie,this.transform,ee);let he=null;if(U){const xe=wi(B,U,ie,this.transform,ee);he=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[v.bucketInstanceId]=new xr(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const me={bucket:v,layout:I,posMatrix:B,textLabelPlaneMatrix:te,labelToScreenMatrix:he,scale:k,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const xe of v.sortKeyRanges){const{sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be}=xe;s.push({sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be,parameters:me})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:me})}attemptAnchorPlacement(s,h,p,_,v,E,A,I,k,z,B,U,ie,ee,te,he){const me=[U.textOffset0,U.textOffset1],xe=Hs(s,p,_,me,v),re=this.collisionIndex.placeCollisionBox(os(h,xe.x,xe.y,E,A,this.transform.angle),B,I,k,z.predicate,he);if((!te||this.collisionIndex.placeCollisionBox(os(te,xe.x,xe.y,E,A,this.transform.angle),B,I,k,z.predicate,he).box.length!==0)&&re.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:me,width:p,height:_,anchor:s,textBoxScale:v,prevAnchor:Ee},this.markUsedJustification(ie,s,U,ee),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ee,U),this.placedOrientations[U.crossTileID]=ee),{shift:xe,placedGlyphBoxes:re}}}placeLayerBucketPart(s,h,p){const{bucket:_,layout:v,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:I,textPixelRatio:k,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:U,collisionGroup:ie}=s.parameters,ee=v.get("text-optional"),te=v.get("icon-optional"),he=l.getOverlapMode(v,"text-overlap","text-allow-overlap"),me=he==="always",xe=l.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),re=xe==="always",Ee=v.get("text-rotation-alignment")==="map",be=v.get("text-pitch-alignment")==="map",ke=v.get("icon-text-fit")!=="none",Le=v.get("symbol-z-order")==="viewport-y",Fe=me&&(re||!_.hasIconData()||te),Ce=re&&(me||!_.hasTextData()||ee);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B);const et=(We,nt)=>{if(h[We.crossTileID])return;if(z)return void(this.placements[We.crossTileID]=new $s(!1,!1,!1));let Ct=!1,Lt=!1,_t=!0,rn=null,sn={box:null,offscreen:null},$t={box:null,offscreen:null},Ht=null,an=null,si=null,cs=0,Fr=0,us=0;nt.textFeatureIndex?cs=nt.textFeatureIndex:We.useRuntimeCollisionCircles&&(cs=We.featureIndex),nt.verticalTextFeatureIndex&&(Fr=nt.verticalTextFeatureIndex);const Qs=this.retainedQueryData[_.bucketInstanceId].tileID,wr=this.terrain?(Kn,Bt)=>this.terrain.getElevation(Qs,Kn,Bt):null;for(const Kn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Bt=nt[Kn];Bt&&(Bt.elevation=wr?wr(Bt.anchorPointX,Bt.anchorPointY):0)}const Hi=nt.textBox;if(Hi){const Kn=en=>{let oi=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!en&&this.prevPlacement){const ai=this.prevPlacement.placedOrientations[We.crossTileID];ai&&(this.placedOrientations[We.crossTileID]=ai,oi=ai,this.markUsedOrientation(_,oi,We))}return oi},Bt=(en,oi)=>{if(_.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&nt.verticalTextBox){for(const ai of _.writingModes)if(ai===l.WritingMode.vertical?(sn=oi(),$t=sn):sn=en(),sn&&sn.box&&sn.box.length)break}else sn=en()};if(v.get("text-variable-anchor")){let en=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We.crossTileID]){const xn=this.prevPlacement.variableOffsets[We.crossTileID];en.indexOf(xn.anchor)>0&&(en=en.filter(Er=>Er!==xn.anchor),en.unshift(xn.anchor))}const oi=(xn,Er,Eo)=>{const Gu=xn.x2-xn.x1,ua=xn.y2-xn.y1,cf=We.textBoxScale,$u=ke&&xe==="never"?Er:null;let eo={box:[],offscreen:!1};const To=he!=="never"?2*en.length:en.length;for(let So=0;So<To;++So){const ac=this.attemptAnchorPlacement(en[So%en.length],xn,Gu,ua,cf,Ee,be,k,E,ie,So>=en.length?he:"never",We,_,Eo,$u,wr);if(ac&&(eo=ac.placedGlyphBoxes,eo&&eo.box&&eo.box.length)){Ct=!0,rn=ac.shift;break}}return eo};Bt(()=>oi(Hi,nt.iconBox,l.WritingMode.horizontal),()=>{const xn=nt.verticalTextBox;return _.allowVerticalPlacement&&!(sn&&sn.box&&sn.box.length)&&We.numVerticalGlyphVertices>0&&xn?oi(xn,nt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),sn&&(Ct=sn.box,_t=sn.offscreen);const ai=Kn(sn&&sn.box);if(!Ct&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[We.crossTileID];xn&&(this.variableOffsets[We.crossTileID]=xn,this.markUsedJustification(_,xn.anchor,We,ai))}}else{const en=(oi,ai)=>{const xn=this.collisionIndex.placeCollisionBox(oi,he,k,E,ie.predicate,wr);return xn&&xn.box&&xn.box.length&&(this.markUsedOrientation(_,ai,We),this.placedOrientations[We.crossTileID]=ai),xn};Bt(()=>en(Hi,l.WritingMode.horizontal),()=>{const oi=nt.verticalTextBox;return _.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&oi?en(oi,l.WritingMode.vertical):{box:null,offscreen:null}}),Kn(sn&&sn.box&&sn.box.length)}}if(Ht=sn,Ct=Ht&&Ht.box&&Ht.box.length>0,_t=Ht&&Ht.offscreen,We.useRuntimeCollisionCircles){const Kn=_.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex),Bt=l.evaluateSizeForFeature(_.textSizeData,U,Kn),en=v.get("text-padding");an=this.collisionIndex.placeCollisionCircles(he,Kn,_.lineVertexArray,_.glyphOffsetArray,Bt,E,A,I,p,be,ie.predicate,We.collisionCircleDiameter,en,wr),an.circles.length&&an.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Ct=me||an.circles.length>0&&!an.collisionDetected,_t=_t&&an.offscreen}if(nt.iconFeatureIndex&&(us=nt.iconFeatureIndex),nt.iconBox){const Kn=Bt=>{const en=ke&&rn?os(Bt,rn.x,rn.y,Ee,be,this.transform.angle):Bt;return this.collisionIndex.placeCollisionBox(en,xe,k,E,ie.predicate,wr)};$t&&$t.box&&$t.box.length&&nt.verticalIconBox?(si=Kn(nt.verticalIconBox),Lt=si.box.length>0):(si=Kn(nt.iconBox),Lt=si.box.length>0),_t=_t&&si.offscreen}const Is=ee||We.numHorizontalGlyphVertices===0&&We.numVerticalGlyphVertices===0,oc=te||We.numIconVertices===0;if(Is||oc?oc?Is||(Lt=Lt&&Ct):Ct=Lt&&Ct:Lt=Ct=Lt&&Ct,Ct&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,he,v.get("text-ignore-placement"),_.bucketInstanceId,$t&&$t.box&&Fr?Fr:cs,ie.ID),Lt&&si&&this.collisionIndex.insertCollisionBox(si.box,xe,v.get("icon-ignore-placement"),_.bucketInstanceId,us,ie.ID),an&&(Ct&&this.collisionIndex.insertCollisionCircles(an.circles,he,v.get("text-ignore-placement"),_.bucketInstanceId,cs,ie.ID),p)){const Kn=_.bucketInstanceId;let Bt=this.collisionCircleArrays[Kn];Bt===void 0&&(Bt=this.collisionCircleArrays[Kn]=new vr);for(let en=0;en<an.circles.length;en+=4)Bt.circles.push(an.circles[en+0]),Bt.circles.push(an.circles[en+1]),Bt.circles.push(an.circles[en+2]),Bt.circles.push(an.collisionDetected?1:0)}if(We.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[We.crossTileID]=new $s(Ct||Fe,Lt||Ce,_t||_.justReloaded),h[We.crossTileID]=!0};if(Le){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const We=_.getSortedSymbolIndexes(this.transform.angle);for(let nt=We.length-1;nt>=0;--nt){const Ct=We[nt];et(_.symbolInstances.get(Ct),_.collisionArrays[Ct])}}else for(let We=s.symbolInstanceStart;We<s.symbolInstanceEnd;We++)et(_.symbolInstances.get(We),_.collisionArrays[We]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[_.bucketInstanceId];l.invert(We.invProjMatrix,E),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(s,h,p,_){let v;v=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of E)A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:p.crossTileID)}markUsedOrientation(s,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,v=h===l.WritingMode.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of E)s.text.placedSymbolArray.get(A).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(s):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const I in this.placements){const k=this.placements[I],z=v[I];z?(this.opacities[I]=new Qt(z,_,k.text,k.icon),p=p||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[I]=new Qt(null,_,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const I in v){const k=v[I];if(!this.opacities[I]){const z=new Qt(k,_,!1,!1);z.isHidden()||(this.opacities[I]=z,p=p||k.text.placed||k.icon.placed)}}for(const I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const _ of h){const v=_.getBucket(s);v&&_.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(s,h,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const _=s.layers[0].layout,v=new Qt(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),I=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",B=_.get("icon-text-fit")!=="none",U=new Qt(null,0,E&&(A||!s.hasIconData()||_.get("icon-optional")),A&&(E||!s.hasTextData()||_.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const ie=(ee,te,he)=>{for(let me=0;me<te/4;me++)ee.opacityVertexArray.emplaceBack(he)};for(let ee=0;ee<s.symbolInstances.length;ee++){const te=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:me,crossTileID:xe}=te;let re=this.opacities[xe];h[xe]?re=v:re||(re=U,this.opacities[xe]=re),h[xe]=!0;const Ee=te.numIconVertices>0,be=this.placedOrientations[te.crossTileID],ke=be===l.WritingMode.vertical,Le=be===l.WritingMode.horizontal||be===l.WritingMode.horizontalOnly;if(he>0||me>0){const Fe=fe(re.text);ie(s.text,he,ke?Pe:Fe),ie(s.text,me,Le?Pe:Fe);const Ce=re.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach(nt=>{nt>=0&&(s.text.placedSymbolArray.get(nt).hidden=Ce||ke?1:0)}),te.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=Ce||Le?1:0);const et=this.variableOffsets[te.crossTileID];et&&this.markUsedJustification(s,et.anchor,te,be);const We=this.placedOrientations[te.crossTileID];We&&(this.markUsedJustification(s,"left",te,We),this.markUsedOrientation(s,We,te))}if(Ee){const Fe=fe(re.icon),Ce=!(B&&te.verticalPlacedIconSymbolIndex&&ke);te.placedIconSymbolIndex>=0&&(ie(s.icon,te.numIconVertices,Ce?Fe:Pe),s.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=re.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&(ie(s.icon,te.numVerticalIconVertices,Ce?Pe:Fe),s.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Fe=s.collisionArrays[ee];if(Fe){let Ce=new l.pointGeometry(0,0);if(Fe.textBox||Fe.verticalTextBox){let We=!0;if(I){const nt=this.variableOffsets[xe];nt?(Ce=Hs(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),k&&Ce._rotate(z?this.transform.angle:-this.transform.angle)):We=!1}Fe.textBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!We||ke,Ce.x,Ce.y),Fe.verticalTextBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!We||Le,Ce.x,Ce.y)}const et=!!(!Le&&Fe.verticalIconBox);Fe.iconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,et,B?Ce.x:0,B?Ce.y:0),Fe.verticalIconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,!et,B?Ce.x:0,B?Ce.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function R(m,s,h,p,_){m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),q=Math.pow(2,24),Z=Math.pow(2,17),le=Math.pow(2,16),de=Math.pow(2,9),ue=Math.pow(2,8),ae=Math.pow(2,1);function fe(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+s*q+h*Z+s*le+h*de+s*ue+h*ae+s}const Pe=0;class ze{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,_,v){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,_,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Ie{constructor(s,h,p,_,v,E,A,I){this.placement=new Y(s,h,E,A,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const _=l.exported.now(),v=()=>{const E=l.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ze(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const rt=512/l.EXTENT/2;class lt{constructor(s,h,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const v=h.get(_),E=v.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,s)})}}getScaledCoordinates(s,h){const p=rt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+s.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+s.anchorY)*p)}}findMatches(s,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<s.length;v++){const E=s.get(v);if(E.crossTileID)continue;const A=this.indexedSymbolInstances[E.key];if(!A)continue;const I=this.getScaledCoordinates(E,h);for(const k of A)if(Math.abs(k.coord.x-I.x)<=_&&Math.abs(k.coord.y-I.y)<=_&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Ye{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],v={};for(const E in _){const A=_[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const _=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>s.overscaledZ)for(const A in E){const I=E[A];I.tileID.isChildOf(s)&&I.findMatches(h.symbolInstances,s,_)}else{const A=E[s.scaledTo(Number(v)).key];A&&A.findMatches(h.symbolInstances,s,_)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new lt(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][_.crossTileID]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)s[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],h=!0)}return h}}class dt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ye,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let _=this.layerIndexes[s.id];_===void 0&&(_=this.layerIndexes[s.id]=new gt);let v=!1;const E={};_.handleWrapJump(p);for(const A of h){const I=A.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,I,this.crossTileIDs)&&(v=!0),E[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Mt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class vt extends l.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=s._cache.max,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const s in this._tiles){const h=this._tiles[s];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];for(const p of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new ii(p,this.tileSize))}removeOutdated(s){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(s),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=v}else if(_.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const E=_.canonical.z-s.canonical.z,A=_.canonical.x-(_.canonical.x>>E<<E),I=_.canonical.y-(_.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(v.posMatrix,0,k,0,k,0,1),l.translate(v.posMatrix,v.posMatrix,[-A*k,-I*k,0]),h[p]=v}else if(s.canonical.isChildOf(_.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const E=s.canonical.z-_.canonical.z,A=s.canonical.x-(s.canonical.x>>E<<E),I=s.canonical.y-(s.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(v.posMatrix,v.posMatrix,[A*k,I*k,0]),l.scale(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[p]=v}}return h}getSourceTile(s,h){const p=this.sourceCache._source;let _=s.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(_).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&h)for(;_>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(_--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=s)}}class Tt{constructor(s,h,p){this.style=s,this.sourceCache=new vt(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(s,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let v=0;const E=this.getTerrainData(s);if(E.tile&&E.tile.dem){const A=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],E.u_terrain_matrix),I=[A[0]*E.tile.dem.dim,A[1]*E.tile.dem.dim],k=[Math.floor(I[0]),Math.floor(I[1])],z=E.tile.dem.get(k[0],k[1]),B=E.tile.dem.get(k[0],k[1]+1),U=E.tile.dem.get(k[0]+1,k[1]),ie=E.tile.dem.get(k[0]+1,k[1]+1);v=l.number(l.number(z,B,I[0]-k[0]),l.number(U,ie,I[0]-k[0]),I[1]-k[1])}return v}rememberForRerender(s,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(s===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[s]=this._rerender[s]||{},this._rerender[s][_.tileID.key]=!0)}}needsRerender(s,h){return this._rerender[s]&&this._rerender[s][h.key]}clearRerenderCache(){this._rerender={}}getElevation(s,h,p,_=l.EXTENT){return(this.getDEMElevation(s,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const _=this.style.map.painter.context,v=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(_,v,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ne(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=_?v=s.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=s.canonical.x-(s.canonical.x>>v<<v),A=s.canonical.y-(s.canonical.y>>v<<v),I=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<v),1/(l.EXTENT<<v),0]);l.translate(I,I,[E*l.EXTENT,A*l.EXTENT,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const s=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=s.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(s){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let A=0;A<this._coordsTextureSize;A++,E+=4)h[E+0]=255&A,h[E+1]=255&v,h[E+2]=A>>8<<4|v>>8,h[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new ne(s,p,s.gl.RGBA,{premultiply:!1});return _.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(s){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,v=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(s.x,p.height/devicePixelRatio-s.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const E=h[0]+(h[2]>>4<<8),A=h[1]+((15&h[2])<<8),I=this.coordsIndex[255-h[3]],k=I&&this.sourceCache.getTileByID(I);if(!k)return null;const z=this._coordsTextureSize,B=(1<<k.tileID.canonical.z)*z;return new l.MercatorCoordinate((k.tileID.canonical.x*z+E)/B,(k.tileID.canonical.y*z+A)/B,this.getElevation(k.tileID,E,A,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,v=l.EXTENT/_,E=_*_;for(let A=0;A<=_;A++)for(let I=0;I<=_;I++)h.emplaceBack(I*v,A*v);for(let A=0;A<E;A+=_+1)for(let I=0;I<_;I++)p.emplaceBack(I+A,_+I+A+1,_+I+A+2),p.emplaceBack(I+A,_+I+A+2,I+A+1);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(h,Mt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ot=(m,s)=>l.emitValidationErrors(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Ut=l.pick(jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),un=l.pick(jt,["setCenter","setZoom","setBearing","setPitch"]),hn=function(){const m={},s=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?s:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class Yn extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new je(hi(),this),this.imageManager=new K,this.imageManager.setEventedParent(this),this.glyphManager=new ye(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new dt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Yn.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(l.triggerPluginCompletionEvent(v),E&&E.every(A=>A))for(const A in p.sourceCaches)p.sourceCaches[A].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const E=v.getSource();if(E&&E.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===E.id&&this._validateLayer(I)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new l.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(hn,!1)}_load(s,h){if(h&&Ot(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const _ in s.sources)this.addSource(_,s.sources[_],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=Vs(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Be(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,p,_,v){let E,A,I;const k=_>1?"@2x":"";let z=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(ie,ee)=>{z=null,I||(I=ie,E=ee,U())}),B=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(ie,ee)=>{B=null,I||(I=ie,A=ee,U())});function U(){if(I)v(I);else if(E&&A){const ie=l.exported.getImageData(A),ee={};for(const te in E){const{width:he,height:me,x:xe,y:re,sdf:Ee,pixelRatio:be,stretchX:ke,stretchY:Le,content:Fe}=E[te],Ce=new l.RGBAImage({width:he,height:me});l.RGBAImage.copy(ie,Ce,{x:xe,y:re},{x:0,y:0},{width:he,height:me}),ee[te]={data:Ce,pixelRatio:be,sdf:Ee,stretchX:ke,stretchY:Le,content:Fe}}v(null,ee)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const p of s){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const E in this._updatedSources){const A=this._updatedSources[E];if(A==="reload")this._reloadSource(E);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const v=this.sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const _ in p){const v=this.sourceCaches[_];p[_]!==v.used&&v.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(s){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),s){const h=this.sourceCaches[s.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${s.source}`);this.terrain=new Tt(this,h,s),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===s.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:s}))}setState(s){if(this._checkLoaded(),Ot(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=Vs(s.layers);const h=function(_,v){if(!_)return[{command:jt.setStyle,args:[v]}];let E=[];try{if(!L(_.version,v.version))return[{command:jt.setStyle,args:[v]}];L(_.center,v.center)||E.push({command:jt.setCenter,args:[v.center]}),L(_.zoom,v.zoom)||E.push({command:jt.setZoom,args:[v.zoom]}),L(_.bearing,v.bearing)||E.push({command:jt.setBearing,args:[v.bearing]}),L(_.pitch,v.pitch)||E.push({command:jt.setPitch,args:[v.pitch]}),L(_.sprite,v.sprite)||E.push({command:jt.setSprite,args:[v.sprite]}),L(_.glyphs,v.glyphs)||E.push({command:jt.setGlyphs,args:[v.glyphs]}),L(_.transition,v.transition)||E.push({command:jt.setTransition,args:[v.transition]}),L(_.light,v.light)||E.push({command:jt.setLight,args:[v.light]});const A={},I=[];(function(z,B,U,ie){let ee;for(ee in B=B||{},z=z||{})Object.prototype.hasOwnProperty.call(z,ee)&&(Object.prototype.hasOwnProperty.call(B,ee)||On(ee,U,ie));for(ee in B)Object.prototype.hasOwnProperty.call(B,ee)&&(Object.prototype.hasOwnProperty.call(z,ee)?L(z[ee],B[ee])||(z[ee].type==="geojson"&&B[ee].type==="geojson"&&go(z,B,ee)?U.push({command:jt.setGeoJSONSourceData,args:[ee,B[ee].data]}):is(ee,B,U,ie)):Mi(ee,B,U))})(_.sources,v.sources,I,A);const k=[];_.layers&&_.layers.forEach(z=>{A[z.source]?E.push({command:jt.removeLayer,args:[z.id]}):k.push(z)}),E=E.concat(I),function(z,B,U){B=B||[];const ie=(z=z||[]).map(Lr),ee=B.map(Lr),te=z.reduce(js,{}),he=B.reduce(js,{}),me=ie.slice(),xe=Object.create(null);let re,Ee,be,ke,Le,Fe,Ce;for(re=0,Ee=0;re<ie.length;re++)be=ie[re],Object.prototype.hasOwnProperty.call(he,be)?Ee++:(U.push({command:jt.removeLayer,args:[be]}),me.splice(me.indexOf(be,Ee),1));for(re=0,Ee=0;re<ee.length;re++)be=ee[ee.length-1-re],me[me.length-1-re]!==be&&(Object.prototype.hasOwnProperty.call(te,be)?(U.push({command:jt.removeLayer,args:[be]}),me.splice(me.lastIndexOf(be,me.length-Ee),1)):Ee++,Fe=me[me.length-re],U.push({command:jt.addLayer,args:[he[be],Fe]}),me.splice(me.length-re,0,be),xe[be]=!0);for(re=0;re<ee.length;re++)if(be=ee[re],ke=te[be],Le=he[be],!xe[be]&&!L(ke,Le))if(L(ke.source,Le.source)&&L(ke["source-layer"],Le["source-layer"])&&L(ke.type,Le.type)){for(Ce in kr(ke.layout,Le.layout,U,be,null,jt.setLayoutProperty),kr(ke.paint,Le.paint,U,be,null,jt.setPaintProperty),L(ke.filter,Le.filter)||U.push({command:jt.setFilter,args:[be,Le.filter]}),L(ke.minzoom,Le.minzoom)&&L(ke.maxzoom,Le.maxzoom)||U.push({command:jt.setLayerZoomRange,args:[be,Le.minzoom,Le.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?kr(ke[Ce],Le[Ce],U,be,Ce.slice(6),jt.setPaintProperty):L(ke[Ce],Le[Ce])||U.push({command:jt.setLayerProperty,args:[be,Ce,Le[Ce]]}));for(Ce in Le)Object.prototype.hasOwnProperty.call(Le,Ce)&&!Object.prototype.hasOwnProperty.call(ke,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?kr(ke[Ce],Le[Ce],U,be,Ce.slice(6),jt.setPaintProperty):L(ke[Ce],Le[Ce])||U.push({command:jt.setLayerProperty,args:[be,Ce,Le[Ce]]}))}else U.push({command:jt.removeLayer,args:[be]}),Fe=me[me.lastIndexOf(be)+1],U.push({command:jt.addLayer,args:[Le,Fe]})}(k,v.layers,E)}catch(A){console.warn("Unable to compute style diff:",A),E=[{command:jt.setStyle,args:[v]}]}return E}(this.serialize(),s).filter(_=>!(_.command in un));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Ut));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[s]=new Wt(s,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:s})),_.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const _=s.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let v;if(s.type==="custom"){if(Ot(this,l.validateCustomStyleLayer(s)))return;v=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(_,s.source),s=l.clone$1(s),s=l.extend(s,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,s,{arrayIndex:-1},p))return;v=l.createStyleLayer(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v,this._removedLayers[_]&&v.source&&v.type!=="custom"){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(_,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const _=this.getLayer(s);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const _=this.getLayer(s);if(_){if(!L(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?L(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,_),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?L(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,_=s.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(_,s.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.getSource().type,E=v==="vector"?s.sourceLayer:void 0;v!=="vector"||E?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,s.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,s.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A)){p[A]=E;for(const I of s){const k=I[A];if(k)for(const z of k)_.push(z)}}}_.sort((E,A)=>A.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A))for(let I=_.length-1;I>=0;I--){const k=_[I].feature;if(p[k.layer.id]<E)break;v.push(k),_.pop()}else for(const I of s){const k=I[A];if(k)for(const z of k)v.push(z.feature)}}return v}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const A=this._layers[E];if(!A)return this.fire(new l.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[A.source]=!0}}const v=[];h.availableImages=this._availableImages;for(const E in this.sourceCaches)h.layers&&!_[E]||v.push(ni(this.sourceCaches[E],this._layers,this._serializedLayers,s,h,p));return this.placement&&v.push(function(E,A,I,k,z,B,U){const ie={},ee=B.queryRenderedSymbols(k),te=[];for(const he of Object.keys(ee).map(Number))te.push(U[he]);te.sort(xi);for(const he of te){const me=he.featureIndex.lookupSymbolFeatures(ee[he.bucketInstanceId],A,he.bucketIndex,he.sourceLayerIndex,z.filter,z.layers,z.availableImages,E);for(const xe in me){const re=ie[xe]=ie[xe]||[],Ee=me[xe];Ee.sort((be,ke)=>{const Le=he.featureSortOrder;if(Le){const Fe=Le.indexOf(be.featureIndex);return Le.indexOf(ke.featureIndex)-Fe}return ke.featureIndex-be.featureIndex});for(const be of Ee)re.push(be)}}for(const he in ie)ie[he].forEach(me=>{const xe=me.feature,re=I[E[he].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=re});return ie}(this._layers,this._serializedLayers,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(_,v){const E=_.getRenderableIds().map(k=>_.getTileByID(k)),A=[],I={};for(let k=0;k<E.length;k++){const z=E[k],B=z.tileID.canonical.key;I[B]||(I[B]=!0,z.querySourceFeatures(A,v))}return A}(p,h):[]}addSourceType(s,h,p){return Yn.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(Yn.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in s)if(!L(s[E],p[E])){_=!0;break}if(!_)return;const v={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(v)}_validate(s,h,p,_,v={}){return(!v||v.validate!==!1)&&Ot(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const h=this.sourceCaches[s];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,_,v=!1){let E=!1,A=!1;const I={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!I[z.source]){const U=this.sourceCaches[z.source];I[z.source]=U.getRenderableIds(!0).map(ie=>U.getTileByID(ie)).sort((ie,ee)=>ee.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(ee.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,I[z.source],s.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new Ie(s,this.terrain,this._order,v,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(s,h,p){return l.makeRequest(h,p)}}Yn.getSourceType=function(m){return nn[m]},Yn.setSourceType=function(m,s){nn[m]=s},Yn.registerForPluginStateChange=l.registerForPluginStateChange;var Dr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const di={prelude:Zt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Zt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Zt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Zt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Zt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Zt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Dr),terrainDepth:Zt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Dr),terrainCoords:Zt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Dr)};function Zt(m,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(_):_,A={};return{fragmentSource:m=m.replace(h,(I,k,z,B,U)=>(A[U]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${z} ${B} ${U};
#else
uniform ${z} ${B} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${z} ${B} ${U} = u_${U};
#endif
`)),vertexSource:s=s.replace(h,(I,k,z,B,U)=>{const ie=B==="float"?"vec2":"vec4",ee=U.match(/color/)?"color":ie;return A[U]?k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${z} ${ie} a_${U};
varying ${z} ${B} ${U};
#else
uniform ${z} ${B} u_${U};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${z} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${ee}(a_${U}, u_${U}_t);
#else
    ${z} ${B} ${U} = u_${U};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${z} ${ie} a_${U};
#else
uniform ${z} ${B} u_${U};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${z} ${B} ${U} = a_${U};
#else
    ${z} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${z} ${B} ${U} = unpack_mix_${ee}(a_${U}, u_${U}_t);
#else
    ${z} ${B} ${U} = u_${U};
#endif
`}),staticAttributes:p,staticUniforms:E}}class _o{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,_,v,E,A,I,k){this.context=s;let z=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!z&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(z=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===k?(s.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),k&&k.bind()):this.freshBind(h,p,_,v,E,A,I,k)}freshBind(s,h,p,_,v,E,A,I){let k;const z=s.numAttributes,B=this.context,U=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=I;else{k=B.currentNumAttributes||0;for(let ie=z;ie<k;ie++)U.disableVertexAttribArray(ie)}h.enableAttributes(U,s);for(const ie of p)ie.enableAttributes(U,s);E&&E.enableAttributes(U,s),A&&A.enableAttributes(U,s),I&&I.enableAttributes(U,s),h.bind(),h.setVertexAttribPointers(U,s,v);for(const ie of p)ie.bind(),ie.setVertexAttribPointers(U,s,v);E&&(E.bind(),E.setVertexAttribPointers(U,s,v)),_&&_.bind(),A&&(A.bind(),A.setVertexAttribPointers(U,s,v)),I&&(I.bind(),I.setVertexAttribPointers(U,s,v)),B.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yo(m){const s=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");s.push(p.pop())}return s}class Yo{constructor(s,h,p,_,v,E,A){const I=s.gl;this.program=I.createProgram();const k=yo(p.staticAttributes),z=_?_.getBinderAttributes():[],B=k.concat(z),U=di.prelude.staticUniforms?yo(di.prelude.staticUniforms):[],ie=p.staticUniforms?yo(p.staticUniforms):[],ee=_?_.getBinderUniforms():[],te=U.concat(ie).concat(ee),he=[];for(const Le of te)he.indexOf(Le)<0&&he.push(Le);const me=_?_.defines():[];E&&me.push("#define OVERDRAW_INSPECTOR;"),A&&me.push("#define TERRAIN3D;");const xe=me.concat(di.prelude.fragmentSource,p.fragmentSource).join(`
`),re=me.concat(di.prelude.vertexSource,p.vertexSource).join(`
`),Ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Ee,xe),I.compileShader(Ee),I.attachShader(this.program,Ee);const be=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(be,re),I.compileShader(be),I.attachShader(this.program,be),this.attributes={};const ke={};this.numAttributes=B.length;for(let Le=0;Le<this.numAttributes;Le++)B[Le]&&(I.bindAttribLocation(this.program,Le,B[Le]),this.attributes[B[Le]]=Le);I.linkProgram(this.program),I.deleteShader(be),I.deleteShader(Ee);for(let Le=0;Le<he.length;Le++){const Fe=he[Le];if(Fe&&!ke[Fe]){const Ce=I.getUniformLocation(this.program,Fe);Ce&&(ke[Fe]=Ce)}}this.fixedUniforms=v(s,ke),this.terrainUniforms=((Le,Fe)=>({u_depth:new l.Uniform1i(Le,Fe.u_depth),u_terrain:new l.Uniform1i(Le,Fe.u_terrain),u_terrain_dim:new l.Uniform1f(Le,Fe.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Le,Fe.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Le,Fe.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Le,Fe.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Le,Fe.u_terrain_exaggeration)}))(s,ke),this.binderUniforms=_?_.getUniforms(s,ke):[]}draw(s,h,p,_,v,E,A,I,k,z,B,U,ie,ee,te,he,me,xe){const re=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(_),s.setColorMode(v),s.setCullFace(E),I){s.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,I.depthTexture),s.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,I.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(I[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(A[be]);te&&te.setUniforms(s,this.binderUniforms,ie,{zoom:ee});let Ee=0;switch(h){case re.LINES:Ee=2;break;case re.TRIANGLES:Ee=3;break;case re.LINE_STRIP:Ee=1}for(const be of U.get()){const ke=be.vaos||(be.vaos={});(ke[k]||(ke[k]=new _o)).bind(s,this,z,te?te.getPaintVertexBuffers():[],B,be.vertexOffset,he,me,xe),re.drawElements(h,be.primitiveLength*Ee,re.UNSIGNED_SHORT,be.primitiveOffset*Ee*2)}}}function Ko(m,s,h){const p=1/Mn(h,1,s.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,s.transform.tileZoom)/_,E=v*(h.tileID.canonical.x+h.tileID.wrap*_),A=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,A>>16],u_pixel_coord_lower:[65535&E,65535&A]}}const Ws=(m,s,h,p)=>{const _=s.style.light,v=_.properties.get("position"),E=[v.x,v.y,v.z],A=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(A,-s.transform.angle),l.transformMat3(E,E,A);const I=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+h,u_opacity:p}},zr=(m,s,h,p,_,v,E)=>l.extend(Ws(m,s,h,p),Ko(v,s,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),Jo=m=>({u_matrix:m}),Qo=(m,s,h,p)=>l.extend(Jo(m),Ko(h,s,p)),ea=(m,s)=>({u_matrix:m,u_world:s}),Wa=(m,s,h,p,_)=>l.extend(Qo(m,s,h,p),{u_world:_}),$l=(m,s,h,p)=>{const _=m.transform;let v,E;if(p.paint.get("circle-pitch-alignment")==="map"){const A=Mn(h,1,_.zoom);v=!0,E=[A,A]}else v=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(s.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},Ts=(m,s,h)=>{const p=Mn(h,1,s.zoom),_=Math.pow(2,s.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*_),s.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:v}},j=(m,s,h=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:h}),X=m=>({u_matrix:m}),ce=(m,s,h,p)=>({u_matrix:m,u_extrude_scale:Mn(s,1,h),u_intensity:p});function Se(m,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Ne=(m,s,h,p)=>{const _=m.transform;return{u_matrix:Fn(m,s,h,p),u_ratio:1/Mn(s,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ot=(m,s,h,p,_)=>l.extend(Ne(m,s,h,_),{u_image:0,u_image_height:p}),Ft=(m,s,h,p,_)=>{const v=m.transform,E=kt(s,v);return{u_matrix:Fn(m,s,h,_),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Mn(s,1,v.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},En=(m,s,h,p,_,v)=>{const E=m.lineAtlas,A=kt(s,m.transform),I=h.layout.get("line-cap")==="round",k=E.getDash(p.from,I),z=E.getDash(p.to,I),B=k.width*_.fromScale,U=z.width*_.toScale;return l.extend(Ne(m,s,h,v),{u_patternscale_a:[A/B,-k.height/2],u_patternscale_b:[A/U,-z.height/2],u_sdfgamma:E.width/(256*Math.min(B,U)*m.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:z.y,u_mix:_.t})};function kt(m,s){return 1/Mn(m,1,s.tileZoom)}function Fn(m,s,h,p){return m.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const rr=(m,s,h,p,_)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Md(_.paint.get("raster-hue-rotate"))};var v,E};function Md(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const gu=(m,s,h,p,_,v,E,A,I,k)=>{const z=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:z.width/z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},Hl=(m,s,h,p,_,v,E,A,I,k,z)=>{const B=_.transform;return l.extend(gu(m,s,h,p,_,v,E,A,I,k),{u_gamma_scale:p?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+z})},kd=(m,s,h,p,_,v,E,A,I,k)=>l.extend(Hl(m,s,h,p,_,v,E,A,!0,I,!0),{u_texsize_icon:k,u_texture_icon:1}),Nm=(m,s,h)=>({u_matrix:m,u_opacity:s,u_color:h}),Um=(m,s,h,p,_,v)=>l.extend(function(E,A,I,k){const z=I.imageManager.getPattern(E.from.toString()),B=I.imageManager.getPattern(E.to.toString()),{width:U,height:ie}=I.imageManager.getPixelSize(),ee=Math.pow(2,k.tileID.overscaledZ),te=k.tileSize*Math.pow(2,I.transform.tileZoom)/ee,he=te*(k.tileID.canonical.x+k.tileID.wrap*ee),me=te*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[U,ie],u_mix:A.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Mn(k,1,I.transform.tileZoom),u_pixel_coord_upper:[he>>16,me>>16],u_pixel_coord_lower:[65535&he,65535&me]}}(p,v,h,_),{u_matrix:m,u_opacity:s}),_u={fillExtrusion:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,s.u_height_factor),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,s.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,s.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,s.u_overscale_factor)}),collisionCircle:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new l.UniformColor(m,s.u_color),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_overlay:new l.Uniform1i(m,s.u_overlay),u_overlay_scale:new l.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new l.Uniform1f(m,s.u_extrude_scale),u_intensity:new l.Uniform1f(m,s.u_intensity),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_color_ramp:new l.Uniform1i(m,s.u_color_ramp),u_opacity:new l.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_latrange:new l.Uniform2f(m,s.u_latrange),u_light:new l.Uniform2f(m,s.u_light),u_shadow:new l.UniformColor(m,s.u_shadow),u_highlight:new l.UniformColor(m,s.u_highlight),u_accent:new l.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_dimension:new l.Uniform2f(m,s.u_dimension),u_zoom:new l.Uniform1f(m,s.u_zoom),u_unpack:new l.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_image:new l.Uniform1i(m,s.u_image),u_image_height:new l.Uniform1f(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texsize:new l.Uniform2f(m,s.u_texsize),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_image:new l.Uniform1i(m,s.u_image),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,s.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,s.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,s.u_sdfgamma),u_image:new l.Uniform1i(m,s.u_image),u_tex_y_a:new l.Uniform1f(m,s.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,s.u_tex_y_b),u_mix:new l.Uniform1f(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new l.Uniform2f(m,s.u_tl_parent),u_scale_parent:new l.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,s.u_buffer_scale),u_fade_t:new l.Uniform1f(m,s.u_fade_t),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image0:new l.Uniform1i(m,s.u_image0),u_image1:new l.Uniform1i(m,s.u_image1),u_brightness_low:new l.Uniform1f(m,s.u_brightness_low),u_brightness_high:new l.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texsize_icon:new l.Uniform2f(m,s.u_texsize_icon),u_texture:new l.Uniform1i(m,s.u_texture),u_texture_icon:new l.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_color:new l.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image:new l.Uniform1i(m,s.u_image),u_pattern_tl_a:new l.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,s.u_pattern_br_b),u_texsize:new l.Uniform2f(m,s.u_texsize),u_mix:new l.Uniform1f(m,s.u_mix),u_pattern_size_a:new l.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,s.u_scale_a),u_scale_b:new l.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture)}),terrainDepth:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),terrainCoords:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture),u_terrain_coords_id:new l.Uniform1f(m,s.u_terrain_coords_id)})};class yu{constructor(s,h,p){this.context=s;const _=s.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xu{constructor(s,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&s.enableVertexAttribArray(_)}}setVertexAttribPointers(s,h,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],E=h.attributes[v.name];E!==void 0&&s.vertexAttribPointer(E,v.components,s[vu[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ld extends Kt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Vm extends Kt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class qa extends Kt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Za extends Kt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Rd extends Kt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class sr extends Kt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class bu extends Kt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Wl extends Kt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class ql extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class wu extends Kt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Eu extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Zl extends Kt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Tu extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Su extends Kt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Xl extends Kt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Dd extends Kt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class zd extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class ta extends Kt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class jm extends Kt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Gm extends Kt{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class $m extends Kt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Hm extends Kt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Wm extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class qm extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Au extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Yl extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Iu extends Kt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Pu extends Kt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class na extends Kt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Od extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Fd extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Kl extends Kt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class vo extends Kl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Bd extends Kl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ia{constructor(s,h,p,_){this.context=s,this.width=h,this.height=p;const v=s.gl,E=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new vo(s,E),_&&(this.depthAttachment=new Bd(s,E)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class mn{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}mn.Replace=[1,0],mn.disabled=new mn(mn.Replace,l.Color.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,l.Color.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Nd{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ld(this),this.clearDepth=new Vm(this),this.clearStencil=new qa(this),this.colorMask=new Za(this),this.depthMask=new Rd(this),this.stencilMask=new sr(this),this.stencilFunc=new bu(this),this.stencilOp=new Wl(this),this.stencilTest=new ql(this),this.depthRange=new wu(this),this.depthTest=new Eu(this),this.depthFunc=new Zl(this),this.blend=new Tu(this),this.blendFunc=new Su(this),this.blendColor=new Xl(this),this.blendEquation=new Dd(this),this.cullFace=new zd(this),this.cullFaceSide=new ta(this),this.frontFace=new jm(this),this.program=new Gm(this),this.activeTexture=new $m(this),this.viewport=new Hm(this),this.bindFramebuffer=new Wm(this),this.bindRenderbuffer=new qm(this),this.bindTexture=new Au(this),this.bindVertexBuffer=new Yl(this),this.bindElementBuffer=new Iu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pu(this),this.pixelStoreUnpack=new na(this),this.pixelStoreUnpackPremultiplyAlpha=new Od(this),this.pixelStoreUnpackFlipY=new Fd(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new yu(this,s,h)}createVertexBuffer(s,h,p){return new xu(this,s,h,p)}createRenderbuffer(s,h,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(s,h,p){return new ia(this,s,h,p)}clear({color:s,depth:h}){const p=this.gl;let _=0;s&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){L(s.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Gt{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const Jt=7680;class dn{constructor(s,h,p,_,v,E){this.test=s,this.ref=h,this.mask=p,this.fail=_,this.depthFail=v,this.pass=E}}dn.disabled=new dn({func:519,mask:0},0,0,Jt,Jt,Jt);class yn{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}let Xa;function ra(m,s,h,p,_,v,E){const A=m.context,I=A.gl,k=m.useProgram("collisionBox"),z=[];let B=0,U=0;for(let re=0;re<p.length;re++){const Ee=p[re],be=s.getTile(Ee),ke=be.getBucket(h);if(!ke)continue;let Le=Ee.posMatrix;_[0]===0&&_[1]===0||(Le=m.translatePosMatrix(Ee.posMatrix,be,_,v));const Fe=E?ke.textCollisionBox:ke.iconCollisionBox,Ce=ke.collisionCircleArray;if(Ce.length>0){const et=l.create(),We=Le;l.mul(et,ke.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(et,et,ke.placementViewportMatrix),z.push({circleArray:Ce,circleOffset:U,transform:We,invTransform:et,coord:Ee}),B+=Ce.length/4,U=B}Fe&&k.draw(A,I.LINES,Gt.disabled,dn.disabled,m.colorModeForRenderPass(),yn.disabled,Ts(Le,m.transform,be),m.style.terrain&&m.style.terrain.getTerrainData(Ee),h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,m.transform.zoom,null,null,Fe.collisionVertexBuffer)}if(!E||!z.length)return;const ie=m.useProgram("collisionCircle"),ee=new l.CollisionCircleLayoutArray;ee.resize(4*B),ee._trim();let te=0;for(const re of z)for(let Ee=0;Ee<re.circleArray.length/4;Ee++){const be=4*Ee,ke=re.circleArray[be+0],Le=re.circleArray[be+1],Fe=re.circleArray[be+2],Ce=re.circleArray[be+3];ee.emplace(te++,ke,Le,Fe,Ce,0),ee.emplace(te++,ke,Le,Fe,Ce,1),ee.emplace(te++,ke,Le,Fe,Ce,2),ee.emplace(te++,ke,Le,Fe,Ce,3)}(!Xa||Xa.length<2*B)&&(Xa=function(re){const Ee=2*re,be=new l.QuadTriangleArray;be.resize(Ee),be._trim();for(let ke=0;ke<Ee;ke++){const Le=6*ke;be.uint16[Le+0]=4*ke+0,be.uint16[Le+1]=4*ke+1,be.uint16[Le+2]=4*ke+2,be.uint16[Le+3]=4*ke+2,be.uint16[Le+4]=4*ke+3,be.uint16[Le+5]=4*ke+0}return be}(B));const he=A.createIndexBuffer(Xa,!0),me=A.createVertexBuffer(ee,l.collisionCircleLayout.members,!0);for(const re of z){const Ee={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ie.draw(A,I.TRIANGLES,Gt.disabled,dn.disabled,m.colorModeForRenderPass(),yn.disabled,Ee,m.style.terrain&&m.style.terrain.getTerrainData(re.coord),h.id,me,he,l.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;me.destroy(),he.destroy()}yn.disabled=new yn(!1,1029,2305),yn.backCCW=new yn(!0,1029,2305);const Zm=l.identity(new Float32Array(16));function Xm(m,s,h,p,_,v){const{horizontalAlign:E,verticalAlign:A}=l.getAnchorAlignment(m),I=-(E-.5)*s,k=-(A-.5)*h,z=l.evaluateVariableOffset(m,p);return new l.pointGeometry((I/_+z[0])*v,(k/_+z[1])*v)}function Ud(m,s,h,p,_,v,E,A,I,k,z){const B=m.text.placedSymbolArray,U=m.text.dynamicLayoutVertexArray,ie=m.icon.dynamicLayoutVertexArray,ee={};U.clear();for(let te=0;te<B.length;te++){const he=B.get(te),me=m.allowVerticalPlacement&&!he.placedOrientation,xe=he.hidden||!he.crossTileID||me?null:p[he.crossTileID];if(xe){const re=new l.pointGeometry(he.anchorX,he.anchorY),Ee=Nt(re,h?E:v,z),be=Gi(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let ke=l.evaluateSizeForFeature(m.textSizeData,I,he)*be/l.ONE_EM;h&&(ke*=m.tilePixelRatio/A);const{width:Le,height:Fe,anchor:Ce,textOffset:et,textBoxScale:We}=xe,nt=Xm(Ce,Le,Fe,et,We,ke),Ct=h?Nt(re.add(nt),v,z).point:Ee.point.add(s?nt.rotate(-_.angle):nt),Lt=m.allowVerticalPlacement&&he.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<he.numGlyphs;_t++)l.addDynamicAttributes(U,Ct,Lt);k&&he.associatedIconIndex>=0&&(ee[he.associatedIconIndex]={shiftedAnchor:Ct,angle:Lt})}else At(he.numGlyphs,U)}if(k){ie.clear();const te=m.icon.placedSymbolArray;for(let he=0;he<te.length;he++){const me=te.get(he);if(me.hidden)At(me.numGlyphs,ie);else{const xe=ee[he];if(xe)for(let re=0;re<me.numGlyphs;re++)l.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else At(me.numGlyphs,ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(ie)}m.text.dynamicLayoutVertexBuffer.updateData(U)}function Ym(m,s,h){return h.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Jl(m,s,h,p,_,v,E,A,I,k,z,B){const U=m.context,ie=U.gl,ee=m.transform,te=A==="map",he=I==="map",me=A!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=te&&!he&&!me,re=!h.layout.get("symbol-sort-key").isConstant();let Ee=!1;const be=m.depthModeForSublayer(0,Gt.ReadOnly),ke=h.layout.get("text-variable-anchor"),Le=[];for(const Fe of p){const Ce=s.getTile(Fe),et=Ce.getBucket(h);if(!et)continue;const We=_?et.text:et.icon;if(!We||!We.segments.get().length)continue;const nt=We.programConfigurations.get(h.id),Ct=_||et.sdfIcons,Lt=_?et.textSizeData:et.iconSizeData,_t=he||ee.pitch!==0,rn=m.useProgram(Ym(Ct,_,et),nt),sn=l.evaluateSizeForZoom(Lt,ee.zoom),$t=m.style.terrain&&m.style.terrain.getTerrainData(Fe);let Ht,an,si,cs,Fr=[0,0],us=null;if(_){if(an=Ce.glyphAtlasTexture,si=ie.LINEAR,Ht=Ce.glyphAtlasTexture.size,et.iconsInText){Fr=Ce.imageAtlasTexture.size,us=Ce.imageAtlasTexture;const Er=Lt.kind==="composite"||Lt.kind==="camera";cs=_t||m.options.rotating||m.options.zooming||Er?ie.LINEAR:ie.NEAREST}}else{const Er=h.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;an=Ce.imageAtlasTexture,si=Ct||m.options.rotating||m.options.zooming||Er||_t?ie.LINEAR:ie.NEAREST,Ht=Ce.imageAtlasTexture.size}const Qs=Mn(Ce,1,m.transform.zoom),wr=rs(Fe.posMatrix,he,te,m.transform,Qs),Hi=wi(Fe.posMatrix,he,te,m.transform,Qs),Is=ke&&et.hasTextData(),oc=h.layout.get("icon-text-fit")!=="none"&&Is&&et.hasIconData();if(me){const Er=m.style.terrain?(Gu,ua)=>m.style.terrain.getElevation(Fe,Gu,ua):null,Eo=h.layout.get("text-rotation-alignment")==="map";Li(et,Fe.posMatrix,m,_,wr,Hi,he,k,Eo,Er)}const Kn=m.translatePosMatrix(Fe.posMatrix,Ce,v,E),Bt=me||_&&ke||oc?Zm:wr,en=m.translatePosMatrix(Hi,Ce,v,E,!0),oi=Ct&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ai;ai=Ct?et.iconsInText?kd(Lt.kind,sn,xe,he,m,Kn,Bt,en,Ht,Fr):Hl(Lt.kind,sn,xe,he,m,Kn,Bt,en,_,Ht,!0):gu(Lt.kind,sn,xe,he,m,Kn,Bt,en,_,Ht);const xn={program:rn,buffers:We,uniformValues:ai,atlasTexture:an,atlasTextureIcon:us,atlasInterpolation:si,atlasInterpolationIcon:cs,isSDF:Ct,hasHalo:oi};if(re&&et.canOverlap){Ee=!0;const Er=We.segments.get();for(const Eo of Er)Le.push({segments:new l.SegmentVector([Eo]),sortKey:Eo.sortKey,state:xn,terrainData:$t})}else Le.push({segments:We.segments,sortKey:0,state:xn,terrainData:$t})}Ee&&Le.sort((Fe,Ce)=>Fe.sortKey-Ce.sortKey);for(const Fe of Le){const Ce=Fe.state;if(U.activeTexture.set(ie.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,ie.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(U.activeTexture.set(ie.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Ce.isSDF){const et=Ce.uniformValues;Ce.hasHalo&&(et.u_is_halo=1,Ya(Ce.buffers,Fe.segments,h,m,Ce.program,be,z,B,et,Fe.terrainData)),et.u_is_halo=0}Ya(Ce.buffers,Fe.segments,h,m,Ce.program,be,z,B,Ce.uniformValues,Fe.terrainData)}}function Ya(m,s,h,p,_,v,E,A,I,k){const z=p.context;_.draw(z,z.gl.TRIANGLES,v,E,A,yn.disabled,I,k,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ka(m,s,h,p,_,v,E){const A=m.context.gl,I=h.paint.get("fill-pattern"),k=I&&I.constantOr(1),z=h.getCrossfadeParameters();let B,U,ie,ee,te;E?(U=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(U=k?"fillPattern":"fill",B=A.TRIANGLES);for(const he of p){const me=s.getTile(he);if(k&&!me.patternsLoaded())continue;const xe=me.getBucket(h);if(!xe)continue;const re=xe.programConfigurations.get(h.id),Ee=m.useProgram(U,re),be=m.style.terrain&&m.style.terrain.getTerrainData(he);k&&(m.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),re.updatePaintBuffers(z));const ke=I.constantOr(null);if(ke&&me.imageAtlas){const Ce=me.imageAtlas,et=Ce.patternPositions[ke.to.toString()],We=Ce.patternPositions[ke.from.toString()];et&&We&&re.setConstantPatternPositions(et,We)}const Le=be?he:null,Fe=m.translatePosMatrix(Le?Le.posMatrix:he.posMatrix,me,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ee=xe.indexBuffer2,te=xe.segments2;const Ce=[A.drawingBufferWidth,A.drawingBufferHeight];ie=U==="fillOutlinePattern"&&k?Wa(Fe,m,z,me,Ce):ea(Fe,Ce)}else ee=xe.indexBuffer,te=xe.segments,ie=k?Qo(Fe,m,z,me):Jo(Fe);Ee.draw(m.context,B,_,m.stencilModeForClipping(he),v,yn.disabled,ie,be,h.id,xe.layoutVertexBuffer,ee,te,h.paint,m.transform.zoom,re)}}function Ja(m,s,h,p,_,v,E){const A=m.context,I=A.gl,k=h.paint.get("fill-extrusion-pattern"),z=k.constantOr(1),B=h.getCrossfadeParameters(),U=h.paint.get("fill-extrusion-opacity");for(const ie of p){const ee=s.getTile(ie),te=ee.getBucket(h);if(!te)continue;const he=m.style.terrain&&m.style.terrain.getTerrainData(ie),me=te.programConfigurations.get(h.id),xe=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",me);z&&(m.context.activeTexture.set(I.TEXTURE0),ee.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),me.updatePaintBuffers(B));const re=k.constantOr(null);if(re&&ee.imageAtlas){const Le=ee.imageAtlas,Fe=Le.patternPositions[re.to.toString()],Ce=Le.patternPositions[re.from.toString()];Fe&&Ce&&me.setConstantPatternPositions(Fe,Ce)}const Ee=m.translatePosMatrix(ie.posMatrix,ee,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),be=h.paint.get("fill-extrusion-vertical-gradient"),ke=z?zr(Ee,m,be,U,ie,B,ee):Ws(Ee,m,be,U);xe.draw(A,A.gl.TRIANGLES,_,v,E,yn.backCCW,ke,he,h.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,h.paint,m.transform.zoom,me,m.style.terrain&&te.centroidVertexBuffer)}}function Cu(m,s,h,p,_,v,E){const A=m.context,I=A.gl,k=h.fbo;if(!k)return;const z=m.useProgram("hillshade"),B=m.style.terrain&&m.style.terrain.getTerrainData(s);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),z.draw(A,I.TRIANGLES,_,v,E,yn.disabled,((U,ie,ee,te)=>{const he=ee.paint.get("hillshade-shadow-color"),me=ee.paint.get("hillshade-highlight-color"),xe=ee.paint.get("hillshade-accent-color");let re=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=U.transform.angle);const Ee=!U.options.moving;return{u_matrix:te?te.posMatrix:U.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Se(0,ie.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),re],u_shadow:he,u_highlight:me,u_accent:xe}})(m,h,p,B?s:null),B,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Vd(m,s,h,p,_,v){const E=m.context,A=E.gl,I=s.dem;if(I&&I.data){const k=I.dim,z=I.stride,B=I.getPixels();if(E.activeTexture.set(A.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(z),s.demTexture){const ie=s.demTexture;ie.update(B,{premultiply:!1}),ie.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else s.demTexture=new ne(E,B,A.RGBA,{premultiply:!1}),s.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);E.activeTexture.set(A.TEXTURE0);let U=s.fbo;if(!U){const ie=new ne(E,{width:k,height:k,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),U=s.fbo=E.createFramebuffer(k,k,!0),U.colorAttachment.set(ie.texture)}E.bindFramebuffer.set(U.framebuffer),E.viewport.set([0,0,k,k]),m.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,p,_,v,yn.disabled,((ie,ee)=>{const te=ee.stride,he=l.create();return l.ortho(he,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(he,he,[0,-l.EXTENT,0]),{u_matrix:he,u_image:1,u_dimension:[te,te],u_zoom:ie.overscaledZ,u_unpack:ee.getUnpackVector()}})(s.tileID,I),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Ql(m,s,h,p,_,v){const E=p.paint.get("raster-fade-duration");if(!v&&E>0){const A=l.exported.now(),I=(A-m.timeAdded)/E,k=s?(A-s.timeAdded)/E:-1,z=h.getSource(),B=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),U=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),ie=U&&m.refreshedUponExpiration?1:l.clamp(U?I:1-k,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const ec=new l.Color(1,0,0,1),Or=new l.Color(0,1,0,1),jd=new l.Color(0,0,1,1),Mu=new l.Color(1,0,1,1),Gd=new l.Color(0,1,1,1);function xo(m,s,h,p){sa(m,0,s+h/2,m.transform.width,h,p)}function Qa(m,s,h,p){sa(m,s-h/2,0,h,m.transform.height,p)}function sa(m,s,h,p,_,v){const E=m.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(s*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),E.clear({color:v}),A.disable(A.SCISSOR_TEST)}function Km(m,s,h){const p=m.context,_=p.gl,v=h.posMatrix,E=m.useProgram("debug"),A=Gt.disabled,I=dn.disabled,k=m.colorModeForRenderPass(),z="$debug",B=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const U=s.getTileByID(h.key).latestRawTileData,ie=Math.floor((U&&U.byteLength||0)/1024),ee=s.getTile(h).tileSize,te=512/Math.min(ee,512)*(h.overscaledZ/m.transform.zoom)*.5;let he=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(he+=` => ${h.overscaledZ}`),function(me,xe){me.initDebugOverlayCanvas();const re=me.debugOverlayCanvas,Ee=me.context.gl,be=me.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,re.width,re.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(xe,5,5),be.strokeText(xe,5,5),me.debugOverlayTexture.update(re),me.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(m,`${he} ${ie}kB`),E.draw(p,_.TRIANGLES,A,I,mn.alphaBlended,yn.disabled,j(v,l.Color.transparent,te),null,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),E.draw(p,_.LINE_STRIP,A,I,k,yn.disabled,j(v,l.Color.red),B,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function tc(m,s,h){const p=m.context,_=p.gl,v=m.colorModeForRenderPass(),E=new Gt(_.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D),A=m.useProgram("terrain"),I=s.getTerrainMesh(),k=s.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,s.getRTTFramebuffer().colorAttachment.get());const z=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());A.draw(p,_.TRIANGLES,E,dn.disabled,v,yn.backCCW,{u_matrix:z,u_texture:0},k,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function $d(m,s,h,p){const _=m.context,v=h.tileSize*s.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(v)||new ne(_,{width:v,height:v,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&s.sourceCache.renderHistory.unshift(h.tileID.key));const E=s.getRTTFramebuffer();E.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,v,v])}class Hd{constructor(s){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=s,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=s.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const s=this.painter.style,h=s.terrain;for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const _=s.sourceCaches[p].getVisibleCoordinates();for(const v of _){const E=h.sourceCache.getTerrainCoords(v);for(const A in E)this._coordsDescendingInv[p][A]||(this._coordsDescendingInv[p][A]=[]),this._coordsDescendingInv[p][A].push(E[A])}}for(const p of s._order){const _=s._layers[p],v=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(A=>A.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[_][p.tileID.key];v&&v!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(s){const h=s.type,p=this.painter,_=p.style._order,v=p.currentLayer,E=v+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[v]),!E))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&E){this._prevType=h;const A=this._stacks.length-1,I=this._stacks[A]||[];for(const k of this._renderableTiles){if($d(p,p.style.terrain,k,A),this._rerender[k.tileID.key]){p.context.clear({color:l.Color.transparent});for(let z=0;z<I.length;z++){const B=p.style._layers[I[z]],U=B.source?this._coordsDescendingInv[B.source][k.tileID.key]:[k.tileID];p._renderTileClippingMasks(B,U),p.renderLayer(p,p.style.sourceCaches[B.source],B,U),B.source&&(k.textureCoords[B.source]=this._coordsDescendingInvStr[B.source][k.tileID.key])}}tc(p,p.style.terrain,k)}if(h==="hillshade"){this._stacks.push([_[v]]);for(const k of this._renderableTiles){const z=this._coordsDescendingInv[s.source][k.tileID.key];$d(p,p.style.terrain,k,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(s,z),p.renderLayer(p,p.style.sourceCaches[s.source],s,z),tc(p,p.style.terrain,k)}return!0}return this._renderToTexture[h]}return!1}}const el={symbol:function(m,s,h,p,_){if(m.renderPass!=="translucent")return;const v=dn.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,I,k,z,B,U,ie){const ee=I.transform,te=B==="map",he=U==="map";for(const me of A){const xe=z.getTile(me),re=xe.getBucket(k);if(!re||!re.text||!re.text.segments.get().length)continue;const Ee=l.evaluateSizeForZoom(re.textSizeData,ee.zoom),be=Mn(xe,1,I.transform.zoom),ke=rs(me.posMatrix,he,te,I.transform,be),Le=k.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Ee){const Fe=Math.pow(2,ee.zoom-xe.tileID.overscaledZ);Ud(re,te,he,ie,ee,ke,me.posMatrix,Fe,Ee,Le,I.style.terrain?(Ce,et)=>I.style.terrain.getElevation(me,Ce,et):null)}}}(p,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&Jl(m,s,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),v,E),h.paint.get("text-opacity").constantOr(1)!==0&&Jl(m,s,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),v,E),s.map.showCollisionBoxes&&(ra(m,s,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ra(m,s,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),v=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),A=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(v.constantOr(1)===0||E.constantOr(1)===0))return;const I=m.context,k=I.gl,z=m.depthModeForSublayer(0,Gt.ReadOnly),B=dn.disabled,U=m.colorModeForRenderPass(),ie=[];for(let ee=0;ee<p.length;ee++){const te=p[ee],he=s.getTile(te),me=he.getBucket(h);if(!me)continue;const xe=me.programConfigurations.get(h.id),re=m.useProgram("circle",xe),Ee=me.layoutVertexBuffer,be=me.indexBuffer,ke=m.style.terrain&&m.style.terrain.getTerrainData(te),Le={programConfiguration:xe,program:re,layoutVertexBuffer:Ee,indexBuffer:be,uniformValues:$l(m,te,he,h),terrainData:ke};if(A){const Fe=me.segments.get();for(const Ce of Fe)ie.push({segments:new l.SegmentVector([Ce]),sortKey:Ce.sortKey,state:Le})}else ie.push({segments:me.segments,sortKey:0,state:Le})}A&&ie.sort((ee,te)=>ee.sortKey-te.sortKey);for(const ee of ie){const{programConfiguration:te,program:he,layoutVertexBuffer:me,indexBuffer:xe,uniformValues:re,terrainData:Ee}=ee.state;he.draw(I,k.TRIANGLES,z,B,U,yn.disabled,re,Ee,h.id,me,xe,ee.segments,h.paint,m.transform.zoom,te)}},heatmap:function(m,s,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,v=_.gl,E=dn.disabled,A=new mn([v.ONE,v.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(I,k,z){const B=I.gl;I.activeTexture.set(B.TEXTURE1),I.viewport.set([0,0,k.width/4,k.height/4]);let U=z.heatmapFbo;if(U)B.bindTexture(B.TEXTURE_2D,U.colorAttachment.get()),I.bindFramebuffer.set(U.framebuffer);else{const ie=B.createTexture();B.bindTexture(B.TEXTURE_2D,ie),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),U=z.heatmapFbo=I.createFramebuffer(k.width/4,k.height/4,!1),function(ee,te,he,me){const xe=ee.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,te.width/4,te.height/4,0,xe.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),me.colorAttachment.set(he)}(I,k,ie,U)}})(_,m,h),_.clear({color:l.Color.transparent});for(let I=0;I<p.length;I++){const k=p[I];if(s.hasRenderableParent(k))continue;const z=s.getTile(k),B=z.getBucket(h);if(!B)continue;const U=B.programConfigurations.get(h.id),ie=m.useProgram("heatmap",U),{zoom:ee}=m.transform;ie.draw(_,v.TRIANGLES,Gt.disabled,E,A,yn.disabled,ce(k.posMatrix,z,ee,h.paint.get("heatmap-intensity")),null,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,m.transform.zoom,U)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,v){const E=_.context,A=E.gl,I=v.heatmapFbo;if(!I)return;E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),E.activeTexture.set(A.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new ne(E,v.colorRamp,A.RGBA)),k.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,A.TRIANGLES,Gt.disabled,dn.disabled,_.colorModeForRenderPass(),yn.disabled,((z,B,U,ie)=>{const ee=l.create();l.ortho(ee,0,z.width,z.height,0,0,1);const te=z.context.gl;return{u_matrix:ee,u_world:[te.drawingBufferWidth,te.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(_,v),null,v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(m,h))},line:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),v=h.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,Gt.ReadOnly),A=m.colorModeForRenderPass(),I=h.paint.get("line-dasharray"),k=h.paint.get("line-pattern"),z=k.constantOr(1),B=h.paint.get("line-gradient"),U=h.getCrossfadeParameters(),ie=z?"linePattern":I?"lineSDF":B?"lineGradient":"line",ee=m.context,te=ee.gl;let he=!0;for(const me of p){const xe=s.getTile(me);if(z&&!xe.patternsLoaded())continue;const re=xe.getBucket(h);if(!re)continue;const Ee=re.programConfigurations.get(h.id),be=m.context.program.get(),ke=m.useProgram(ie,Ee),Le=he||ke.program!==be,Fe=m.style.terrain&&m.style.terrain.getTerrainData(me),Ce=k.constantOr(null);if(Ce&&xe.imageAtlas){const nt=xe.imageAtlas,Ct=nt.patternPositions[Ce.to.toString()],Lt=nt.patternPositions[Ce.from.toString()];Ct&&Lt&&Ee.setConstantPatternPositions(Ct,Lt)}const et=Fe?me:null,We=z?Ft(m,xe,h,U,et):I?En(m,xe,h,I,U,et):B?ot(m,xe,h,re.lineClipsArray.length,et):Ne(m,xe,h,et);if(z)ee.activeTexture.set(te.TEXTURE0),xe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ee.updatePaintBuffers(U);else if(I&&(Le||m.lineAtlas.dirty))ee.activeTexture.set(te.TEXTURE0),m.lineAtlas.bind(ee);else if(B){const nt=re.gradients[h.id];let Ct=nt.texture;if(h.gradientVersion!==nt.version){let Lt=256;if(h.stepInterpolant){const _t=s.getSource().maxzoom,rn=me.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-me.canonical.z):1;Lt=l.clamp(l.nextPowerOfTwo(re.maxLineLength/l.EXTENT*1024*rn),256,ee.maxTextureSize)}nt.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:nt.gradient||void 0,clips:re.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new ne(ee,nt.gradient,te.RGBA),nt.version=h.gradientVersion,Ct=nt.texture}ee.activeTexture.set(te.TEXTURE0),Ct.bind(h.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}ke.draw(ee,te.TRIANGLES,E,m.stencilModeForClipping(me),A,yn.disabled,We,Fe,h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,m.transform.zoom,Ee,re.layoutVertexBuffer2),he=!1}},fill:function(m,s,h,p){const _=h.paint.get("fill-color"),v=h.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),I=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===I){const k=m.depthModeForSublayer(1,m.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly);Ka(m,s,h,p,k,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly);Ka(m,s,h,p,k,E,!0)}},"fill-extrusion":function(m,s,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const v=new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Ja(m,s,h,p,v,dn.disabled,mn.disabled),Ja(m,s,h,p,v,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();Ja(m,s,h,p,v,dn.disabled,E)}}},hillshade:function(m,s,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,v=m.depthModeForSublayer(0,Gt.ReadOnly),E=m.colorModeForRenderPass(),[A,I]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const k of I){const z=s.getTile(k);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&m.renderPass==="offscreen"?Vd(m,z,h,v,dn.disabled,E):m.renderPass==="translucent"&&Cu(m,k,z,h,v,A[k.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,s,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,v=_.gl,E=s.getSource(),A=m.useProgram("raster"),I=m.colorModeForRenderPass(),[k,z]=E instanceof wt?[{},p]:m.stencilConfigForOverlap(p),B=z[z.length-1].overscaledZ,U=!m.options.moving;for(const ie of z){const ee=m.depthModeForSublayer(ie.overscaledZ-B,h.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,v.LESS),te=s.getTile(ie);te.registerFadeDuration(h.paint.get("raster-fade-duration"));const he=s.findLoadedParent(ie,0),me=Ql(te,he,s,h,m.transform,m.style.terrain);let xe,re;const Ee=h.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;_.activeTexture.set(v.TEXTURE0),te.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(v.TEXTURE1),he?(he.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,he.tileID.overscaledZ-te.tileID.overscaledZ),re=[te.tileID.canonical.x*xe%1,te.tileID.canonical.y*xe%1]):te.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const be=m.style.terrain&&m.style.terrain.getTerrainData(ie),ke=be?ie:null,Le=ke?ke.posMatrix:m.transform.calculatePosMatrix(ie.toUnwrapped(),U),Fe=rr(Le,re||[0,0],xe||1,me,h);E instanceof wt?A.draw(_,v.TRIANGLES,ee,dn.disabled,I,yn.disabled,Fe,be,h.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):A.draw(_,v.TRIANGLES,ee,k[ie.overscaledZ],I,yn.disabled,Fe,be,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,s,h,p){const _=h.paint.get("background-color"),v=h.paint.get("background-opacity");if(v===0)return;const E=m.context,A=E.gl,I=m.transform,k=I.tileSize,z=h.paint.get("background-pattern");if(m.isPatternMissing(z))return;const B=!z&&_.a===1&&v===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const U=dn.disabled,ie=m.depthModeForSublayer(0,B==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ee=m.colorModeForRenderPass(),te=m.useProgram(z?"backgroundPattern":"background"),he=p||I.coveringTiles({tileSize:k,terrain:m.style.terrain});z&&(E.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));const me=h.getCrossfadeParameters();for(const xe of he){const re=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Ee=z?Um(re,v,m,z,{tileID:xe,tileSize:k},me):Nm(re,v,_),be=m.style.terrain&&m.style.terrain.getTerrainData(xe);te.draw(E,A.TRIANGLES,ie,U,ee,yn.disabled,Ee,be,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,s,h){for(let p=0;p<h.length;p++)Km(m,s,h[p])},custom:function(m,s,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const v=_.prerender;v&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),v.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(dn.disabled);const v=_.renderingMode==="3d"?new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Gt.ReadOnly);p.setDepthMode(v),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class ku{constructor(s,h){this.context=new Nd(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Wt.maxUnderzooming+Wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dt,this.gpuTimers={}}resize(s,h,p){if(this.width=s*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const s=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,Mt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Mt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(_,tt.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const v=new l.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Mt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const A=new l.TriangleIndexArray;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A),this.emptyTexture=new ne(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new dn({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,Gt.disabled,this.stencilClearMode,mn.disabled,yn.disabled,X(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(mn.disabled),p.setDepthMode(Gt.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(E);v.draw(p,_.TRIANGLES,Gt.disabled,new dn({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),mn.disabled,yn.disabled,X(E.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new dn({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new dn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,p=s.sort((E,A)=>A.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let A=0;A<v;A++)E[A+_]=new dn({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:dn.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new mn([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}depthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return Gt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Gt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,v=this.style.terrain&&new Hd(this);for(const k in _){const z=_[k];z.used&&z.prepare(this.context)}const E={},A={},I={};for(const k in _){const z=_[k];E[k]=z.getVisibleCoordinates(),A[k]=E[k].slice().reverse(),I[k]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<p.length;k++)if(this.style._layers[p[k]].is3D()){this.opaquePassCutoff=k;break}if(v){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,B){const U=z.context,ie=U.gl,ee=mn.unblended,te=new Gt(ie.LEQUAL,Gt.ReadWrite,[0,1]),he=B.getTerrainMesh(),me=B.sourceCache.getRenderableTiles(),xe=z.useProgram("terrainDepth");U.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:l.Color.transparent,depth:1});for(const re of me){const Ee=B.getTerrainData(re.tileID),be=z.transform.calculatePosMatrix(re.tileID.toUnwrapped());xe.draw(U,ie.TRIANGLES,te,dn.disabled,ee,yn.backCCW,{u_matrix:be},Ee,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,B){const U=z.context,ie=U.gl,ee=mn.unblended,te=new Gt(ie.LEQUAL,Gt.ReadWrite,[0,1]),he=B.getTerrainMesh(),me=B.getCoordsTexture(),xe=B.sourceCache.getRenderableTiles(),re=z.useProgram("terrainCoords");U.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:l.Color.transparent,depth:1}),B.coordsIndex=[];for(const Ee of xe){const be=B.getTerrainData(Ee.tileID);U.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,me.texture);const ke=z.transform.calculatePosMatrix(Ee.tileID.toUnwrapped());re.draw(U,ie.TRIANGLES,te,dn.disabled,ee,yn.backCCW,{u_matrix:ke,u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0},be,"terrain",he.vertexBuffer,he.indexBuffer,he.segments),B.coordsIndex.push(Ee.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of p){const z=this.style._layers[k];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const B=A[z.source];(z.type==="custom"||B.length)&&this.renderLayer(this,_[z.source],z,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[p[this.currentLayer]],z=_[k.source],B=E[k.source];this._renderTileClippingMasks(k,B),this.renderLayer(this,z,k,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const k=this.style._layers[p[this.currentLayer]],z=_[k.source];if(v&&v.renderLayer(k))continue;const B=(k.type==="symbol"?I:A)[k.source];this._renderTileClippingMasks(k,E[k.source]),this.renderLayer(this,z,k,B)}if(this.options.showTileBoundaries){let k,z;Object.values(this.style._layers).forEach(B=>{B.source&&!B.isHidden(this.transform.zoom)&&(B.source!==(z&&z.id)&&(z=this.style.sourceCaches[B.source]),(!k||k.getSource().maxzoom<z.getSource().maxzoom)&&(k=z))}),k&&el.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const z=k.transform.padding;xo(k,k.transform.height-(z.top||0),3,ec),xo(k,z.bottom||0,3,Or),Qa(k,z.left||0,3,jd),Qa(k,k.transform.width-(z.right||0),3,Mu);const B=k.transform.centerPoint;(function(U,ie,ee,te){sa(U,ie-1,ee-10,2,20,te),sa(U,ie-10,ee-1,20,2,te)})(k,B.x,k.transform.height-B.y,Gd)}(this),this.context.setDefault()}renderLayer(s,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),el[p.type](s,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const p in s){const _=s[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),h[p]=E}return h}translatePosMatrix(s,h,p,_,v){if(!p[0]&&!p[1])return s;const E=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const k=Math.sin(E),z=Math.cos(E);p=[p[0]*z-p[1]*k,p[0]*k+p[1]*z]}const A=[v?p[0]:Mn(h,p[0],this.transform.zoom),v?p[1]:Mn(h,p[1],this.transform.zoom),0],I=new Float32Array(16);return l.translate(I,s,A),I}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h){this.cache=this.cache||{};const p=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Yo(this.context,s,di[s],h,_u[s],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class nc{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,p){const _=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=1/(A=l.transformMat4([],A,s))[3]/h*_;return l.mul$1(A,A,[I,I,1/A[3],I])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=l.sub([],v[A[0]],v[A[1]]),k=l.sub([],v[A[2]],v[A[1]]),z=l.normalize([],l.cross([],I,k)),B=-l.dot(z,v[A[1]]);return z.concat(B)});return new nc(v,E)}}class tl{constructor(s,h){this.min=s,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],_[v]=h[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new tl(p,_)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<s.planes.length;_++){const v=s.planes[_];let E=0;for(let A=0;A<h.length;A++)l.dot$1(v,h[A])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A=0;A<s.points.length;A++){const I=s.points[A][_]-this.min[_];v=Math.min(v,I),E=Math.max(E,I)}if(E<0||v>this.max[_]-this.min[_])return 0}return 1}}class oa{constructor(s=0,h=0,p=0,_=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=_}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,p)),this}getCenter(s,h){const p=l.clamp((this.left+s-this.right)/2,0,s),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new oa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class nl{constructor(s,h,p,_,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new oa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new nl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-l.wrap(s,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,E){var A=v[0],I=v[1],k=v[2],z=v[3],B=Math.sin(E),U=Math.cos(E);_[0]=A*U+k*B,_[1]=I*U+z*B,_[2]=A*-B+k*U,_[3]=I*-B+z*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),v=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,_.x,v.x,E.x)),I=Math.floor(Math.max(p.x,_.x,v.x,E.x)),k=1;for(let z=A-k;z<=I+k;z++)z!==0&&h.push(new l.UnwrappedTileID(z,s))}return h}coveringTiles(s){var h,p;let _=this.coveringZoomLevel(s);const v=_;if(s.minzoom!==void 0&&_<s.minzoom)return[];s.maxzoom!==void 0&&_>s.maxzoom&&(_=s.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),A=l.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,_),k=[I*E.x,I*E.y,0],z=[I*A.x,I*A.y,0],B=nc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let U=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=_);const ie=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ee=re=>({aabb:new tl([re*I,0,0],[(re+1)*I,I,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),te=[],he=[],me=_,xe=s.reparseOverscaled?v:_;if(this._renderWorldCopies)for(let re=1;re<=3;re++)te.push(ee(-re)),te.push(ee(re));for(te.push(ee(0));te.length>0;){const re=te.pop(),Ee=re.x,be=re.y;let ke=re.fullyVisible;if(!ke){const nt=re.aabb.intersects(B);if(nt===0)continue;ke=nt===2}const Le=s.terrain?k:z,Fe=re.aabb.distanceX(Le),Ce=re.aabb.distanceY(Le),et=Math.max(Math.abs(Fe),Math.abs(Ce)),We=ie+(1<<me-re.zoom)-2;if(re.zoom===me||et>We&&re.zoom>=U){const nt=me-re.zoom,Ct=k[0]-.5-(Ee<<nt),Lt=k[1]-.5-(be<<nt);he.push({tileID:new l.OverscaledTileID(re.zoom===me?xe:re.zoom,re.wrap,re.zoom,Ee,be),distanceSq:l.sqrLen([z[0]-.5-Ee,z[1]-.5-be]),tileDistanceToCamera:Math.sqrt(Ct*Ct+Lt*Lt)})}else for(let nt=0;nt<4;nt++){const Ct=(Ee<<1)+nt%2,Lt=(be<<1)+(nt>>1),_t=re.zoom+1;let rn=re.aabb.quadrant(nt);if(s.terrain){const sn=new l.OverscaledTileID(_t,re.wrap,_t,Ct,Lt),$t=s.terrain.getMinMaxElevation(sn),Ht=(h=$t.minElevation)!==null&&h!==void 0?h:this.elevation,an=(p=$t.maxElevation)!==null&&p!==void 0?p:this.elevation;rn=new tl([rn.min[0],rn.min[1],Ht],[rn.max[0],rn.max[1],an])}te.push({aabb:rn,zoom:_t,x:Ct,y:Lt,wrap:re.wrap,fullyVisible:ke})}}return he.sort((re,Ee)=>re.distanceSq-Ee.distanceSq).map(re=>re.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(s.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new l.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,h){const p=l.MercatorCoordinate.fromLngLat(s),_=(1<<this.tileZoom)*l.EXTENT,v=p.x*_,E=p.y*_,A=Math.floor(v/l.EXTENT),I=Math.floor(E/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,A,I);return h.getElevation(k,v%l.EXTENT,E%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),p=this.getElevation(h,s);if(!(this.elevation-p))return;const _=this.getCameraPosition(),v=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),E=l.MercatorCoordinate.fromLngLat(h,p),A=v.x-E.x,I=v.y-E.y,k=v.z-E.z,z=Math.sqrt(A*A+I*I+k*k),B=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=p,this._center=h,this.zoom=B}setLocationAtPoint(s,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),E=new l.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return l.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const U=h.pointCoordinate(s);if(U!=null)return U}const p=[s.x,s.y,0,1],_=[s.x,s.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const v=p[3],E=_[3],A=p[1]/v,I=_[1]/E,k=p[2]/v,z=_[2]/E,B=k===z?0:(0-k)/(z-k);return new l.MercatorCoordinate(l.number(p[0]/v,_[0]/E,B)/this.worldSize,l.number(A,I,B)/this.worldSize)}coordinatePoint(s,h=0,p=this.pixelMatrix){const _=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,s))).extend(this.pointLocation(new l.pointGeometry(this.width,s))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const p=s.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const v=s.canonical,E=this.worldSize/this.zoomScale(v.z),A=v.x+Math.pow(2,v.z)*s.wrap,I=l.identity(new Float64Array(16));return l.translate(I,I,[A*E,v.y*E,0]),l.scale(I,I,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(I,h?this.alignedProjMatrix:this.projMatrix,I),_[p]=new Float32Array(I),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,p,_,v=-90,E=90,A=-180,I=180;const k=this.size,z=this._unmodified;if(this.latRange){const ie=this.latRange;v=l.mercatorYfromLat(ie[1])*this.worldSize,E=l.mercatorYfromLat(ie[0])*this.worldSize,s=E-v<k.y?k.y/(E-v):0}if(this.lngRange){const ie=this.lngRange;A=l.wrap(l.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),I=l.wrap(l.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),I<A&&(I+=this.worldSize),h=I-A<k.x?k.x/(I-A):0}const B=this.point,U=Math.max(h||0,s||0);if(U)return this.center=this.unproject(new l.pointGeometry(h?(I+A)/2:B.x,s?(E+v)/2:B.y)),this.zoom+=this.scaleZoom(U),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const ie=B.y,ee=k.y/2;ie-ee<v&&(_=v+ee),ie+ee>E&&(_=E-ee)}if(this.lngRange){const ie=(A+I)/2,ee=l.wrap(B.x,ie-this.worldSize/2,ie+this.worldSize/2),te=k.x/2;ee-te<A&&(p=A+te),ee+te>I&&(p=I-te)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:B.x,_!==void 0?_:B.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,E=this._fov*(.5+s.y/this.height),A=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-E,.01,Math.PI-.01)),I=this.getHorizon(),k=2*Math.atan(I/this.cameraToCenterDistance)*(.5+s.y/(2*I)),z=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-k,.01,Math.PI-.01)),B=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,U=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,ie=1.01*Math.min(B,U),ee=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,ee,ie),_[8]=2*-s.x/this.width,_[9]=2*s.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const te=this.width%2/2,he=this.height%2/2,me=Math.cos(this.angle),xe=Math.sin(this.angle),re=h-Math.round(h)+me*te+xe*he,Ee=p-Math.round(p)+me*he+xe*te,be=new Float64Array(_);if(l.translate(be,be,[re>.5?re-1:re,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=be,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.pointGeometry(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let p=h.x,_=h.y,v=h.x,E=h.y;for(const A of s)p=Math.min(p,A.x),_=Math.min(_,A.y),v=Math.max(v,A.x),E=Math.max(E,A.y);return[new l.pointGeometry(p,_),new l.pointGeometry(v,_),new l.pointGeometry(v,E),new l.pointGeometry(p,E),new l.pointGeometry(p,_)]}}}class Wd{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,v=null;const E=()=>{v=null,_&&(h(),v=setTimeout(E,300),_=!1)};return()=>(_=!0,v||E(),v)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),E=Math.round(h.lng*v)/v,A=Math.round(h.lat*v)/v,I=this._map.getBearing(),k=this._map.getPitch();let z="";if(z+=s?`/${E}/${A}/${p}`:`${p}/${A}/${E}`,(I||k)&&(z+="/"+Math.round(10*I)/10),k&&(z+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let U=!1;const ie=window.location.hash.slice(1).split("&").map(ee=>{const te=ee.split("=")[0];return te===B?(U=!0,`${te}=${z}`):ee}).filter(ee=>ee);return U||ie.push(`${B}=${z}`),`#${ie.join("&")}`}return`#${z}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const il={linearity:.3,easing:l.bezier(0,0,.3,1)},qd=l.extend({deceleration:2500,maxSpeed:1400},il),Zd=l.extend({deceleration:20,maxSpeed:1400},il),Xd=l.extend({deceleration:1e3,maxSpeed:360},il),aa=l.extend({deceleration:1e3,maxSpeed:90},il);class Yd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const v=sl(h.pan.mag(),p,l.extend({},qd,s||{}));_.offset=h.pan.mult(v.amount/h.pan.mag()),_.center=this._map.transform.center,rl(_,v)}if(h.zoom){const v=sl(h.zoom,p,Zd);_.zoom=this._map.transform.zoom+v.amount,rl(_,v)}if(h.bearing){const v=sl(h.bearing,p,Xd);_.bearing=this._map.transform.bearing+l.clamp(v.amount,-179,179),rl(_,v)}if(h.pitch){const v=sl(h.pitch,p,aa);_.pitch=this._map.transform.pitch+v.amount,rl(_,v)}if(_.zoom||_.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function rl(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function sl(m,s,h){const{maxSpeed:p,linearity:_,deceleration:v}=h,E=l.clamp(m*_/(s/1e3),-p,p),A=Math.abs(E)/(v*_);return{easing:h.easing,duration:1e3*A,amount:E*(A/2)}}class or extends l.Event{constructor(s,h,p,_={}){const v=C.mousePos(h.getCanvasContainer(),p),E=h.unproject(v);super(s,l.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ol extends l.Event{constructor(s,h,p){const _=s==="touchend"?p.changedTouches:p.touches,v=C.touchPos(h.getCanvasContainer(),_),E=v.map(I=>h.unproject(I)),A=v.reduce((I,k,z,B)=>I.add(k.div(B.length)),new l.pointGeometry(0,0));super(s,{points:v,point:A,lngLats:E,lngLat:h.unproject(A),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ar extends l.Event{constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Jm{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new ar(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new or(s.type,this._map,s))}mouseup(s){this._map.fire(new or(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new or(s.type,this._map,s))}dblclick(s){return this._firePreventable(new or(s.type,this._map,s))}mouseover(s){this._map.fire(new or(s.type,this._map,s))}mouseout(s){this._map.fire(new or(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ol(s.type,this._map,s))}touchmove(s){this._map.fire(new ol(s.type,this._map,s))}touchend(s){this._map.fire(new ol(s.type,this._map,s))}touchcancel(s){this._map.fire(new ol(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new or(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new or(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kd{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(_.x,p.x),E=Math.max(_.x,p.x),A=Math.min(_.y,p.y),I=Math.max(_.y,p.y);C.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=E-v+"px",this._box.style.height=I-A+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,_=h;if(this.reset(),C.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function Ss(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=s[p];return h}class al{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new l.pointGeometry(0,0);for(const E of _)v._add(E);return v.div(_.length)}(h),this.touches=Ss(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const _=Ss(p,h);for(const v in this.touches){const E=this.touches[v],A=_[v];(!A||A.dist(E)>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Lu{constructor(s){this.singleTap=new al(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const _=this.singleTap.touchend(s,h,p);if(_){const v=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Qm{constructor(){this._zoomIn=new Lu({numTouches:1,numTaps:2}),this._zoomOut=new Lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const _=this._zoomIn.touchend(s,h,p),v=this._zoomOut.touchend(s,h,p);return _?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const eg={0:1,2:2};class ic{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const p=C.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(s,h){const p=this._lastPoint;if(p){if(s.preventDefault(),function(_,v){const E=eg[v];return _.buttons===void 0||(_.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(s){this._lastPoint&&C.mouseButton(s)===this._eventButton&&(this._moved&&C.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ll extends ic{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class As extends ic{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=.8*(h.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class st extends ic{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=-.5*(h.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class Jd{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,p)}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const _=Ss(p,h),v=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let A=0;for(const k in _){const z=_[k],B=this._touches[k];B&&(v._add(z),E._add(z.sub(B)),A++,_[k]=z)}if(this._touches=_,A<this._minTouches||!E.mag())return;const I=E.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,p){return{}}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[_,v]=this._firstTwoTouches,E=Zs(p,h,_),A=Zs(p,h,v);if(!E||!A)return;const I=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],I,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,E=Zs(p,h,_),A=Zs(p,h,v);E&&A||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zs(m,s,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return s[p]}function Ru(m,s){return Math.log(m/s)/Math.LN2}class Ke extends bo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ru(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ru(this._distance,p),pinchAround:h}}}function rc(m,s){return 180*m.angleWith(s)/Math.PI}class tg extends bo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rc(this._vector,p),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=rc(s,this._startVector);return Math.abs(p)<h}}function Du(m){return Math.abs(m.y)>Math.abs(m.x)}class zu extends bo{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,Du(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const _=s.mag()>=2,v=h.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return Du(s)&&Du(h)&&E}}const Qd={panStep:100,bearingStep:15,pitchStep:10};class ef{constructor(){const s=Qd;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,_=0,v=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?_=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?_=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:ng,zoom:h?Math.round(I)+h*(s.shiftKey?2:1):I,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:A.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ng(m){return m*(2-m)}const tf=4.000244140625;class Ou{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%tf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._el,s);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>tf?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const k=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(k*I))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,_=this._easing;let v,E=!1;if(this._type==="wheel"&&p&&_){const A=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),I=_(A);v=l.number(p,h,I),A<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-E*E);h=l.bezier(E,A,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}reset(){this._active=!1}}class Fu{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bu{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(){this._tap=new Lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,h,p))}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(s,h,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $i{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xs{constructor(s,h,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nf{constructor(s,h,p,_){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const la=m=>m.zoom||m.drag||m.pitch||m.rotate;class Uu extends l.Event{}function cl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class rf{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yd(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,E]of this._listeners)C.addEventListener(_,v,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,p]of this._listeners)C.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Jm(h,s));const _=h.boxZoom=new Kd(h,s);this._add("boxZoom",_);const v=new Qm,E=new Bu;h.doubleClickZoom=new Fu(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const A=new Nu;this._add("tapDragZoom",A);const I=h.touchPitch=new zu(h);this._add("touchPitch",I);const k=new As(s),z=new st(s);h.dragRotate=new Xs(s,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new ll(s),U=new Jd(s,h);h.dragPan=new $i(p,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]);const ie=new tg,ee=new Ke;h.touchZoomRotate=new nf(p,ee,ie,A),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]);const te=h.scrollZoom=new Ou(h,this);this._add("scrollZoom",te,["mousePan"]);const he=h.keyboard=new ef;this._add("keyboard",he),this._add("blockableMapEvent",new qs(h));for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[me]&&h[me].enable(s[me])}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!la(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,p){for(const _ in s)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}handleEvent(s,h){if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},v={},E={},A=s.touches,I=A?this._getMapTouches(A):void 0,k=I?C.touchPos(this._el,I):C.mousePos(this._el,s);for(const{handlerName:U,handler:ie,allowed:ee}of this._handlers){if(!ie.isEnabled())continue;let te;this._blockedByActive(E,ee,U)?ie.reset():ie[h||s.type]&&(te=ie[h||s.type](s,k,I),this.mergeHandlerResult(_,v,te,U,p),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||ie.isActive())&&(E[U]=ie)}const z={};for(const U in this._previousActiveHandlers)E[U]||(z[U]=p);this._previousActiveHandlers=E,(Object.keys(z).length||cl(_))&&(this._changes.push([_,v,z]),this._triggerRenderFrame()),(Object.keys(E).length||cl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,h,p,_,v){if(!p)return;l.extend(s,p);const E={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const s={},h={},p={};for(const[_,v,E]of this._changes)_.panDelta&&(s.panDelta=(s.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(s.around=_.around),_.pinchAround!==void 0&&(s.pinchAround=_.pinchAround),_.noInertia&&(s.noInertia=_.noInertia),l.extend(h,v),l.extend(p,E);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const _=this._map,v=_.transform,E=_.style&&_.style.terrain;if(!(cl(s)||E&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:A,zoomDelta:I,bearingDelta:k,pitchDelta:z,around:B,pinchAround:U}=s;U!==void 0&&(B=U),_._stop(!0),B=B||_.transform.centerPoint;const ie=v.pointLocation(A?B.sub(A):B);k&&(v.bearing+=k),z&&(v.pitch+=z),I&&(v.zoom+=I),E?h.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(B),point:B,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(A))):v.setLocationAtPoint(ie,B),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const _=la(this._eventsInProgress),v=la(s),E={};for(const z in s){const{originalEvent:B}=s[z];this._eventsInProgress[z]||(E[`${z}start`]=B),this._eventsInProgress[z]=s[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in E)this._fireEvent(z,E[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in s){const{originalEvent:B}=s[z];this._fireEvent(z,B)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:U}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],I=h[B]||U,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const k=la(this._eventsInProgress);if(p&&(_||v)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new l.Event("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Uu("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const br={extend:(m,...s)=>l.extend(m,...s),run(m){m()},logToElement(m,s=!1,h="log"){const p=window.document.getElementById(h);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class vn extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,p){return s=l.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),p)}panTo(s,h,p){return this.easeTo(l.extend({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(l.extend({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(l.extend({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,_){const v={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const be=_.padding;_.padding={top:be,bottom:be,right:be,left:be}}_.padding=l.extend(v,_.padding);const E=this.transform,A=E.padding,I=E.project(l.LngLat.convert(s)),k=E.project(l.LngLat.convert(h)),z=I.rotate(-p*Math.PI/180),B=k.rotate(-p*Math.PI/180),U=new l.pointGeometry(Math.max(z.x,B.x),Math.max(z.y,B.y)),ie=new l.pointGeometry(Math.min(z.x,B.x),Math.min(z.y,B.y)),ee=U.sub(ie),te=(E.width-(A.left+A.right+_.padding.left+_.padding.right))/ee.x,he=(E.height-(A.top+A.bottom+_.padding.top+_.padding.bottom))/ee.y;if(he<0||te<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const me=Math.min(E.scaleZoom(E.scale*Math.min(te,he)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),re=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ee=xe.add(re).mult(E.scale/E.zoomScale(me));return{center:E.unproject(I.add(k).div(2).sub(Ee)),zoom:me,bearing:p}}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,_,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(s)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,v)}_fitInternal(s,h,p){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this.transform;let _=!1,v=!1,E=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(_=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(v=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(E=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),v&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(s,h,p,_=0){const v=l.MercatorCoordinate.fromLngLat(s,h),E=l.MercatorCoordinate.fromLngLat(p,_),A=E.x-v.x,I=E.y-v.y,k=E.z-v.z,z=Math.hypot(A,I,k);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(A,I),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),ie=180*Math.atan2(A,-I)/Math.PI;let ee=180*Math.acos(B/z)/Math.PI;return ee=k<0?90-ee:90+ee,{center:E.toLngLat(),zoom:U,pitch:ee,bearing:ie}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||!s.essential&&l.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),A=this.getPadding(),I="zoom"in s?+s.zoom:_,k="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,U=l.pointGeometry.convert(s.offset);let ie=p.centerPoint.add(U);const ee=p.pointLocation(ie),te=l.LngLat.convert(s.center||ee);this._normalizeCenter(te);const he=p.project(ee),me=p.project(te).sub(he),xe=p.zoomScale(I-_);let re,Ee;s.around&&(re=l.LngLat.convert(s.around),Ee=p.locationPoint(re));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==_,this._rotating=this._rotating||v!==k,this._pitching=this._pitching||z!==E,this._padding=!p.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,be),this._ease(ke=>{if(this._zooming&&(p.zoom=l.number(_,I,ke)),this._rotating&&(p.bearing=l.number(v,k,ke)),this._pitching&&(p.pitch=l.number(E,z,ke)),this._padding&&(p.interpolatePadding(A,B,ke),ie=p.centerPoint.add(U)),re)p.setLocationAtPoint(re,Ee);else{const Le=p.zoomScale(p.zoom-_),Fe=I>_?Math.min(2,xe):Math.max(.5,xe),Ce=Math.pow(Fe,1-ke),et=p.unproject(he.add(me.mult(ke*Ce)).mult(Le));p.setLocationAtPoint(p.renderWorldCopies?et.wrap():et,ie)}this._fireMoveEvents(h)},ke=>{this._afterEase(h,ke)},s),this}_prepareEase(s,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",s)),_&&this.fire(new l.Event("rotateend",s)),v&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(!s.essential&&l.exported.prefersReducedMotion){const _t=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_t,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),A=this.getPadding(),I="zoom"in s?l.clamp(+s.zoom,p.minZoom,p.maxZoom):_,k="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,U=p.zoomScale(I-_),ie=l.pointGeometry.convert(s.offset);let ee=p.centerPoint.add(ie);const te=p.pointLocation(ee),he=l.LngLat.convert(s.center||te);this._normalizeCenter(he);const me=p.project(te),xe=p.project(he).sub(me);let re=s.curve;const Ee=Math.max(p.width,p.height),be=Ee/U,ke=xe.mag();if("minZoom"in s){const _t=l.clamp(Math.min(s.minZoom,_,I),p.minZoom,p.maxZoom),rn=Ee/p.zoomScale(_t-_);re=Math.sqrt(rn/ke*2)}const Le=re*re;function Fe(_t){const rn=(be*be-Ee*Ee+(_t?-1:1)*Le*Le*ke*ke)/(2*(_t?be:Ee)*Le*ke);return Math.log(Math.sqrt(rn*rn+1)-rn)}function Ce(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function et(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const We=Fe(0);let nt=function(_t){return et(We)/et(We+re*_t)},Ct=function(_t){return Ee*((et(We)*(Ce(rn=We+re*_t)/et(rn))-Ce(We))/Le)/ke;var rn},Lt=(Fe(1)-We)/re;if(Math.abs(ke)<1e-6||!isFinite(Lt)){if(Math.abs(Ee-be)<1e-6)return this.easeTo(s,h);const _t=be<Ee?-1:1;Lt=Math.abs(Math.log(be/Ee))/re,Ct=function(){return 0},nt=function(rn){return Math.exp(_t*re*rn)}}return s.duration="duration"in s?+s.duration:1e3*Lt/("screenSpeed"in s?+s.screenSpeed/re:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==k,this._pitching=z!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(h,!1),this._ease(_t=>{const rn=_t*Lt,sn=1/nt(rn);p.zoom=_t===1?I:_+p.scaleZoom(sn),this._rotating&&(p.bearing=l.number(v,k,_t)),this._pitching&&(p.pitch=l.number(E,z,_t)),this._padding&&(p.interpolatePadding(A,B,_t),ee=p.centerPoint.add(ie));const $t=_t===1?he:p.unproject(me.add(xe.mult(Ct(rn))).mult(sn));p.setLocationAtPoint(p.renderWorldCopies?$t.wrap():$t,ee),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=s.lng-h.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class ul{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const v=h[_];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s=s.filter(_=>String(_).trim()),s.sort((_,v)=>_.length-v.length),s=s.filter((_,v)=>{for(let E=v+1;E<s.length;E++)if(s[E].indexOf(_)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class sc{constructor(s={}){this.options=s,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=C.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class sf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===s)return void(_.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const of={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},af={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ig={showCompass:!0,showZoom:!0,visualizePitch:!1};class as{constructor(s,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new As({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new st({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchmove",this.touchmove),C.addEventListener(h,"touchend",this.touchend),C.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),C.disableDrag()}move(s,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(s,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(s,h);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const s=this.element;C.removeEventListener(s,"mousedown",this.mousedown),C.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(s,"touchmove",this.touchmove),C.removeEventListener(s,"touchend",this.touchend),C.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),C.mousePos(this.element,s)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,C.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hl(m,s,h){if(m=new l.LngLat(m.lng,m.lat),s){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),v=h.locationPoint(m).distSqr(s);h.locationPoint(p).distSqr(s)<v?m=p:h.locationPoint(_).distSqr(s)<v&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const ht={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bt(m,s,h){const p=m.classList;for(const _ in ht)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${s}`,`mapboxgl-${h}-anchor-${s}`)}class ca extends l.Evented{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=l.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const p=C.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${v}px`),p.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const A=C.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=C.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of k){const re=C.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",xe.rx),re.setAttributeNS(null,"ry",xe.ry),I.appendChild(re)}const z=C.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const B=C.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(B);const U=C.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const ie=C.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(ie);const ee=C.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const te=C.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=C.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const me=C.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),te.appendChild(he),te.appendChild(me),A.appendChild(I),A.appendChild(z),A.appendChild(U),A.appendChild(ee),A.appendChild(te),p.appendChild(A),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),bt(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,p=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${ht[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=l.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ys,fi=0,Ks=!1;const ls={maxWidth:100,unit:"metric"};function lf(m,s,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,v=m.unproject([0,_]),E=m.unproject([p,_]),A=v.distanceTo(E);if(h&&h.unit==="imperial"){const I=3.2808*A;I>5280?Js(s,p,I/5280,m._getUIString("ScaleControl.Miles")):Js(s,p,I,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Js(s,p,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Js(s,p,A/1e3,m._getUIString("ScaleControl.Kilometers")):Js(s,p,A,m._getUIString("ScaleControl.Meters"))}function Js(m,s,h,p){const _=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let A=v/E;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const k=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*k)/k}(A),E*A}(h);m.style.width=s*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ju(m){if(m){if(typeof m=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(s,s),"top-right":new l.pointGeometry(-s,s),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(s,-s),"bottom-right":new l.pointGeometry(-s,-s),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const s=l.pointGeometry.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return ju(new l.pointGeometry(0,0))}const wo={supported:b,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends vn{constructor(m){var s;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},af,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new nl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new sf,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},of,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(s=m.pixelRatio)!==null&&s!==void 0?s:devicePixelRatio,this._requestManager=new W(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new rf(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new Wd(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new ul({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new sc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,s,h,p)}resize(m){const s=this._containerDimensions(),h=s[0],p=s[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[s,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(s,h,m),this.painter.resize(s,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:v=>{const E=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];E.length?p||(p=!0,h.call(this,new or(m,this,v.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:E=>{(this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,h.call(this,new or(m,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new or(m,this,E.originalEvent)))}}}}{const p=_=>{const v=this.getLayer(s)?this.queryRenderedFeatures(_.point,{layers:[s]}):[];v.length&&(_.features=v,h.call(this,_),delete _.features)};return{layer:s,listener:h,delegates:{[m]:p}}}}on(m,s,h){if(h===void 0)return super.on(m,s);const p=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,s,h){if(h===void 0)return super.once(m,s);const p=this._createDelegatedListener(m,s,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,s,h){return h===void 0?super.off(m,s):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let v=0;v<_.length;v++){const E=_[v];if(E.layer===s&&E.listener===h){for(const A in E.delegates)this.off(A,E.delegates[A]);return _.splice(v,1),this}}})(),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let h;if(s!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(s=m,m=void 0),s=s||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Yn(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Yn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,s)})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const h=m[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||l.isImageBitmap(s)){const{width:A,height:I,data:k}=l.exported.getImageData(s);this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},k),pixelRatio:h,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else{if(s.width===void 0||s.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:k}=s,z=s;this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},new Uint8Array(k)),pixelRatio:h,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}}updateImage(m,s){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.isImageBitmap(s)?l.exported.getImageData(s):s,{width:_,height:v,data:E}=p;if(_===void 0||v===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||v!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(s instanceof HTMLImageElement||l.isImageBitmap(s));h.data.replace(E,A),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,h){return this.style.setLayerZoomRange(m,s,h),this._update(!0)}setFilter(m,s,h={}){return this.style.setFilter(m,s,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,h,p={}){return this.style.setPaintProperty(m,s,h,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,h,p={}){return this.style.setLayoutProperty(m,s,h,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=C.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=C.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=C.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=C.create("div","maplibregl-cooperative-gesture-screen",m);let s="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,s,h){this._canvas.width=h*m,this._canvas.height=h*s,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=l.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(this.painter=new ku(s,this.transform),l.exported$1.testSupport(s)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let s,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,A=l.exported.now();this.style.zoomHistory.update(E,A);const I=new l.EvaluationParameters(E,{now:A,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=I.crossFadingFactor();k===1&&k===this._crossFadingFactor||(_=!0,this._crossFadingFactor=k),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:E,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(E);this.fire(new l.Event("gpu-timing-layer",{layerTimes:A}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._cooperativeGestures&&C.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){l.setCacheLimits(m,s)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},ig,m),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new as(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const h=C.create("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){const h=this._map._getUIString(`NavigationControl.${s}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},Vu,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var s;return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Ys!==void 0?s(Ys):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ys=h.state!=="denied",s(Ys)}):(Ys=!!window.navigator.geolocation,s(Ys)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fi=0,Ks=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,s=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=s.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Ks)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ca(this._dotElement),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ca({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fi--,Ks=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fi++,fi>1?(m={maximumAge:6e5,timeout:0},Ks=!0):(m=this.options.positionOptions,Ks=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ul,LogoControl:sc,ScaleControl:class{constructor(m){this.options=l.extend({},ls,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){lf(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,lf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(kn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=C.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=ju(this.options.offset);if(!h){const v=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=s.y+p.bottom.y<E?["top"]:s.y>this._map.transform.height-E?["bottom"]:[],s.x<v/2?A.push("left"):s.x>this._map.transform.width-v/2&&A.push("right"),h=A.length===0?"bottom":A.join("-")}const _=s.add(p[h]).round();C.setTransform(this._container,`${ht[h]} translate(${_.x}px,${_.y}px)`),bt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Gn);m&&m.focus()}_onClose(){this.remove()}},Marker:ca,Style:Yn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:tn,GeoJSONSource:vi,ImageSource:wt,RasterDEMTileSource:xt,RasterTileSource:zt,VectorTileSource:qt,VideoSource:St,prewarm:function(){hi().acquire(Ci)},clearPrewarmedResources:function(){const m=Vi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ci),Vi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Zn.workerCount},set workerCount(m){Zn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,s){l.config.REGISTERED_PROTOCOLS[m]=s},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return br.extend(wo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),wo});var f=o;return f})})(G2);var Ek=G2.exports;const Tk=PE(Ek);function Yp(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const uv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Ib=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ib&&parseFloat(Ib[1]);const Sk="3.4.14";function $o(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const vp=typeof process!="object"||String(process)!=="[object process]"||process.browser,Ak=typeof window<"u"&&typeof window.orientation<"u",Pb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Pb&&parseFloat(Pb[1]);function od(t){"@babel/helpers - typeof";return od=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},od(t)}function Ik(t,e){if(od(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(od(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Pk(t){var e=Ik(t,"string");return od(e)=="symbol"?e:String(e)}function V(t,e,n){return e=Pk(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Ck{constructor(e,n){V(this,"name",void 0),V(this,"workerThread",void 0),V(this,"isRunning",!0),V(this,"result",void 0),V(this,"_resolve",()=>{}),V(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,o)=>{this._resolve=i,this._reject=o})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){$o(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){$o(this.isRunning),this.isRunning=!1,this._reject(e)}}let m_=class{terminate(){}};const g_=new Map;function Mk(t){$o(t.source&&!t.url||!t.source&&t.url);let e=g_.get(t.source||t.url);return e||(t.url&&(e=kk(t.url),g_.set(t.url,e)),t.source&&(e=H2(t.source),g_.set(t.source,e))),$o(e),e}function kk(t){if(!t.startsWith("http"))return t;const e=Lk(t);return H2(e)}function H2(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Lk(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function W2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(Cb(t))i.add(t);else if(Cb(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)W2(t[o],e,i)}}return n===void 0?Array.from(i):[]}function Cb(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const __=()=>{};class Fy{static isSupported(){return typeof Worker<"u"&&vp||typeof m_<"u"&&!vp}constructor(e){V(this,"name",void 0),V(this,"source",void 0),V(this,"url",void 0),V(this,"terminated",!1),V(this,"worker",void 0),V(this,"onMessage",void 0),V(this,"onError",void 0),V(this,"_loadableURL","");const{name:n,source:i,url:o}=e;$o(i||o),this.name=n,this.source=i,this.url=o,this.onMessage=__,this.onError=u=>console.log(u),this.worker=vp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=__,this.onError=__,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||W2(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Mk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new m_(i,{eval:!1})}else if(this.source)e=new m_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Rk{static isSupported(){return Fy.isSupported()}constructor(e){V(this,"name","unnamed"),V(this,"source",void 0),V(this,"url",void 0),V(this,"maxConcurrency",1),V(this,"maxMobileConcurrency",1),V(this,"onDebug",()=>{}),V(this,"reuseWorkers",!0),V(this,"props",{}),V(this,"jobQueue",[]),V(this,"idleQueue",[]),V(this,"count",0),V(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(u,f,l)=>u.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(u,f)=>u.error(f);const o=new Promise(u=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:u}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new Ck(n.name,e);e.onMessage=o=>n.onMessage(i,o.type,o.payload),e.onError=o=>n.onError(i,o),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Fy({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Ak?this.maxMobileConcurrency:this.maxConcurrency}}const Dk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Oo{static isSupported(){return Fy.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oo._workerFarm=Oo._workerFarm||new Oo({}),Oo._workerFarm.setProps(e),Oo._workerFarm}constructor(e){V(this,"props",void 0),V(this,"workerPools",new Map),this.props={...Dk},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:o}=e;let u=this.workerPools.get(n);return u||(u=new Rk({name:n,source:i,url:o}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}V(Oo,"_workerFarm",void 0);const zk="latest";function Ok(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let o=n.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(o="modules/".concat(t.module,"/dist/").concat(i)),!o){let u=t.version;u==="latest"&&(u=zk);const f=u?"@".concat(u):"";o="https://unpkg.com/@loaders.gl/".concat(t.module).concat(f,"/dist/").concat(i)}return $o(o),o}function Fk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sk;$o(t,"no worker provided");const n=t.version;return!(!e||!n)}function Bk(t,e){return!Oo.isSupported()||!vp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Nk(t,e,n,i,o){const u=t.id,f=Ok(t,n),b=Oo.getWorkerFarm(n).getWorkerPool({name:u,url:f});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await b.startJob("process-on-worker",Uk.bind(null,o));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function Uk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:u,options:f}=i;try{const l=await t(u,f);e.postMessage("done",{id:o,result:l})}catch(l){const b=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:b})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Vk(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),o=new Uint8Array(e);for(let u=0;u<i.length;++u)if(i[u]!==o[u])return!1;return!0}function jk(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),o=i.reduce((l,b)=>l+b.byteLength,0),u=new Uint8Array(o);let f=0;for(const l of i)u.set(l,f),f+=l.byteLength;return u.buffer}async function Gk(t){const e=[];for await(const n of t)e.push(n);return jk(...e)}let $k="";const Mb={};function Hk(t){for(const e in Mb)if(t.startsWith(e)){const n=Mb[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat($k).concat(t)),t}function Wk(t){return t&&typeof t=="object"&&t.isBuffer}function q2(t){if(Wk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Z2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function qk(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Zk=t=>typeof t=="boolean",Nh=t=>typeof t=="function",vd=t=>t!==null&&typeof t=="object",kb=t=>vd(t)&&t.constructor==={}.constructor,Xk=t=>t&&typeof t[Symbol.iterator]=="function",Yk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Vl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,jl=t=>typeof Blob<"u"&&t instanceof Blob,Kk=t=>t&&typeof t=="object"&&t.isBuffer,Jk=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||vd(t)&&Nh(t.tee)&&Nh(t.cancel)&&Nh(t.getReader),Qk=t=>vd(t)&&Nh(t.read)&&Nh(t.pipe)&&Zk(t.readable),X2=t=>Jk(t)||Qk(t),eL=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,tL=/^([-\w.]+\/[-\w.+]+)/;function nL(t){const e=tL.exec(t);return e?e[1]:t}function Lb(t){const e=eL.exec(t);return e?e[1]:""}const Y2=/\?.*/;function iL(t){const e=t.match(Y2);return e&&e[0]}function hv(t){return t.replace(Y2,"")}function km(t){return Vl(t)?t.url:jl(t)?t.name||"":typeof t=="string"?t:""}function dv(t){if(Vl(t)){const e=t,n=e.headers.get("content-type")||"",i=hv(e.url);return nL(n)||Lb(i)}return jl(t)?t.type||"":typeof t=="string"?Lb(t):""}function rL(t){return Vl(t)?t.headers["content-length"]||-1:jl(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function K2(t){if(Vl(t))return t;const e={},n=rL(t);n>=0&&(e["content-length"]=String(n));const i=km(t),o=dv(t);o&&(e["content-type"]=o);const u=await aL(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const f=new Response(t,{headers:e});return Object.defineProperty(f,"url",{value:i}),f}async function sL(t){if(!t.ok){const e=await oL(t);throw new Error(e)}}async function oL(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function aL(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const o=new FileReader;o.onload=u=>{var f;return i(u==null||(f=u.target)===null||f===void 0?void 0:f.result)},o.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=lL(n);return"data:base64,".concat(i)}return null}function lL(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Rb(t,e){if(typeof t=="string"){t=Hk(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await K2(t)}function cL(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function xd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||cL()}const Xf=globalThis.window||globalThis.self||globalThis.global,gh=globalThis.process||{},J2=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";xd();function uL(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let hL=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=uL(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function dL(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function fL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function y_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const u=t.width*n,f=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(f/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(f,"px;"),"background:url(".concat(o,");"),"background-size:".concat(u,"px ").concat(f,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Kp;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Kp||(Kp={}));const pL=10;function Db(t){return typeof t!="string"?t:(t=t.toUpperCase(),Kp[t]||Kp.WHITE)}function mL(t,e,n){if(!xd&&typeof t=="string"){if(e){const i=Db(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=Db(n);t="\x1B[".concat(i+pL,"m").concat(t,"\x1B[49m")}}return t}function gL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),o=t;for(const u of i){const f=o[u];typeof f=="function"&&(e.find(l=>u===l)||(o[u]=f.bind(t)))}}function Jp(t,e){if(!t)throw new Error(e||"Assertion failed")}function yc(){let t;if(xd()&&Xf.performance){var e,n;t=Xf==null||(e=Xf.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in gh){var i;const o=gh==null||(i=gh.hrtime)===null||i===void 0?void 0:i.call(gh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const vc={debug:xd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},_L={enabled:!0,level:0};function ps(){}const zb={},Ob={once:!0};let fv=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=J2,this._startTs=yc(),this._deltaTs=yc(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new hL("__probe-".concat(this.id,"__"),_L),this.timeStamp("".concat(this.id," started")),gL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((yc()-this._startTs).toPrecision(10))}getDelta(){return Number((yc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Jp(e,n)}warn(e){return this._getLogFunction(0,e,vc.warn,arguments,Ob)}error(e){return this._getLogFunction(0,e,vc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,vc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,vc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,vc.debug||vc.info,arguments,Ob)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ps,i&&[i],{tag:bL(n)}):ps}image(e){let{logLevel:n,priority:i,image:o,message:u="",scale:f=1}=e;return this._shouldLog(n||i)?xd()?xL({image:o,message:u,scale:f}):vL():ps}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ps)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=Fb({logLevel:e,message:n,opts:i}),{collapsed:u}=i;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ps)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Q2(e)}_getLogFunction(e,n,i,o,u){if(this._shouldLog(e)){u=Fb({logLevel:e,message:n,args:o,opts:u}),i=i||u.method,Jp(i),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=yc();const f=u.tag||u.message;if(u.once&&f)if(!zb[f])zb[f]=yc();else return ps;return n=yL(this.id,u.message,u),i.bind(console,n,...u.args)}return ps}};fv.VERSION=J2;function Q2(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Jp(Number.isFinite(e)&&e>=0),e}function Fb(t){const{logLevel:e,message:n}=t;t.logLevel=Q2(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return Jp(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function yL(t,e,n){if(typeof e=="string"){const i=n.time?fL(dL(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=mL(e,n.color,n.background)}return e}function vL(t){return console.warn("removed"),ps}function xL(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const f=y_(u,n,i);console.log(...f)},u.src=e,ps}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...y_(e,n,i)),ps;if(o.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...y_(u,n,i)),u.src=e.toDataURL(),ps}return ps}function bL(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Bb=new fv({id:"loaders.gl"});class wL{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class EL{constructor(){V(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const eS={fetch:null,mimeType:void 0,nothrow:!1,log:new EL,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:uv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},TL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tS(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const nS=()=>{const t=tS();return t.globalOptions=t.globalOptions||{...eS},t.globalOptions};function SL(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],AL(t,n),PL(e,t,i)}function AL(t,e){Nb(t,null,eS,TL,e);for(const n of e){const i=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},u=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Nb(i,n.id,o,u,e)}}function Nb(t,e,n,i,o){const u=e||"Top level",f=e?"".concat(e,"."):"";for(const l in t){const b=!e&&vd(t[l]),w=l==="baseUri"&&!e,M=l==="workerUrl"&&e;if(!(l in n)&&!w&&!M){if(l in i)Bb.warn("".concat(u," loader option '").concat(f).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!b){const L=IL(l,o);Bb.warn("".concat(u," loader option '").concat(f).concat(l,"' not recognized. ").concat(L))()}}}}function IL(t,e){const n=t.toLowerCase();let i="";for(const o of e)for(const u in o.options){if(t===u)return"Did you mean '".concat(o.id,".").concat(u,"'?");const f=u.toLowerCase();(n.startsWith(f)||f.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(u,"'?"))}return i}function PL(t,e,n){const o={...t.options||{}};return CL(o,n),o.log===null&&(o.log=new wL),Ub(o,nS()),Ub(o,e),o}function Ub(t,e){for(const n in e)if(n in e){const i=e[n];kb(i)&&kb(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function CL(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function pv(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function mv(t){var e,n;Yp(t,"null loader"),Yp(pv(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const iS=()=>{const t=tS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function ML(t){const e=iS();t=Array.isArray(t)?t:[t];for(const n of t){const i=mv(n);e.find(o=>i===o)||e.unshift(i)}}function kL(){return iS()}const LL=new fv({id:"loaders.gl"}),RL=/\.([^.]+)$/;async function DL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!rS(t))return null;let o=Vb(t,e,{...n,nothrow:!0},i);if(o)return o;if(jl(t)&&(t=await t.slice(0,10).arrayBuffer(),o=Vb(t,e,n,i)),!o&&!(n!=null&&n.nothrow))throw new Error(sS(t));return o}function Vb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!rS(t))return null;if(e&&!Array.isArray(e))return mv(e);let o=[];e&&(o=o.concat(e)),n!=null&&n.ignoreRegisteredLoaders||o.push(...kL()),OL(o);const u=zL(t,o,n,i);if(!u&&!(n!=null&&n.nothrow))throw new Error(sS(t));return u}function zL(t,e,n,i){const o=km(t),u=dv(t),f=hv(o)||(i==null?void 0:i.url);let l=null,b="";if(n!=null&&n.mimeType&&(l=v_(e,n==null?void 0:n.mimeType),b="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||FL(e,f),b=b||(l?"matched url ".concat(f):""),l=l||v_(e,u),b=b||(l?"matched MIME type ".concat(u):""),l=l||NL(e,t),b=b||(l?"matched initial data ".concat(oS(t)):""),l=l||v_(e,n==null?void 0:n.fallbackMimeType),b=b||(l?"matched fallback MIME type ".concat(u):""),b){var w;LL.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(b,"."))}return l}function rS(t){return!(t instanceof Response&&t.status===204)}function sS(t){const e=km(t),n=dv(t);let i="No valid loader found (";i+=e?"".concat(Z2(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=t?oS(t):"";return i+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",i+=")",i}function OL(t){for(const e of t)mv(e)}function FL(t,e){const n=e&&RL.exec(e),i=n&&n[1];return i?BL(t,i):null}function BL(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function v_(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function NL(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(UL(e,n))return n}else if(ArrayBuffer.isView(e)){if(jb(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&jb(e,0,n))return n;return null}function UL(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function jb(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>VL(t,e,n,o))}function VL(t,e,n,i){if(i instanceof ArrayBuffer)return Vk(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const o=By(t,e,i.length);return i===o;default:return!1}}function oS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?By(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?By(t,0,e):""}function By(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let o="";for(let u=0;u<n;u++)o+=String.fromCharCode(i.getUint8(e+u));return o}const jL=256*1024;function*GL(t,e){const n=(e==null?void 0:e.chunkSize)||jL;let i=0;const o=new TextEncoder;for(;i<t.length;){const u=Math.min(t.length-i,n),f=t.slice(i,i+u);i+=u,yield o.encode(f)}}const $L=256*1024;function HL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=$L}=e;let i=0;for(;i<t.byteLength;){const o=Math.min(t.byteLength-i,n),u=new ArrayBuffer(o),f=new Uint8Array(t,i,o);new Uint8Array(u).set(f),i+=o,yield u}}()}const WL=1024*1024;async function*qL(t,e){const n=(e==null?void 0:e.chunkSize)||WL;let i=0;for(;i<t.size;){const o=i+n,u=await t.slice(i,o).arrayBuffer();i=o,yield u}}function Gb(t,e){return uv?ZL(t,e):XL(t)}async function*ZL(t,e){const n=t.getReader();let i;try{for(;;){const o=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:u,value:f}=await o;if(u)return;yield q2(f)}}catch{n.releaseLock()}}async function*XL(t,e){for await(const n of t)yield q2(n)}function YL(t,e){if(typeof t=="string")return GL(t,e);if(t instanceof ArrayBuffer)return HL(t,e);if(jl(t))return qL(t,e);if(X2(t))return Gb(t,e);if(Vl(t))return Gb(t.body,e);throw new Error("makeIterator")}const aS="Cannot convert supplied data type";function KL(t,e,n){if(e.text&&typeof t=="string")return t;if(Kk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+o)),i}throw new Error(aS)}async function JL(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return KL(t,e);if(jl(t)&&(t=await K2(t)),Vl(t)){const o=t;return await sL(o),e.binary?await o.arrayBuffer():await o.text()}if(X2(t)&&(t=YL(t,n)),Xk(t)||Yk(t))return Gk(t);throw new Error(aS)}function lS(t,e){const n=nS(),i=t||n;return typeof i.fetch=="function"?i.fetch:vd(i.fetch)?o=>Rb(o,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Rb}function QL(t,e,n){if(n)return n;const i={fetch:lS(e,t),...t};if(i.url){const o=hv(i.url);i.baseUrl=o,i.queryString=iL(i.url),i.filename=Z2(o),i.baseUrl=qk(o)}return Array.isArray(i.loaders)||(i.loaders=null),i}function e3(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function gv(t,e,n,i){$o(!i||typeof i=="object"),e&&!Array.isArray(e)&&!pv(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const o=km(t),f=e3(e,i),l=await DL(t,f,n);return l?(n=SL(n,l,f,o),i=QL({url:o,parse:gv,loaders:f},n,i||null),await t3(l,t,n,i)):null}async function t3(t,e,n,i){if(Fk(t),Vl(e)){const o=e,{ok:u,redirected:f,status:l,statusText:b,type:w,url:M}=o,L=Object.fromEntries(o.headers.entries());i.response={headers:L,ok:u,redirected:f,status:l,statusText:b,type:w,url:M}}if(e=await JL(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(Bk(t,n))return await Nk(t,e,n,i,gv);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw $o(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Qp(t,e,n,i){!Array.isArray(e)&&!pv(e)&&(n=e,e=void 0);const o=lS(n);let u=t;return typeof t=="string"&&(u=await o(t)),jl(t)&&(u=await o(t)),await gv(u,e,n)}const n3="3.4.14",{_parseImageNode:i3}=globalThis,Ny=typeof Image<"u",Uy=typeof ImageBitmap<"u",r3=!!i3,Vy=uv?!0:r3;function s3(t){switch(t){case"auto":return Uy||Ny||Vy;case"imagebitmap":return Uy;case"image":return Ny;case"data":return Vy;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function o3(){if(Uy)return"imagebitmap";if(Ny)return"image";if(Vy)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function a3(t){const e=c3(t);if(!e)throw new Error("Not an image");return e}function l3(t){switch(a3(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function c3(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const u3=/^data:image\/svg\+xml/,h3=/\.svg((\?|#).*)?$/;function _v(t){return t&&(u3.test(t)||h3.test(t))}function d3(t,e){if(_v(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(u){throw new Error(u.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return cS(t,e)}function cS(t,e){if(_v(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function uS(t,e,n){const i=d3(t,n),o=self.URL||self.webkitURL,u=typeof i!="string"&&o.createObjectURL(i);try{return await f3(u||i,e)}finally{u&&o.revokeObjectURL(u)}}async function f3(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,o)=>{try{n.onload=()=>i(n),n.onerror=u=>o(new Error("Could not load image ".concat(t,": ").concat(u)))}catch(u){o(u)}})}const p3={};let $b=!0;async function m3(t,e,n){let i;_v(n)?i=await uS(t,e,n):i=cS(t,n);const o=e&&e.imagebitmap;return await g3(i,o)}async function g3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((_3(e)||!$b)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),$b=!1}return await createImageBitmap(t)}function _3(t){for(const e in t||p3)return!1;return!0}function y3(t){return!w3(t,"ftyp",4)||!(t[8]&96)?null:v3(t)}function v3(t){switch(x3(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function x3(t,e,n){return String.fromCharCode(...t.slice(e,n))}function b3(t){return[...t].map(e=>e.charCodeAt(0))}function w3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=b3(e);for(let o=0;o<i.length;++o)if(i[o]!==t[o+n])return!1;return!0}const lo=!1,Uh=!0;function hS(t){const e=bd(t);return T3(e)||I3(e)||S3(e)||A3(e)||E3(e)}function E3(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=y3(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function T3(t){const e=bd(t);return e.byteLength>=24&&e.getUint32(0,lo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,lo),height:e.getUint32(20,lo)}:null}function S3(t){const e=bd(t);return e.byteLength>=10&&e.getUint32(0,lo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Uh),height:e.getUint16(8,Uh)}:null}function A3(t){const e=bd(t);return e.byteLength>=14&&e.getUint16(0,lo)===16973&&e.getUint32(2,Uh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Uh),height:e.getUint32(22,Uh)}:null}function I3(t){const e=bd(t);if(!(e.byteLength>=3&&e.getUint16(0,lo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:o}=P3();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,lo);if(o.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,lo),width:e.getUint16(u+7,lo)};if(!i.has(f))return null;u+=2,u+=e.getUint16(u,lo)}return null}function P3(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function bd(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function C3(t,e){const{mimeType:n}=hS(t)||{},i=globalThis._parseImageNode;return Yp(i),await i(t,n)}async function M3(t,e,n){e=e||{};const o=(e.image||{}).type||"auto",{url:u}=n||{},f=k3(o);let l;switch(f){case"imagebitmap":l=await m3(t,e,u);break;case"image":l=await uS(t,e,u);break;case"data":l=await C3(t);break;default:Yp(!1)}return o==="data"&&(l=l3(l)),l}function k3(t){switch(t){case"auto":case"data":return o3();default:return s3(t),t}}const L3=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],R3=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],D3={image:{type:"auto",decode:!0}},z3={id:"image",module:"images",name:"Images",version:n3,mimeTypes:R3,extensions:L3,parse:M3,tests:[t=>!!hS(new DataView(t))],options:D3};function dS(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Zo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||dS()}const xp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Yf=xp.window||xp.self||xp.global,_h=xp.process||{},fS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Zo();const x_=globalThis;function pS(t){if(!t&&!Zo())return"Node";if(dS(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o?"IE":x_.chrome?"Chrome":x_.safari?"Safari":x_.mozInnerScreenX?"Firefox":"Unknown"}function O3(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class F3{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";V(this,"storage",void 0),V(this,"id",void 0),V(this,"config",void 0),this.storage=O3(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function B3(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function N3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function b_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const u=t.width*n,f=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(f/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(f,"px;"),"background:url(".concat(o,");"),"background-size:".concat(u,"px ").concat(f,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let em;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(em||(em={}));function Hb(t){return typeof t=="string"?em[t.toUpperCase()]||em.WHITE:t}function U3(t,e,n){return!Zo&&typeof t=="string"&&(e&&(e=Hb(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=Hb(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function V3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const o of i)typeof t[o]=="function"&&(e.find(u=>o===u)||(t[o]=t[o].bind(t)))}function tm(t,e){if(!t)throw new Error(e||"Assertion failed")}function xc(){let t;if(Zo&&"performance"in Yf){var e,n;t=Yf==null||(e=Yf.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in _h){var i;const o=_h==null||(i=_h.hrtime)===null||i===void 0?void 0:i.call(_h);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const bc={debug:Zo&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},j3={enabled:!0,level:0};function ms(){}const Wb={},qb={once:!0};class yv{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};V(this,"id",void 0),V(this,"VERSION",fS),V(this,"_startTs",xc()),V(this,"_deltaTs",xc()),V(this,"_storage",void 0),V(this,"userData",{}),V(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new F3("__probe-".concat(this.id,"__"),j3),this.timeStamp("".concat(this.id," started")),V3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((xc()-this._startTs).toPrecision(10))}getDelta(){return Number((xc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){tm(e,n)}warn(e){return this._getLogFunction(0,e,bc.warn,arguments,qb)}error(e){return this._getLogFunction(0,e,bc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,bc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,bc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),u=2;u<i;u++)o[u-2]=arguments[u];return this._getLogFunction(e,n,bc.debug||bc.info,arguments,qb)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ms,i&&[i],{tag:W3(n)}):ms}image(e){let{logLevel:n,priority:i,image:o,message:u="",scale:f=1}=e;return this._shouldLog(n||i)?Zo?H3({image:o,message:u,scale:f}):$3():ms}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ms)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=Zb({logLevel:e,message:n,opts:i}),{collapsed:u}=i;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ms)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=mS(e)}_getLogFunction(e,n,i,o,u){if(this._shouldLog(e)){u=Zb({logLevel:e,message:n,args:o,opts:u}),i=i||u.method,tm(i),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=xc();const f=u.tag||u.message;if(u.once)if(!Wb[f])Wb[f]=xc();else return ms;return n=G3(this.id,u.message,u),i.bind(console,n,...u.args)}return ms}}V(yv,"VERSION",fS);function mS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return tm(Number.isFinite(e)&&e>=0),e}function Zb(t){const{logLevel:e,message:n}=t;t.logLevel=mS(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return tm(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function G3(t,e,n){if(typeof e=="string"){const i=n.time?N3(B3(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=U3(e,n.color,n.background)}return e}function $3(t){return console.warn("removed"),ms}function H3(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const f=b_(u,n,i);console.log(...f)},u.src=e,ms}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...b_(e,n,i)),ms;if(o.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...b_(u,n,i)),u.src=e.toDataURL(),ms}return ms}function W3(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const _n=new yv({id:"deck"});let jy={};function q3(t){jy=t}function Ji(t,e,n,i){_n.level>0&&jy[t]&&jy[t].call(null,e,n,i)}function Z3(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const X3={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Z3,parseTextSync:JSON.parse};function Y3(){const t="8.9.33",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(_n.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:_n,_registerLoggers:q3},ML([X3,[z3,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const K3=Y3(),fn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(fn,"IDENTITY",{get:()=>(_n.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const co={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Gy={common:0,meters:1,pixels:2},Xb={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Et=new yv({id:"luma.gl"});function pr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const J3="Invalid WebGLRenderingContext",Q3="Requires WebGL2";function Lm(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Xt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function eR(t){return Xt(t)?t:null}function Rm(t){return pr(Lm(t),J3),t}function er(t){return pr(Xt(t),Q3),t}const Ph={};function tR(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function nR(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function iR(t,e){Ph[t]=!0,e!==void 0&&tR(e)}function rR(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Ph[i]=!0);while(i!==0);for(i in Ph)if(Ph[i])return delete Ph[i],parseInt(i,10);return 0}}const wd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const o=new t.VertexAttrib(n);this.attribs[i]=o}this.maxAttrib=0};wd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};wd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Gl=function(e){const n=this;this.gl=e,rR(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(u){return u===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(u,f){switch(u){case 34962:n.currentArrayBuffer=f;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=f;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(u,f){const b=n.currentVertexArrayObject.attribs[u];switch(f){case 34975:return b.buffer;case 34338:return b.enabled;case 34339:return b.size;case 34340:return b.stride;case 34341:return b.type;case 34922:return b.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(u,f,l,b,w,M){const L=n.currentVertexArrayObject;L.maxAttrib=Math.max(L.maxAttrib,u);const C=L.attribs[u];return C.buffer=n.currentArrayBuffer,C.size=f,C.type=l,C.normalized=b,C.stride=w,C.offset=M,C.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{nR("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Gl.prototype.VERTEX_ARRAY_BINDING_OES=34229;Gl.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new wd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Gl.prototype.createVertexArrayOES=function(){const e=new wd(this);return this.vertexArrayObjects.push(e),e};Gl.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Gl.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof wd&&e.hasBeenBound&&e.ext===this)};Gl.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){iR(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const u=this.currentVertexArrayObject;if(o===u)return;(!o||u.elementArrayBuffer!==o.elementArrayBuffer)&&i.bindBuffer.call(n,34963,u.elementArrayBuffer);let f=this.currentArrayBuffer;const l=Math.max(o?o.maxAttrib:0,u.maxAttrib);for(let b=0;b<=l;b++){const w=u.attribs[b],M=o?o.attribs[b]:null;if((!o||w.enabled!==M.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,b):i.disableVertexAttribArray.call(n,b)),w.enabled){let L=!1;(!o||w.buffer!==M.buffer)&&(f!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),f=w.buffer),L=!0),(L||w.cached!==M.cached)&&i.vertexAttribPointer.call(n,b,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==f&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function sR(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=e.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=t.getExtension;t.getExtension=function(o){const u=n.call(this,o);return u||(o!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Gl(this)),this.__OESVertexArrayObject))}}const Yb="OES_element_index",Kb="WEBGL_draw_buffers",oR="EXT_disjoint_timer_query",aR="EXT_disjoint_timer_query_webgl2",lR="EXT_texture_filter_anisotropic",Jb="WEBGL_debug_renderer_info",cR=35723,uR=4352,hR=36795,dR=34047,fR=37445,pR=37446,Sn=t=>Xt(t)?void 0:0,mR={3074:t=>Xt(t)?void 0:36064,[cR]:t=>Xt(t)?void 0:uR,35977:Sn,32937:Sn,[hR]:(t,e)=>{const n=Xt(t)?t.getExtension(aR):t.getExtension(oR);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[fR]:(t,e)=>{const n=t.getExtension(Jb);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[pR]:(t,e)=>{const n=t.getExtension(Jb);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[dR]:(t,e)=>{const n=t.luma.extensions[lR];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Sn,35071:Sn,37447:Sn,36063:(t,e)=>{if(!Xt(t)){const n=t.getExtension(Kb);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Sn,35374:Sn,35377:Sn,34852:t=>{if(!Xt(t)){const e=t.getExtension(Kb);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(Yb)?2147483647:65535,33001:t=>t.getExtension(Yb)?16777216:65535,33e3:t=>16777216,37157:Sn,35373:Sn,35657:Sn,36183:Sn,37137:Sn,34045:Sn,35978:Sn,35979:Sn,35968:Sn,35376:Sn,35375:Sn,35659:Sn,37154:Sn,35371:Sn,35658:Sn,35076:Sn,35077:Sn,35380:Sn};function gR(t,e,n){const i=mR[n],o=typeof i=="function"?i(t,e,n):i;return o!==void 0?o:e(n)}const _R="OES_vertex_array_object",gS="ANGLE_instanced_arrays",yR="WEBGL_draw_buffers",vR="EXT_disjoint_timer_query",xR="EXT_texture_filter_anisotropic",bR="VertexArray requires WebGL2 or OES_vertex_array_object extension";function wR(t,e){return{webgl2:Xt(t),ext:t.getExtension(e)}}const _S={[_R]:{meta:{suffix:"OES"},createVertexArray:()=>{pr(!1,bR)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[gS]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){pr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[yR]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{pr(!1)}},[vR]:{meta:{suffix:"EXT"},createQuery:()=>{pr(!1)},deleteQuery:()=>{pr(!1)},beginQuery:()=>{pr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},w_={readBuffer:(t,e,n)=>{Xt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:o,ext:u}=wR(t,gS);let f;switch(i){case 35069:f=o?void 0:!1;break;case 35070:f=!o&&!u?0:void 0;break}return f!==void 0?f:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Xt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,o)=>{if(!Xt(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,o)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:o}=t.luma,u=o[xR];i=u&&u.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:gR,hint(t,e,n,i){return e(n,i)}};function ER(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(sR(t),TR(t),AR(t,_S),SR(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=ER;function TR(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function SR(t,e){let{target:n,target2:i}=e;Object.keys(w_).forEach(o=>{if(typeof w_[o]=="function"){const u=t[o]?t[o].bind(t):()=>{},f=w_[o].bind(null,t,u);n[o]=f,i[o]=f}})}function AR(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&IR(t,{extension:n,target:t.luma,target2:t})}function IR(t,e){let{extension:n,target:i,target2:o}=e;const u=_S[n];pr(u);const{meta:f={}}=u,{suffix:l=""}=f,b=t.getExtension(n);for(const w of Object.keys(u)){const M="".concat(w).concat(l);let L=null;w==="meta"||typeof t[w]=="function"||(b&&typeof b[M]=="function"?L=function(){return b[M](...arguments)}:typeof u[w]=="function"&&(L=u[w].bind(i))),L&&(i[w]=L,o[w]=L)}}const vv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},_a=(t,e,n)=>e?t.enable(n):t.disable(n),Qb=(t,e,n)=>t.hint(n,e),jr=(t,e,n)=>t.pixelStorei(n,e),PR=(t,e)=>{const n=Xt(t)?36009:36160;return t.bindFramebuffer(n,e)},CR=(t,e)=>t.bindFramebuffer(36008,e);function yh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const MR={3042:_a,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:_a,2885:(t,e)=>t.cullFace(e),2929:_a,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:_a,35723:Qb,36006:PR,2886:(t,e)=>t.frontFace(e),33170:Qb,2849:(t,e)=>t.lineWidth(e),32823:_a,32824:"polygonOffset",10752:"polygonOffset",35977:_a,32938:"sampleCoverage",32939:"sampleCoverage",3089:_a,3088:(t,e)=>t.scissor(...e),2960:_a,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:jr,3317:jr,37440:jr,37441:jr,37443:jr,3330:jr,3332:jr,3331:jr,36010:CR,3314:jr,32878:jr,3316:jr,3315:jr,32877:jr,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=yh(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=yh(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=yh(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=yh(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilFuncSeparate(1028,n,i,o),t.stencilFuncSeparate(1029,u,f,l)},stencilOp:(t,e)=>{e=yh(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilOpSeparate(1028,n,i,o),t.stencilOpSeparate(1029,u,f,l)},viewport:(t,e)=>t.viewport(...e)};function Wn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const kR={blendEquation:(t,e,n)=>t.blendEquationSeparate(Wn(32777,e,n),Wn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Wn(32969,e,n),Wn(32968,e,n),Wn(32971,e,n),Wn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Wn(32824,e,n),Wn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Wn(32938,e,n),Wn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Wn(2962,e,n),Wn(2967,e,n),Wn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Wn(34816,e,n),Wn(36003,e,n),Wn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Wn(2964,e,n),Wn(2965,e,n),Wn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Wn(34817,e,n),Wn(34818,e,n),Wn(34819,e,n))},ew={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,o)=>t({32773:new Float32Array([e,n,i,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,o)=>t({32969:e,32968:n,32971:i,32970:o}),clearColor:(t,e,n,i,o)=>t({3106:new Float32Array([e,n,i,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,o)=>t({3107:[e,n,i,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,o)=>t({3088:new Int32Array([e,n,i,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,o)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:o}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,o)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:o}),viewport:(t,e,n,i,o)=>t({2978:[e,n,i,o]})},io=(t,e)=>t.isEnabled(e),tw={3042:io,2884:io,2929:io,3024:io,32823:io,32926:io,32928:io,3089:io,2960:io,35977:io};function yS(t){for(const e in t)return!1;return!0}function LR(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}function nw(t,e){const n=t[e].bind(t);t[e]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in t.state.cache?t.state.enable?t.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function RR(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var u=arguments.length,f=new Array(u),l=0;l<u;l++)f[l]=arguments[l];const{valueChanged:b,oldValue:w}=n(t.state._updateCache,...f);return b&&i(...f),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function DR(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class zR{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?FR(e):Object.assign({},vv),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){pr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ho(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const u in e){pr(u!==void 0);const f=e[u],l=this.cache[u];LR(f,l)||(n=!0,i=l,o&&!(u in o)&&(o[u]=l),this.cache[u]=f)}return{valueChanged:n,oldValue:i}}}function vS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(pr(i!==void 0),!t.state){const{polyfillContext:o}=globalThis;o&&o(t),t.state=new zR(t,{copyState:i}),DR(t);for(const u in ew){const f=ew[u];RR(t,u,f)}nw(t,"getParameter"),nw(t,"isEnabled")}return t.state.enable=n,t}function OR(t){t.state||vS(t,{copyState:!1}),t.state.push()}function iw(t){pr(t.state),t.state.pop()}function Ho(t,e){if(pr(Lm(t),"setParameters requires a WebGL context"),yS(e))return;const n={};for(const o in e){const u=Number(o),f=MR[o];f&&(typeof f=="string"?n[f]=!0:f(t,e[o],u))}const i=t.state&&t.state.cache;if(i)for(const o in n){const u=kR[o];u(t,e,i)}}function FR(t,e){if(e=e||vv,typeof e=="number"){const o=e,u=tw[o];return u?u(t,o):t.getParameter(o)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const o of n){const u=tw[o];i[o]=u?u(t,Number(o)):t.getParameter(Number(o))}return i}function BR(t){Ho(t,vv)}function Ns(t,e,n){if(yS(e))return n(t);const{nocatch:i=!0}=e;OR(t),Ho(t,e);let o;if(i)o=n(t),iw(t);else try{o=n(t)}finally{iw(t)}return o}function iu(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function E_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=iu(t),o=t.drawingBufferWidth,u=t.drawingBufferHeight;return UR(e,i,o,u,n)}function NR(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function UR(t,e,n,i,o){const u=rw(t[0],e,n);let f=sw(t[1],e,i,o),l=rw(t[0]+1,e,n);const b=l===n-1?l:l-1;l=sw(t[1]+1,e,i,o);let w;return o?(l=l===0?l:l+1,w=f,f=l):w=l===i-1?l:l-1,{x:u,y:f,width:Math.max(b-u+1,1),height:Math.max(w-f+1,1)}}function rw(t,e,n){return Math.min(Math.round(t*e),n-1)}function sw(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const xv=Zo(),VR=xv&&typeof document<"u",xS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function bS(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pr(xv,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},xS,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let o;const{canvas:u}=t,f=HR({canvas:u,width:e,height:n,onError:i});return o=$R(f,t),o?(o=bv(o,t),WR(o),o):null}function bv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||qR(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},xS,e);const{manageState:n,debug:i}=e;return n&&vS(t,{copyState:!1,log:function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];return Et.log(1,...u)()}}),xv&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Et.level=Math.max(Et.level,1)):Et.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function jR(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),o=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),u=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||e,renderer:u||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function GR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=NR(e.useDevicePixels);ZR(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function $R(t,e){const{onError:n}=e;let i=null;const o=b=>i=b.statusMessage||i;t.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:u=!0,webgl2:f=!0}=e;let l=null;return f&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),u&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",o,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(f&&!u?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function HR(t){let{canvas:e,width:n=800,height:i=600,onError:o}=t,u;return typeof e=="string"?(VR&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(e,"' before page was loaded")),u=document.getElementById(e)):e?u=e:(u=document.createElement("canvas"),u.id="lumagl-canvas",u.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",u.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(u,document.body.firstChild)),u}function WR(t){const e=Xt(t)?"WebGL2":"WebGL1",n=jR(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";Et.info(1,"".concat(e).concat(o," context ").concat(i))()}function qR(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function ZR(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;(!i||!o)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const u=t.luma.canvasSizeInfo;if(u.clientWidth!==i||u.clientHeight!==o||u.devicePixelRatio!==e){let f=e;const l=Math.floor(i*f),b=Math.floor(o*f);t.canvas.width=l,t.canvas.height=b,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==b)&&(Et.warn("Device pixel ratio clamped")(),f=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/o),t.canvas.width=Math.floor(i*f),t.canvas.height=Math.floor(o*f)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:o,devicePixelRatio:e})}}function ow(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class aw{constructor(e,n){V(this,"name",void 0),V(this,"type",void 0),V(this,"sampleSize",1),V(this,"time",void 0),V(this,"count",void 0),V(this,"samples",void 0),V(this,"lastTiming",void 0),V(this,"lastSampleTime",void 0),V(this,"lastSampleCount",void 0),V(this,"_count",0),V(this,"_time",0),V(this,"_samples",0),V(this,"_startTime",0),V(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ow(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ow()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class wv{constructor(e){V(this,"id",void 0),V(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof aw?this.stats[n]=e:this.stats[n]=new aw(n,i)),this.stats[n]}}const Vh="8.5.21",XR="set luma.log.level=1 (or higher) to trace rendering";class YR{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new wv({id:e})),this.stats.get(e)}}const Il=new YR;if(globalThis.luma&&globalThis.luma.VERSION!==Vh)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Vh));globalThis.luma||(Zo()&&Et.log(1,"luma.gl ".concat(Vh," - ").concat(XR))(),globalThis.luma=globalThis.luma||{VERSION:Vh,version:Vh,log:Et,stats:Il,globals:{modules:{},nodeIO:{}}});function KR(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function JR(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ut(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function T_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ut(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ba(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const S_={};function ja(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";S_[t]=S_[t]||1;const e=S_[t]++;return"".concat(t,"-").concat(e)}function lw(t){return ut(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function ru(t){let e=!0;for(const n in t){e=!1;break}return e}function wS(t,e,n,i){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),u=Object.getPrototypeOf(t);i.forEach(f=>{u.methodName||(u[f]=()=>{throw Et.removed("Calling removed method ".concat(e,".").concat(f,": "),o)(),new Error(f)})})}const wc="Resource subclass must define virtual methods";let Xo=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rm(e);const{id:i,userData:o={}}=n;this.gl=e,this.gl2=e,this.id=i||ja(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=T_(this.gl,e),ut(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Xt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const l=o.webgl1,b="webgl2"in o?o.webgl2:o.webgl1;return u?b:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,o=this.constructor.PARAMETERS||{},u=Xt(this.gl),f={},l=n||Object.keys(o);for(const b of l){const w=o[b];if(w&&(!("webgl2"in w)||u)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const L=i?Ba(this.gl,b):b;f[L]=this.getParameter(b,e),i&&w.type==="GLenum"&&(f[L]=Ba(this.gl,f[L]))}}return f}setParameter(e,n){e=T_(this.gl,e),ut(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Xt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=T_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return wS(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(wc)}_deleteHandle(){throw new Error(wc)}_bindHandle(e){throw new Error(wc)}_getOptsFromHandle(){throw new Error(wc)}_getParameter(e,n){throw new Error(wc)}_setParameter(e,n){throw new Error(wc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Il.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Il.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=Il.get("Memory Usage".concat(i));o.get("GPU Memory").addCount(e),o.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Il.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const QR="Failed to deduce GL constant from typed array";function $y(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(QR)}}function ad(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function eD(t){let{data:e,width:n,height:i,bytesPerPixel:o=4,temp:u}=t;const f=n*o;u=u||new Uint8Array(f);for(let l=0;l<i/2;++l){const b=l*f,w=(i-l-1)*f;u.set(e.subarray(b,b+f)),e.copyWithin(b,w,w+f),e.set(u,w)}}function tD(t){let{data:e,width:n,height:i}=t;const o=Math.round(n/2),u=Math.round(i/2),f=new Uint8Array(o*u*4);for(let l=0;l<u;l++)for(let b=0;b<o;b++)for(let w=0;w<4;w++)f[(l*o+b)*4+w]=e[(l*2*n+b*2)*4+w];return{data:f,width:o,height:u}}function Hy(t,e,n){const{removedProps:i={},deprecatedProps:o={},replacedProps:u={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Et.removed("".concat(t,".").concat(l),w)()}for(const l in o)if(l in e){const b=o[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))()}let f=null;for(const l in u)if(l in e){const b=u[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))(),f=f||Object.assign({},e),f[b]=e[l],delete f[l]}return f||e}const nD={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},iD={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class qr{static getBytesPerElement(e){return ad(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ut(e.size),ad(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new qr(nD,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return qr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return qr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Hy("Accessor",e,iD),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const cw=10,ES={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},rD={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:ES},sD={removedProps:ES};class wn extends Xo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/qr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/qr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Hy("Buffer",e,rD),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Hy("Buffer",e,sD),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new qr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:o=0}=e,u=e.byteLength||e.length;ut(n);const f=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(f,this.handle),o!==0||u!==void 0?(er(this.gl),this.gl.bufferSubData(this.target,i,n,o,u)):this.gl.bufferSubData(f,i,n),this.gl.bindBuffer(f,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:o=0,size:u}=e;const{gl:f}=this;return er(f),f.bindBuffer(36662,n.handle),f.bindBuffer(36663,this.handle),f.copyBufferSubData(36662,36663,i,o,u),f.bindBuffer(36662,null),f.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};er(this.gl);const u=ad(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(n),l=i;let b,w;e?(w=e.length,b=w-l):(b=Math.min(f,o||f),w=l+b);const M=Math.min(f,b);return o=o||M,ut(o<=M),e=e||new u(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,o),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?o!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,o):(ut(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(cw,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ut(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.usage),this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=e.slice(0,cw),this.bytesUsed=i,this._trackAllocatedMemory(i);const u=$y(e);return ut(u),this.setAccessor(new qr(this.accessor,{type:u})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ut(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=ad(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new qr(this.accessor,{type:$y(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Et.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Et.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Et.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Et.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new qr(this.accessor,e),this}}const Ev={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},TS={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},SS={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function oD(t,e){const n=Ev[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Xt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function aD(t,e){const n=Ev[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const lD=[9729,9728],uw=globalThis.WebGLBuffer||function(){};class Ol extends Xo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:o}=n;let u=!0;return i&&(u=u&&oD(e,i),u=u&&(!o||aD(e,i))),u}constructor(e,n){const{id:i=ja("texture"),handle:o,target:u}=n;super(e,{id:i,handle:o}),this.target=u,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then($=>this.initialize(Object.assign({},e,{pixels:$,data:$}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:o=null,format:u=6408,border:f=0,recreate:l=!1,parameters:b={},pixelStore:w={},textureUnit:M=void 0}=e;n||(n=o);let{width:L,height:C,dataFormat:W,type:Q,compressed:ne=!1,mipmaps:_e=!0}=e;const{depth:K=0}=e;return{width:L,height:C,compressed:ne,dataFormat:W,type:Q}=this._deduceParameters({format:u,type:Q,dataFormat:W,compressed:ne,data:n,width:L,height:C}),this.width=L,this.height=C,this.depth=K,this.format=u,this.type=Q,this.dataFormat=W,this.border=f,this.textureUnit=M,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),_e&&this._isNPOT()&&(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),_e=!1,this._updateForNPOT(b)),this.mipmaps=_e,this.setImageData({data:n,width:L,height:C,depth:K,format:u,type:Q,dataFormat:W,border:f,mipmaps:_e,parameters:w,compressed:ne}),_e&&this.generateMipmap(),this.setParameters(b),l&&(this.data=n),i&&(this._video={video:n,parameters:b,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:o=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ns(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:o=0,format:u=this.format,border:f=this.border,offset:l=0,parameters:b={}}=e;let{data:w=null,type:M=this.type,width:L=this.width,height:C=this.height,dataFormat:W=this.dataFormat,compressed:Q=!1}=e;w||(w=i),{type:M,dataFormat:W,compressed:Q,width:L,height:C}=this._deduceParameters({format:u,type:M,dataFormat:W,compressed:Q,data:w,width:L,height:C});const{gl:ne}=this;ne.bindTexture(this.target,this.handle);let _e=null;({data:w,dataType:_e}=this._getDataType({data:w,compressed:Q}));let K,$=0;if(Ns(this.gl,b,()=>{switch(_e){case"null":ne.texImage2D(n,o,u,L,C,f,W,M,w);break;case"typed-array":ne.texImage2D(n,o,u,L,C,f,W,M,w,l);break;case"buffer":K=er(ne),K.bindBuffer(35052,w.handle||w),K.texImage2D(n,o,u,L,C,f,W,M,l),K.bindBuffer(35052,null);break;case"browser-object":Xt(ne)?ne.texImage2D(n,o,u,L,C,f,W,M,w):ne.texImage2D(n,o,u,W,M,w);break;case"compressed":for(const[J,pe]of w.entries())ne.compressedTexImage2D(n,J,pe.format,pe.width,pe.height,f,pe.data),$+=pe.levelSize;break;default:ut(!1,"Unknown image data type")}}),_e==="compressed")this._trackAllocatedMemory($,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const J=TS[this.dataFormat]||4,pe=SS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*J*pe,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:o=null,x:u=0,y:f=0,width:l=this.width,height:b=this.height,level:w=0,format:M=this.format,type:L=this.type,dataFormat:C=this.dataFormat,compressed:W=!1,offset:Q=0,border:ne=this.border,parameters:_e={}}=e;if({type:L,dataFormat:C,compressed:W,width:l,height:b}=this._deduceParameters({format:M,type:L,dataFormat:C,compressed:W,data:o,width:l,height:b}),ut(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=i),o&&o.data){const K=o;o=K.data,l=K.shape[0],b=K.shape[1]}o instanceof wn&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,_e,()=>{if(W)this.gl.compressedTexSubImage2D(n,w,u,f,l,b,M,o);else if(o===null)this.gl.texSubImage2D(n,w,u,f,l,b,C,L,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,w,u,f,l,b,C,L,o,Q);else if(o instanceof uw){const K=er(this.gl);K.bindBuffer(35052,o),K.texSubImage2D(n,w,u,f,l,b,C,L,Q),K.bindBuffer(35052,null)}else Xt(this.gl)?er(this.gl).texSubImage2D(n,w,u,f,l,b,C,L,o):this.gl.texSubImage2D(n,w,u,f,C,L,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Et.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof wn?{data:n.handle,dataType:"buffer"}:n instanceof uw?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:o,height:u,dataFormat:f,type:l,compressed:b}=e;const w=Ev[n];return f=f||w&&w.dataFormat,l=l||w&&w.types[0],b=b||w&&w.compressed,{width:o,height:u}=this._deduceImageSize(i,o,u),{dataFormat:f,type:l,compressed:b,width:o,height:u,format:n,data:i}}_deduceImageSize(e,n,i){let o;return typeof ImageData<"u"&&e instanceof ImageData?o={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?o={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?o={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?o={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?o={width:e.videoWidth,height:e.videoHeight}:e?o={width:n,height:i}:o={width:n>=0?n:1,height:i>=0?i:1},ut(o,"Could not deduced texture size"),ut(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),ut(i===void 0||o.height===i,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ut(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Xt(this.gl)||!this.width||!this.height?!1:!lw(this.width)||!lw(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:lD.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let cD="";function uD(t,e){return ut(typeof t=="string"),t=cD+t,new Promise((n,i)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),o.crossOrigin=e&&e.crossOrigin||"anonymous",o.src=t}catch(o){i(o)}})}class Qr extends Ol{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ol.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rm(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:uD(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Wy=[34069,34070,34071,34072,34073,34074];class AS extends Ol{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rm(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:o=0,y:u=0,mipmapLevel:f=0}=e;return this._subImage({target:n,data:i,x:o,y:u,mipmapLevel:f})}async setCubeMapImageData(e){let{width:n,height:i,pixels:o,data:u,border:f=0,format:l=6408,type:b=5121}=e;const{gl:w}=this,M=o||u,L=await Promise.all(Wy.map(C=>{const W=M[C];return Promise.all(Array.isArray(W)?W:[W])}));this.bind(),Wy.forEach((C,W)=>{L[W].length>1&&this.opts.mipmaps!==!1&&Et.warn("".concat(this.id," has mipmap and multiple LODs."))(),L[W].forEach((Q,ne)=>{n&&i?w.texImage2D(C,ne,l,n,i,f,l,b,Q):w.texImage2D(C,ne,l,l,b,Q)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:o,pixels:u,data:f,border:l=0,format:b=6408,type:w=5121}=e,{gl:M}=this,L=u||f;return this.bind(),L instanceof Promise?L.then(C=>this.setImageDataForFace(Object.assign({},e,{face:n,data:C,pixels:C}))):this.width||this.height?M.texImage2D(n,0,b,i,o,l,b,w,L):M.texImage2D(n,0,b,b,w,L),this}}AS.FACES=Wy;class hD extends Ol{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:o,height:u,depth:f=1,border:l=0,format:b,type:w=5121,offset:M=0,data:L,parameters:C={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,C,()=>{ArrayBuffer.isView(L)&&this.gl.texImage3D(this.target,n,i,o,u,f,l,b,w,L),L instanceof wn&&(this.gl.bindBuffer(35052,L.handle),this.gl.texImage3D(this.target,n,i,o,u,f,l,b,w,M))}),L&&L.byteLength)this._trackAllocatedMemory(L.byteLength,"Texture");else{const W=TS[this.dataFormat]||4,Q=SS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*W*Q,"Texture")}return this.loaded=!0,this}}const yl="EXT_color_buffer_float",hw={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:yl,bpp:2},33327:{gl2:yl,bpp:4},34842:{gl2:yl,bpp:8},33326:{gl2:yl,bpp:4},33328:{gl2:yl,bpp:8},34836:{gl2:yl,bpp:16},35898:{gl2:yl,bpp:4}};function dD(t,e,n){const i=n[e];if(!i)return!1;const o=Xt(t)&&i.gl2||i.gl1;return typeof o=="string"?t.getExtension(o):o}class Nc extends Xo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||dD(e,n,hw)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:o=1,samples:u=0}=e;return ut(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),u!==0&&Xt(this.gl)?this.gl.renderbufferStorageMultisample(36161,u,n,i,o):this.gl.renderbufferStorage(36161,n,i,o),this.format=n,this.width=i,this.height=o,this.samples=u,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*hw[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const fD=256,pD=1024,mD=16384,dw=6144,fw=6145,pw=6146,mw=34041,IS="clear: bad arguments";function Tv(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};e&&(u.framebuffer=e);let f=0;n&&(f|=mD,n!==!0&&(u.clearColor=n)),i&&(f|=fD,i!==!0&&(u.clearDepth=i)),o&&(f|=pD,i!==!0&&(u.clearStencil=i)),ut(f!==0,IS),Ns(t,u,()=>{t.clear(f)})}function gD(t){let{framebuffer:e=null,buffer:n=dw,drawBuffer:i=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(t),Ns(t,{framebuffer:e},()=>{switch(n){case dw:switch(o.constructor){case Int32Array:t.clearBufferiv(n,i,o);break;case Uint32Array:t.clearBufferuiv(n,i,o);break;case Float32Array:default:t.clearBufferfv(n,i,o)}break;case fw:t.clearBufferfv(fw,0,[o]);break;case pw:t.clearBufferiv(pw,0,[o]);break;case mw:const[u,f]=o;t.clearBufferfi(mw,0,u,f);break;default:ut(!1,IS)}})}function _D(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ut(!1),0}}function Dm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:o=6408}=e;let{sourceAttachment:u=36064,target:f=null,sourceWidth:l,sourceHeight:b,sourceType:w}=e;const{framebuffer:M,deleteFramebuffer:L}=PS(t);ut(M);const{gl:C,handle:W,attachments:Q}=M;l=l||M.width,b=b||M.height,u===36064&&W===null&&(u=1028),ut(Q[u]),w=w||Q[u].type,f=vD(f,w,o,l,b),w=w||$y(f);const ne=C.bindFramebuffer(36160,W);return C.readPixels(n,i,l,b,o,w,f),C.bindFramebuffer(36160,ne||null),L&&M.delete(),f}function gw(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Dm(t,{sourceAttachment:e}),{width:o,height:u}=t;for(;u>n;)({data:i,width:o,height:u}=tD({data:i,width:o,height:u}));eD({data:i,width:o,height:u});const f=document.createElement("canvas");f.width=o,f.height=u;const l=f.getContext("2d"),b=l.createImageData(o,u);return b.data.set(i),l.putImageData(b,0,0),f.toDataURL()}function yD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:o=0,targetMipmaplevel:u=0,targetInternalFormat:f=6408}=n;let{targetX:l,targetY:b,targetZ:w,width:M,height:L}=n;const{framebuffer:C,deleteFramebuffer:W}=PS(t);ut(C);const{gl:Q,handle:ne}=C,_e=typeof l<"u"||typeof b<"u"||typeof w<"u";l=l||0,b=b||0,w=w||0;const K=Q.bindFramebuffer(36160,ne);ut(e);let $=null;if(e instanceof Ol&&($=e,M=Number.isFinite(M)?M:$.width,L=Number.isFinite(L)?L:$.height,$.bind(0),e=$.target),!_e)Q.copyTexImage2D(e,u,f,i,o,M,L,0);else switch(e){case 3553:case 34067:Q.copyTexSubImage2D(e,u,l,b,i,o,M,L);break;case 35866:case 32879:er(Q).copyTexSubImage3D(e,u,l,b,w,i,o,M,L);break}return $&&$.unbind(),Q.bindFramebuffer(36160,K||null),W&&C.delete(),$}function PS(t){return t instanceof yi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:CD(t),deleteFramebuffer:!0}}function vD(t,e,n,i,o){if(t)return t;e=e||5121;const u=ad(e,{clamped:!1}),f=_D(n);return new u(i*o*f)}const Rn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function xD(t){const e=new Qr(t,{format:6408,type:5126,dataFormat:6408}),n=new yi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const CS={[Rn.WEBGL2]:[!1,!0],[Rn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Rn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Rn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Rn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Rn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Rn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Rn.FLOAT_BLEND]:["EXT_float_blend"],[Rn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Rn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Rn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Rn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Rn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Rn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Rn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Rn.COLOR_ATTACHMENT_RGBA32F]:[xD,"EXT_color_buffer_float"],[Rn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Rn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Rn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Rn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Rn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Rn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},bD=2;function wD(t,e){return MS(t,e)}function MS(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>kS(t,n))}function ED(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in CS)t.luma.caps[e]===void 0&&(t.luma.caps[e]=kS(t,e));return t.luma.caps}function kS(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=TD(t,e)),t.luma.caps[e]||Et.log(bD,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function TD(t,e){const n=CS[e];ut(n,e);let i;const o=Xt(t)&&n[1]||n[0];if(typeof o=="function")i=o(t);else if(Array.isArray(o)){i=!0;for(const u of o)i=i&&!!t.getExtension(u)}else typeof o=="string"?i=!!t.getExtension(o):typeof o=="boolean"?i=o:ut(!1);return i}const _w="Multiple render targets not supported";class yi extends Xo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:o}=n;let u=!0;return i&&(u=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),o&&(u=u&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),u}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new yi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=er(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=er(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:o=null,color:u=!0,depth:f=!0,stencil:l=!1,check:b=!0,readBuffer:w=void 0,drawBuffers:M=void 0}=e;if(ut(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,o)for(const L in o){const C=o[L];(Array.isArray(C)?C[0]:C).resize({width:n,height:i})}else o=this._createDefaultAttachments(u,f,l,n,i);this.update({clearAttachments:!0,attachments:o,readBuffer:w,drawBuffers:M}),o&&b&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:o,clearAttachments:u=!1,resizeAttachments:f=!0}=e;this.attach(n,{clearAttachments:u,resizeAttachments:f});const{gl:l}=this,b=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),o&&this._setDrawBuffers(o),l.bindFramebuffer(36160,b||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ut(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Et.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(f=>{o[f]=null}),Object.assign(o,e);const u=this.gl.bindFramebuffer(36160,this.handle);for(const f in o){ut(f!==void 0,"Misspelled framebuffer binding point?");const l=Number(f),b=o[l];let w=b;if(!w)this._unattach(l);else if(w instanceof Nc)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(b)){const[M,L=0,C=0]=b;w=M,this._attachTexture({attachment:l,texture:M,layer:L,level:C})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(f=>!this.attachments[f]).forEach(f=>{delete this.attachments[f]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(AD(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:o,drawBuffers:u=[]}=e,f=this.gl.bindFramebuffer(36160,this.handle);return(n||i||o)&&Tv(this.gl,{color:n,depth:i,stencil:o}),u.forEach((l,b)=>{gD(this.gl,{drawBuffer:b,value:l})}),this.gl.bindFramebuffer(36160,f||null),this}readPixels(){return Et.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Et.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Et.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Et.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Et.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Et.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:o=0,width:u,height:f}=e;const l=er(this.gl),b=l.bindFramebuffer(36008,this.handle);return i===0&&o===0&&u===void 0&&f===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,o,u,f),l.bindFramebuffer(36008,b),this}getAttachmentParameter(e,n,i){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&o>1e3&&(o=Ba(this.gl,o)),o}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const u of i){const f=n?Ba(this.gl,u):u;o[f]=this.getAttachmentParameter(e,u,n)}return o}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const o of n){const u=Number(o),f=e?Ba(this.gl,u):u;i[f]=this.getAttachmentParameters(u,e)}return i}show(){return typeof window<"u"&&window.open(gw(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Et.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=gw(this,{targetMaxHeight:100});return Et.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,o,u){let f=null;return e&&(f=f||{},f[36064]=new Qr(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:u,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(f[36064])),n&&i?(f=f||{},f[33306]=new Nc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(f[33306])):n?(f=f||{},f[36096]=new Nc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:u}),this.ownResources.push(f[36096])):i&&ut(!1),f}_unattach(e){const n=this.attachments[e];n&&(n instanceof Nc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:o,level:u}=e;const{gl:f}=this;switch(f.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:er(f).framebufferTextureLayer(36160,n,i.target,u,o);break;case 34067:const b=SD(o);f.framebufferTexture2D(36160,n,b,i.handle,u);break;case 3553:f.framebufferTexture2D(36160,n,3553,i.handle,u);break;default:ut(!1,"Illegal texture type")}f.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=eR(this.gl);n?n.readBuffer(e):ut(e===36064||e===1029,_w),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=er(n);if(i)i.drawBuffers(e);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(e):ut(e.length===1&&(e[0]===36064||e[0]===1029),_w)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=ED(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function SD(t){return t<34069?t+34069:t}function AD(t){return(yi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const ID=[36049,36048,33296,33298,33299,33300,33301,33302,33303];yi.ATTACHMENT_PARAMETERS=ID;function PD(t,e){ut(t instanceof Qr||t instanceof AS||t instanceof hD);const n=t.constructor,{gl:i,width:o,height:u,format:f,type:l,dataFormat:b,border:w,mipmaps:M}=t,L=Object.assign({width:o,height:u,format:f,type:l,dataFormat:b,border:w,mipmaps:M},e);return new n(i,L)}function CD(t,e){const{gl:n,width:i,height:o,id:u}=t;return new yi(n,Object.assign({},e,{id:"framebuffer-for-".concat(u),width:i,height:o,attachments:{36064:t}}))}function bp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const MD=35632,kD=35633;function LD(t){switch(t){case MD:return"fragment";case kD:return"vertex";default:return"unknown type"}}function RD(t,e,n,i){const o=t.split(/\r?\n/),u={},f={},l=i||bp(e)||"(unnamed)",b="".concat(LD(n)," shader ").concat(l);for(let M=0;M<o.length;M++){const L=o[M];if(L.length<=1)continue;const C=L.split(":"),W=C[0],Q=parseInt(C[2],10);if(isNaN(Q))throw new Error("GLSL compilation error in ".concat(b,": ").concat(t));W!=="WARNING"?u[Q]=L:f[Q]=L}const w=DD(e);return{shaderName:b,errors:yw(u,w),warnings:yw(f,w)}}function yw(t,e){let n="";for(let i=0;i<e.length;i++){const o=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(o,`
`),t[i+1])){const u=t[i+1],f=u.split(":",3),l=f[0],b=parseInt(f[1],10)||0,w=u.substring(f.join(":").length+1).trim();n+=LS("^^^ ".concat(l,": ").concat(w,`

`),b)}}return n}function DD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),o=String(i.length+e-1).length;return i.map((u,f)=>{const l=String(f+e),b=l.length;return LS(l,o-b)+n+u})}function LS(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function RS(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const zD="Shader: GLSL source code must be a JavaScript string";class ld extends Xo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ut(!1),"unknown"}}constructor(e,n){Rm(e),ut(typeof n.source=="string",zD);const i=bp(n.source,null)||n.id||ja("unnamed ".concat(ld.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=bp(n,null);i&&(this.id=ja(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(ld.getTypeName(this.shaderType),":").concat(this.id)}getName(){return bp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:u,warnings:f}=RD(i,this.source,this.shaderType,this.id);throw Et.error("GLSL compilation errors in ".concat(o,`
`).concat(u))(),Et.warn("GLSL compilation warnings in ".concat(o,`
`).concat(f))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class A_ extends ld{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class I_ extends ld{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const OD={5126:In.bind(null,"uniform1fv",Gr,1,Ki),35664:In.bind(null,"uniform2fv",Gr,2,Ki),35665:In.bind(null,"uniform3fv",Gr,3,Ki),35666:In.bind(null,"uniform4fv",Gr,4,Ki),5124:In.bind(null,"uniform1iv",ya,1,Ki),35667:In.bind(null,"uniform2iv",ya,2,Ki),35668:In.bind(null,"uniform3iv",ya,3,Ki),35669:In.bind(null,"uniform4iv",ya,4,Ki),35670:In.bind(null,"uniform1iv",ya,1,Ki),35671:In.bind(null,"uniform2iv",ya,2,Ki),35672:In.bind(null,"uniform3iv",ya,3,Ki),35673:In.bind(null,"uniform4iv",ya,4,Ki),35674:In.bind(null,"uniformMatrix2fv",Gr,4,Lo),35675:In.bind(null,"uniformMatrix3fv",Gr,9,Lo),35676:In.bind(null,"uniformMatrix4fv",Gr,16,Lo),35678:Oi,35680:Oi,5125:In.bind(null,"uniform1uiv",Kf,1,Ki),36294:In.bind(null,"uniform2uiv",Kf,2,Ki),36295:In.bind(null,"uniform3uiv",Kf,3,Ki),36296:In.bind(null,"uniform4uiv",Kf,4,Ki),35685:In.bind(null,"uniformMatrix2x3fv",Gr,6,Lo),35686:In.bind(null,"uniformMatrix2x4fv",Gr,8,Lo),35687:In.bind(null,"uniformMatrix3x2fv",Gr,6,Lo),35688:In.bind(null,"uniformMatrix3x4fv",Gr,12,Lo),35689:In.bind(null,"uniformMatrix4x2fv",Gr,8,Lo),35690:In.bind(null,"uniformMatrix4x3fv",Gr,12,Lo),35678:Oi,35680:Oi,35679:Oi,35682:Oi,36289:Oi,36292:Oi,36293:Oi,36298:Oi,36299:Oi,36300:Oi,36303:Oi,36306:Oi,36307:Oi,36308:Oi,36311:Oi},FD={},BD={},ND={},vw=[0];function Sv(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(vw[0]=t,t=vw);const o=t.length;if(o%e&&Et.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let u=i[o];u||(u=new n(o),i[o]=u);for(let f=0;f<o;f++)u[f]=t[f];return u}function Gr(t,e){return Sv(t,e,Float32Array,FD)}function ya(t,e){return Sv(t,e,Int32Array,BD)}function Kf(t,e){return Sv(t,e,Uint32Array,ND)}function xw(t,e,n){const i=OD[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function UD(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function VD(t,e,n){for(const i in t){const o=t[i];if((!n||!!n[i])&&!jD(o))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),o),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function jD(t){return Array.isArray(t)||ArrayBuffer.isView(t)?$D(t):isFinite(t)||t===!0||t===!1||t instanceof Ol||t instanceof Nc?!0:t instanceof yi?!!t.texture:!1}function GD(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let o=0,u=n.length;o<u;++o)i[o]=n[o]}else t[e]=n.slice();else t[e]=n}function $D(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Oi(){let t=null;return(e,n,i)=>{const o=t!==i;return o&&(e.uniform1i(n,i),t=i),o}}function In(t,e,n,i){let o=null,u=null;return(f,l,b)=>{const w=e(b,n),M=w.length;let L=!1;if(o===null)o=new Float32Array(M),u=M,L=!0;else{ut(u===M,"Uniform length cannot change.");for(let C=0;C<M;++C)if(w[C]!==o[C]){L=!0;break}}return L&&(i(f,t,l,w),o.set(w)),L}}function Ki(t,e,n,i){t[e](n,i)}function Lo(t,e,n,i){t[e](n,!1,i)}const HD=5120,WD=5121,qD=5122,ZD=5123,bw=0,Jf=1,XD=2,YD=3,Qf=4,KD=5,JD=6,mi=5126,QD=35664,ez=35665,tz=35666,vh=5124,nz=35667,iz=35668,rz=35669,xh=5125,sz=36294,oz=36295,az=36296,lz=35670,cz=35671,uz=35672,hz=35673,dz=35674,fz=35675,pz=35676,mz=35685,gz=35686,_z=35687,yz=35688,vz=35689,xz=35690,qy={[mi]:[mi,1,"float"],[QD]:[mi,2,"vec2"],[ez]:[mi,3,"vec3"],[tz]:[mi,4,"vec4"],[vh]:[vh,1,"int"],[nz]:[vh,2,"ivec2"],[iz]:[vh,3,"ivec3"],[rz]:[vh,4,"ivec4"],[xh]:[xh,1,"uint"],[sz]:[xh,2,"uvec2"],[oz]:[xh,3,"uvec3"],[az]:[xh,4,"uvec4"],[lz]:[mi,1,"bool"],[cz]:[mi,2,"bvec2"],[uz]:[mi,3,"bvec3"],[hz]:[mi,4,"bvec4"],[dz]:[mi,8,"mat2"],[mz]:[mi,8,"mat2x3"],[gz]:[mi,8,"mat2x4"],[fz]:[mi,12,"mat3"],[_z]:[mi,12,"mat3x2"],[yz]:[mi,12,"mat3x4"],[pz]:[mi,16,"mat4"],[vz]:[mi,16,"mat4x2"],[xz]:[mi,16,"mat4x3"]};function bz(t){switch(t){case bw:return bw;case Jf:return Jf;case YD:return Jf;case XD:return Jf;case Qf:return Qf;case KD:return Qf;case JD:return Qf;default:return ut(!1),0}}function ww(t){const e=qy[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function DS(t,e){switch(t){case HD:case WD:case qD:case ZD:t=mi;break}for(const n in qy){const[i,o,u]=qy[n];if(i===t&&o===e)return{glType:n,name:u}}return null}class wz{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getActiveAttrib(e.handle,o),b=n.getAttribLocation(e.handle,u);b>=0&&this._addAttribute(b,u,f,l)}this.attributeInfos.sort((o,u)=>o.location-u.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Xt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getTransformFeedbackVarying(e.handle,o);this._addVarying(o,u,f,l)}this.varyingInfos.sort((o,u)=>o.location-u.location)}_addAttribute(e,n,i,o){const{type:u,components:f}=ww(i),l={type:u,size:o*f};this._inferProperties(e,n,l);const b={location:e,name:n,accessor:new qr(l)};this.attributeInfos.push(b),this.attributeInfosByLocation[e]=b,this.attributeInfosByName[b.name]=b}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,o){const{type:u,components:f}=ww(i),l=new qr({type:u,size:o*f}),b={location:e,name:n,accessor:l};this.varyingInfos.push(b),this.varyingInfosByName[b.name]=b}}const Ew=4,Ez=35981,Tz=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class zS extends Xo{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",Tz),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:o,varyings:u,bufferMode:f=Ez}=e;return this.hash=n||"",this.vs=typeof i=="string"?new A_(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof o=="string"?new I_(this.gl,{id:"".concat(e.id,"-fs"),source:o}):o,ut(this.vs instanceof A_),ut(this.fs instanceof I_),this.uniforms={},this._textureUniforms={},u&&u.length>0&&(er(this.gl),this.varyings=u,this.gl2.transformFeedbackVaryings(this.handle,u,f)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new wz(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:o,offset:u=0,start:f,end:l,isIndexed:b=!1,indexType:w=5123,instanceCount:M=0,isInstanced:L=M>0,vertexArray:C=null,transformFeedback:W,framebuffer:Q,parameters:ne={},uniforms:_e,samplers:K}=e;if((_e||K)&&(Et.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(_e||{})),Et.priority>=n){const $=Q?Q.id:"default",J="mode=".concat(Ba(this.gl,i)," verts=").concat(o," ")+"instances=".concat(M," indexType=").concat(Ba(this.gl,w)," ")+"isInstanced=".concat(L," isIndexed=").concat(b," ")+"Framebuffer=".concat($);Et.log(n,J)()}return ut(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||L&&M===0?!1:(C.bindForDraw(o,M,()=>{if(Q!==void 0&&(ne=Object.assign({},ne,{framebuffer:Q})),W){const $=bz(i);W.begin($)}this._bindTextures(),Ns(this.gl,ne,()=>{b&&L?this.gl2.drawElementsInstanced(i,o,w,u,M):b&&Xt(this.gl)&&!isNaN(f)&&!isNaN(l)?this.gl2.drawRangeElements(i,f,l,o,w,u):b?this.gl.drawElements(i,o,w,u):L?this.gl2.drawArraysInstanced(i,u,o,M):this.gl.drawArrays(i,u,o)}),W&&W.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Et.priority>=2&&VD(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],o=this._uniformSetters[n];if(o){let u=i,f=!1;if(u instanceof yi&&(u=u.texture),u instanceof Ol)if(f=this.uniforms[n]!==i,f){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const l=u,{textureIndex:b}=o;l.bind(b),u=b,this._textureUniforms[n]=l}else u=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(u)||f)&&GD(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new A_({handle:o});break;case 35632:i.fs=new I_({handle:o});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=ja(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Et.time(Ew,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Et.timeEnd(Ew,"linkProgram for ".concat(this._getName()))(),e.debug||Et.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:o}=UD(i.name);let u=e.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=xw(e,u,i),i.size>1)for(let f=0;f<i.size;f++)u=e.getUniformLocation(this.handle,"".concat(o,"[").concat(f,"]")),this._uniformSetters["".concat(o,"[").concat(f,"]")]=xw(e,u,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const Sz=34918,Az=34919,Iz=35007,Pz=36795,Cz=35976,Mz=35887,kz=36202;class nm extends Xo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Xt(e),o=MS(e,Rn.TIMER_QUERY);let u=i||o;for(const f of n)switch(f){case"queries":u=u&&i;break;case"timers":u=u&&o;break;default:ut(!1)}return u}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Iz)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?kz:Mz)}beginTransformFeedbackQuery(){return this.begin(Cz)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,Az);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(Pz)}getResult(){return this.gl2.getQueryParameter(this.handle,Sz)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const u=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}_createHandle(){return nm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class OS extends Xo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,ru(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:o,byteSize:u,byteOffset:f}=this._getBufferParams(n);return i<0?(this.unused[e]=o,Et.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,o,f,u),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,o;return e instanceof wn?o=e:(o=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:o}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,o,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const u=n&&n.handle;return!u||o===void 0?this.gl.bindBufferBase(35982,e,u):this.gl.bindBufferRange(35982,e,u,i,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let ep=null;function Lz(t){return(!ep||ep.byteLength<t)&&(ep=new ArrayBuffer(t)),ep}function Rz(t,e){const n=Lz(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function Dz(t){let{target:e,source:n,start:i=0,count:o=1}=t;const u=n.length,f=o*u;let l=0;for(let b=i;l<u;l++)e[b++]=n[l];for(;l<f;)l<f-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+f-l),l=f);return e}const zz="elements must be GL.ELEMENT_ARRAY_BUFFER";class $r extends Xo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Xt(e)||pS()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new $r(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return $r.MAX_ATTRIBUTES=$r.MAX_ATTRIBUTES||e.getParameter(34921),$r.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:$r._setConstantFloatArray(e,n,i);break;case Int32Array:$r._setConstantIntArray(e,n,i);break;case Uint32Array:$r._setConstantUintArray(e,n,i);break;default:ut(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return $r.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ut(!e||e.target===34963,zz),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:o,type:u,stride:f,offset:l,normalized:b,integer:w,divisor:M}=i,{gl:L,gl2:C}=this;return e=Number(e),this.bind(()=>{L.bindBuffer(34962,n.handle),w?(ut(Xt(L)),C.vertexAttribIPointer(e,o,u,f,l)):L.vertexAttribPointer(e,o,u,b,f,l),L.enableVertexAttribArray(e),C.vertexAttribDivisor(e,M||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!$r.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),o=i.byteLength*e,u=i.length*e;let f=!this.buffer;if(this.buffer=this.buffer||new wn(this.gl,o),f=f||this.buffer.reallocate(o),f=f||!this._compareConstantArrayValues(i,this.bufferValue),f){const l=Rz(n.constructor,u);Dz({target:l,source:i,start:0,count:u}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ut(!1)}}static _setConstantIntArray(e,n,i){switch(ut(Xt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ut(!1)}}static _setConstantUintArray(e,n,i){switch(ut(Xt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ut(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ut(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const Oz="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Fz=/^(.+)__LOCATION_([0-9]+)$/,Bz=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Nz{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new $r(e),wS(this,"VertexArray","v6.0",Bz),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return o>=0&&(this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,u)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new wn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof wn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof wn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),o=i()}),o}_resolveLocationAndAccessor(e,n,i,o){const u={location:-1,accessor:null},{location:f,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(f)||f<0)return this.unused[e]=n,Et.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),u;const b=this._getAttributeInfo(l||f);if(!b)return u;const w=this.accessors[f]||{},M=qr.resolve(b.accessor,w,i,o),{size:L,type:C}=M;return ut(Number.isFinite(L)&&Number.isFinite(C)),{location:f,accessor:M}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=Fz.exec(e),o=i?i[1]:e,u=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+u,name:o}:{location:-1}}_setAttribute(e,n){if(n instanceof wn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof wn){const i=n[0],o=n[1];this.setBuffer(e,i,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof wn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(Oz)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,i);for(let u=1;u<this.vertexArrayObject.MAX_ATTRIBUTES;u++)o=this.values[u],ArrayBuffer.isView(o)&&this._setConstantAttribute(u,o)}_setConstantAttributeZero(e,n){if($r.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){$r.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],o=this.accessors[n];if(!i)return;const{divisor:u}=o,f=u>0;if(e.isInstanced=e.isInstanced||f,i instanceof wn){const l=i;if(f){const b=l.getVertexCount(o);e.instanceCount=Math.min(e.instanceCount,b)}else{const b=l.getVertexCount(o);e.vertexCount=Math.min(e.vertexCount,b)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Et.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function Uz(t,e){const{maxElts:n=16,size:i=1}=e;let o="[";for(let f=0;f<t.length&&f<n;++f)f>0&&(o+=",".concat(f%i===0?" ":"")),o+=cd(t[f],e);const u=t.length>n?"...":"]";return"".concat(o).concat(u)}function cd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return Uz(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const o=t.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function Tw(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:o=!1}=t;ut(n);const u=".*_.*",f=".*Matrix",l=n._uniformSetters,b={},w=Object.keys(l).sort();let M=0;for(const W of w)!W.match(u)&&!W.match(f)&&P_({table:b,header:e,uniforms:i,uniformName:W,undefinedOnly:o})&&M++;for(const W of w)W.match(f)&&P_({table:b,header:e,uniforms:i,uniformName:W,undefinedOnly:o})&&M++;for(const W of w)b[W]||P_({table:b,header:e,uniforms:i,uniformName:W,undefinedOnly:o})&&M++;let L=0;const C={};if(!o)for(const W in i){const Q=i[W];b[W]||(L++,C[W]={Type:"NOT USED: ".concat(Q),[e]:cd(Q)})}return{table:b,count:M,unusedTable:C,unusedCount:L}}function P_(t){let{table:e,header:n,uniforms:i,uniformName:o,undefinedOnly:u}=t;const f=i[o],l=Vz(f);return!u||!l?(e[o]={[n]:l?cd(f):"N/A","Uniform Type":l?f:"NOT PROVIDED"},!0):!1}function Vz(t){return t!=null}function jz(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=Sw(e,e.elements,null,n));const o=e.values;for(const u in o){const f=e._getAttributeInfo(u);if(f){let l="".concat(u,": ").concat(f.name);const b=e.accessors[f.location];b&&(l="".concat(u,": ").concat(Gz(f.name,b))),i[l]=Sw(e,o[u],b,n)}}return i}function Sw(t,e,n,i){const{gl:o}=t;if(!e)return{[i]:"null","Format ":"N/A"};let u="NOT PROVIDED",f=1,l=0,b=0,w,M,L;if(n&&(u=n.type,f=n.size,u=String(u).replace("Array",""),w=u.indexOf("nt")!==-1),e instanceof wn){const C=e,{data:W,changed:Q}=C.getDebugData();M=Q?"*":"",L=W,b=C.byteLength,l=b/W.BYTES_PER_ELEMENT/f;let ne;if(n){const _e=n.divisor>0;ne="".concat(_e?"I ":"P "," ").concat(l," (x").concat(f,"=").concat(b," bytes ").concat(Ba(o,u),")")}else w=!0,ne="".concat(b," bytes");return{[i]:"".concat(M).concat(cd(L,{size:f,isInteger:w})),"Format ":ne}}return L=e,f=e.length,u=String(e.constructor.name).replace("Array",""),w=u.indexOf("nt")!==-1,{[i]:"".concat(cd(L,{size:f,isInteger:w})," (constant)"),"Format ":"".concat(f,"x").concat(u," (constant)")}}function Gz(t,e){const{type:n,size:i}=e,o=DS(n,i);return o?"".concat(t," (").concat(o.name,")"):t}function $z(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const o=Aw(i);e["in ".concat(o)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const o=Aw(i);e["out ".concat(o)]={[n]:JSON.stringify(i.accessor)}}return e}function Aw(t){const{type:e,size:n}=t.accessor,i=DS(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Iw=Zo()&&typeof document<"u";let Hz=0;class Wz{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=_e=>bS(_e),onAddHTML:i=null,onInitialize:o=()=>{},onRender:u=()=>{},onFinalize:f=()=>{},onError:l,gl:b=null,glOptions:w={},debug:M=!1,createFramebuffer:L=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:W=!0,stats:Q=Il.get("animation-loop-".concat(Hz++))}=e;let{useDevicePixels:ne=!0}=e;"useDevicePixelRatio"in e&&(Et.deprecated("useDevicePixelRatio","useDevicePixels")(),ne=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:o,onRender:u,onFinalize:f,onError:l,gl:b,glOptions:w,debug:M,createFramebuffer:L},this.gl=b,this.needsRedraw=null,this.timeline=null,this.stats=Q,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:W,useDevicePixels:ne}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ut(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=nm.isSupported(this.gl,["timers"])?new nm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Et.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Iw?new Promise((e,n)=>{if(Iw&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):JR(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):KR(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?bv(this.props.gl,e):this.onCreateContext(e),!Lm(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");BR(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:o}=this.gl;return o&&o.clientHeight?i=o.clientWidth/o.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&GR(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new yi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Ed="vs",Av="fs";function Kr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const C_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function qz(t){const e={};for(const n in t){const i=t[n],o=Zz(i);e[n]=o}return e}function Zz(t){let e=Pw(t);return e==="object"?t?"type"in t?Object.assign({},t,C_[t.type]):"value"in t?(e=Pw(t.value),Object.assign({type:e},t,C_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},C_[e])}function Pw(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const Xz="vs",Yz="fs";class Cw{constructor(e){let{name:n,vs:i,fs:o,dependencies:u=[],uniforms:f,getUniforms:l,deprecations:b=[],defines:w={},inject:M={},vertexShader:L,fragmentShader:C}=e;Kr(typeof n=="string"),this.name=n,this.vs=i||L,this.fs=o||C,this.getModuleUniforms=l,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(b),this.defines=w,this.injections=Kz(M),f&&(this.uniforms=qz(f))}getModuleSource(e){let n;switch(e){case Xz:n=this.vs||"";break;case Yz:n=this.fs||"";break;default:Kr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const o in i){const u=i[o];o in e&&!u.private?(u.validate&&Kr(u.validate(e[o],u),"".concat(this.name,": invalid ").concat(o)),n[o]=e[o]):n[o]=u.value}return n}}function Kz(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const o=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[o][n]=i}return e}function Jz(t){return Qz(BS(t))}function Qz(t){const e={},n={};return FS({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,o)=>n[o]-n[i]).map(i=>e[i])}function FS(t){let{modules:e,level:n,moduleMap:i,moduleDepth:o}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)i[u.name]=u,(o[u.name]===void 0||o[u.name]<n)&&(o[u.name]=n);for(const u of e)u.dependencies&&FS({modules:u.dependencies,level:n+1,moduleMap:i,moduleDepth:o})}function BS(t,e){return t.map(n=>(n instanceof Cw||(Kr(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Kr(n.name,"shader module has no name"),n=new Cw(n),n.dependencies=BS(n.dependencies)),n))}function eO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o}const tO=7936,nO=7937,iO=7938,rO=35724,Iv={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},El={};Object.keys(Iv).forEach(t=>{El[t]=t});function sO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function oO(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||tO),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||nO);return{gpuVendor:aO(n,i),vendor:n,renderer:i,version:t.getParameter(iO),shadingLanguageVersion:t.getParameter(rO)}}function aO(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const M_={};function Mw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Iv[e];if(Kr(i,e),!eO(n))return!0;if(e in M_)return M_[e];const o=i[0],u=n.behavior||"enable",f="#extension GL_".concat(o," : ").concat(u,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,f),t.compileShader(l);const b=t.getShaderParameter(l,35713);return t.deleteShader(l),M_[e]=b,b}function lO(t,e){const n=Iv[e];Kr(n,e);const i=sO(t)&&n[1]||n[0],o=typeof i=="string"?!!t.getExtension(i):i;return Kr(o===!1||o===!0),o}function tp(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>lO(t,n))}function cO(t){switch(oO(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function uO(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return tp(t,El.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),tp(t,El.GLSL_DERIVATIVES)&&Mw(t,El.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),tp(t,El.GLSL_FRAG_DATA)&&Mw(t,El.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),tp(t,El.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const hO=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dO=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,fO={[Ed]:hO,[Av]:dO},wp="__LUMA_INJECT_DECLARATIONS__",kw=/void\s+main\s*\([^)]*\)\s*\{\n?/,Lw=/}\n?[^{}]*$/,k_=[];function Rw(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=e===Ed;for(const u in n){const f=n[u];f.sort((b,w)=>b.order-w.order),k_.length=f.length;for(let b=0,w=f.length;b<w;++b)k_[b]=f[b].injection;const l="".concat(k_.join(`
`),`
`);switch(u){case"vs:#decl":o&&(t=t.replace(wp,l));break;case"vs:#main-start":o&&(t=t.replace(kw,b=>b+l));break;case"vs:#main-end":o&&(t=t.replace(Lw,b=>l+b));break;case"fs:#decl":o||(t=t.replace(wp,l));break;case"fs:#main-start":o||(t=t.replace(kw,b=>b+l));break;case"fs:#main-end":o||(t=t.replace(Lw,b=>l+b));break;default:t=t.replace(u,b=>b+l)}}return t=t.replace(wp,""),i&&(t=t.replace(/\}\s*$/,u=>u+fO[e])),t}function Zy(t){const e={};return Kr(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function su(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const NS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],pO=[...NS,[su("attribute"),"in $1"],[su("varying"),"out $1"]],mO=[...NS,[su("varying"),"in $1"]],US=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],gO=[...US,[su("in"),"attribute $1"],[su("out"),"varying $1"]],_O=[...US,[su("in"),"varying $1"]],Xy="gl_FragColor",Yy=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,yO=/void\s+main\s*\([^)]*\)\s*\{\n?/;function vO(t,e,n){switch(e){case 300:return n?im(t,pO):xO(t);case 100:return n?im(t,gO):bO(t);default:throw new Error("unknown GLSL version ".concat(e))}}function im(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function xO(t){t=im(t,mO);const e=t.match(Yy);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Xy,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(yO,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Xy,"\\b"),"g"),n)}return t}function bO(t){t=im(t,_O);const e=t.match(Yy);if(e){const n=e[1];t=t.replace(Yy,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Xy)}return t}const wO=`

`.concat(wp,`

`),VS={[Ed]:"vertex",[Av]:"fragment"},EO=`precision highp float;

`;function TO(t,e){const{vs:n,fs:i}=e,o=Jz(e.modules||[]);return{gl:t,vs:Dw(t,Object.assign({},e,{source:n,type:Ed,modules:o})),fs:Dw(t,Object.assign({},e,{source:i,type:Av,modules:o})),getUniforms:SO(o)}}function Dw(t,e){let{id:n,source:i,type:o,modules:u,defines:f={},hookFunctions:l=[],inject:b={},transpileToGLSL100:w=!1,prologue:M=!0,log:L}=e;Kr(typeof i=="string","shader source must be a string");const C=o===Ed,W=i.split(`
`);let Q=100,ne="",_e=i;W[0].indexOf("#version ")===0?(Q=300,ne=W[0],_e=W.slice(1).join(`
`)):ne="#version ".concat(Q);const K={};u.forEach(Oe=>{Object.assign(K,Oe.getDefines())}),Object.assign(K,f);let $=M?"".concat(ne,`
`).concat(IO({id:n,source:i,type:o}),`
`).concat(AO({type:o}),`
`).concat(cO(t),`
`).concat(uO(t),`
`).concat(PO(K),`
`).concat(C?"":EO,`
`):"".concat(ne,`
`);const J=MO(l),pe={},ye={},Ae={};for(const Oe in b){const Be=typeof b[Oe]=="string"?{injection:b[Oe],order:0}:b[Oe],Xe=Oe.match(/^(v|f)s:(#)?([\w-]+)$/);if(Xe){const je=Xe[2],mt=Xe[3];je?mt==="decl"?ye[Oe]=[Be]:Ae[Oe]=[Be]:pe[Oe]=[Be]}else Ae[Oe]=[Be]}for(const Oe of u){L&&Oe.checkDeprecations(_e,L);const Be=Oe.getModuleSource(o,Q);$+=Be;const Xe=Oe.injections[o];for(const je in Xe){const mt=je.match(/^(v|f)s:#([\w-]+)$/);if(mt){const qt=mt[2]==="decl"?ye:Ae;qt[je]=qt[je]||[],qt[je].push(Xe[je])}else pe[je]=pe[je]||[],pe[je].push(Xe[je])}}return $+=wO,$=Rw($,o,ye),$+=CO(J[o],pe),$+=_e,$=Rw($,o,Ae),$=vO($,w?100:Q,C),$}function SO(t){return function(n){const i={};for(const o of t){const u=o.getUniforms(n,i);Object.assign(i,u)}return i}}function AO(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(VS[e].toUpperCase(),`
`)}function IO(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(VS[i],`

`):""}function PO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const o=t[i];(o||Number.isFinite(o))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function CO(t,e){let n="";for(const i in t){const o=t[i];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),e[i]){const u=e[i];u.sort((f,l)=>f.order-l.order);for(const f of u)n+="  ".concat(f.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function MO(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[o,u]=n.split(":"),f=n.replace(/\(.+/,"");e[o][f]=Object.assign(i,{signature:u})}),e}const kO="void main() {gl_FragColor = vec4(0);}",jS=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,LO=`#version 300 es
`.concat(jS);function GS(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,o,u]=n;if(!e.includes(i)||!o||!u)return null;const f=u.split(";")[0];return{qualifier:i,type:o,name:f}}function $S(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:o}=t;if(!n)return e===300?LO:e>300?"#version ".concat(e,`
`).concat(jS):kO;const u=zO(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(u,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(u,`;
}`)}function RO(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Kr(!1),null}}function DO(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Kr(!1),null}}function zO(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Kr(!1),null}}const OO=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,FO={name:"fp32",vs:OO,fs:null};function zw(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Xr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function BO(t,{precision:e=Xr.precision}={}){return t=NO(t),"".concat(parseFloat(t.toPrecision(e)))}function ou(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Pa(t,e,n){return VO(t,i=>Math.max(e,Math.min(n,i)))}function rm(t,e,n){return ou(t)?t.map((i,o)=>rm(i,e[o],n)):n*e+(1-n)*t}function ud(t,e,n){const i=Xr.EPSILON;n&&(Xr.EPSILON=n);try{if(t===e)return!0;if(ou(t)&&ou(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!ud(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Xr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Xr.EPSILON=i}}function NO(t){return Math.round(t/Xr.EPSILON)*Xr.EPSILON}function UO(t){return t.clone?t.clone():new Array(t.length)}function VO(t,e,n){if(ou(t)){const i=t;n=n||UO(i);for(let o=0;o<n.length&&o<i.length;++o)n[o]=e(t[o],o,n);return n}return e(t)}function jO(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class HS extends jO(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ou(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Xr)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+BO(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ud(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let o=0;o<this.ELEMENTS;++o){const u=e[o];this[o]=u+i*(n[o]-u)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Xr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function GO(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Wr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function L_(t,e,n=""){if(Xr.debug&&!GO(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class $O extends HS{get x(){return this[0]}set x(e){this[0]=Wr(e)}get y(){return this[1]}set y(e){this[1]=Wr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const o=this[i]-e[i];n+=o*o}return Wr(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return Wr(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return zw(e>=0&&e<this.ELEMENTS,"index is out of range"),Wr(this[e])}setComponent(e,n){return zw(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Ep=1e-6,au=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function HO(){var t=new au(2);return au!=Float32Array&&(t[0]=0,t[1]=0),t}function Ow(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function WO(t,e){return t[0]=-e[0],t[1]=-e[1],t}function WS(t,e,n,i){var o=e[0],u=e[1];return t[0]=o+i*(n[0]-o),t[1]=u+i*(n[1]-u),t}function qO(t,e,n){var i=e[0],o=e[1];return t[0]=n[0]*i+n[4]*o+n[12],t[1]=n[1]*i+n[5]*o+n[13],t}(function(){var t=HO();return function(e,n,i,o,u,f){var l,b;for(n||(n=2),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],u(t,t,f),e[l]=t[0],e[l+1]=t[1];return e}})();function ZO(t,e,n){const i=e[0],o=e[1],u=n[3]*i+n[7]*o||1;return t[0]=(n[0]*i+n[4]*o)/u,t[1]=(n[1]*i+n[5]*o)/u,t}function qS(t,e,n){const i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u||1;return t[0]=(n[0]*i+n[4]*o+n[8]*u)/f,t[1]=(n[1]*i+n[5]*o+n[9]*u)/f,t[2]=(n[2]*i+n[6]*o+n[10]*u)/f,t}function XO(t,e,n){const i=e[0],o=e[1];return t[0]=n[0]*i+n[2]*o,t[1]=n[1]*i+n[3]*o,t[2]=e[2],t}function YO(){var t=new au(3);return au!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function KO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function JO(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function QO(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eF(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[0],l=n[1],b=n[2];return t[0]=o*b-u*l,t[1]=u*f-i*b,t[2]=i*l-o*f,t}function ZS(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u+n[15];return f=f||1,t[0]=(n[0]*i+n[4]*o+n[8]*u+n[12])/f,t[1]=(n[1]*i+n[5]*o+n[9]*u+n[13])/f,t[2]=(n[2]*i+n[6]*o+n[10]*u+n[14])/f,t}function tF(t,e,n){var i=e[0],o=e[1],u=e[2];return t[0]=i*n[0]+o*n[3]+u*n[6],t[1]=i*n[1]+o*n[4]+u*n[7],t[2]=i*n[2]+o*n[5]+u*n[8],t}function nF(t,e,n){var i=n[0],o=n[1],u=n[2],f=n[3],l=e[0],b=e[1],w=e[2],M=o*w-u*b,L=u*l-i*w,C=i*b-o*l,W=o*C-u*L,Q=u*M-i*C,ne=i*L-o*M,_e=f*2;return M*=_e,L*=_e,C*=_e,W*=2,Q*=2,ne*=2,t[0]=l+M+W,t[1]=b+L+Q,t[2]=w+C+ne,t}function iF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0],u[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),u[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function rF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),u[1]=o[1],u[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function sF(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),u[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),u[2]=o[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function oF(t,e){var n=t[0],i=t[1],o=t[2],u=e[0],f=e[1],l=e[2],b=Math.sqrt(n*n+i*i+o*o),w=Math.sqrt(u*u+f*f+l*l),M=b*w,L=M&&QO(t,e)/M;return Math.acos(Math.min(Math.max(L,-1),1))}var aF=KO;(function(){var t=YO();return function(e,n,i,o,u,f){var l,b;for(n||(n=3),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const R_=[0,0,0];let np;class po extends $O{static get ZERO(){return np||(np=new po(0,0,0),Object.freeze(np)),np}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&ou(e)?this.copy(e):(Xr.debug&&(Wr(e),Wr(n),Wr(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Xr.debug&&(Wr(e.x),Wr(e.y),Wr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Wr(e)}angle(e){return oF(this,e)}cross(e){return eF(this,this,e),this.check()}rotateX({radians:e,origin:n=R_}){return iF(this,this,n,e),this.check()}rotateY({radians:e,origin:n=R_}){return rF(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=R_}){return sF(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ZS(this,this,e),this.check()}transformAsVector(e){return qS(this,this,e),this.check()}transformByMatrix3(e){return tF(this,this,e),this.check()}transformByMatrix2(e){return XO(this,this,e),this.check()}transformByQuaternion(e){return nF(this,this,e),this.check()}}class lF extends HS{toString(){let e="[";if(Xr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=Wr(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[i+o];return n}setColumn(e,n){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)this[i+o]=n[o];return this}}function cF(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uF(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],u=e[6],f=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=u,t[11]=e[14],t[12]=o,t[13]=f,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ky(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=e[4],l=e[5],b=e[6],w=e[7],M=e[8],L=e[9],C=e[10],W=e[11],Q=e[12],ne=e[13],_e=e[14],K=e[15],$=n*l-i*f,J=n*b-o*f,pe=n*w-u*f,ye=i*b-o*l,Ae=i*w-u*l,Oe=o*w-u*b,Be=M*ne-L*Q,Xe=M*_e-C*Q,je=M*K-W*Q,mt=L*_e-C*ne,Dt=L*K-W*ne,qt=C*K-W*_e,zt=$*qt-J*Dt+pe*mt+ye*je-Ae*Xe+Oe*Be;return zt?(zt=1/zt,t[0]=(l*qt-b*Dt+w*mt)*zt,t[1]=(o*Dt-i*qt-u*mt)*zt,t[2]=(ne*Oe-_e*Ae+K*ye)*zt,t[3]=(C*Ae-L*Oe-W*ye)*zt,t[4]=(b*je-f*qt-w*Xe)*zt,t[5]=(n*qt-o*je+u*Xe)*zt,t[6]=(_e*pe-Q*Oe-K*J)*zt,t[7]=(M*Oe-C*pe+W*J)*zt,t[8]=(f*Dt-l*je+w*Be)*zt,t[9]=(i*je-n*Dt-u*Be)*zt,t[10]=(Q*Ae-ne*pe+K*$)*zt,t[11]=(L*pe-M*Ae-W*$)*zt,t[12]=(l*Xe-f*mt-b*Be)*zt,t[13]=(n*mt-i*Xe+o*Be)*zt,t[14]=(ne*J-Q*ye-_e*$)*zt,t[15]=(M*ye-L*J+C*$)*zt,t):null}function hF(t){var e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],f=t[5],l=t[6],b=t[7],w=t[8],M=t[9],L=t[10],C=t[11],W=t[12],Q=t[13],ne=t[14],_e=t[15],K=e*f-n*u,$=e*l-i*u,J=e*b-o*u,pe=n*l-i*f,ye=n*b-o*f,Ae=i*b-o*l,Oe=w*Q-M*W,Be=w*ne-L*W,Xe=w*_e-C*W,je=M*ne-L*Q,mt=M*_e-C*Q,Dt=L*_e-C*ne;return K*Dt-$*mt+J*je+pe*Xe-ye*Be+Ae*Oe}function Ml(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3],l=e[4],b=e[5],w=e[6],M=e[7],L=e[8],C=e[9],W=e[10],Q=e[11],ne=e[12],_e=e[13],K=e[14],$=e[15],J=n[0],pe=n[1],ye=n[2],Ae=n[3];return t[0]=J*i+pe*l+ye*L+Ae*ne,t[1]=J*o+pe*b+ye*C+Ae*_e,t[2]=J*u+pe*w+ye*W+Ae*K,t[3]=J*f+pe*M+ye*Q+Ae*$,J=n[4],pe=n[5],ye=n[6],Ae=n[7],t[4]=J*i+pe*l+ye*L+Ae*ne,t[5]=J*o+pe*b+ye*C+Ae*_e,t[6]=J*u+pe*w+ye*W+Ae*K,t[7]=J*f+pe*M+ye*Q+Ae*$,J=n[8],pe=n[9],ye=n[10],Ae=n[11],t[8]=J*i+pe*l+ye*L+Ae*ne,t[9]=J*o+pe*b+ye*C+Ae*_e,t[10]=J*u+pe*w+ye*W+Ae*K,t[11]=J*f+pe*M+ye*Q+Ae*$,J=n[12],pe=n[13],ye=n[14],Ae=n[15],t[12]=J*i+pe*l+ye*L+Ae*ne,t[13]=J*o+pe*b+ye*C+Ae*_e,t[14]=J*u+pe*w+ye*W+Ae*K,t[15]=J*f+pe*M+ye*Q+Ae*$,t}function sm(t,e,n){var i=n[0],o=n[1],u=n[2],f,l,b,w,M,L,C,W,Q,ne,_e,K;return e===t?(t[12]=e[0]*i+e[4]*o+e[8]*u+e[12],t[13]=e[1]*i+e[5]*o+e[9]*u+e[13],t[14]=e[2]*i+e[6]*o+e[10]*u+e[14],t[15]=e[3]*i+e[7]*o+e[11]*u+e[15]):(f=e[0],l=e[1],b=e[2],w=e[3],M=e[4],L=e[5],C=e[6],W=e[7],Q=e[8],ne=e[9],_e=e[10],K=e[11],t[0]=f,t[1]=l,t[2]=b,t[3]=w,t[4]=M,t[5]=L,t[6]=C,t[7]=W,t[8]=Q,t[9]=ne,t[10]=_e,t[11]=K,t[12]=f*i+M*o+Q*u+e[12],t[13]=l*i+L*o+ne*u+e[13],t[14]=b*i+C*o+_e*u+e[14],t[15]=w*i+W*o+K*u+e[15]),t}function Pv(t,e,n){var i=n[0],o=n[1],u=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dF(t,e,n,i){var o=i[0],u=i[1],f=i[2],l=Math.hypot(o,u,f),b,w,M,L,C,W,Q,ne,_e,K,$,J,pe,ye,Ae,Oe,Be,Xe,je,mt,Dt,qt,zt,ti;return l<Ep?null:(l=1/l,o*=l,u*=l,f*=l,b=Math.sin(n),w=Math.cos(n),M=1-w,L=e[0],C=e[1],W=e[2],Q=e[3],ne=e[4],_e=e[5],K=e[6],$=e[7],J=e[8],pe=e[9],ye=e[10],Ae=e[11],Oe=o*o*M+w,Be=u*o*M+f*b,Xe=f*o*M-u*b,je=o*u*M-f*b,mt=u*u*M+w,Dt=f*u*M+o*b,qt=o*f*M+u*b,zt=u*f*M-o*b,ti=f*f*M+w,t[0]=L*Oe+ne*Be+J*Xe,t[1]=C*Oe+_e*Be+pe*Xe,t[2]=W*Oe+K*Be+ye*Xe,t[3]=Q*Oe+$*Be+Ae*Xe,t[4]=L*je+ne*mt+J*Dt,t[5]=C*je+_e*mt+pe*Dt,t[6]=W*je+K*mt+ye*Dt,t[7]=Q*je+$*mt+Ae*Dt,t[8]=L*qt+ne*zt+J*ti,t[9]=C*qt+_e*zt+pe*ti,t[10]=W*qt+K*zt+ye*ti,t[11]=Q*qt+$*zt+Ae*ti,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function XS(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[4],f=e[5],l=e[6],b=e[7],w=e[8],M=e[9],L=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*o+w*i,t[5]=f*o+M*i,t[6]=l*o+L*i,t[7]=b*o+C*i,t[8]=w*o-u*i,t[9]=M*o-f*i,t[10]=L*o-l*i,t[11]=C*o-b*i,t}function fF(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],w=e[8],M=e[9],L=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o-w*i,t[1]=f*o-M*i,t[2]=l*o-L*i,t[3]=b*o-C*i,t[8]=u*i+w*o,t[9]=f*i+M*o,t[10]=l*i+L*o,t[11]=b*i+C*o,t}function YS(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],w=e[4],M=e[5],L=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o+w*i,t[1]=f*o+M*i,t[2]=l*o+L*i,t[3]=b*o+C*i,t[4]=w*o-u*i,t[5]=M*o-f*i,t[6]=L*o-l*i,t[7]=C*o-b*i,t}function pF(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=n+n,l=i+i,b=o+o,w=n*f,M=i*f,L=i*l,C=o*f,W=o*l,Q=o*b,ne=u*f,_e=u*l,K=u*b;return t[0]=1-L-Q,t[1]=M+K,t[2]=C-_e,t[3]=0,t[4]=M-K,t[5]=1-w-Q,t[6]=W+ne,t[7]=0,t[8]=C+_e,t[9]=W-ne,t[10]=1-w-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mF(t,e,n,i,o,u,f){var l=1/(n-e),b=1/(o-i),w=1/(u-f);return t[0]=u*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*b,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(o+i)*b,t[10]=(f+u)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*w,t[15]=0,t}function gF(t,e,n,i,o){var u=1/Math.tan(e/2),f;return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0?(f=1/(i-o),t[10]=(o+i)*f,t[14]=2*o*i*f):(t[10]=-1,t[14]=-2*i),t}var _F=gF;function yF(t,e,n,i,o,u,f){var l=1/(e-n),b=1/(i-o),w=1/(u-f);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(o+i)*b,t[14]=(f+u)*w,t[15]=1,t}var vF=yF;function xF(t,e,n,i){var o,u,f,l,b,w,M,L,C,W,Q=e[0],ne=e[1],_e=e[2],K=i[0],$=i[1],J=i[2],pe=n[0],ye=n[1],Ae=n[2];return Math.abs(Q-pe)<Ep&&Math.abs(ne-ye)<Ep&&Math.abs(_e-Ae)<Ep?cF(t):(M=Q-pe,L=ne-ye,C=_e-Ae,W=1/Math.hypot(M,L,C),M*=W,L*=W,C*=W,o=$*C-J*L,u=J*M-K*C,f=K*L-$*M,W=Math.hypot(o,u,f),W?(W=1/W,o*=W,u*=W,f*=W):(o=0,u=0,f=0),l=L*f-C*u,b=C*o-M*f,w=M*u-L*o,W=Math.hypot(l,b,w),W?(W=1/W,l*=W,b*=W,w*=W):(l=0,b=0,w=0),t[0]=o,t[1]=l,t[2]=M,t[3]=0,t[4]=u,t[5]=b,t[6]=L,t[7]=0,t[8]=f,t[9]=w,t[10]=C,t[11]=0,t[12]=-(o*Q+u*ne+f*_e),t[13]=-(l*Q+b*ne+w*_e),t[14]=-(M*Q+L*ne+C*_e),t[15]=1,t)}function bF(){var t=new au(4);return au!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function wF(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Td(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3];return t[0]=n[0]*i+n[4]*o+n[8]*u+n[12]*f,t[1]=n[1]*i+n[5]*o+n[9]*u+n[13]*f,t[2]=n[2]*i+n[6]*o+n[10]*u+n[14]*f,t[3]=n[3]*i+n[7]*o+n[11]*u+n[15]*f,t}(function(){var t=bF();return function(e,n,i,o,u,f){var l,b;for(n||(n=4),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var Jy;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Jy||(Jy={}));const EF=45*Math.PI/180,TF=1,D_=.1,z_=500,SF=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class mo extends lF{static get IDENTITY(){return IF()}static get ZERO(){return AF()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Jy}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,o,u,f,l,b,w,M,L,C,W,Q,ne,_e){return this[0]=e,this[1]=n,this[2]=i,this[3]=o,this[4]=u,this[5]=f,this[6]=l,this[7]=b,this[8]=w,this[9]=M,this[10]=L,this[11]=C,this[12]=W,this[13]=Q,this[14]=ne,this[15]=_e,this.check()}setRowMajor(e,n,i,o,u,f,l,b,w,M,L,C,W,Q,ne,_e){return this[0]=e,this[1]=u,this[2]=w,this[3]=W,this[4]=n,this[5]=f,this[6]=M,this[7]=Q,this[8]=i,this[9]=l,this[10]=L,this[11]=ne,this[12]=o,this[13]=b,this[14]=C,this[15]=_e,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(SF)}fromObject(e){return this.check()}fromQuaternion(e){return pF(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:o,top:u,near:f=D_,far:l=z_}=e;return l===1/0?PF(this,n,i,o,u,f):mF(this,n,i,o,u,f,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:o=[0,1,0]}=e;return xF(this,n,i,o),this.check()}ortho(e){const{left:n,right:i,bottom:o,top:u,near:f=D_,far:l=z_}=e;return vF(this,n,i,o,u,f,l),this.check()}orthographic(e){const{fovy:n=EF,aspect:i=TF,focalDistance:o=1,near:u=D_,far:f=z_}=e;Fw(n);const l=n/2,b=o*Math.tan(l),w=b*i;return this.ortho({left:-w,right:w,bottom:-b,top:b,near:u,far:f})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:o=.1,far:u=500}=e;return Fw(n),_F(this,n,i,o,u),this.check()}determinant(){return hF(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*o,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*o,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return uF(this,this),this.check()}invert(){return Ky(this,this),this.check()}multiplyLeft(e){return Ml(this,e,this),this.check()}multiplyRight(e){return Ml(this,this,e),this.check()}rotateX(e){return XS(this,this,e),this.check()}rotateY(e){return fF(this,this,e),this.check()}rotateZ(e){return YS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return dF(this,this,e,n),this.check()}scale(e){return Pv(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return sm(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Td(n||[-0,-0,-0,-0],e,this),L_(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let o;switch(i){case 2:o=qO(n||[-0,-0],e,this);break;case 3:o=ZS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return L_(o,e.length),o}transformAsVector(e,n){let i;switch(e.length){case 2:i=ZO(n||[-0,-0],e,this);break;case 3:i=qS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return L_(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let ip,rp;function AF(){return ip||(ip=new mo([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ip)),ip}function IF(){return rp||(rp=new mo,Object.freeze(rp)),rp}function Fw(t){if(t>Math.PI*2)throw Error("expected radians")}function PF(t,e,n,i,o,u){const f=2*u/(n-e),l=2*u/(o-i),b=(n+e)/(n-e),w=(o+i)/(o-i),M=-1,L=-1,C=-2*u;return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=b,t[9]=w,t[10]=M,t[11]=L,t[12]=0,t[13]=0,t[14]=C,t[15]=0,t}const CF=new Uint8Array([0,255,255,255]),MF={pickingSelectedColor:null,pickingHighlightColor:CF,pickingActive:!1,pickingAttribute:!1};function kF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:MF;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const LF=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,RF=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,DF={name:"picking",vs:LF,fs:RF,getUniforms:kF},zF=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,OF={name:"transform",vs:zF,fs:null};class Sd{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Sd(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:o={},inject:u={},varyings:f=[],bufferMode:l=35981,transpileToGLSL100:b=!1}=e,w=this._getModuleList(e.modules),M=this._getHash(n),L=this._getHash(i),C=w.map(J=>this._getHash(J.name)).sort(),W=f.map(J=>this._getHash(J)),Q=Object.keys(o).sort(),ne=Object.keys(u).sort(),_e=[],K=[];for(const J of Q)_e.push(this._getHash(J)),_e.push(this._getHash(o[J]));for(const J of ne)K.push(this._getHash(J)),K.push(this._getHash(u[J]));const $="".concat(M,"/").concat(L,"D").concat(_e.join("/"),"M").concat(C.join("/"),"I").concat(K.join("/"),"V").concat(W.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(b?"T":"");if(!this._programCache[$]){const J=TO(this.gl,{vs:n,fs:i,modules:w,inject:u,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:b});this._programCache[$]=new zS(this.gl,{hash:$,vs:J.vs,fs:J.fs,varyings:f,bufferMode:l}),this._getUniforms[$]=J.getUniforms||(pe=>{}),this._useCounts[$]=0}return this._useCounts[$]++,this._programCache[$]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let o=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const l=this._defaultModules[u],b=l.name;n[o++]=l,i[b]=!0}for(let u=0,f=e.length;u<f;++u){const l=e[u],b=l.name;i[b]||(n[o++]=l,i[b]=!0)}return n.length=o,n}}const FF={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function BF(t,e,n){const i={};let o=e.indices;for(const u in e.attributes){const f=e.attributes[u],l=NF(u,n);if(u==="indices")o=f;else if(f.constant)i[l]=f.value;else{const b=f.value,w={...f};delete w.value,i[l]=[new wn(t,b),w],UF(u,w)}}if(o){const u=o.value||o;ut(u instanceof Uint16Array||u instanceof Uint32Array,'attribute array for "indices" must be of integer type');const f={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};i.indices=[new wn(t,{data:u,target:34963}),f]}return i}function NF(t,e){const{attributeMap:n=FF}=e||{};return n&&n[t]||t}function UF(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ut(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Ec=2,VF=1e4,jF="Model needs drawMode and vertexCount",Bw=()=>{},GF={};class KS{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=ja("model")}=n;ut(Lm(e)),this.id=i,this.gl=e,this.id=n.id||ja("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Sd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:M}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:M},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ut(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),jF)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:M}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:w,transpileToGLSL100:M},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ut(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ut(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=BF(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ru(e))return this;const n={};for(const i in e){const o=e[i];n[i]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Tv(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:o={},attributes:u={},transformFeedback:f=this.transformFeedback,parameters:l={},vertexArray:b=this.vertexArray}=e;this.setAttributes(u),this.updateModuleSettings(n),this.setUniforms(o);let w;Et.priority>=Ec&&(w=this._logDrawCallStart(Ec));const M=this.vertexArray.getDrawParams(),{isIndexed:L=M.isIndexed,indexType:C=M.indexType,indexOffset:W=M.indexOffset,vertexArrayInstanced:Q=M.isInstanced}=this.props;Q&&!this.isInstanced&&Et.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:ne,instanceCount:_e}=this,{onBeforeRender:K=Bw,onAfterRender:$=Bw}=this.props;K(),this.program.setUniforms(this.uniforms);const J=this.program.draw(Object.assign(GF,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:b,transformFeedback:f,isIndexed:L,indexType:C,isInstanced:ne,instanceCount:_e,offset:L?W:0}));return $(),Et.priority>=Ec&&this._logDrawCallEnd(w,b,i),J}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:o=[]}=e;let{parameters:u}=e;i&&this._setFeedbackBuffers(i),n&&(u=Object.assign({},u,{35977:n})),o.forEach(f=>f.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:u}))}finally{o.forEach(f=>f.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Et.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:w,transpileToGLSL100:M}=this.programProps;n=this.programManager.get({vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:w,transpileToGLSL100:M}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ut(n instanceof zS,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Nz(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof wn&&n.delete()}}_setAnimationProps(e){this.animated&&ut(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ru(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new OS(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:VF;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Et.group(Ec,">>> DRAWING MODEL ".concat(this.id),{collapsed:Et.level<=2})(),e}_logDrawCallEnd(e,n,i,o){if(e===void 0)return;const u=jz({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:f,unusedTable:l,unusedCount:b}=Tw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:M}=Tw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});M>0&&Et.log("MISSING UNIFORMS",Object.keys(w))(),b>0&&Et.log("UNUSED UNIFORMS",Object.keys(l))();const L=$z(this.vertexArray.configuration);Et.table(e,u)(),Et.table(e,f)(),Et.table(e+1,L)(),o&&o.log({logLevel:Ec,message:"Rendered to ".concat(o.id)}),Et.groupEnd(Ec)()}}class $F{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:o}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof wn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ut(Xt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const u=this.feedbackMap[o];o in n&&(i[u]=o)}Object.assign(i,e.feedbackBuffers);for(const o in i){const u=i[o];if(typeof u=="string"){const f=n[u],{byteLength:l,usage:b,accessor:w}=f;i[o]=this._createNewBuffer(o,{byteLength:l,usage:b,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:o}=i;e.transformFeedback=new OS(this.gl,{program:o,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const o in this.feedbackMap){const u=this.feedbackMap[o];n[o]=e.feedbackBuffers[u],i[u]=e.sourceBuffers[o],ut(i[u]instanceof wn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new wn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const HF="transform_uSampler_",om="transform_uSize_",Nw="transform_position";function WF(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:o}=t,f=Object.keys(n).length,l=null;const b={};let w=e,M={};if(f>0||i){const L=w.split(`
`),C=L.slice();if(L.forEach((W,Q,ne)=>{if(f>0){const _e=KF(W,n);if(_e){const{updatedLine:K,inject:$}=_e;C[Q]=K,M=Zy([M,$]),Object.assign(b,_e.samplerTextureMap),f--}}i&&!l&&(l=YF(W,i))}),i){ut(o);const W="".concat(om).concat(i),Q="uniform vec2 ".concat(W,`;
`),ne="     vec2 ".concat(Nw," = transform_getPos(").concat(W,`);
     gl_Position = vec4(`).concat(Nw,`, 0, 1.);
`);M=Zy([M,{"vs:#decl":Q,"vs:#main-start":ne}])}w=C.join(`
`)}return{vs:w,targetTextureType:l,inject:M,samplerTextureMap:b}}function qF(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const o={};let u,f;n&&({width:u,height:f}=i,o["".concat(om).concat(n)]=[u,f]);for(const l in e)({width:u,height:f}=e[l]),o["".concat(om).concat(l)]=[u,f];return o}function ZF(t){return GS(t,["attribute","in"])}function XF(t){const e="".concat(HF).concat(t),n="".concat(om).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function YF(t,e){const n=GS(t,["varying","out"]);return n&&n.name===e?n.type:null}function KF(t,e){const n={},i=ZF(t);if(!i)return null;const{type:o,name:u}=i;if(u&&e[u]){const f="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:b,uniformDeclerations:w}=XF(u),M=RO(o),L="  ".concat(o," ").concat(u," = transform_getInput(").concat(l,", ").concat(b,").").concat(M,`;
`);return n[l]=u,{updatedLine:f,inject:{"vs:#decl":w,"vs:#main-start":L},samplerTextureMap:n}}return null}const JF={10241:9728,10240:9728,10242:33071,10243:33071},QF="transform_output";class eB{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:o,targetTexture:u}=this.bindings[this.currentIndex],f=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),b=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){f.transform_elementID=this.elementIDBuffer;for(const L in this.samplerTextureMap){const C=this.samplerTextureMap[L];l[L]=i[C]}this._setSourceTextureParameters();const M=qF({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:u});Object.assign(l,M)}return this.hasTargetTexture&&(w=!1,b.viewport=[0,0,o.width,o.height]),{attributes:f,framebuffer:o,uniforms:l,discard:w,parameters:b}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Dm(n);if(!e)return i;const o=i.constructor,u=DO(this.targetTextureType),f=new o(i.length*u/4);let l=0;for(let b=0;b<i.length;b+=4)for(let w=0;w<u;w++)f[l++]=i[b+w];return f}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof Qr)return i;const o=n[i];return o?(this._targetRefTexName=i,this._createNewTexture(o)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:o}=e,u=this._createTargetTexture({sourceTextures:i,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:u}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,o,u)=>{u[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new wn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:o,targetTexture:u}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,o),Object.assign(e.sourceBuffers,i),u){e.targetTexture=u;const{width:f,height:l}=u,{framebuffer:b}=e;b?(b.update({attachments:{36064:u},resizeAttachments:!1}),b.resize({width:f,height:l})):e.framebuffer=new yi(this.gl,{id:"transform-framebuffer",width:f,height:l,attachments:{36064:u}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(JF)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=PD(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:o,uniforms:u,targetTextureType:f,inject:l,samplerTextureMap:b}=WF({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=Zy([e.inject||{},l]);this.targetTextureType=f,this.samplerTextureMap=b;const M=e._fs||$S({version:RS(o),input:this.targetTextureVarying,inputType:f,output:QF}),L=this.hasSourceTextures||this.targetTextureVarying?[OF].concat(e.modules||[]):e.modules;return{vs:o,fs:M,modules:L,uniforms:u,inject:w}}}class Cv{static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ut(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const o=i.getData(e);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new KS(n,Object.assign({},e,{fs:e.fs||$S({version:RS(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=o.updateModelProps(n);return n}_buildResourceTransforms(e,n){tB(n)&&(this.bufferTransform=new $F(e,n)),nB(n)&&(this.textureTransform=new eB(e,n)),ut(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=Object.assign(n,o.getDrawOptions(n));return n}}function tB(t){return!!(!ru(t.feedbackBuffers)||!ru(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function nB(t){return!!(!ru(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const Uw={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class iB{static get DRAW_MODE(){return Uw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=ja("geometry"),drawMode:i=Uw.TRIANGLES,attributes:o={},indices:u=null,vertexCount:f=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(o,u),this.vertexCount=f||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let o=e[i];o=ArrayBuffer.isView(o)?{value:o}:o,ut(ArrayBuffer.isView(o.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!o.size&&(o.size=3),i==="indices"?(ut(!this.indices),this.indices=o):this.attributes[i]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const o in e){const u=e[o],{value:f,size:l,constant:b}=u;!b&&f&&l>=1&&(i=Math.min(i,f.length/l))}return ut(Number.isFinite(i)),i}}let rB=1,sB=1;class JS{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:o=1,repeat:u=1}=e,f=rB++,l={time:0,delay:n,duration:i,rate:o,repeat:u};return this._setChannelTime(l,this.time),this.channels.set(f,l),f}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const i=this.animations.values();for(const o of i){const{animation:u,channel:f}=o;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=sB++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,o=e.duration*e.repeat;i>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const oB=[255,255,255],aB=1;let lB=0;class cB{constructor(e={}){V(this,"id",void 0),V(this,"color",void 0),V(this,"intensity",void 0),V(this,"type","ambient");const{color:n=oB}=e,{intensity:i=aB}=e;this.id=e.id||"ambient-".concat(lB++),this.color=n,this.intensity=i}}const uB=[255,255,255],hB=1,dB=[0,0,-1];let fB=0;class Vw{constructor(e={}){V(this,"id",void 0),V(this,"color",void 0),V(this,"intensity",void 0),V(this,"type","directional"),V(this,"direction",void 0),V(this,"shadow",void 0);const{color:n=uB}=e,{intensity:i=hB}=e,{direction:o=dB}=e,{_shadow:u=!1}=e;this.id=e.id||"directional-".concat(fB++),this.color=n,this.intensity=i,this.type="directional",this.direction=new po(o).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class pB{constructor(e,n={id:"pass"}){V(this,"id",void 0),V(this,"gl",void 0),V(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Mv extends pB{constructor(...e){super(...e),V(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Ho(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:o,views:u,onViewportActive:f,clearStack:l=!0,clearCanvas:b=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;b&&gB(w,n),l&&(this._lastRenderIndex=-1);const M=[];for(const L of o){const C=u&&u[L.id];f==null||f(L);const W=this._getDrawLayerParams(L,e),Q=L.subViewports||[L];for(const ne of Q){const _e=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:ne,view:C,pass:e.pass,layers:e.layers},W);M.push(_e)}}return M}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:o=!1,layerFilter:u,cullRect:f,effects:l,moduleParameters:b},w=!1){const M=[],L=QS(this._lastRenderIndex+1),C={layer:n[0],viewport:e,isPicking:o,renderPass:i,cullRect:f},W={};for(let Q=0;Q<n.length;Q++){const ne=n[Q],_e=this._shouldDrawLayer(ne,C,u,W),K={shouldDrawLayer:_e};_e&&!w&&(K.layerRenderIndex=L(ne,_e),K.moduleParameters=this._getModuleParameters(ne,l,i,b),K.layerParameters=this.getLayerParameters(ne,Q,e)),M[Q]=K}return M}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:o,target:u,viewport:f,view:l},b){const w=mB(e,{moduleParameters:i,target:u,viewport:f});if(l&&l.props.clear){const L=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Ns(e,{scissorTest:!0,scissor:w},()=>Tv(e,L))}const M={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Ho(e,{viewport:w});for(let L=0;L<n.length;L++){const C=n[L],{shouldDrawLayer:W,layerRenderIndex:Q,moduleParameters:ne,layerParameters:_e}=b[L];if(W&&C.props.pickable&&M.pickableCount++,C.isComposite)M.compositeCount++;else if(W){M.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Q),ne.viewport=f;try{C._drawLayer({moduleParameters:ne,uniforms:{layerIndex:Q},parameters:_e})}catch(K){C.raiseError(K,"drawing ".concat(C," to ").concat(o))}}}return M}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(n))return!1;n.layer=f,f=f.parent}if(i){const l=n.layer.id;if(l in o||(o[l]=i(n)),!o[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,o){var u;const f=Object.assign(Object.create(((u=e.internalState)===null||u===void 0?void 0:u.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:iu(this.gl)});if(n)for(const b of n){var l;Object.assign(f,(l=b.getModuleParameters)===null||l===void 0?void 0:l.call(b,e))}return Object.assign(f,this.getModuleParameters(e,n),o)}}function QS(t=0,e={}){const n={},i=(o,u)=>{const f=o.props._offset,l=o.id,b=o.parent&&o.parent.id;let w;if(b&&!(b in e)&&i(o.parent,!1),b in n){const M=n[b]=n[b]||QS(e[b],e);w=M(o,u),n[l]=M}else Number.isFinite(f)?(w=f+(e[b]||0),n[l]=null):w=t;return u&&w>=t&&(t=w+1),e[l]=w,w};return i}function mB(t,{moduleParameters:e,target:n,viewport:i}){const o=n&&n.id!=="default-framebuffer",u=e&&e.devicePixelRatio||iu(t),f=o?n.height:t.drawingBufferHeight,l=i;return[l.x*u,f-(l.y+l.height)*u,l.width*u,l.height*u]}function gB(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Ho(t,{viewport:[0,0,n,i]}),t.clear(16640)}class _B extends Mv{constructor(e,n){super(e,n),V(this,"shadowMap",void 0),V(this,"depthBuffer",void 0),V(this,"fbo",void 0),this.shadowMap=new Qr(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Nc(e,{format:33189,width:1,height:1}),this.fbo=new yi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Ns(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],o=iu(this.gl),u=i.width*o,f=i.height*o;(u!==n.width||f!==n.height)&&n.resize({width:u,height:f}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const eA="#define SMOOTH_EDGE_RADIUS 0.5",yB=`
`.concat(eA,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),vB=`
`.concat(eA,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),xB={name:"geometry",vs:yB,fs:vB},bB=Object.keys(fn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(fn[t],";")).join(""),wB=Object.keys(co).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(co[t],";")).join(""),EB=Object.keys(Gy).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Gy[t],";")).join(""),TB="".concat(bB,`
`).concat(wB,`
`).concat(EB,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function SB(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Ad(t){let e={},n;return i=>{for(const o in i)if(!SB(i[o],e[o])){n=t(i),e=i;break}return n}}const jw=[0,0,0,0],AB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],tA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],IB=[0,0,0],nA=[0,0,0],PB=Ad(kB);function iA(t,e,n=nA){n.length<3&&(n=[n[0],n[1],0]);let i=n,o,u=!0;switch(e===fn.LNGLAT_OFFSETS||e===fn.METER_OFFSETS?o=n:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case co.WEB_MERCATOR:(e===fn.LNGLAT||e===fn.CARTESIAN)&&(o=[0,0,0],u=!1);break;case co.WEB_MERCATOR_AUTO_OFFSET:e===fn.LNGLAT?i=o:e===fn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case co.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case co.GLOBE:u=!1,o=null;break;default:u=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:i,offsetMode:u}}function CB(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:o}=t;let{viewMatrix:u,viewProjectionMatrix:f}=t,l=jw,b=jw,w=t.cameraPosition;const{geospatialOrigin:M,shaderCoordinateOrigin:L,offsetMode:C}=iA(t,e,n);return C&&(b=t.projectPosition(M||L),w=[w[0]-b[0],w[1]-b[1],w[2]-b[2]],b[3]=1,l=Td([],b,f),u=i||u,f=Ml([],o,u),f=Ml([],f,AB)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:l,originCommon:b,cameraPosCommon:w,shaderCoordinateOrigin:L,geospatialOrigin:M}}function MB({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=fn.DEFAULT,coordinateOrigin:o=nA,autoWrapLongitude:u=!1}){i===fn.DEFAULT&&(i=t.isGeospatial?fn.LNGLAT:fn.CARTESIAN);const f=PB({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:o});return f.project_uWrapLongitude=u,f.project_uModelMatrix=n||tA,f}function kB({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:o,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:l,shaderCoordinateOrigin:b,geospatialOrigin:w}=CB(t,n,i),M=t.getDistanceScales(),L=[t.width*e,t.height*e],C=Td([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,W={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:f.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:L,project_uDevicePixelRatio:e,project_uFocalDistance:C,project_uCommonUnitsPerMeter:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit:M.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:IB,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:tA,project_uCameraPosition:l};if(w){const Q=t.getDistanceScales(w);switch(n){case fn.METER_OFFSETS:W.project_uCommonUnitsPerWorldUnit=Q.unitsPerMeter,W.project_uCommonUnitsPerWorldUnit2=Q.unitsPerMeter2;break;case fn.LNGLAT:case fn.LNGLAT_OFFSETS:t._pseudoMeters||(W.project_uCommonUnitsPerMeter=Q.unitsPerMeter),W.project_uCommonUnitsPerWorldUnit=Q.unitsPerDegree,W.project_uCommonUnitsPerWorldUnit2=Q.unitsPerDegree2;break;case fn.CARTESIAN:W.project_uCommonUnitsPerWorldUnit=[1,1,Q.unitsPerMeter[2]],W.project_uCommonUnitsPerWorldUnit2=[0,0,Q.unitsPerMeter2[2]];break}}return W}const LB={};function RB(t=LB){return"viewport"in t?MB(t):{}}const kv={name:"project",dependencies:[FO,xB],vs:TB,getUniforms:RB};function DB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function qc(t,e){const n=Td([],e,t);return wF(n,n,1/n[3]),n}function Gw(t,e){const n=t%e;return n<0?e+n:n}function Qy(t,e,n){return t<e?e:t>n?n:t}function zB(t){return Math.log(t)*Math.LOG2E}const Lv=Math.log2||zB;function Wo(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Os=Math.PI,rA=Os/4,xs=Os/180,e0=180/Os,lu=512,am=4003e4,sp=85.051129,OB=1.5;function FB(t){return Lv(t)}function lm(t){const[e,n]=t;Wo(Number.isFinite(e)),Wo(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*xs,o=n*xs,u=lu*(i+Os)/(2*Os),f=lu*(Os+Math.log(Math.tan(rA+o*.5)))/(2*Os);return[u,f]}function cu(t){const[e,n]=t,i=e/lu*(2*Os)-Os,o=2*(Math.atan(Math.exp(n/lu*(2*Os)-Os))-rA);return[i*e0,o*e0]}function BB(t){const{latitude:e}=t;Wo(Number.isFinite(e));const n=Math.cos(e*xs);return FB(am*n)-9}function O_(t){const e=Math.cos(t*xs);return lu/am/e}function t0(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Wo(Number.isFinite(e)&&Number.isFinite(n));const o=lu,u=Math.cos(e*xs),f=o/360,l=f/u,b=o/am/u,w={unitsPerMeter:[b,b,b],metersPerUnit:[1/b,1/b,1/b],unitsPerDegree:[f,l,b],degreesPerUnit:[1/f,1/l,1/b]};if(i){const M=xs*Math.tan(e*xs)/u,L=f*M/2,C=o/am*M,W=C/l*b;w.unitsPerDegree2=[0,L,C],w.unitsPerMeter2=[W,0,W]}return w}function sA(t,e){const[n,i,o]=t,[u,f,l]=e,{unitsPerMeter:b,unitsPerMeter2:w}=t0({longitude:n,latitude:i,highPrecision:!0}),M=lm(t);M[0]+=u*(b[0]+w[0]*f),M[1]+=f*(b[1]+w[1]*f);const L=cu(M),C=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[L[0],L[1],C]:L}function NB(t){const{height:e,pitch:n,bearing:i,altitude:o,scale:u,center:f}=t,l=DB();sm(l,l,[0,0,-o]),XS(l,l,-n*xs),YS(l,l,i*xs);const b=u/e;return Pv(l,l,[b,b,b]),f&&sm(l,l,JO([],f)),l}function UB(t){const{width:e,height:n,altitude:i,pitch:o=0,offset:u,center:f,scale:l,nearZMultiplier:b=1,farZMultiplier:w=1}=t;let{fovy:M=cm(OB)}=t;i!==void 0&&(M=cm(i));const L=M*xs,C=o*xs,W=oA(M);let Q=W;f&&(Q+=f[2]*l/Math.cos(C)/n);const ne=L*(.5+(u?u[1]:0)/n),_e=Math.sin(ne)*Q/Math.sin(Qy(Math.PI/2-C-ne,.01,Math.PI-.01)),K=Math.sin(C)*_e+Q,$=Q*10,J=Math.min(K*w,$);return{fov:L,aspect:e/n,focalDistance:W,near:b,far:J}}function cm(t){return 2*Math.atan(.5/t)*e0}function oA(t){return .5/Math.tan(.5*t*xs)}function aA(t,e){const[n,i,o=0]=t;return Wo(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),qc(e,[n,i,o,1])}function Rv(t,e,n=0){const[i,o,u]=t;if(Wo(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u))return qc(e,[i,o,u,1]);const f=qc(e,[i,o,0,1]),l=qc(e,[i,o,1,1]),b=f[2],w=l[2],M=b===w?0:((n||0)-b)/(w-b);return WS([],f,l,M)}function VB(t){const{width:e,height:n,bounds:i,minExtent:o=0,maxZoom:u=24,offset:f=[0,0]}=t,[[l,b],[w,M]]=i,L=jB(t.padding),C=lm([l,Qy(M,-sp,sp)]),W=lm([w,Qy(b,-sp,sp)]),Q=[Math.max(Math.abs(W[0]-C[0]),o),Math.max(Math.abs(W[1]-C[1]),o)],ne=[e-L.left-L.right-Math.abs(f[0])*2,n-L.top-L.bottom-Math.abs(f[1])*2];Wo(ne[0]>0&&ne[1]>0);const _e=ne[0]/Q[0],K=ne[1]/Q[1],$=(L.right-L.left)/2/_e,J=(L.top-L.bottom)/2/K,pe=[(W[0]+C[0])/2+$,(W[1]+C[1])/2+J],ye=cu(pe),Ae=Math.min(u,Lv(Math.abs(Math.min(_e,K))));return Wo(Number.isFinite(Ae)),{longitude:ye[0],latitude:ye[1],zoom:Ae}}function jB(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Wo(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const $w=Math.PI/180;function GB(t,e=0){const{width:n,height:i,unproject:o}=t,u={targetZ:e},f=o([0,i],u),l=o([n,i],u);let b,w;const M=t.fovy?.5*t.fovy*$w:Math.atan(.5/t.altitude),L=(90-t.pitch)*$w;return M>L-.01?(b=Hw(t,0,e),w=Hw(t,n,e)):(b=o([0,0],u),w=o([n,0],u)),[f,l,w,b]}function Hw(t,e,n){const{pixelUnprojectionMatrix:i}=t,o=qc(i,[e,0,1,1]),u=qc(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-o[2])/(u[2]-o[2]),b=WS([],o,u,l),w=cu(b);return w.push(n),w}const Ww=512;function $B(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:o,latitude:u,zoom:f,bearing:l=0}=t;(o<-180||o>180)&&(o=Gw(o+180,360)-180),(l<-180||l>180)&&(l=Gw(l+180,360)-180);const b=Lv(n/Ww);if(f<=b)f=b,u=0;else{const w=n/2/Math.pow(2,f),M=cu([0,w])[1];if(u<M)u=M;else{const L=cu([0,Ww-w])[1];u>L&&(u=L)}}return{width:e,height:n,longitude:o,latitude:u,zoom:f,pitch:i,bearing:l}}const HB=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,WB=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,qB=Ad(JB),ZB=Ad(QB),XB=[0,0,0,1],YB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function KB(t,e){const[n,i,o]=t,u=Rv([n,i,o],e);return Number.isFinite(o)?u:[u[0],u[1],0]}function JB({viewport:t,center:e}){return new mo(t.viewProjectionMatrix).invert().transform(e)}function QB({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,u=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(f=>KB(f,i));for(const f of e){const l=f.clone().translate(new po(t.center).negate()),b=u.map(M=>l.transform(M)),w=new mo().ortho({left:Math.min(...b.map(M=>M[0])),right:Math.max(...b.map(M=>M[0])),bottom:Math.min(...b.map(M=>M[1])),top:Math.max(...b.map(M=>M[1])),near:Math.min(...b.map(M=>-M[2])),far:Math.max(...b.map(M=>-M[2]))});n.push(w.multiplyRight(f))}return n}function e4(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||XB,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=qB({viewport:t.viewport,center:e.project_uCenter}),u=[],f=ZB({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const b=f[l],w=b.clone().translate(new po(t.viewport.center).negate());e.project_uCoordinateSystem===fn.LNGLAT&&e.project_uProjectionMode===co.WEB_MERCATOR?(f[l]=w,u[l]=o):(f[l]=b.clone().multiplyRight(YB),u[l]=w.transform(o))}for(let l=0;l<f.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=f[l],i["shadow_uProjectCenters[".concat(l,"]")]=u[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const F_={name:"shadow",dependencies:[kv],vs:HB,fs:WB,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?e4(t,e):{}},t4={color:[255,255,255],intensity:1},qw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],n4=[0,0,0,200/255];class lA{constructor(e={}){V(this,"id","lighting-effect"),V(this,"props",void 0),V(this,"shadowColor",n4),V(this,"shadow",void 0),V(this,"ambientLight",void 0),V(this,"directionalLights",void 0),V(this,"pointLights",void 0),V(this,"shadowPasses",[]),V(this,"shadowMaps",[]),V(this,"dummyShadowMap",null),V(this,"programManager",void 0),V(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Sd.getDefaultProgramManager(e),F_&&this.programManager.addDefaultModule(F_)),this.dummyShadowMap||(this.dummyShadowMap=new Qr(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(F_),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new mo().lookAt({eye:new po(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new _B(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new cB(t4),this.directionalLights.push(new Vw(qw[0]),new Vw(qw[1])))}}class i4{constructor(e={}){V(this,"_pool",[]),V(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:o,padding:u=0,copy:f=!1,initialize:l=!1,maxCount:b}){const w=o||e&&e.constructor||Float32Array,M=n*i+u;if(ArrayBuffer.isView(e)){if(M<=e.length)return e;if(M*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,M)}let L=1/0;b&&(L=b*i+u);const C=this._allocate(w,M,l,L);return e&&f?C.set(e):l||C.fill(0,0,4),this._release(e),C}release(e){this._release(e)}_allocate(e,n,i,o){let u=Math.max(Math.ceil(n*this.opts.overAlloc),1);u>o&&(u=o);const f=this._pool,l=e.BYTES_PER_ELEMENT*u,b=f.findIndex(w=>w.byteLength>=l);if(b>=0){const w=new e(f.splice(b,1)[0],0,u);return i&&w.fill(0),w}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:o}=i,u=n.findIndex(f=>f.byteLength>=o);u<0?n.push(i):(u>0||n.length<this.opts.poolSize)&&n.splice(u,0,i),n.length>this.opts.poolSize&&n.shift()}}const hd=new i4;function Ch(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r4(t){return[t[12],t[13],t[14]]}function s4(t){return{left:Tc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Tc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Tc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Tc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Tc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Tc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Zw=new po;function Tc(t,e,n,i){Zw.set(t,e,n);const o=Zw.len();return{distance:i/o,normal:new po(-t/o,-e/o,-n/o)}}function o4(t){return t-Math.fround(t)}let bh;function B_(t,e){const{size:n=1,startIndex:i=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,u=(o-i)/n;bh=hd.allocate(bh,u,{type:Float32Array,size:n*2});let f=i,l=0;for(;f<o;){for(let b=0;b<n;b++){const w=t[f++];bh[l+b]=w,bh[l+b+n]=o4(w)}l+=n*2}return bh.subarray(0,u*n*2)}function a4(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const l4=Math.PI/180,c4=Ch(),Xw=[0,0,0],u4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function h4({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:o,padding:u,near:f,far:l}){const b=t/e,w=n?new mo().orthographic({fovy:i,aspect:b,focalDistance:o,near:f,far:l}):new mo().perspective({fovy:i,aspect:b,near:f,far:l});if(u){const{left:M=0,right:L=0,top:C=0,bottom:W=0}=u,Q=Pa((M+t-L)/2,0,t)-t/2,ne=Pa((C+e-W)/2,0,e)-e/2;w[8]-=Q*2/t,w[9]+=ne*2/e}return w}class mu{constructor(e={}){V(this,"id",void 0),V(this,"x",void 0),V(this,"y",void 0),V(this,"width",void 0),V(this,"height",void 0),V(this,"padding",void 0),V(this,"isGeospatial",void 0),V(this,"zoom",void 0),V(this,"focalDistance",void 0),V(this,"position",void 0),V(this,"modelMatrix",void 0),V(this,"distanceScales",void 0),V(this,"scale",void 0),V(this,"center",void 0),V(this,"cameraPosition",void 0),V(this,"projectionMatrix",void 0),V(this,"viewMatrix",void 0),V(this,"viewMatrixUncentered",void 0),V(this,"viewMatrixInverse",void 0),V(this,"viewProjectionMatrix",void 0),V(this,"pixelProjectionMatrix",void 0),V(this,"pixelUnprojectionMatrix",void 0),V(this,"resolution",void 0),V(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||u4,this.focalDistance=e.focalDistance||1,this.position=e.position||Xw,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?co.WEB_MERCATOR:co.WEB_MERCATOR_AUTO_OFFSET:co.IDENTITY}equals(e){return e instanceof mu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ud(e.projectionMatrix,this.projectionMatrix)&&ud(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),o=aA(i,this.pixelProjectionMatrix),[u,f]=o,l=n?f:this.height-f;return e.length===2?[u,l]:[u,l,o[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[o,u,f]=e,l=n?u:this.height-u,b=i&&i*this.distanceScales.unitsPerMeter[2],w=Rv([o,l,f],this.pixelUnprojectionMatrix,b),[M,L,C]=this.unprojectPosition(w);return Number.isFinite(f)?[M,L,C]:Number.isFinite(i)?[M,L,i]:[M,L]}projectPosition(e){const[n,i]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,o]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,o]}projectFlat(e){if(this.isGeospatial){const n=lm(e);return n[1]=Pa(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?cu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),o=this.unproject([this.width,0],n),u=this.unproject([0,this.height],n),f=this.unproject([this.width,this.height],n);return[Math.min(i[0],o[0],u[0],f[0]),Math.min(i[1],o[1],u[1],f[1]),Math.max(i[0],o[0],u[0],f[0]),Math.max(i[1],o[1],u[1],f[1])]}getDistanceScales(e){return e?t0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:o=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,s4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=BB({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||t0({latitude:i,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:u,modelMatrix:f}=e;let l=Xw;if(u&&(l=f?new mo(f).transformAsVector(u,[]):u),this.isGeospatial){const b=this.projectPosition([n,i,0]);this.center=new po(l).scale(this.distanceScales.unitsPerMeter).add(b)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=c4,projectionMatrix:i=null,orthographic:o=!1,fovyRadians:u,fovy:f=75,near:l=.1,far:b=1e3,padding:w=null,focalDistance:M=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new mo().multiplyRight(n).translate(new po(this.center).negate()),this.projectionMatrix=i||h4({width:this.width,height:this.height,orthographic:o,fovyRadians:u||f*l4,focalDistance:M,padding:w,near:l,far:b});const L=Ch();Ml(L,L,this.projectionMatrix),Ml(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=Ky([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=r4(this.viewMatrixInverse);const C=Ch(),W=Ch();Pv(C,C,[this.width/2,-this.height/2,1]),sm(C,C,[1,-1,0]),Ml(W,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=W,this.pixelUnprojectionMatrix=Ky(Ch(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||_n.warn("Pixel project matrix not invertible")()}}V(mu,"displayName","Viewport");class uu extends mu{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:o=0,pitch:u=0,bearing:f=0,nearZMultiplier:l=.1,farZMultiplier:b=1.01,nearZ:w,farZ:M,orthographic:L=!1,projectionMatrix:C,repeat:W=!1,worldOffset:Q=0,position:ne,padding:_e,legacyMeterSizes:K=!1}=e;let{width:$,height:J,altitude:pe=1.5}=e;const ye=Math.pow(2,o);$=$||1,J=J||1;let Ae,Oe=null;if(C)pe=C[5]/2,Ae=cm(pe);else{e.fovy?(Ae=e.fovy,pe=oA(Ae)):Ae=cm(pe);let Xe;if(_e){const{top:je=0,bottom:mt=0}=_e;Xe=[0,Pa((je+J-mt)/2,0,J)-J/2]}Oe=UB({width:$,height:J,scale:ye,center:ne&&[0,0,ne[2]*O_(n)],offset:Xe,pitch:u,fovy:Ae,nearZMultiplier:l,farZMultiplier:b}),Number.isFinite(w)&&(Oe.near=w),Number.isFinite(M)&&(Oe.far=M)}let Be=NB({height:J,pitch:u,bearing:f,scale:ye,altitude:pe});Q&&(Be=new mo().translate([512*Q,0,0]).multiplyLeft(Be)),super({...e,width:$,height:J,viewMatrix:Be,longitude:i,latitude:n,zoom:o,...Oe,fovy:Ae,focalDistance:pe}),V(this,"longitude",void 0),V(this,"latitude",void 0),V(this,"pitch",void 0),V(this,"bearing",void 0),V(this,"altitude",void 0),V(this,"fovy",void 0),V(this,"orthographic",void 0),V(this,"_subViewports",void 0),V(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=o,this.pitch=u,this.bearing=f,this.altitude=pe,this.fovy=Ae,this.orthographic=L,this._subViewports=W?[]:null,this._pseudoMeters=K,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let o=n;o<=i;o++){const u=o?new uu({...this,worldOffset:o}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),o=(e[2]||0)*O_(e[1]);return[n,i,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),o=(e[2]||0)/O_(i);return[n,i,o]}addMetersToLngLat(e,n){return sA(e,n)}panByPosition(e,n){const i=Rv(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=Ow([],o,WO([],i)),f=Ow([],this.center,u),[l,b]=this.unprojectFlat(f);return{longitude:l,latitude:b}}getBounds(e={}){const n=GB(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:o}=this,{longitude:u,latitude:f,zoom:l}=VB({width:i,height:o,bounds:e,...n});return new uu({width:i,height:o,longitude:u,latitude:f,zoom:l})}}V(uu,"displayName","WebMercatorViewport");const Yw=[0,0,0];function N_(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof uu){const[o,u,f=0]=t,l=e.getDistanceScales([o,u]);i[2]=f*l.unitsPerMeter[2]}return i}function d4(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:o,fromCoordinateSystem:u,fromCoordinateOrigin:f}=t;return o===fn.DEFAULT&&(o=e.isGeospatial?fn.LNGLAT:fn.CARTESIAN),u===void 0&&(u=o),f===void 0&&(f=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function cA(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:o,offsetMode:u}){let[f,l,b=0]=t;switch(n&&([f,l,b]=Td([],[f,l,b,1],n)),i){case fn.LNGLAT:return N_([f,l,b],e,u);case fn.LNGLAT_OFFSETS:return N_([f+o[0],l+o[1],b+(o[2]||0)],e,u);case fn.METER_OFFSETS:return N_(sA(o,[f,l,b]),e,u);case fn.CARTESIAN:default:return e.isGeospatial?[f+o[0],l+o[1],b+o[2]]:e.projectPosition([f,l,b])}}function f4(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:o,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:l}=d4(e),{autoOffset:b=!0}=e,{geospatialOrigin:w=Yw,shaderCoordinateOrigin:M=Yw,offsetMode:L=!1}=b?iA(n,i,o):{},C=cA(t,{viewport:n,modelMatrix:u,coordinateSystem:f,coordinateOrigin:l,offsetMode:L});if(L){const W=n.projectPosition(w||M);aF(C,C,W)}return C}const Kw={blendFunc:[1,0,32771,0],blendEquation:32774};class uA extends Mv{constructor(...e){super(...e),V(this,"pickZ",void 0),V(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,pickingFBO:f,deviceRect:{x:l,y:b,width:w,height:M},cullRect:L,effects:C,pass:W="picking",pickZ:Q,moduleParameters:ne}){const _e=this.gl;this.pickZ=Q;const K=this._resetColorEncoder(Q),$=Ns(_e,{scissorTest:!0,scissor:[l,b,w,M],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Kw,blend:!Q},()=>super.render({target:f,layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,cullRect:L,effects:C==null?void 0:C.filter(pe=>pe.useInPicking),pass:W,isPicking:!0,moduleParameters:ne}));return this._colorEncoderState=null,{decodePickingColor:K&&m4.bind(null,K),stats:$}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const o={...e.props.parameters},{pickable:u,operation:f}=e.props;return this._colorEncoderState?u&&f.includes("draw")&&(Object.assign(o,Kw),o.blend=!0,o.blendColor=p4(this._colorEncoderState,e,i)):o.blend=!1,f.includes("terrain")&&(o.blend=!1),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function p4(t,e,n){const{byLayer:i,byAlpha:o}=t;let u,f=i.get(e);return f?(f.viewports.push(n),u=f.a):(u=i.size+1,u<=255?(f={a:u,layer:e,viewports:[n]},i.set(e,f),o[u]=f):(_n.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function m4(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Ac={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},um=Symbol.for("component"),Na=Symbol.for("propTypes"),U_=Symbol.for("deprecatedProps"),Zc=Symbol.for("asyncPropDefaults"),Fl=Symbol.for("asyncPropOriginal"),Ca=Symbol.for("asyncPropResolved");function Dv(t,e=()=>!0){return Array.isArray(t)?hA(t,e,[]):e(t)?[t]:[]}function hA(t,e,n){let i=-1;for(;++i<t.length;){const o=t[i];Array.isArray(o)?hA(o,e,n):e(o)&&n.push(o)}return n}function g4({target:t,source:e,start:n=0,count:i=1}){const o=e.length,u=i*o;let f=0;for(let l=n;f<o;f++)t[l++]=e[f];for(;f<u;)f<u-f?(t.copyWithin(n+f,n,n+f),f*=2):(t.copyWithin(n+f,n,n+u-f),f=u);return t}class _4{constructor(e,n,i){V(this,"id",void 0),V(this,"context",void 0),V(this,"isLoaded",void 0),V(this,"persistent",void 0),V(this,"_loadCount",0),V(this,"_subscribers",new Set),V(this,"_data",void 0),V(this,"_loader",void 0),V(this,"_error",void 0),V(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let o=e;typeof e=="string"&&(o=Qp(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class y4{constructor({gl:e,protocol:n}){V(this,"protocol",void 0),V(this,"_context",void 0),V(this,"_resources",void 0),V(this,"_consumers",void 0),V(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:o=!0}){let u=this._resources[e];u?u.setData(n,i):(u=new _4(e,n,this._context),this._resources[e]=u),u.persistent=o}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const o=n[i],u=this._resources[o.resourceId];u&&u.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:o="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=u[e];if(this._track(i,o,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,o){const u=this._consumers,f=u[e]=u[e]||{},l=f[n]||{},b=l.resourceId&&this._resources[l.resourceId];b&&(b.unsubscribe(l),this.prune()),i&&(f[n]=l,l.onChange=o,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const v4=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,x4={name:"project32",dependencies:[kv],vs:v4},b4={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...DF},w4=[kv],E4=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function T4(t){const e=Sd.getDefaultProgramManager(t);for(const n of w4)e.addDefaultModule(n);for(const n of E4)e.addShaderHook(n);return e}const S4="layerManager.setLayers",A4="layerManager.activateViewport";class I4{constructor(e,{deck:n,stats:i,viewport:o,timeline:u}={}){V(this,"layers",void 0),V(this,"context",void 0),V(this,"resourceManager",void 0),V(this,"_lastRenderedLayers",[]),V(this,"_needsRedraw",!1),V(this,"_needsUpdate",!1),V(this,"_nextLayers",null),V(this,"_debug",!1),V(this,"activateViewport",f=>{Ji(A4,this,f),f&&(this.context.viewport=f)}),this.layers=[],this.resourceManager=new y4({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&T4(e),stats:i||new wv({id:"deck.gl"}),viewport:o||new mu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new JS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const o=i.getNeedsRedraw(e);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ji(S4,this,n,e),this._lastRenderedLayers=e;const i=Dv(e,Boolean);for(const o of i)o.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const f of e)i[f.id]?_n.warn("Multiple old layers with same id ".concat(f.id))():i[f.id]=f;const o=[];this._updateSublayersRecursively(n,i,o),this._finalizeOldLayers(i);let u=!1;for(const f of o)if(f.hasUniformTransition()){u="Uniform transition in ".concat(f);break}this._needsUpdate=u,this.layers=o}_updateSublayersRecursively(e,n,i){for(const o of e){o.context=this.context;const u=n[o.id];u===null&&_n.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let f=null;try{this._debug&&u!==o&&o.validateProps(),u?(this._transferLayerState(u,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),f=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}f&&this._updateSublayersRecursively(f,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ac.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Ac.MATCHED,n!==e&&(e.lifecycle=Ac.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Ac.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ac.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function uo(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!uo(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(const u of i)if(!e.hasOwnProperty(u)||!uo(t[u],e[u],n-1))return!1;return!0}return!1}class P4{constructor(e){V(this,"width",void 0),V(this,"height",void 0),V(this,"views",void 0),V(this,"viewState",void 0),V(this,"controllers",void 0),V(this,"timeline",void 0),V(this,"_viewports",void 0),V(this,"_viewportMap",void 0),V(this,"_isUpdating",void 0),V(this,"_needsRedraw",void 0),V(this,"_needsUpdate",void 0),V(this,"_eventManager",void 0),V(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),o={x:e[0],y:e[1]};for(let u=i.length-1;u>=0;--u){const f=i[u];if(f.containsPixel(o)){const l=e.slice();return l[0]-=f.x,l[1]-=f.y,f.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Dv(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!uo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):_n.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,n,i,o){const u=e.controller;if(u&&i){const f={...n,...u,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!o||o.constructor!==u.type)&&(o=this._createController(e,f)),o&&o.setProps(f),o}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let o=e.length;o--;){const u=e[o],f=this.getViewState(u),l=u.makeViewport({viewState:f,width:this.width,height:this.height});let b=n[u.id];const w=!!u.controller;w&&!b&&(i=!0),(i||!w)&&b&&(b.finalize(),b=null),this.controllers[u.id]=this._updateController(u,f,l,b),l&&this._viewports.unshift(l)}for(const o in n){const u=n[o];u&&!this.controllers[o]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,o)=>!e[o].equals(n[o]))}}const C4=/([0-9]+\.?[0-9]*)(%|px)/;function va(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=C4.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function xa(t,e){return t.relative?Math.round(t.position*e):t.position}function Bi(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class hu{constructor(e){V(this,"id",void 0),V(this,"viewportInstance",void 0),V(this,"_x",void 0),V(this,"_y",void 0),V(this,"_width",void 0),V(this,"_height",void 0),V(this,"_padding",void 0),V(this,"props",void 0);const{id:n,x:i=0,y:o=0,width:u="100%",height:f="100%",padding:l=null,viewportInstance:b}=e||{};Bi(!b||b instanceof mu),this.viewportInstance=b,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=va(i),this._y=va(o),this._width=va(u),this._height=va(f),this._padding=l&&{left:va(l.left||0),right:va(l.right||0),top:va(l.top||0),bottom:va(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&uo(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const o=this.getDimensions({width:e,height:n});return!o.height||!o.width?null:new this.ViewportType({...i,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:xa(this._x,e),y:xa(this._y,n),width:xa(this._width,e),height:xa(this._height,n)};return this._padding&&(i.padding={left:xa(this._padding.left,e),top:xa(this._padding.top,n),right:xa(this._padding.right,e),bottom:xa(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Id{constructor(e){V(this,"_inProgress",void 0),V(this,"_handle",void 0),V(this,"_timeline",void 0),V(this,"time",void 0),V(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:o}=this;this._handle=i.addChannel({delay:i.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Jw=()=>{},n0={BREAK:1,SNAP_TO_END:2,IGNORE:3},M4=t=>t,k4=n0.BREAK;class L4{constructor(e){V(this,"getControllerState",void 0),V(this,"props",void 0),V(this,"propsInTransition",void 0),V(this,"transition",void 0),V(this,"onViewStateChange",void 0),V(this,"onStateChange",void 0),V(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:o,startProps:u,endProps:f,duration:l,easing:b}}=n,w=b(i/l),M=o.interpolateProps(u,f,w);this.propsInTransition=this.getControllerState({...this.props,...M}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Id(e.timeline),this.onViewStateChange=e.onViewStateChange||Jw,this.onStateChange=e.onStateChange||Jw}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let o=i;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;o={...i,...u===n0.SNAP_TO_END?f:this.propsInTransition||i}}this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===n0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),o=this.getControllerState(n).shortestPathFrom(i),u=n.transitionInterpolator,f=u.getDuration?u.getDuration(e,n):n.transitionDuration;if(f===0)return;const l=u.initializeProps(e,o);this.propsInTransition={};const b={duration:f,easing:n.transitionEasing||M4,interpolator:u,interruption:n.transitionInterruption||k4,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(b),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class R4{constructor(e){V(this,"_propsToCompare",void 0),V(this,"_propsToExtract",void 0),V(this,"_requiredProps",void 0);const{compare:n,extract:i,required:o}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=o}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!ud(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},o={};for(const u of this._propsToExtract)(u in e||u in n)&&(i[u]=e[u],o[u]=n[u]);return this._checkRequiredProps(i),this._checkRequiredProps(o),{start:i,end:o}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Bi(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const D4=["longitude","latitude","zoom","bearing","pitch"],z4=["longitude","latitude","zoom"];class dA extends R4{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:D4,required:z4},super(i.transitionProps),V(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:o,around:u}=this.opts;if(o&&u){const f=o(e),l=o(n),b=f.unproject(u);i.start.around=u,Object.assign(i.end,{around:l.project(b),aroundPosition:b,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const o={};for(const u of this._propsToExtract)o[u]=rm(e[u]||0,n[u]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...n,...o});Object.assign(o,u.panByPosition(n.aroundPosition,rm(e.around,n.around,i)))}return o}}const ba={transitionDuration:0},O4=300,op=t=>1-(1-t)*(1-t),Sc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},vl={};class F4{constructor(e){V(this,"props",void 0),V(this,"state",{}),V(this,"transitionManager",void 0),V(this,"eventManager",void 0),V(this,"onViewStateChange",void 0),V(this,"onStateChange",void 0),V(this,"makeViewport",void 0),V(this,"_controllerState",void 0),V(this,"_events",{}),V(this,"_interactionState",{isDragging:!1}),V(this,"_customEvents",[]),V(this,"_eventStartBlocked",null),V(this,"_panMove",!1),V(this,"invertPan",!1),V(this,"dragMode","rotate"),V(this,"inertia",0),V(this,"scrollZoom",!0),V(this,"dragPan",!0),V(this,"dragRotate",!0),V(this,"doubleClickZoom",!0),V(this,"touchZoom",!0),V(this,"touchRotate",!1),V(this,"keyboard",!0),this.transitionManager=new L4({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:o}=e;return[o.x-n,o.y-i]}isPointInBounds(e,n){const{width:i,height:o}=this.props;if(n&&n.handled)return!1;const u=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=o;return u&&n&&n.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?O4:0;const{scrollZoom:i=!0,dragPan:o=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:l=!0,touchRotate:b=!1,keyboard:w=!0}=e,M=!!this.onViewStateChange;this.toggleEvents(Sc.WHEEL,M&&i),this.toggleEvents(Sc.PAN,M),this.toggleEvents(Sc.PINCH,M&&(l||b)),this.toggleEvents(Sc.TRIPLE_PAN,M&&b),this.toggleEvents(Sc.DOUBLE_TAP,M&&f),this.toggleEvents(Sc.KEYBOARD,M&&w),this.scrollZoom=i,this.dragPan=o,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=l,this.touchRotate=b,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const o={...e.getViewportProps(),...n},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:f})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const o=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(o,ba,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,ba,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:op},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ba,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:op},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*i)));u<0&&f!==0&&(f=1/f);const l=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,ba,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ba,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*n/2],u=this.controllerState.rotate({pos:o});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:op},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return vl._startPinchRotation=e.rotation,vl._lastPinchEvent=e,this.updateViewport(i,ba,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,o=this.getCenter(e);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:vl._startPinchRotation-i})}return this.updateViewport(n,ba,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),vl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=vl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const o=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),l=(f-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),b=Math.pow(2,f+l*n/2);u=u.zoom({pos:o,scale:b}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:op},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return vl._startPinchRotation=null,vl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:o,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let b;const w={};switch(e.srcEvent.code){case"Minus":b=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":b=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(b=l.rotateLeft(u),w.isRotating=!0):(b=l.moveLeft(o),w.isPanning=!0);break;case"ArrowRight":n?(b=l.rotateRight(u),w.isRotating=!0):(b=l.moveRight(o),w.isPanning=!0);break;case"ArrowUp":n?(b=l.rotateUp(f),w.isRotating=!0):(b=l.moveUp(o),w.isPanning=!0);break;case"ArrowDown":n?(b=l.rotateDown(f),w.isRotating=!0):(b=l.moveDown(o),w.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ba:e?{...n,transitionInterpolator:new dA({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class B4{constructor(e,n){V(this,"_viewportProps",void 0),V(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Qw=5,N4=1.2;class U4 extends B4{constructor(e){const{width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l=0,pitch:b=0,altitude:w=1.5,position:M=[0,0,0],maxZoom:L=20,minZoom:C=0,maxPitch:W=60,minPitch:Q=0,startPanLngLat:ne,startZoomLngLat:_e,startRotatePos:K,startBearing:$,startPitch:J,startZoom:pe,normalize:ye=!0}=e;Bi(Number.isFinite(u)),Bi(Number.isFinite(o)),Bi(Number.isFinite(f)),super({width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l,pitch:b,altitude:w,maxZoom:L,minZoom:C,maxPitch:W,minPitch:Q,normalize:ye,position:M},{startPanLngLat:ne,startZoomLngLat:_e,startRotatePos:K,startBearing:$,startPitch:J,startZoom:pe}),V(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:o,startBearing:u,startPitch:f}=this.getState();if(!o||u===void 0||f===void 0)return this;let l;return e?l=this._getNewRotation(e,o,f,u):l={bearing:u+n,pitch:f+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:o,startZoomLngLat:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(n)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:l}=this.getViewportProps();let b=o+Math.log2(i);b=Pa(b,l,f);const w=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...w.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:o,longitude:u}=i;return Math.abs(o-n.bearing)>180&&(i.bearing=o<0?o+360:o-360),Math.abs(u-n.longitude)>180&&(i.longitude=u<0?u+360:u-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:o}=e;e.zoom=Pa(o,i,n);const{maxPitch:u,minPitch:f,pitch:l}=e;e.pitch=Pa(l,f,u);const{normalize:b=!0}=e;return b&&Object.assign(e,$B(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,o){const u=e[0]-n[0],f=e[1]-n[1],l=e[1],b=n[1],{width:w,height:M}=this.getViewportProps(),L=u/w;let C=0;f>0?Math.abs(M-b)>Qw&&(C=f/(b-M)*N4):f<0&&b>Qw&&(C=1-l/b),C=Pa(C,-1,1);const{minPitch:W,maxPitch:Q}=this.getViewportProps(),ne=o+180*L;let _e=i;return C>0?_e=i+C*(Q-i):C<0&&(_e=i-C*(W-i)),{pitch:_e,bearing:ne}}}class V4 extends F4{constructor(...e){super(...e),V(this,"ControllerState",U4),V(this,"transition",{transitionDuration:300,transitionInterpolator:new dA({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),V(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class zv extends hu{get ViewportType(){return uu}get ControllerType(){return V4}}V(zv,"displayName","MapView");const j4=new lA;function G4(t,e){var n,i;const o=(n=t.order)!==null&&n!==void 0?n:1/0,u=(i=e.order)!==null&&i!==void 0?i:1/0;return o-u}class $4{constructor(){V(this,"effects",void 0),V(this,"_resolvedEffects",[]),V(this,"_defaultEffects",[]),V(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(o=>G4(o,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(uo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const o of this.effects)n[o.id]=o;const i=[];for(const o of e){const u=n[o.id];u&&u!==o?u.setProps?(u.setProps(o.props),i.push(u)):(u.cleanup(),i.push(o)):i.push(o),delete n[o.id]}for(const o in n)n[o].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(o=>o instanceof lA)||this._resolvedEffects.push(j4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class H4 extends Mv{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const W4="deckRenderer.renderLayers";class q4{constructor(e){V(this,"gl",void 0),V(this,"layerFilter",void 0),V(this,"drawPickingColors",void 0),V(this,"drawLayersPass",void 0),V(this,"pickLayersPass",void 0),V(this,"renderCount",void 0),V(this,"_needsRedraw",void 0),V(this,"renderBuffers",void 0),V(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new H4(e),this.pickLayersPass=new uA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||yi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const o=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,u=n.render({...i,target:o});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ji(W4,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new yi(this.gl),new yi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,o={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const u of e)if(u.postRender){if(u.id===this.lastPostProcessEffect){o.target=n.target,u.postRender(this.gl,o);break}const f=u.postRender(this.gl,o);o.inputBuffer=f,o.swapBuffer=f===i[0]?i[1]:i[0]}}}const Z4={pickedColor:null,pickedObjectIndex:-1};function X4({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:o,deviceRect:u}){const{x:f,y:l,width:b,height:w}=u;let M=o*o,L=-1,C=0;for(let W=0;W<w;W++){const Q=W+l-i,ne=Q*Q;if(ne>M)C+=4*b;else for(let _e=0;_e<b;_e++){if(t[C+3]-1>=0){const $=_e+f-n,J=$*$+ne;J<=M&&(M=J,L=C)}C+=4}}if(L>=0){const W=t.slice(L,L+4),Q=e(W);if(Q){const ne=Math.floor(L/4/b),_e=L/4-ne*b;return{...Q,pickedColor:W,pickedX:f+_e,pickedY:l+ne}}_n.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Z4}function Y4({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const u=t.slice(i,i+4),f=u.join(",");if(!n.has(f)){const l=e(u);l?n.set(f,{...l,color:u}):_n.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function fA({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:o,z:u}){let f=e[0];e.length>1&&(f=J4((t==null?void 0:t.pickedViewports)||e,{x:i,y:o}));let l;if(f){const b=[i-f.x,o-f.y];u!==void 0&&(b[2]=u),l=f.unproject(b)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:i,y:o,pixel:[i,o],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function K4(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:o}=t,{pickedColor:u,pickedLayer:f,pickedObjectIndex:l}=e,b=f?[f]:[];if(i==="hover"){const L=n.index,C=n.layerId,W=f?f.props.id:null;if(W!==C||l!==L){if(W!==C){const Q=o.find(ne=>ne.props.id===C);Q&&b.unshift(Q)}n.layerId=W,n.index=l,n.info=null}}const w=fA(t),M=new Map;return M.set(null,w),b.forEach(L=>{let C={...w};L===f&&(C.color=u,C.index=l,C.picked=!0),C=pA({layer:L,info:C,mode:i});const W=C.layer;L===f&&i==="hover"&&(n.info=C),M.set(W.id,C),i==="hover"&&W.updateAutoHighlight(C)}),M}function pA({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function J4(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class Q4{constructor(e){V(this,"gl",void 0),V(this,"pickingFBO",void 0),V(this,"depthFBO",void 0),V(this,"pickLayersPass",void 0),V(this,"layerFilter",void 0),V(this,"lastPickedInfo",void 0),V(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new uA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:o},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,l=u&&u.viewport&&u.viewport.id,b=f?i.find(C=>C.id===f):null,w=l&&o.find(C=>C.id===l)||o[0],M=w&&w.unproject([e-w.x,n-w.y]);return{...u,...{x:e,y:n,viewport:w,coordinate:M,layer:b}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new yi(i),yi.isSupported(i,{colorBufferFloat:!0}))){const o=new yi(i);o.attach({36064:new Qr(i,{format:Xt(i)?34836:6408,type:5126})}),this.depthFBO=o}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:o,y:u,radius:f=0,depth:l=1,mode:b="query",unproject3D:w,onViewportActive:M,effects:L}){const C=this._getPickable(e),W=iu(this.gl);if(!C)return{result:[],emptyInfo:fA({viewports:i,x:o,y:u,pixelRatio:W})};this._resizeBuffer();const Q=E_(this.gl,[o,u],!0),ne=[Q.x+Math.floor(Q.width/2),Q.y+Math.floor(Q.height/2)],_e=Math.round(f*W),{width:K,height:$}=this.pickingFBO,J=this._getPickingRect({deviceX:ne[0],deviceY:ne[1],deviceRadius:_e,deviceWidth:K,deviceHeight:$}),pe={x:o-f,y:u-f,width:f*2+1,height:f*2+1};let ye;const Ae=[],Oe=new Set;for(let Be=0;Be<l;Be++){let Xe;if(J){const mt=this._drawAndSample({layers:C,views:n,viewports:i,onViewportActive:M,deviceRect:J,cullRect:pe,effects:L,pass:"picking:".concat(b)});Xe=X4({...mt,deviceX:ne[0],deviceY:ne[1],deviceRadius:_e,deviceRect:J})}else Xe={pickedColor:null,pickedObjectIndex:-1};let je;if(Xe.pickedLayer&&w&&this.depthFBO){const{pickedColors:mt}=this._drawAndSample({layers:[Xe.pickedLayer],views:n,viewports:i,onViewportActive:M,deviceRect:{x:Xe.pickedX,y:Xe.pickedY,width:1,height:1},cullRect:pe,effects:L,pass:"picking:".concat(b,":z")},!0);mt[3]&&(je=mt[0])}Xe.pickedLayer&&Be+1<l&&(Oe.add(Xe.pickedLayer),Xe.pickedLayer.disablePickingIndex(Xe.pickedObjectIndex)),ye=K4({pickInfo:Xe,lastPickedInfo:this.lastPickedInfo,mode:b,layers:C,viewports:i,x:o,y:u,z:je,pixelRatio:W});for(const mt of ye.values())mt.layer&&Ae.push(mt);if(!Xe.pickedColor)break}for(const Be of Oe)Be.restorePickingColors();return{result:Ae,emptyInfo:ye.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:o,y:u,width:f=1,height:l=1,mode:b="query",maxObjects:w=null,onViewportActive:M,effects:L}){const C=this._getPickable(e);if(!C)return[];this._resizeBuffer();const W=iu(this.gl),Q=E_(this.gl,[o,u],!0),ne=Q.x,_e=Q.y+Q.height,K=E_(this.gl,[o+f,u+l],!0),$=K.x+K.width,J=K.y,pe={x:ne,y:J,width:$-ne,height:_e-J},ye=this._drawAndSample({layers:C,views:n,viewports:i,onViewportActive:M,deviceRect:pe,cullRect:{x:o,y:u,width:f,height:l},effects:L,pass:"picking:".concat(b)}),Ae=Y4(ye),Oe=new Map,Be=Number.isFinite(w);for(let je=0;je<Ae.length;je++){var Xe;if(Be&&w&&Oe.size>=w)break;const mt=Ae[je];let Dt={color:mt.pickedColor,layer:null,index:mt.pickedObjectIndex,picked:!0,x:o,y:u,pixelRatio:W};Dt=pA({layer:mt.pickedLayer,info:Dt,mode:b});const qt=(Xe=Dt.object)!==null&&Xe!==void 0?Xe:"".concat(Dt.layer.id,"[").concat(Dt.index,"]");Oe.has(qt)||Oe.set(qt,Dt)}return Array.from(Oe.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:o,deviceRect:u,cullRect:f,effects:l,pass:b},w=!1){const M=w?this.depthFBO:this.pickingFBO,L={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:o,pickingFBO:M,deviceRect:u,cullRect:f,effects:l,pass:b,pickZ:w,preRenderStats:{}};for(const $ of l)$.useInPicking&&(L.preRenderStats[$.id]=$.preRender(this.gl,L));const{decodePickingColor:C}=this.pickLayersPass.render(L),{x:W,y:Q,width:ne,height:_e}=u,K=new(w?Float32Array:Uint8Array)(ne*_e*4);return Dm(M,{sourceX:W,sourceY:Q,sourceWidth:ne,sourceHeight:_e,target:K}),{pickedColors:K,decodePickingColor:C}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:o,deviceHeight:u}){const f=Math.max(0,e-i),l=Math.max(0,n-i),b=Math.min(o,e+i+1)-f,w=Math.min(u,n+i+1)-l;return b<=0||w<=0?null:{x:f,y:l,width:b,height:w}}}const eN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class tN{constructor(e){V(this,"el",null),V(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,eN),n.appendChild(this.el))}setTooltip(e,n,i){const o=this.el;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var mA={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,o){var u=["","webkit","Moz","MS","ms","o"],f=n.createElement("div"),l="function",b=Math.round,w=Math.abs,M=Date.now;function L(j,X,ce){return setTimeout(J(j,ce),X)}function C(j,X,ce){return Array.isArray(j)?(W(j,ce[X],ce),!0):!1}function W(j,X,ce){var Se;if(j)if(j.forEach)j.forEach(X,ce);else if(j.length!==o)for(Se=0;Se<j.length;)X.call(ce,j[Se],Se,j),Se++;else for(Se in j)j.hasOwnProperty(Se)&&X.call(ce,j[Se],Se,j)}function Q(j,X,ce){var Se="DEPRECATED METHOD: "+X+`
`+ce+` AT 
`;return function(){var Ne=new Error("get-stack-trace"),ot=Ne&&Ne.stack?Ne.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ft=e.console&&(e.console.warn||e.console.log);return Ft&&Ft.call(e.console,Se,ot),j.apply(this,arguments)}}var ne;typeof Object.assign!="function"?ne=function(X){if(X===o||X===null)throw new TypeError("Cannot convert undefined or null to object");for(var ce=Object(X),Se=1;Se<arguments.length;Se++){var Ne=arguments[Se];if(Ne!==o&&Ne!==null)for(var ot in Ne)Ne.hasOwnProperty(ot)&&(ce[ot]=Ne[ot])}return ce}:ne=Object.assign;var _e=Q(function(X,ce,Se){for(var Ne=Object.keys(ce),ot=0;ot<Ne.length;)(!Se||Se&&X[Ne[ot]]===o)&&(X[Ne[ot]]=ce[Ne[ot]]),ot++;return X},"extend","Use `assign`."),K=Q(function(X,ce){return _e(X,ce,!0)},"merge","Use `assign`.");function $(j,X,ce){var Se=X.prototype,Ne;Ne=j.prototype=Object.create(Se),Ne.constructor=j,Ne._super=Se,ce&&ne(Ne,ce)}function J(j,X){return function(){return j.apply(X,arguments)}}function pe(j,X){return typeof j==l?j.apply(X&&X[0]||o,X):j}function ye(j,X){return j===o?X:j}function Ae(j,X,ce){W(je(X),function(Se){j.addEventListener(Se,ce,!1)})}function Oe(j,X,ce){W(je(X),function(Se){j.removeEventListener(Se,ce,!1)})}function Be(j,X){for(;j;){if(j==X)return!0;j=j.parentNode}return!1}function Xe(j,X){return j.indexOf(X)>-1}function je(j){return j.trim().split(/\s+/g)}function mt(j,X,ce){if(j.indexOf&&!ce)return j.indexOf(X);for(var Se=0;Se<j.length;){if(ce&&j[Se][ce]==X||!ce&&j[Se]===X)return Se;Se++}return-1}function Dt(j){return Array.prototype.slice.call(j,0)}function qt(j,X,ce){for(var Se=[],Ne=[],ot=0;ot<j.length;){var Ft=X?j[ot][X]:j[ot];mt(Ne,Ft)<0&&Se.push(j[ot]),Ne[ot]=Ft,ot++}return ce&&(X?Se=Se.sort(function(kt,Fn){return kt[X]>Fn[X]}):Se=Se.sort()),Se}function zt(j,X){for(var ce,Se,Ne=X[0].toUpperCase()+X.slice(1),ot=0;ot<u.length;){if(ce=u[ot],Se=ce?ce+Ne:X,Se in j)return Se;ot++}return o}var ti=1;function xt(){return ti++}function vi(j){var X=j.ownerDocument||j;return X.defaultView||X.parentWindow||e}var tt=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in e,St=zt(e,"PointerEvent")!==o,tn=wt&&tt.test(navigator.userAgent),nn="touch",nr="pen",ni="mouse",xi="kinect",ii=25,ln=1,bi=2,Wt=4,zn=8,ns=1,Ci=2,Zn=4,Mr=8,Vi=16,hi=Ci|Zn,ji=Mr|Vi,Vs=hi|ji,jt=["x","y"],Mi=["clientX","clientY"];function On(j,X){var ce=this;this.manager=j,this.callback=X,this.element=j.element,this.target=j.options.inputTarget,this.domHandler=function(Se){pe(j.options.enable,[j])&&ce.handler(Se)},this.init()}On.prototype={handler:function(){},init:function(){this.evEl&&Ae(this.element,this.evEl,this.domHandler),this.evTarget&&Ae(this.target,this.evTarget,this.domHandler),this.evWin&&Ae(vi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Oe(this.element,this.evEl,this.domHandler),this.evTarget&&Oe(this.target,this.evTarget,this.domHandler),this.evWin&&Oe(vi(this.element),this.evWin,this.domHandler)}};function is(j){var X,ce=j.options.inputClass;return ce?X=ce:St?X=ir:tn?X=xr:wt?X=Y:X=Pt,new X(j,go)}function go(j,X,ce){var Se=ce.pointers.length,Ne=ce.changedPointers.length,ot=X&ln&&Se-Ne===0,Ft=X&(Wt|zn)&&Se-Ne===0;ce.isFirst=!!ot,ce.isFinal=!!Ft,ot&&(j.session={}),ce.eventType=X,kr(j,ce),j.emit("hammer.input",ce),j.recognize(ce),j.session.prevInput=ce}function kr(j,X){var ce=j.session,Se=X.pointers,Ne=Se.length;ce.firstInput||(ce.firstInput=yr(X)),Ne>1&&!ce.firstMultiple?ce.firstMultiple=yr(X):Ne===1&&(ce.firstMultiple=!1);var ot=ce.firstInput,Ft=ce.firstMultiple,En=Ft?Ft.center:ot.center,kt=X.center=Me(Se);X.timeStamp=M(),X.deltaTime=X.timeStamp-ot.timeStamp,X.angle=Nt(En,kt),X.distance=wi(En,kt),Lr(ce,X),X.offsetDirection=rs(X.deltaX,X.deltaY);var Fn=He(X.deltaTime,X.deltaX,X.deltaY);X.overallVelocityX=Fn.x,X.overallVelocityY=Fn.y,X.overallVelocity=w(Fn.x)>w(Fn.y)?Fn.x:Fn.y,X.scale=Ft?ki(Ft.pointers,Se):1,X.rotation=Ft?Gi(Ft.pointers,Se):0,X.maxPointers=ce.prevInput?X.pointers.length>ce.prevInput.maxPointers?X.pointers.length:ce.prevInput.maxPointers:X.pointers.length,js(ce,X);var rr=j.element;Be(X.srcEvent.target,rr)&&(rr=X.srcEvent.target),X.target=rr}function Lr(j,X){var ce=X.center,Se=j.offsetDelta||{},Ne=j.prevDelta||{},ot=j.prevInput||{};(X.eventType===ln||ot.eventType===Wt)&&(Ne=j.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},Se=j.offsetDelta={x:ce.x,y:ce.y}),X.deltaX=Ne.x+(ce.x-Se.x),X.deltaY=Ne.y+(ce.y-Se.y)}function js(j,X){var ce=j.lastInterval||X,Se=X.timeStamp-ce.timeStamp,Ne,ot,Ft,En;if(X.eventType!=zn&&(Se>ii||ce.velocity===o)){var kt=X.deltaX-ce.deltaX,Fn=X.deltaY-ce.deltaY,rr=He(Se,kt,Fn);ot=rr.x,Ft=rr.y,Ne=w(rr.x)>w(rr.y)?rr.x:rr.y,En=rs(kt,Fn),j.lastInterval=X}else Ne=ce.velocity,ot=ce.velocityX,Ft=ce.velocityY,En=ce.direction;X.velocity=Ne,X.velocityX=ot,X.velocityY=Ft,X.direction=En}function yr(j){for(var X=[],ce=0;ce<j.pointers.length;)X[ce]={clientX:b(j.pointers[ce].clientX),clientY:b(j.pointers[ce].clientY)},ce++;return{timeStamp:M(),pointers:X,center:Me(X),deltaX:j.deltaX,deltaY:j.deltaY}}function Me(j){var X=j.length;if(X===1)return{x:b(j[0].clientX),y:b(j[0].clientY)};for(var ce=0,Se=0,Ne=0;Ne<X;)ce+=j[Ne].clientX,Se+=j[Ne].clientY,Ne++;return{x:b(ce/X),y:b(Se/X)}}function He(j,X,ce){return{x:X/j||0,y:ce/j||0}}function rs(j,X){return j===X?ns:w(j)>=w(X)?j<0?Ci:Zn:X<0?Mr:Vi}function wi(j,X,ce){ce||(ce=jt);var Se=X[ce[0]]-j[ce[0]],Ne=X[ce[1]]-j[ce[1]];return Math.sqrt(Se*Se+Ne*Ne)}function Nt(j,X,ce){ce||(ce=jt);var Se=X[ce[0]]-j[ce[0]],Ne=X[ce[1]]-j[ce[1]];return Math.atan2(Ne,Se)*180/Math.PI}function Gi(j,X){return Nt(X[1],X[0],Mi)+Nt(j[1],j[0],Mi)}function ki(j,X){return wi(X[0],X[1],Mi)/wi(j[0],j[1],Mi)}var Li={mousedown:ln,mousemove:bi,mouseup:Wt},ss="mousedown",$e="mousemove mouseup";function Pt(){this.evEl=ss,this.evWin=$e,this.pressed=!1,On.apply(this,arguments)}$(Pt,On,{handler:function(X){var ce=Li[X.type];ce&ln&&X.button===0&&(this.pressed=!0),ce&bi&&X.which!==1&&(ce=Wt),this.pressed&&(ce&Wt&&(this.pressed=!1),this.callback(this.manager,ce,{pointers:[X],changedPointers:[X],pointerType:ni,srcEvent:X}))}});var It={pointerdown:ln,pointermove:bi,pointerup:Wt,pointercancel:zn,pointerout:zn},Xn={2:nn,3:nr,4:ni,5:xi},Rr="pointerdown",At="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Rr="MSPointerDown",At="MSPointerMove MSPointerUp MSPointerCancel");function ir(){this.evEl=Rr,this.evWin=At,On.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(ir,On,{handler:function(X){var ce=this.store,Se=!1,Ne=X.type.toLowerCase().replace("ms",""),ot=It[Ne],Ft=Xn[X.pointerType]||X.pointerType,En=Ft==nn,kt=mt(ce,X.pointerId,"pointerId");ot&ln&&(X.button===0||En)?kt<0&&(ce.push(X),kt=ce.length-1):ot&(Wt|zn)&&(Se=!0),!(kt<0)&&(ce[kt]=X,this.callback(this.manager,ot,{pointers:ce,changedPointers:[X],pointerType:Ft,srcEvent:X}),Se&&ce.splice(kt,1))}});var jn={touchstart:ln,touchmove:bi,touchend:Wt,touchcancel:zn},Gs="touchstart",Mn="touchstart touchmove touchend touchcancel";function ri(){this.evTarget=Gs,this.evWin=Mn,this.started=!1,On.apply(this,arguments)}$(ri,On,{handler:function(X){var ce=jn[X.type];if(ce===ln&&(this.started=!0),!!this.started){var Se=Qt.call(this,X,ce);ce&(Wt|zn)&&Se[0].length-Se[1].length===0&&(this.started=!1),this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:nn,srcEvent:X})}}});function Qt(j,X){var ce=Dt(j.touches),Se=Dt(j.changedTouches);return X&(Wt|zn)&&(ce=qt(ce.concat(Se),"identifier",!0)),[ce,Se]}var $s={touchstart:ln,touchmove:bi,touchend:Wt,touchcancel:zn},vr="touchstart touchmove touchend touchcancel";function xr(){this.evTarget=vr,this.targetIds={},On.apply(this,arguments)}$(xr,On,{handler:function(X){var ce=$s[X.type],Se=Es.call(this,X,ce);Se&&this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:nn,srcEvent:X})}});function Es(j,X){var ce=Dt(j.touches),Se=this.targetIds;if(X&(ln|bi)&&ce.length===1)return Se[ce[0].identifier]=!0,[ce,ce];var Ne,ot,Ft=Dt(j.changedTouches),En=[],kt=this.target;if(ot=ce.filter(function(Fn){return Be(Fn.target,kt)}),X===ln)for(Ne=0;Ne<ot.length;)Se[ot[Ne].identifier]=!0,Ne++;for(Ne=0;Ne<Ft.length;)Se[Ft[Ne].identifier]&&En.push(Ft[Ne]),X&(Wt|zn)&&delete Se[Ft[Ne].identifier],Ne++;if(En.length)return[qt(ot.concat(En),"identifier",!0),En]}var Hs=2500,os=25;function Y(){On.apply(this,arguments);var j=J(this.handler,this);this.touch=new xr(this.manager,j),this.mouse=new Pt(this.manager,j),this.primaryTouch=null,this.lastTouches=[]}$(Y,On,{handler:function(X,ce,Se){var Ne=Se.pointerType==nn,ot=Se.pointerType==ni;if(!(ot&&Se.sourceCapabilities&&Se.sourceCapabilities.firesTouchEvents)){if(Ne)R.call(this,ce,Se);else if(ot&&q.call(this,Se))return;this.callback(X,ce,Se)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(j,X){j&ln?(this.primaryTouch=X.changedPointers[0].identifier,F.call(this,X)):j&(Wt|zn)&&F.call(this,X)}function F(j){var X=j.changedPointers[0];if(X.identifier===this.primaryTouch){var ce={x:X.clientX,y:X.clientY};this.lastTouches.push(ce);var Se=this.lastTouches,Ne=function(){var ot=Se.indexOf(ce);ot>-1&&Se.splice(ot,1)};setTimeout(Ne,Hs)}}function q(j){for(var X=j.srcEvent.clientX,ce=j.srcEvent.clientY,Se=0;Se<this.lastTouches.length;Se++){var Ne=this.lastTouches[Se],ot=Math.abs(X-Ne.x),Ft=Math.abs(ce-Ne.y);if(ot<=os&&Ft<=os)return!0}return!1}var Z=zt(f.style,"touchAction"),le=Z!==o,de="compute",ue="auto",ae="manipulation",fe="none",Pe="pan-x",ze="pan-y",Ie=Ye();function rt(j,X){this.manager=j,this.set(X)}rt.prototype={set:function(j){j==de&&(j=this.compute()),le&&this.manager.element.style&&Ie[j]&&(this.manager.element.style[Z]=j),this.actions=j.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var j=[];return W(this.manager.recognizers,function(X){pe(X.options.enable,[X])&&(j=j.concat(X.getTouchAction()))}),lt(j.join(" "))},preventDefaults:function(j){var X=j.srcEvent,ce=j.offsetDirection;if(this.manager.session.prevented){X.preventDefault();return}var Se=this.actions,Ne=Xe(Se,fe)&&!Ie[fe],ot=Xe(Se,ze)&&!Ie[ze],Ft=Xe(Se,Pe)&&!Ie[Pe];if(Ne){var En=j.pointers.length===1,kt=j.distance<2,Fn=j.deltaTime<250;if(En&&kt&&Fn)return}if(!(Ft&&ot)&&(Ne||ot&&ce&hi||Ft&&ce&ji))return this.preventSrc(X)},preventSrc:function(j){this.manager.session.prevented=!0,j.preventDefault()}};function lt(j){if(Xe(j,fe))return fe;var X=Xe(j,Pe),ce=Xe(j,ze);return X&&ce?fe:X||ce?X?Pe:ze:Xe(j,ae)?ae:ue}function Ye(){if(!le)return!1;var j={},X=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ce){j[ce]=X?e.CSS.supports("touch-action",ce):!0}),j}var gt=1,dt=2,Mt=4,vt=8,Tt=vt,Ot=16,Ut=32;function un(j){this.options=ne({},this.defaults,j||{}),this.id=xt(),this.manager=null,this.options.enable=ye(this.options.enable,!0),this.state=gt,this.simultaneous={},this.requireFail=[]}un.prototype={defaults:{},set:function(j){return ne(this.options,j),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(j){if(C(j,"recognizeWith",this))return this;var X=this.simultaneous;return j=Dr(j,this),X[j.id]||(X[j.id]=j,j.recognizeWith(this)),this},dropRecognizeWith:function(j){return C(j,"dropRecognizeWith",this)?this:(j=Dr(j,this),delete this.simultaneous[j.id],this)},requireFailure:function(j){if(C(j,"requireFailure",this))return this;var X=this.requireFail;return j=Dr(j,this),mt(X,j)===-1&&(X.push(j),j.requireFailure(this)),this},dropRequireFailure:function(j){if(C(j,"dropRequireFailure",this))return this;j=Dr(j,this);var X=mt(this.requireFail,j);return X>-1&&this.requireFail.splice(X,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(j){return!!this.simultaneous[j.id]},emit:function(j){var X=this,ce=this.state;function Se(Ne){X.manager.emit(Ne,j)}ce<vt&&Se(X.options.event+hn(ce)),Se(X.options.event),j.additionalEvent&&Se(j.additionalEvent),ce>=vt&&Se(X.options.event+hn(ce))},tryEmit:function(j){if(this.canEmit())return this.emit(j);this.state=Ut},canEmit:function(){for(var j=0;j<this.requireFail.length;){if(!(this.requireFail[j].state&(Ut|gt)))return!1;j++}return!0},recognize:function(j){var X=ne({},j);if(!pe(this.options.enable,[this,X])){this.reset(),this.state=Ut;return}this.state&(Tt|Ot|Ut)&&(this.state=gt),this.state=this.process(X),this.state&(dt|Mt|vt|Ot)&&this.tryEmit(X)},process:function(j){},getTouchAction:function(){},reset:function(){}};function hn(j){return j&Ot?"cancel":j&vt?"end":j&Mt?"move":j&dt?"start":""}function Yn(j){return j==Vi?"down":j==Mr?"up":j==Ci?"left":j==Zn?"right":""}function Dr(j,X){var ce=X.manager;return ce?ce.get(j):j}function di(){un.apply(this,arguments)}$(di,un,{defaults:{pointers:1},attrTest:function(j){var X=this.options.pointers;return X===0||j.pointers.length===X},process:function(j){var X=this.state,ce=j.eventType,Se=X&(dt|Mt),Ne=this.attrTest(j);return Se&&(ce&zn||!Ne)?X|Ot:Se||Ne?ce&Wt?X|vt:X&dt?X|Mt:dt:Ut}});function Zt(){di.apply(this,arguments),this.pX=null,this.pY=null}$(Zt,di,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vs},getTouchAction:function(){var j=this.options.direction,X=[];return j&hi&&X.push(ze),j&ji&&X.push(Pe),X},directionTest:function(j){var X=this.options,ce=!0,Se=j.distance,Ne=j.direction,ot=j.deltaX,Ft=j.deltaY;return Ne&X.direction||(X.direction&hi?(Ne=ot===0?ns:ot<0?Ci:Zn,ce=ot!=this.pX,Se=Math.abs(j.deltaX)):(Ne=Ft===0?ns:Ft<0?Mr:Vi,ce=Ft!=this.pY,Se=Math.abs(j.deltaY))),j.direction=Ne,ce&&Se>X.threshold&&Ne&X.direction},attrTest:function(j){return di.prototype.attrTest.call(this,j)&&(this.state&dt||!(this.state&dt)&&this.directionTest(j))},emit:function(j){this.pX=j.deltaX,this.pY=j.deltaY;var X=Yn(j.direction);X&&(j.additionalEvent=this.options.event+X),this._super.emit.call(this,j)}});function _o(){di.apply(this,arguments)}$(_o,di,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.scale-1)>this.options.threshold||this.state&dt)},emit:function(j){if(j.scale!==1){var X=j.scale<1?"in":"out";j.additionalEvent=this.options.event+X}this._super.emit.call(this,j)}});function yo(){un.apply(this,arguments),this._timer=null,this._input=null}$(yo,un,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ue]},process:function(j){var X=this.options,ce=j.pointers.length===X.pointers,Se=j.distance<X.threshold,Ne=j.deltaTime>X.time;if(this._input=j,!Se||!ce||j.eventType&(Wt|zn)&&!Ne)this.reset();else if(j.eventType&ln)this.reset(),this._timer=L(function(){this.state=Tt,this.tryEmit()},X.time,this);else if(j.eventType&Wt)return Tt;return Ut},reset:function(){clearTimeout(this._timer)},emit:function(j){this.state===Tt&&(j&&j.eventType&Wt?this.manager.emit(this.options.event+"up",j):(this._input.timeStamp=M(),this.manager.emit(this.options.event,this._input)))}});function Yo(){di.apply(this,arguments)}$(Yo,di,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.rotation)>this.options.threshold||this.state&dt)}});function Ko(){di.apply(this,arguments)}$(Ko,di,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:hi|ji,pointers:1},getTouchAction:function(){return Zt.prototype.getTouchAction.call(this)},attrTest:function(j){var X=this.options.direction,ce;return X&(hi|ji)?ce=j.overallVelocity:X&hi?ce=j.overallVelocityX:X&ji&&(ce=j.overallVelocityY),this._super.attrTest.call(this,j)&&X&j.offsetDirection&&j.distance>this.options.threshold&&j.maxPointers==this.options.pointers&&w(ce)>this.options.velocity&&j.eventType&Wt},emit:function(j){var X=Yn(j.offsetDirection);X&&this.manager.emit(this.options.event+X,j),this.manager.emit(this.options.event,j)}});function Ws(){un.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(Ws,un,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ae]},process:function(j){var X=this.options,ce=j.pointers.length===X.pointers,Se=j.distance<X.threshold,Ne=j.deltaTime<X.time;if(this.reset(),j.eventType&ln&&this.count===0)return this.failTimeout();if(Se&&Ne&&ce){if(j.eventType!=Wt)return this.failTimeout();var ot=this.pTime?j.timeStamp-this.pTime<X.interval:!0,Ft=!this.pCenter||wi(this.pCenter,j.center)<X.posThreshold;this.pTime=j.timeStamp,this.pCenter=j.center,!Ft||!ot?this.count=1:this.count+=1,this._input=j;var En=this.count%X.taps;if(En===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=Tt,this.tryEmit()},X.interval,this),dt):Tt}return Ut},failTimeout:function(){return this._timer=L(function(){this.state=Ut},this.options.interval,this),Ut},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Tt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function zr(j,X){return X=X||{},X.recognizers=ye(X.recognizers,zr.defaults.preset),new ea(j,X)}zr.VERSION="2.0.7",zr.defaults={domEvents:!1,touchAction:de,enable:!0,inputTarget:null,inputClass:null,preset:[[Yo,{enable:!1}],[_o,{enable:!1},["rotate"]],[Ko,{direction:hi}],[Zt,{direction:hi},["swipe"]],[Ws],[Ws,{event:"doubletap",taps:2},["tap"]],[yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Jo=1,Qo=2;function ea(j,X){this.options=ne({},zr.defaults,X||{}),this.options.inputTarget=this.options.inputTarget||j,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=j,this.input=is(this),this.touchAction=new rt(this,this.options.touchAction),Wa(this,!0),W(this.options.recognizers,function(ce){var Se=this.add(new ce[0](ce[1]));ce[2]&&Se.recognizeWith(ce[2]),ce[3]&&Se.requireFailure(ce[3])},this)}ea.prototype={set:function(j){return ne(this.options,j),j.touchAction&&this.touchAction.update(),j.inputTarget&&(this.input.destroy(),this.input.target=j.inputTarget,this.input.init()),this},stop:function(j){this.session.stopped=j?Qo:Jo},recognize:function(j){var X=this.session;if(!X.stopped){this.touchAction.preventDefaults(j);var ce,Se=this.recognizers,Ne=X.curRecognizer;(!Ne||Ne&&Ne.state&Tt)&&(Ne=X.curRecognizer=null);for(var ot=0;ot<Se.length;)ce=Se[ot],X.stopped!==Qo&&(!Ne||ce==Ne||ce.canRecognizeWith(Ne))?ce.recognize(j):ce.reset(),!Ne&&ce.state&(dt|Mt|vt)&&(Ne=X.curRecognizer=ce),ot++}},get:function(j){if(j instanceof un)return j;for(var X=this.recognizers,ce=0;ce<X.length;ce++)if(X[ce].options.event==j)return X[ce];return null},add:function(j){if(C(j,"add",this))return this;var X=this.get(j.options.event);return X&&this.remove(X),this.recognizers.push(j),j.manager=this,this.touchAction.update(),j},remove:function(j){if(C(j,"remove",this))return this;if(j=this.get(j),j){var X=this.recognizers,ce=mt(X,j);ce!==-1&&(X.splice(ce,1),this.touchAction.update())}return this},on:function(j,X){if(j!==o&&X!==o){var ce=this.handlers;return W(je(j),function(Se){ce[Se]=ce[Se]||[],ce[Se].push(X)}),this}},off:function(j,X){if(j!==o){var ce=this.handlers;return W(je(j),function(Se){X?ce[Se]&&ce[Se].splice(mt(ce[Se],X),1):delete ce[Se]}),this}},emit:function(j,X){this.options.domEvents&&$l(j,X);var ce=this.handlers[j]&&this.handlers[j].slice();if(!(!ce||!ce.length)){X.type=j,X.preventDefault=function(){X.srcEvent.preventDefault()};for(var Se=0;Se<ce.length;)ce[Se](X),Se++}},destroy:function(){this.element&&Wa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Wa(j,X){var ce=j.element;if(ce.style){var Se;W(j.options.cssProps,function(Ne,ot){Se=zt(ce.style,ot),X?(j.oldCssProps[Se]=ce.style[Se],ce.style[Se]=Ne):ce.style[Se]=j.oldCssProps[Se]||""}),X||(j.oldCssProps={})}}function $l(j,X){var ce=n.createEvent("Event");ce.initEvent(j,!0,!0),ce.gesture=X,X.target.dispatchEvent(ce)}ne(zr,{INPUT_START:ln,INPUT_MOVE:bi,INPUT_END:Wt,INPUT_CANCEL:zn,STATE_POSSIBLE:gt,STATE_BEGAN:dt,STATE_CHANGED:Mt,STATE_ENDED:vt,STATE_RECOGNIZED:Tt,STATE_CANCELLED:Ot,STATE_FAILED:Ut,DIRECTION_NONE:ns,DIRECTION_LEFT:Ci,DIRECTION_RIGHT:Zn,DIRECTION_UP:Mr,DIRECTION_DOWN:Vi,DIRECTION_HORIZONTAL:hi,DIRECTION_VERTICAL:ji,DIRECTION_ALL:Vs,Manager:ea,Input:On,TouchAction:rt,TouchInput:xr,MouseInput:Pt,PointerEventInput:ir,TouchMouseInput:Y,SingleTouchInput:ri,Recognizer:un,AttrRecognizer:di,Tap:Ws,Pan:Zt,Swipe:Ko,Pinch:_o,Rotate:Yo,Press:yo,on:Ae,off:Oe,each:W,merge:K,extend:_e,assign:ne,inherit:$,bindFn:J,prefixed:zt});var Ts=typeof e<"u"?e:typeof self<"u"?self:{};Ts.Hammer=zr,typeof o=="function"&&o.amd?o(function(){return zr}):t.exports?t.exports=zr:e[i]=zr})(window,document,"Hammer")})(mA);var Pd=mA.exports;const nN=PE(Pd),ro=TP({__proto__:null,default:nN},[Pd]),gA=1,_A=2,i0=4,iN={mousedown:gA,mousemove:_A,mouseup:i0};function rN(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function sN(t){const e=t.prototype.handler;t.prototype.handler=function(i){const o=this.store;i.button>0&&i.type==="pointerdown"&&(rN(o,u=>u.pointerId===i.pointerId)||o.push(i)),e.call(this,i)}}function oN(t){t.prototype.handler=function(n){let i=iN[n.type];i&gA&&n.button>=0&&(this.pressed=!0),i&_A&&n.which===0&&(i=i0),this.pressed&&(i&i0&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}sN(Pd.PointerEventInput);oN(Pd.MouseInput);const aN=Pd.Manager;class zm{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const lN=ro?[[ro.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ro.Rotate,{enable:!1}],[ro.Pinch,{enable:!1}],[ro.Swipe,{enable:!1}],[ro.Pan,{threshold:0,enable:!1}],[ro.Press,{enable:!1}],[ro.Tap,{event:"doubletap",taps:2,enable:!1}],[ro.Tap,{event:"anytap",enable:!1}],[ro.Tap,{enable:!1}]]:null,eE={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},cN={doubletap:["tap"]},uN={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ov={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},hN={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},tE={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},dN=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Uc=typeof window<"u"?window:global;let r0=!1;try{const t={get passive(){return r0=!0,!0}};Uc.addEventListener("test",null,t),Uc.removeEventListener("test",null)}catch{r0=!1}const fN=dN.indexOf("firefox")!==-1,{WHEEL_EVENTS:pN}=Ov,nE="wheel",iE=4.000244140625,mN=40,gN=.25;class _N extends zm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{if(!this.options.enable)return;let u=o.deltaY;Uc.WheelEvent&&(fN&&o.deltaMode===Uc.WheelEvent.DOM_DELTA_PIXEL&&(u/=Uc.devicePixelRatio),o.deltaMode===Uc.WheelEvent.DOM_DELTA_LINE&&(u*=mN)),u!==0&&u%iE===0&&(u=Math.floor(u/iE)),o.shiftKey&&u&&(u=u*gN),this.callback({type:nE,center:{x:o.clientX,y:o.clientY},delta:-u,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(pN),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,r0?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===nE&&(this.options.enable=n)}}const{MOUSE_EVENTS:yN}=Ov,rE="pointermove",sE="pointerover",oE="pointerout",aE="pointerenter",lE="pointerleave";class vN extends zm{constructor(e,n,i){super(e,n,i),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(yN),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===rE&&(this.enableMoveEvent=n),e===sE&&(this.enableOverEvent=n),e===oE&&(this.enableOutEvent=n),e===aE&&(this.enableEnterEvent=n),e===lE&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(sE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(oE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(aE,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(lE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(rE,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:xN}=Ov,cE="keydown",uE="keyup";class bN extends zm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{const u=o.target||o.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:cE,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:uE,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(xN),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===cE&&(this.enableDownEvent=n),e===uE&&(this.enableUpEvent=n)}}const hE="contextmenu";class wN extends zm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{this.options.enable&&this.callback({type:hE,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===hE&&(this.options.enable=n)}}const s0=1,hm=2,o0=4,EN={pointerdown:s0,pointermove:hm,pointerup:o0,mousedown:s0,mousemove:hm,mouseup:o0},TN=1,SN=2,AN=3,IN=0,PN=1,CN=2,MN=1,kN=2,LN=4;function RN(t){const e=EN[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:o}=t.srcEvent;let u=!1,f=!1,l=!1;return e===o0||e===hm&&!Number.isFinite(n)?(u=o===TN,f=o===SN,l=o===AN):e===hm?(u=!!(n&MN),f=!!(n&LN),l=!!(n&kN)):e===s0&&(u=i===IN,f=i===PN,l=i===CN),{leftButton:u,middleButton:f,rightButton:l}}function DN(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),o=i.width/e.offsetWidth||1,u=i.height/e.offsetHeight||1,f={x:(n.x-i.left-e.clientLeft)/o,y:(n.y-i.top-e.clientTop)/u};return{center:n,offsetCenter:f}}const V_={srcElement:"root",priority:0};class zN{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,o=!1,u=!1){const{handlers:f,handlersByElement:l}=this;let b=V_;typeof i=="string"||i&&i.addEventListener?b={...V_,srcElement:i}:i&&(b={...V_,...i});let w=l.get(b.srcElement);w||(w=[],l.set(b.srcElement,w));const M={type:e,handler:n,srcElement:b.srcElement,priority:b.priority};o&&(M.once=!0),u&&(M.passive=!0),f.push(M),this._active=this._active||!M.passive;let L=w.length-1;for(;L>=0&&!(w[L].priority>=M.priority);)L--;w.splice(L+1,0,M)}remove(e,n){const{handlers:i,handlersByElement:o}=this;for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.type===e&&f.handler===n){i.splice(u,1);const l=o.get(f.srcElement);l.splice(l.indexOf(f),1),l.length===0&&o.delete(f.srcElement)}}this._active=i.some(u=>!u.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let o=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,o=!0},l=[];for(let b=0;b<i.length;b++){const{type:w,handler:M,once:L}=i[b];if(M({...e,type:w,stopPropagation:u,stopImmediatePropagation:f}),L&&l.push(i[b]),o)break}for(let b=0;b<l.length;b++){const{type:w,handler:M}=l[b];this.remove(w,M)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...RN(e),...DN(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const ON={events:null,recognizers:null,recognizerOptions:{},Manager:aN,touchAction:"none",tabIndex:0};class FN{constructor(e=null,n){this._onBasicInput=o=>{const{srcEvent:u}=o,f=uN[u.type];f&&this.manager.emit(f,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...ON,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||lN}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(eE).forEach(o=>{const u=this.manager.get(o);u&&eE[o].forEach(f=>{u.recognizeWith(f)})});for(const o in n.recognizerOptions){const u=this.manager.get(o);if(u){const f=n.recognizerOptions[o];delete f.enable,u.set(f)}}this.wheelInput=new _N(e,this._onOtherEvent,{enable:!1}),this.moveInput=new vN(e,this._onOtherEvent,{enable:!1}),this.keyInput=new bN(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new wN(e,this._onOtherEvent,{enable:!1});for(const[o,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(o,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const o=i.get(e);if(o&&o.options.enable!==n){o.set({enable:n});const u=cN[e];u&&!this.options.recognizers&&u.forEach(f=>{const l=i.get(f);n?(l.requireFailure(e),o.dropRequireFailure(f)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,o,u){if(typeof e!="string"){i=n;for(const M in e)this._addEventHandler(M,e[M],i,o,u);return}const{manager:f,events:l}=this,b=tE[e]||e;let w=l.get(b);w||(w=new zN(this),l.set(b,w),w.recognizerName=hN[b]||b,f&&f.on(b,w.handleEvent)),w.add(e,n,i,o,u),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const f in e)this._removeEventHandler(f,e[f]);return}const{events:i}=this,o=tE[e]||e,u=i.get(o);if(u&&(u.remove(e,n),u.isEmpty())){const{recognizerName:f}=u;let l=!1;for(const b of i.values())if(b.recognizerName===f&&!b.isEmpty()){l=!0;break}l||this._toggleRecognizer(f,!1)}}}function xl(){}const BN=({isDragging:t})=>t?"grabbing":"grab",yA={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:xl,onResize:xl,onViewStateChange:xl,onInteractionStateChange:xl,onBeforeRender:xl,onAfterRender:xl,onLoad:xl,onError:t=>_n.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:BN,getTooltip:null,debug:!1,drawPickingColors:!1};class Om{constructor(e){V(this,"props",void 0),V(this,"width",0),V(this,"height",0),V(this,"userData",{}),V(this,"canvas",null),V(this,"viewManager",null),V(this,"layerManager",null),V(this,"effectManager",null),V(this,"deckRenderer",null),V(this,"deckPicker",null),V(this,"eventManager",null),V(this,"tooltip",null),V(this,"metrics",void 0),V(this,"animationLoop",void 0),V(this,"stats",void 0),V(this,"viewState",void 0),V(this,"cursorState",void 0),V(this,"_needsRedraw",void 0),V(this,"_pickRequest",void 0),V(this,"_lastPointerDownInfo",null),V(this,"_metricsCounter",void 0),V(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),V(this,"_onEvent",n=>{const i=Xb[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const u=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:u,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=f,b=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let M=!1;b&&(M=b.call(l,f,n)),!M&&w&&w(f,n)}),V(this,"_onPointerDown",n=>{const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...yA,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&_n.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),pS()==="IE"&&_n.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new wv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&hd.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,o,u,f,l,b;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(o=this.effectManager)===null||o===void 0||o.finalize(),this.effectManager=null,(u=this.deckRenderer)===null||u===void 0||u.finalize(),this.deckRenderer=null,(f=this.deckPicker)===null||f===void 0||f.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(b=this.tooltip)===null||b===void 0||b.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&_n.removed("onLayerHover","onHover")(),"onLayerClick"in e&&_n.removed("onLayerClick","onClick")(),e.initialViewState&&!uo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return n=n||i||o||u||f,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Bi(this.viewManager),this.viewManager.views}getViewports(e){return Bi(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Bi(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return o.get(n).timeEnd(),u}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Bi(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const u=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=u}if(i||i===0){var o;const u=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const o=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,u=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(o!==this.width||u!==this.height){var f,l;this.width=o,this.height=u,(f=this.viewManager)===null||f===void 0||f.setProps({width:o,height:u}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:o,height:u})}}_createAnimationLoop(e){const{width:n,height:i,gl:o,glOptions:u,debug:f,onError:l,onBeforeRender:b,onAfterRender:w,useDevicePixels:M}=e;return new Wz({width:n,height:i,useDevicePixels:M,autoResizeDrawingBuffer:!o,autoResizeViewport:!1,gl:o,onCreateContext:L=>bS({...u,...L,canvas:this.canvas,debug:f,onContextLost:()=>this._onContextLost()}),onInitialize:L=>this._setGLContext(L.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:b,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new zv({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let u=o,f=!1;for(const l of i){var n;u=l,f=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||f}if(!f&&this.props.onHover&&this.props.onHover(u,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(u);this.tooltip.setTooltip(l,u.x,u.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,bv(e,{enable:!0,copyState:!0})),this.tooltip=new tN(this.canvas),Ho(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new JS;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new FN(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Xb)this.eventManager.on(o,this._onEvent);this.viewManager=new P4({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new I4(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new $4,this.deckRenderer=new q4(e),this.deckPicker=new Q4(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Ho(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),_n.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Il.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}V(Om,"defaultProps",yA);V(Om,"VERSION",K3);class j_{constructor(e,n){V(this,"opts",void 0),V(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:o}=n;let u=i;if(i&&i.length!==o){u=new Float32Array(o);const f=n.elementOffset||0;for(let l=0;l<o;++l)u[l]=i[f+l]}return u}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function NN(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Tp(t){return t.stride||t.size*t.bytesPerElement}function vA(t,e){e.offset&&_n.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Tp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,u=i*n+o*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:n}}function UN(t,e){const n=vA(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class VN{constructor(e,n,i){V(this,"gl",void 0),V(this,"id",void 0),V(this,"size",void 0),V(this,"settings",void 0),V(this,"value",void 0),V(this,"doublePrecision",void 0),V(this,"_buffer",void 0),V(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,u=o===5130;let{defaultValue:f}=n;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let l;u?l=5126:!o&&n.isIndexed?l=e&&wD(e,Rn.ELEMENT_INDEX_UINT32)?5125:5123:l=o||5126;let b=NN(o||l||5126);this.doublePrecision=u,u&&n.fp64===!1&&(b=Float32Array),this.value=null,this.settings={...n,defaultType:b,defaultValue:f,logicalType:o,type:l,size:this.size,bytesPerElement:b.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new wn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Tp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hd.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},o=this.value instanceof Float64Array,u=UN(this.getAccessor(),n||{});return i[e]=new j_(this,u.high),i["".concat(e,"64Low")]=o?new j_(this,u.low):new Float32Array(this.size),i}if(n){const i=vA(this.getAccessor(),n);return{[e]:new j_(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:o}=this,u=i*o;if(n&&u&&n.length>=u){const f=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let b=0;b<u;)for(let w=0;w<o;w++){const M=n[b++];M<f[w]&&(f[w]=M),M>l[w]&&(l[w]=M)}e=[f,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof wn?i={buffer:e}:i=e;const o={...this.settings,...i};if(n.bufferAccessor=o,n.bounds=null,i.constant){let u=i.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!n.constant||!this._areValuesEqual(u,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=u}else if(i.buffer){const u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;const f=i.value instanceof Float64Array;o.type=i.type||u.accessor.type,o.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),o.stride=Tp(o)}else if(i.value){this._checkExternalBuffer(i);let u=i.value;n.externalBuffer=null,n.constant=!1,this.value=u,o.bytesPerElement=u.BYTES_PER_ELEMENT,o.stride=Tp(o);const{buffer:f,byteOffset:l}=this;this.doublePrecision&&u instanceof Float64Array&&(u=B_(u,o));const b=u.byteLength+l+o.stride*2;f.byteLength<b&&f.reallocate(b),f.setAccessor(null),f.subData({data:u,offset:l}),o.type=i.type||f.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:o}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?B_(n,{size:this.size,startIndex:i,endIndex:o}):n.subarray(i,o),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,o=i.allocatedValue,u=hd.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=u;const{buffer:f,byteOffset:l}=this;return f.byteLength<u.byteLength+l&&(f.reallocate(u.byteLength+l),n&&o&&f.subData({data:o instanceof Float64Array?B_(o,this):o,offset:l})),i.allocatedValue=u,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&_n.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:o,size:u}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let f=u;for(;--f>=0;)n[i+f]=o[f];return n}switch(u){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let f=u;for(;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:o[f]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}}const dE=[],fE=[];function xA(t,e=0,n=1/0){let i=dE;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(fE.length=t.length,i=fE):i=dE,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),o.index=e-1),{iterable:i,objectInfo:o}}function bA(t){return t&&t[Symbol.asyncIterator]}function jN(t,e){const{size:n,stride:i,offset:o,startIndices:u,nested:f}=e,l=t.BYTES_PER_ELEMENT,b=i?i/l:n,w=o?o/l:0,M=Math.floor((t.length-w)/b);return(L,{index:C,target:W})=>{if(!u){const K=C*b+w;for(let $=0;$<n;$++)W[$]=t[K+$];return W}const Q=u[C],ne=u[C+1]||M;let _e;if(f){_e=new Array(ne-Q);for(let K=Q;K<ne;K++){const $=K*b+w;W=new Array(n);for(let J=0;J<n;J++)W[J]=t[$+J];_e[K-Q]=W}}else if(b===n)_e=t.subarray(Q*n+w,ne*n+w);else{_e=new t.constructor((ne-Q)*n);let K=0;for(let $=Q;$<ne;$++){const J=$*b+w;for(let pe=0;pe<n;pe++)_e[K++]=t[J+pe]}}return _e}}const GN=[],Sp=[[0,1/0]];function $N(t,e){if(t===Sp||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let o=0;for(let u=0;u<i;u++){const f=t[u];f[1]<e[0]?(n.push(f),o=u+1):f[0]>e[1]?n.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return n.splice(o,0,e),n}function G_(t){const{source:e,target:n,start:i=0,size:o,getData:u}=t,f=t.end||n.length,l=e.length,b=f-i;if(l>b){n.set(e.subarray(0,b),i);return}if(n.set(e,i),!u)return;let w=l;for(;w<b;){const M=u(w,e);for(let L=0;L<o;L++)n[i+w]=M[L]||0,w++}}function HN({source:t,target:e,size:n,getData:i,sourceStartIndices:o,targetStartIndices:u}){if(!Array.isArray(u))return G_({source:t,target:e,size:n,getData:i}),e;let f=0,l=0;const b=i&&((M,L)=>i(M+l,L)),w=Math.min(o.length,u.length);for(let M=1;M<w;M++){const L=o[M]*n,C=u[M]*n;G_({source:t.subarray(f,L),target:e,start:l,end:C,size:n,getData:b}),f=L,l=C}return l<e.length&&G_({source:[],target:e,start:l,size:n,getData:b}),e}const WN={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function wA(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...WN[n],...e,...t,type:n}}function EA(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function TA(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function SA(t){t.push(t.shift())}function Fv(t,e){const{doublePrecision:n,settings:i,value:o,size:u}=t,f=n&&o instanceof Float64Array?2:1;return(i.noAlloc?o.length:e*u)*f}function AA({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:o,getData:u=f=>f}){const f=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*f,b=n.byteOffset,w=n.startIndices,M=o&&w,L=Fv(n,e),C=n.isConstant;if(!M&&i>=L)return;const W=C?n.value:n.getBuffer().getData({srcByteOffset:b});if(n.settings.normalized&&!C){const K=u;u=($,J)=>n.normalizeConstant(K($,J))}const Q=C?(K,$)=>u(W,$):(K,$)=>u(W.subarray(K,K+l),$),ne=t.getData({length:i}),_e=new Float32Array(L);HN({source:ne,target:_e,sourceStartIndices:o,targetStartIndices:w,size:l,getData:Q}),t.byteLength<_e.byteLength+b&&t.reallocate(_e.byteLength+b),t.subData({data:_e,offset:b})}class Bv extends VN{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Sp}),V(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,o=Array.isArray(n)?e[n.find(u=>e[u])]:e[n];return wA(o,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:o=1/0}=n;this.state.updateRanges=$N(this.state.updateRanges,[i,o])}else this.state.updateRanges=Sp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=GN}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Sp),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:l}}=this;let b=!0;if(f){for(const[w,M]of u)f.call(o,this,{data:n,startRow:w,endRow:M,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,M]of u){const L=Number.isFinite(w)?this.getVertexOffset(w):0,C=Number.isFinite(M)?this.getVertexOffset(M):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:L,endOffset:C})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:o}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Bi(ArrayBuffer.isView(f.value),"invalid ".concat(o.accessor));const l=!!f.size&&f.size!==this.size;return i.binaryAccessor=jN(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:o,props:u,numInstances:f}){if(e.constant)return;const{settings:l,state:b,value:w,size:M,startIndices:L}=e,{accessor:C,transform:W}=l,Q=b.binaryAccessor||(typeof C=="function"?C:u[C]);Bi(typeof Q=="function",'accessor "'.concat(C,'" is not a function'));let ne=e.getVertexOffset(i);const{iterable:_e,objectInfo:K}=xA(n,i,o);for(const $ of _e){K.index++;let J=Q($,K);if(W&&(J=W.call(this,J)),L){const pe=(K.index<L.length-1?L[K.index+1]:f)-L[K.index];if(J&&Array.isArray(J[0])){let ye=ne;for(const Ae of J)e._normalizeValue(Ae,w,ye),ye+=M}else J&&J.length>M?w.set(J,ne):(e._normalizeValue(J,K.target,0),g4({target:w,source:K.target,start:ne,count:pe}));ne+=pe*M}else e._normalizeValue(J,w,ne),ne+=M}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class qN{constructor({gl:e,attribute:n,timeline:i}){V(this,"gl",void 0),V(this,"type","interpolation"),V(this,"attributeInTransition",void 0),V(this,"settings",void 0),V(this,"attribute",void 0),V(this,"transition",void 0),V(this,"currentStartIndices",void 0),V(this,"currentLength",void 0),V(this,"transform",void 0),V(this,"buffers",void 0),this.gl=e,this.transition=new Id(i),this.attribute=n,this.attributeInTransition=new Bv(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=XN(e,n);const o={byteLength:0,usage:35050};this.buffers=[new wn(e,o),new wn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:o,attribute:u}=this;SA(o);const f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)AA({buffer:l,...f});this.currentStartIndices=u.startIndices,this.currentLength=Fv(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aFrom:o[0],aTo:EA(i,u)},feedbackBuffers:{vCurrent:o[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:o}=this.transition;let u=o/n;i&&(u=i(u)),this.transform.run({uniforms:{time:u}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const ZN=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function XN(t,e){const n=TA(e.size);return new Cv(t,{vs:ZN,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class YN{constructor({gl:e,attribute:n,timeline:i}){V(this,"gl",void 0),V(this,"type","spring"),V(this,"attributeInTransition",void 0),V(this,"settings",void 0),V(this,"attribute",void 0),V(this,"transition",void 0),V(this,"currentStartIndices",void 0),V(this,"currentLength",void 0),V(this,"texture",void 0),V(this,"framebuffer",void 0),V(this,"transform",void 0),V(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Id(i),this.attribute=n,this.attributeInTransition=new Bv(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=JN(e),this.framebuffer=QN(e,this.texture),this.transform=KN(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new wn(e,o),new wn(e,o),new wn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:o,attribute:u}=this,f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)AA({buffer:l,...f});this.settings=e,this.currentStartIndices=u.startIndices,this.currentLength=Fv(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aTo:EA(i,u)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:o}=this;if(!o.update())return!1;const f=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:f.stiffness,damping:f.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),SA(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Dm(i)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function KN(t,e,n){const i=TA(e.size);return new Cv(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function JN(t){return new Qr(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function QN(t,e){return new yi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const e5={interpolation:qN,spring:YN};class t5{constructor(e,{id:n,timeline:i}){V(this,"id",void 0),V(this,"isSupported",void 0),V(this,"gl",void 0),V(this,"timeline",void 0),V(this,"transitions",void 0),V(this,"needsRedraw",void 0),V(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Cv.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const o in e){const u=e[o],f=u.getTransitionSetting(n);f&&this._updateAttribute(o,u,f)}for(const o in this.transitions){const u=e[o];(!u||!u.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const o=this.transitions[e];let u=!o||o.type!==i.type;if(u){if(!this.isSupported){_n.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}o&&this._removeTransition(e);const f=e5[i.type];f?this.transitions[e]=new f({attribute:n,timeline:this.timeline,gl:this.gl}):(_n.error("unsupported transition type '".concat(i.type,"'"))(),u=!1)}(u||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const pE="attributeManager.invalidate",n5="attributeManager.updateStart",i5="attributeManager.updateEnd",r5="attribute.updateStart",s5="attribute.allocate",o5="attribute.updateEnd";class a5{constructor(e,{id:n="attribute-manager",stats:i,timeline:o}={}){V(this,"id",void 0),V(this,"gl",void 0),V(this,"attributes",void 0),V(this,"updateTriggers",void 0),V(this,"needsRedraw",void 0),V(this,"userData",void 0),V(this,"stats",void 0),V(this,"attributeTransitionManager",void 0),V(this,"mergeBoundsMemoized",Ad(a4)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new t5(e,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ji(pE,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ji(pE,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:o,props:u={},buffers:f={},context:l={}}){let b=!1;Ji(n5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const M=this.attributes[w],L=M.settings.accessor;M.startIndices=i,M.numInstances=n,u[w]&&_n.removed("props.".concat(w),"data.attributes.".concat(w))(),M.setExternalBuffer(f[w])||M.setBinaryValue(typeof L=="string"?f[L]:void 0,e.startIndices)||typeof L=="string"&&!f[L]&&M.setConstantValue(u[L])||M.needsUpdate()&&(b=!0,this._updateAttribute({attribute:M,numInstances:n,data:e,props:u,context:l})),this.needsRedraw=this.needsRedraw||M.needsRedraw()}b&&Ji(i5,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var o;return(o=this.attributes[i])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const u in n){const f=n[u];f.needsRedraw(e)&&!i.hasAttribute(u)&&(o[u]=f)}return o}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const o in e)n[o]||Object.assign(i,e[o].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const o=e[i];this.attributes[i]=this._createAttribute(i,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const o={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new Bv(this.gl,o)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:o}=this,u=o[e];return u&&u.forEach(f=>{const l=i[f];l&&l.setNeedsUpdate(l.id,n)}),u}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ji(r5,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ji(s5,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ji(o5,n,i))}}class l5 extends Id{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:o,easing:u}}=this,f=u(e/o);this._value=rm(n,i,f)}}const mE=1e-5;function gE(t,e,n,i,o){const u=e-t,l=(n-e)*o,b=-u*i;return l+b+u+e}function c5(t,e,n,i,o){if(Array.isArray(n)){const u=[];for(let f=0;f<n.length;f++)u[f]=gE(t[f],e[f],n[f],i,o);return u}return gE(t,e,n,i,o)}function _E(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const o=t[i]-e[i];n+=o*o}return Math.sqrt(n)}return Math.abs(t-e)}class u5 extends Id{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:o}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let l=c5(u,f,n,i,o);const b=_E(l,n),w=_E(l,f);b<mE&&w<mE&&(l=n,this.end()),this._prevValue=f,this._currValue=l}}const h5={interpolation:l5,spring:u5};class d5{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,o){const{transitions:u}=this;if(u.has(e)){const b=u.get(e),{value:w=b.settings.fromValue}=b;n=w,this.remove(e)}if(o=wA(o),!o)return;const f=h5[o.type];if(!f){_n.error("unsupported transition type '".concat(o.type,"'"))();return}const l=new f(this.timeline);l.start({...o,fromValue:n,toValue:i}),u.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function f5(t){const e=t[Na];for(const n in e){const i=e[n],{validate:o}=i;if(o&&!o(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function p5(t,e){const n=IA({newProps:t,oldProps:e,propTypes:t[Na],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=g5(t,e);let o=!1;return i||(o=_5(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:o,extensionsChanged:y5(t,e),transitionsChanged:m5(t,e)}}function m5(t,e){if(!t.transitions)return!1;const n={},i=t[Na];let o=!1;for(const u in t.transitions){const f=i[u],l=f&&f.type;(l==="number"||l==="color"||l==="array")&&a0(t[u],e[u],f)&&(n[u]=!0,o=!0)}return o?n:!1}function IA({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const u of Object.keys(t))if(!(u in n)){if(!(u in e))return"".concat(o,".").concat(u," added");const f=a0(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}for(const u of Object.keys(e))if(!(u in n)){if(!(u in t))return"".concat(o,".").concat(u," dropped");if(!Object.hasOwnProperty.call(t,u)){const f=a0(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}}return!1}function a0(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function g5(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:o}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&o&&(n=o(t.data,e.data)||n),n}function _5(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&yE(t,e,"all"))return{all:!0};const n={};let i=!1;for(const o in t.updateTriggers)o!=="all"&&yE(t,e,o)&&(n[o]=!0,i=!0);return i?n:!1}function y5(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(n[o]))return!0;return!1}function yE(t,e,n){let i=t.updateTriggers[n];i=i??{};let o=e.updateTriggers[n];return o=o??{},IA({oldProps:o,newProps:i,triggerName:n})}const v5="count(): argument not an object",x5="count(): argument not a container";function b5(t){if(!E5(t))throw new Error(v5);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(w5(t))return Object.keys(t).length;throw new Error(x5)}function w5(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function E5(t){return t!==null&&typeof t=="object"}function T5(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(o=>o.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const o in e.inject)i[o]=(i[o]||"")+e.inject[o];n.inject=i}return n}const S5={10241:9987,10240:9729,10242:33071,10243:33071},l0={};function A5(t,e,n,i){if(n instanceof Qr)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let o=null;n.compressed&&(o={10241:n.data.length>1?9985:9729});const u=new Qr(e,{...n,parameters:{...S5,...o,...i}});return l0[u.id]=t,u}function I5(t,e){!e||!(e instanceof Qr)||l0[e.id]===t&&(e.delete(),delete l0[e.id])}const P5={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||c0(t)&&(t.length===3||t.length===4)},equal(t,e,n){return uo(t,e,1)}},accessor:{validate(t,e){const n=dm(t);return n==="function"||n===dm(e.value)},equal(t,e,n){return typeof e=="function"?!0:uo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||c0(t)},equal(t,e,n){const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?uo(t,e,o):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?uo(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:A5(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{I5(n.id,t)}}};function C5(t){const e={},n={},i={};for(const[o,u]of Object.entries(t)){const f=u==null?void 0:u.deprecatedFor;if(f)i[o]=Array.isArray(f)?f:[f];else{const l=M5(o,u);e[o]=l,n[o]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function M5(t,e){switch(dm(e)){case"object":return wh(t,e);case"array":return wh(t,{type:"array",value:e,compare:!1});case"boolean":return wh(t,{type:"boolean",value:e});case"number":return wh(t,{type:"number",value:e});case"function":return wh(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function wh(t,e){return"type"in e?{name:t,...P5[e.type],...e}:"value"in e?{name:t,type:dm(e.value),...e}:{name:t,type:"object",value:e}}function c0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function dm(t){return c0(t)?"array":t===null?"null":typeof t}function k5(t,e){let n;for(let u=e.length-1;u>=0;u--){const f=e[u];"extensions"in f&&(n=f.extensions)}const i=u0(t.constructor,n),o=Object.create(i);o[um]=t,o[Fl]={},o[Ca]={};for(let u=0;u<e.length;++u){const f=e[u];for(const l in f)o[l]=f[l]}return Object.freeze(o),o}const L5="_mergedDefaultProps";function u0(t,e){let n=L5;if(e)for(const o of e){const u=o.constructor;u&&(n+=":".concat(u.extensionName||u.name))}const i=PA(t,n);return i||(t[n]=R5(t,e||[]))}function R5(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),o=u0(i),u=PA(t,"defaultProps")||{},f=C5(u),l=Object.assign(Object.create(null),o,f.defaultProps),b=Object.assign(Object.create(null),o==null?void 0:o[Na],f.propTypes),w=Object.assign(Object.create(null),o==null?void 0:o[U_],f.deprecatedProps);for(const M of e){const L=u0(M.constructor);L&&(Object.assign(l,L),Object.assign(b,L[Na]),Object.assign(w,L[U_]))}return D5(l,t),O5(l,b),z5(l,w),l[Na]=b,l[U_]=w,e.length===0&&!Nv(t,"_propTypes")&&(t._propTypes=b),l}function D5(t,e){const n=B5(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function z5(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const o="".concat(this.id,": ").concat(n);for(const u of e[n])Nv(this,u)||(this[u]=i);_n.deprecated(o,e[n].join("/"))()}})}function O5(t,e){const n={},i={};for(const o in e){const u=e[o],{name:f,value:l}=u;u.async&&(n[f]=l,i[f]=F5(f))}t[Zc]=n,t[Fl]={},Object.defineProperties(t,i)}function F5(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||bA(e)?this[Fl][t]=e:this[Ca][t]=e},get(){if(this[Ca]){if(t in this[Ca])return this[Ca][t]||this[Zc][t];if(t in this[Fl]){const e=this[um]&&this[um].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Zc][t]}}return this[Zc][t]}}}function Nv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function PA(t,e){return Nv(t,e)&&t[e]}function B5(t){const e=t.componentName;return e||_n.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let N5=0;class Uv{constructor(...e){V(this,"id",void 0),V(this,"props",void 0),V(this,"count",void 0),this.props=k5(this,e),this.id=this.props.id,this.count=N5++}clone(e){const{props:n}=this,i={};for(const o in n[Zc])o in n[Ca]?i[o]=n[Ca][o]:o in n[Fl]&&(i[o]=n[Fl][o]);return new this.constructor({...n,...i,...e})}}V(Uv,"componentName","Component");V(Uv,"defaultProps",{});const U5=Object.freeze({});class V5{constructor(e){V(this,"component",void 0),V(this,"onAsyncPropUpdated",void 0),V(this,"asyncProps",void 0),V(this,"oldProps",void 0),V(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||U5}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[um]||this.component;const n=e[Ca]||{},i=e[Fl]||e,o=e[Zc]||{};for(const u in n){const f=n[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f),n[u]=this.getAsyncProp(u)}for(const u in i){const f=i[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(bA(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const o=this.asyncProps[e];o&&i>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;n.then(u=>{this.component&&(u=this._postProcessValue(i,u),this._setAsyncPropValue(e,u,o),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let u=[],f=0;for await(const l of n){if(!this.component)return;const{dataTransform:b}=this.component.props;b?u=b(l,u):u=u.concat(l),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,o)}this._onResolve(e,u)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Na];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class j5 extends V5{constructor({attributeManager:e,layer:n}){super(n),V(this,"attributeManager",void 0),V(this,"needsRedraw",void 0),V(this,"needsUpdate",void 0),V(this,"subLayers",void 0),V(this,"usesPickingColorCache",void 0),V(this,"hasPickingBuffer",void 0),V(this,"changeFlags",void 0),V(this,"viewport",void 0),V(this,"uniformTransitions",void 0),V(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,o=i==null?void 0:i.props.fetch;return o?o(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const o=i.props.onDataLoad;e==="data"&&o&&o(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const G5="layer.changeFlag",$5="layer.initialize",H5="layer.update",W5="layer.finalize",q5="layer.matched",vE=2**24-1,Z5=Object.freeze([]),X5=Ad(({oldViewport:t,viewport:e})=>t.equals(e));let so=new Uint8ClampedArray(0);const Y5={data:{type:"data",value:Z5,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:o,signal:u})=>{const{resourceManager:f}=n.context;if(o=o||n.getLoadOptions(),i=i||n.props.loaders,u){var l;o={...o,fetch:{...(l=o)===null||l===void 0?void 0:l.fetch,signal:u}}}let b=f.contains(t);return!b&&!o&&(f.add({resourceId:t,data:Qp(t,i),persistent:!1}),b=!0),b?f.subscribe({resourceId:t,onChange:w=>{var M;return(M=n.internalState)===null||M===void 0?void 0:M.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):Qp(t,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:fn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Cd extends Uv{constructor(...e){super(...e),V(this,"internalState",null),V(this,"lifecycle",Ac.NO_STATE),V(this,"context",void 0),V(this,"state",void 0),V(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Bi(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=cA(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,u,f]=aA(i,n.pixelProjectionMatrix);return e.length===2?[o,u]:[o,u,f]}unproject(e){return Bi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Bi(this.internalState);const i=this.internalState.viewport||this.context.viewport;return f4(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===fn.DEFAULT||e===fn.LNGLAT||e===fn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Bi(e instanceof Uint8Array);const[n,i,o]=e;return n+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:b5(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=T5(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const o of i)n.invalidateAll(o);else n.invalidateAll();if(n){const{props:o}=e,u=this.internalState.hasPickingBuffer,f=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(u!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:l,instancePickingColors:b}=n.attributes,w=l||b;w&&(f&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!f&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,n){var i,o;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(o=this.props).onError)!==null&&i!==void 0&&i.call(o,e))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!X5({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),o=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const o in n)Object.defineProperty(i,o,{value:n[o]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(so.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>vE&&_n.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),so=hd.allocate(so,n,{size:3,copy:!0,maxCount:Math.max(n,vE)});const o=Math.floor(so.length/3),u=[];for(let f=i;f<o;f++)this.encodePickingColor(f,u),so[f*3+0]=u[0],so[f*3+1]=u[1],so[f*3+2]=u[2]}e.value=so.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),o=e.userData.excludeAttributes||{},u=i.getShaderAttributes(n,o);e.setAttributes(u)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:o}=this.getAttributeManager().attributes,u=i||o,f=u&&n.attributes&&n.attributes[u.id];if(f&&f.value){const l=f.value,b=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const M=u.getVertexOffset(w);l[M]===b[0]&&l[M+1]===b[1]&&l[M+2]===b[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i;if(!o)return;const u=o.getVertexOffset(e),f=o.getVertexOffset(e+1);o.buffer.subData({data:new Uint8Array(f-u),offset:u})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==so.buffer&&(i.value=so.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Bi(!this.internalState),Bi(Number.isFinite(this.props.coordinateSystem)),Ji($5,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new j5({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(_n.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new d5(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ji(q5,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ji(H5,this,e),!e)return;const n=this.props,i=this.context,o=this.internalState,u=i.viewport,f=this._updateUniformTransition();o.propsInTransition=f,i.viewport=o.viewport||u,this.props=f;try{const l=this._getUpdateParams(),b=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const M of this.props.extensions)M.updateState.call(this,l,M);const w=this.getModels()[0]!==b[0];this._postUpdate(l,w)}finally{i.viewport=u,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Ji(W5,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,u=this.context;this.props=this.internalState.propsInTransition||o;const f=this.props.opacity;n.opacity=Math.pow(f,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,b=l&&l(n)||[0,0];Ho(u.gl,{polygonOffset:b}),Ns(u.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:u};for(const M of this.props.extensions)M.draw.call(this,w,M);this.draw(w)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in e)if(e[o]){let u=!1;switch(o){case"dataChanged":const f=e[o],l=n[o];f&&Array.isArray(l)&&(n.dataChanged=Array.isArray(f)?l.concat(f):f,u=!0);default:n[o]||(n[o]=e[o],u=!0)}u&&Ji(G5,this,o,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=p5(e,n);if(i.updateTriggersChanged)for(const u in i.updateTriggersChanged)i.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(i.transitionsChanged)for(const u in i.transitionsChanged){var o;this.internalState.uniformTransitions.add(u,n[u],e[u],(o=e.transitions)===null||o===void 0?void 0:o[u])}return this.setChangeFlags(i)}validateProps(){f5(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new a5(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:u}=this.state;u==null||u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:l,highlightColor:b}=i;if(n||o.autoHighlight!==f||o.highlightedObjectIndex!==l||o.highlightColor!==b){const w={};f||(w.pickingSelectedColor=null),Array.isArray(b)&&(w.pickingHighlightColor=b),(n||l!==o.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(e):!1;if(n=n||o,n)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}V(Cd,"defaultProps",Y5);V(Cd,"layerName","Layer");const K5="compositeLayer.renderLayers";class CA extends Cd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,o)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,o)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:o,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:b,autoHighlight:w,highlightColor:M,coordinateSystem:L,coordinateOrigin:C,wrapLongitude:W,positionFormat:Q,modelMatrix:ne,extensions:_e,fetch:K,operation:$,_subLayerProps:J}=this.props,pe={id:"",updateTriggers:{},opacity:i,pickable:o,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:b,autoHighlight:w,highlightColor:M,coordinateSystem:L,coordinateOrigin:C,wrapLongitude:W,positionFormat:Q,modelMatrix:ne,extensions:_e,fetch:K,operation:$},ye=J&&e.id&&J[e.id],Ae=ye&&ye.updateTriggers,Oe=e.id||"sublayer";if(ye){const Be=this.props[Na],Xe=e.type?e.type._propTypes:{};for(const je in ye){const mt=Xe[je]||Be[je];mt&&mt.type==="accessor"&&(ye[je]=this.getSubLayerAccessor(ye[je]))}}Object.assign(pe,e,ye),pe.id="".concat(this.props.id,"-").concat(Oe),pe.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...Ae};for(const Be of _e){const Xe=Be.getSubLayerProps.call(this,Be);Xe&&Object.assign(pe,Xe,{updateTriggers:Object.assign(pe.updateTriggers,Xe.updateTriggers)})}return pe}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const o=!i||this.needsUpdate();if(o){const u=this.renderLayers();i=Dv(u,Boolean),this.internalState.subLayers=i}Ji(K5,this,o,i);for(const u of i)u.parent=this}}V(CA,"layerName","CompositeLayer");const J5=typeof window<"u"?at.useLayoutEffect:at.useEffect,Q5=J5;function fm(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const e6={position:"absolute",zIndex:-1};function MA(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>MA(n,e));if(Fm(t)){if(t6(t))return e.style=e6,at.cloneElement(t,e);if(n6(t))return at.cloneElement(t,e)}return t}function Fm(t){return t&&typeof t=="object"&&"type"in t||!1}function t6(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function n6(t){const e=t.type;return e&&e.deckGLViewProps}function h0(t){if(typeof t=="function")return at.createElement(hu,{},t);if(Array.isArray(t))return t.map(h0);if(Fm(t)){if(t.type===at.Fragment)return h0(t.props.children);if(fm(t.type,hu))return t}return t}function i6({children:t,layers:e=[],views:n=null}){const i=[],o=[],u={};return at.Children.forEach(h0(t),f=>{if(Fm(f)){const l=f.type;if(fm(l,Cd)){const b=r6(l,f.props);o.push(b)}else i.push(f);if(fm(l,hu)&&l!==hu&&f.props.id){const b=new l(f.props);u[b.id]=b}}else f&&i.push(f)}),Object.keys(u).length>0&&(Array.isArray(n)?n.forEach(f=>{u[f.id]=f}):n&&(u[n.id]=n),n=Object.values(u)),e=o.length>0?[...o,...e]:e,{layers:e,children:i,views:n}}function r6(t,e){const n={},i=t.defaultProps||{};for(const o in e)i[o]!==e[o]&&(n[o]=e[o]);return new t(n)}function s6({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const o={},u=i.views[0].id;for(const f of t){let l=u,b=f;Fm(f)&&fm(f.type,hu)&&(l=f.props.id||u,b=f.props.children);const w=i.getViewport(l),M=i.getViewState(l);if(w){M.padding=w.padding;const{x:L,y:C,width:W,height:Q}=w;b=MA(b,{x:L,y:C,width:W,height:Q,viewport:w,viewState:M}),o[l]||(o[l]={viewport:w,children:[]}),o[l].children.push(b)}}return Object.keys(o).map(f=>{const{viewport:l,children:b}=o[f],{x:w,y:M,width:L,height:C}=l,W={position:"absolute",left:w,top:M,width:L,height:C},Q="view-".concat(f),ne=at.createElement("div",{key:Q,id:Q,style:W},...b);if(n){const _e={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:K=>{K.viewId=f,e._onViewStateChange(K)}};return at.createElement(n,{key:Q,value:_e},ne)}return ne})}const o6={mixBlendMode:null};function a6({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},o={left:0,top:0};if(n)for(const u in n)u in o6?o[u]=n[u]:i[u]=n[u];return{containerStyle:i,canvasStyle:o}}function l6(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function kA(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function c6(t,e,n){const i=new e({...n,_customRender:o=>{t.redrawReason=o;const u=i.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():kA(t)}});return i}const LA=at.forwardRef((t,e)=>{const[n,i]=at.useState(0),u=at.useRef({control:null,version:n,forceUpdate:()=>i(ye=>ye+1)}).current,f=at.useRef(null),l=at.useRef(null),b=at.useMemo(()=>i6(t),[t.layers,t.views,t.children]);let w=!0;const M=ye=>{var Ae;return w&&t.viewState?(u.viewStateUpdateRequested=ye,null):(u.viewStateUpdateRequested=null,(Ae=t.onViewStateChange)===null||Ae===void 0?void 0:Ae.call(t,ye))},L=ye=>{if(w)u.interactionStateUpdateRequested=ye;else{var Ae;u.interactionStateUpdateRequested=null,(Ae=t.onInteractionStateChange)===null||Ae===void 0||Ae.call(t,ye)}},C=at.useMemo(()=>{const ye={...t,style:null,width:"100%",height:"100%",parent:f.current,canvas:l.current,layers:b.layers,views:b.views,onViewStateChange:M,onInteractionStateChange:L};return delete ye._customRender,u.deck&&u.deck.setProps(ye),ye},[t]);at.useEffect(()=>{const ye=t.Deck||Om;return u.deck=c6(u,ye,{...C,parent:f.current,canvas:l.current}),()=>{var Ae;return(Ae=u.deck)===null||Ae===void 0?void 0:Ae.finalize()}},[]),Q5(()=>{kA(u);const{viewStateUpdateRequested:ye,interactionStateUpdateRequested:Ae}=u;ye&&M(ye),Ae&&L(Ae)}),at.useImperativeHandle(e,()=>l6(u),[]);const W=u.deck&&u.deck.isInitialized?u.deck.getViewports():void 0,{ContextProvider:Q,width:ne,height:_e,id:K,style:$}=t,{containerStyle:J,canvasStyle:pe}=at.useMemo(()=>a6({width:ne,height:_e,style:$}),[ne,_e,$]);if(!u.viewStateUpdateRequested&&u.lastRenderedViewports===W||u.version!==n){u.lastRenderedViewports=W,u.version=n;const ye=s6({children:b.children,deck:u.deck,ContextProvider:Q}),Ae=at.createElement("canvas",{key:"canvas",id:K||"deckgl-overlay",ref:l,style:pe});u.control=at.createElement("div",{id:"".concat(K||"deckgl","-wrapper"),ref:f,style:J},[Ae,ye])}return w=!1,u.control});LA.defaultProps=Om.defaultProps;const u6=LA,h6=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,d6=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,f6=1024,p6=4,xE=()=>{},bE={10241:9987,10240:9729,10242:33071,10243:33071};function m6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function g6(t,e,n,i){const o=Math.min(n/e.width,i/e.height),u=Math.floor(e.width*o),f=Math.floor(e.height*o);return o===1?{data:e,width:u,height:f}:(t.canvas.height=f,t.canvas.width=u,t.clearRect(0,0,u,f),t.drawImage(e,0,0,e.width,e.height,0,0,u,f),{data:t.canvas,width:u,height:f})}function dd(t){return t&&(t.id||t.url)}function _6(t,e,n,i){const o=t.width,u=t.height,f=new Qr(t.gl,{width:e,height:n,parameters:i});return yD(t,f,{targetY:0,width:o,height:u}),t.delete(),f}function wE(t,e,n){for(let i=0;i<e.length;i++){const{icon:o,xOffset:u}=e[i],f=dd(o);t[f]={...o,x:u,y:n}}}function y6({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:o=0,rowHeight:u=0,canvasWidth:f}){let l=[];for(let b=0;b<t.length;b++){const w=t[b],M=dd(w);if(!n[M]){const{height:L,width:C}=w;i+C+e>f&&(wE(n,l,o),i=0,o=u+o+e,u=0,l=[]),l.push({icon:w,xOffset:i}),i=i+C+e,u=Math.max(u,L)}}return l.length>0&&wE(n,l,o),{mapping:n,rowHeight:u,xOffset:i,yOffset:o,canvasWidth:f,canvasHeight:m6(u+o+e)}}function v6(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:o,objectInfo:u}=xA(t);for(const f of o){u.index++;const l=e(f,u),b=dd(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!i[b]&&(!n[b]||l.url!==n[b].url)&&(i[b]={...l,source:f,sourceIndex:u.index})}return i}class x6{constructor(e,{onUpdate:n=xE,onError:i=xE}){V(this,"gl",void 0),V(this,"onUpdate",void 0),V(this,"onError",void 0),V(this,"_loadOptions",null),V(this,"_texture",null),V(this,"_externalTexture",null),V(this,"_mapping",{}),V(this,"_textureParameters",null),V(this,"_pendingCount",0),V(this,"_autoPacking",!1),V(this,"_xOffset",0),V(this,"_yOffset",0),V(this,"_rowHeight",0),V(this,"_buffer",p6),V(this,"_canvasWidth",f6),V(this,"_canvasHeight",0),V(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?dd(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:o,textureParameters:u}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),o&&(this._mapping=o),i){var f;(f=this._texture)===null||f===void 0||f.delete(),this._texture=null,this._externalTexture=i}u&&(this._textureParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(v6(e,n,this._mapping)||{});if(i.length>0){const{mapping:o,xOffset:u,yOffset:f,rowHeight:l,canvasHeight:b}=y6({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=o,this._xOffset=u,this._yOffset=f,this._canvasHeight=b,this._texture||(this._texture=new Qr(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||bE})),this._texture.height!==this._canvasHeight&&(this._texture=_6(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||bE)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,Qp(i.url,this._loadOptions).then(o=>{const u=dd(i),f=this._mapping[u],{x:l,y:b,width:w,height:M}=f,{data:L,width:C,height:W}=g6(n,o,w,M);this._texture.setSubImageData({data:L,x:l+(w-C)/2,y:b+(M-W)/2,width:C,height:W}),f.width=C,f.height=W,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const RA=[0,0,0,255],b6={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:RA},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Bm extends Cd{constructor(...e){super(...e),V(this,"state",void 0)}getShaders(){return super.getShaders({vs:h6,fs:d6,modules:[x4,b4]})}initializeState(){this.state={iconManager:new x6(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:RA},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:o}=e,u=this.getAttributeManager(),{iconAtlas:f,iconMapping:l,data:b,getIcon:w,textureParameters:M}=n,{iconManager:L}=this.state,C=f||this.internalState.isAsyncPropLoading("iconAtlas");if(L.setProps({loadOptions:n.loadOptions,autoPacking:!C,iconAtlas:f,iconMapping:C?l:null,textureParameters:M}),C?i.iconMapping!==n.iconMapping&&u.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&L.packIcons(b,w),o.extensionsChanged){var W;const{gl:Q}=this.context;(W=this.state.model)===null||W===void 0||W.delete(),this.state.model=this._getModel(Q),u.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,sizeUnits:u,billboard:f,alphaCutoff:l}=this.props,{iconManager:b}=this.state,w=b.getTexture();w&&this.state.model.setUniforms(e).setUniforms({iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:Gy[u],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,billboard:f,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new KS(e,{...this.getShaders(),id:this.props.id,geometry:new iB({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):_n.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:o=n/2,anchorY:u=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-o,i/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:o,height:u}=this.state.iconManager.getIconMapping(e);return[n,i,o,u]}}V(Bm,"defaultProps",b6);V(Bm,"layerName","IconLayer");function d0(t,e,n,i,o,u){if(o-i<=n)return;const f=i+o>>1;DA(t,e,f,i,o,u%2),d0(t,e,n,i,f-1,u+1),d0(t,e,n,f+1,o,u+1)}function DA(t,e,n,i,o,u){for(;o>i;){if(o-i>600){const w=o-i+1,M=n-i+1,L=Math.log(w),C=.5*Math.exp(2*L/3),W=.5*Math.sqrt(L*C*(w-C)/w)*(M-w/2<0?-1:1),Q=Math.max(i,Math.floor(n-M*C/w+W)),ne=Math.min(o,Math.floor(n+(w-M)*C/w+W));DA(t,e,n,Q,ne,u)}const f=e[2*n+u];let l=i,b=o;for(Eh(t,e,i,n),e[2*o+u]>f&&Eh(t,e,i,o);l<b;){for(Eh(t,e,l,b),l++,b--;e[2*l+u]<f;)l++;for(;e[2*b+u]>f;)b--}e[2*i+u]===f?Eh(t,e,i,b):(b++,Eh(t,e,b,o)),b<=n&&(i=b+1),n<=b&&(o=b-1)}}function Eh(t,e,n,i){$_(t,n,i),$_(e,2*n,2*i),$_(e,2*n+1,2*i+1)}function $_(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function w6(t,e,n,i,o,u,f){const l=[0,t.length-1,0],b=[];let w,M;for(;l.length;){const L=l.pop(),C=l.pop(),W=l.pop();if(C-W<=f){for(let _e=W;_e<=C;_e++)w=e[2*_e],M=e[2*_e+1],w>=n&&w<=o&&M>=i&&M<=u&&b.push(t[_e]);continue}const Q=Math.floor((W+C)/2);w=e[2*Q],M=e[2*Q+1],w>=n&&w<=o&&M>=i&&M<=u&&b.push(t[Q]);const ne=(L+1)%2;(L===0?n<=w:i<=M)&&(l.push(W),l.push(Q-1),l.push(ne)),(L===0?o>=w:u>=M)&&(l.push(Q+1),l.push(C),l.push(ne))}return b}function E6(t,e,n,i,o,u){const f=[0,t.length-1,0],l=[],b=o*o;for(;f.length;){const w=f.pop(),M=f.pop(),L=f.pop();if(M-L<=u){for(let _e=L;_e<=M;_e++)EE(e[2*_e],e[2*_e+1],n,i)<=b&&l.push(t[_e]);continue}const C=Math.floor((L+M)/2),W=e[2*C],Q=e[2*C+1];EE(W,Q,n,i)<=b&&l.push(t[C]);const ne=(w+1)%2;(w===0?n-o<=W:i-o<=Q)&&(f.push(L),f.push(C-1),f.push(ne)),(w===0?n+o>=W:i+o>=Q)&&(f.push(C+1),f.push(M),f.push(ne))}return l}function EE(t,e,n,i){const o=t-n,u=e-i;return o*o+u*u}const T6=t=>t[0],S6=t=>t[1];class TE{constructor(e,n=T6,i=S6,o=64,u=Float64Array){this.nodeSize=o,this.points=e;const f=e.length<65536?Uint16Array:Uint32Array,l=this.ids=new f(e.length),b=this.coords=new u(e.length*2);for(let w=0;w<e.length;w++)l[w]=w,b[2*w]=n(e[w]),b[2*w+1]=i(e[w]);d0(l,b,o,0,l.length-1,0)}range(e,n,i,o){return w6(this.ids,this.coords,e,n,i,o,this.nodeSize)}within(e,n,i){return E6(this.ids,this.coords,e,n,i,this.nodeSize)}}const A6={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:t=>t};class I6{constructor(e){this.options=jh(Object.create(A6),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:n,minZoom:i,maxZoom:o,nodeSize:u}=this.options;n&&console.time("total time");const f=`prepare ${e.length} points`;n&&console.time(f),this.points=e;let l=[];for(let b=0;b<e.length;b++)e[b].geometry&&l.push(C6(e[b],b));this.trees[o+1]=new TE(l,AE,IE,u,Float32Array),n&&console.timeEnd(f);for(let b=o;b>=i;b--){const w=+Date.now();l=this._cluster(l,b),this.trees[b]=new TE(l,AE,IE,u,Float32Array),n&&console.log("z%d: %d clusters in %dms",b,l.length,+Date.now()-w)}return n&&console.timeEnd("total time"),this}getClusters(e,n){let i=((e[0]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[1]));let u=e[2]===180?180:((e[2]+180)%360+360)%360-180;const f=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,u=180;else if(i>u){const M=this.getClusters([i,o,180,f],n),L=this.getClusters([-180,o,u,f],n);return M.concat(L)}const l=this.trees[this._limitZoom(n)],b=l.range(f0(i),p0(f),f0(u),p0(o)),w=[];for(const M of b){const L=l.points[M];w.push(L.numPoints?SE(L):this.points[L.index])}return w}getChildren(e){const n=e>>5,i=e%32,o="No cluster with the specified id.",u=this.trees[i];if(!u)throw new Error(o);const f=u.points[n];if(!f)throw new Error(o);const l=this.options.radius/(this.options.extent*Math.pow(2,i-1)),b=u.within(f.x,f.y,l),w=[];for(const M of b){const L=u.points[M];L.parentId===e&&w.push(L.numPoints?SE(L):this.points[L.index])}if(w.length===0)throw new Error(o);return w}getLeaves(e,n,i){n=n||10,i=i||0;const o=[];return this._appendLeaves(o,e,n,i,0),o}getTile(e,n,i){const o=this.trees[this._limitZoom(e)],u=Math.pow(2,e),{extent:f,radius:l}=this.options,b=l/f,w=(i-b)/u,M=(i+1+b)/u,L={features:[]};return this._addTileFeatures(o.range((n-b)/u,w,(n+1+b)/u,M),o.points,n,i,u,L),n===0&&this._addTileFeatures(o.range(1-b/u,w,1,M),o.points,u,i,u,L),n===u-1&&this._addTileFeatures(o.range(0,w,b/u,M),o.points,-1,i,u,L),L.features.length?L:null}getClusterExpansionZoom(e){let n=e%32-1;for(;n<=this.options.maxZoom;){const i=this.getChildren(e);if(n++,i.length!==1)break;e=i[0].properties.cluster_id}return n}_appendLeaves(e,n,i,o,u){const f=this.getChildren(n);for(const l of f){const b=l.properties;if(b&&b.cluster?u+b.point_count<=o?u+=b.point_count:u=this._appendLeaves(e,b.cluster_id,i,o,u):u<o?u++:e.push(l),e.length===i)break}return u}_addTileFeatures(e,n,i,o,u,f){for(const l of e){const b=n[l],w={type:1,geometry:[[Math.round(this.options.extent*(b.x*u-i)),Math.round(this.options.extent*(b.y*u-o))]],tags:b.numPoints?zA(b):this.points[b.index].properties},M=b.numPoints?b.id:this.points[b.index].id;M!==void 0&&(w.id=M),f.features.push(w)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(e,this.options.maxZoom+1))}_cluster(e,n){const i=[],{radius:o,extent:u,reduce:f}=this.options,l=o/(u*Math.pow(2,n));for(let b=0;b<e.length;b++){const w=e[b];if(w.zoom<=n)continue;w.zoom=n;const M=this.trees[n+1],L=M.within(w.x,w.y,l);let C=w.numPoints||1,W=w.x*C,Q=w.y*C,ne=f&&C>1?this._map(w,!0):null;const _e=(b<<5)+(n+1);for(const K of L){const $=M.points[K];if($.zoom<=n)continue;$.zoom=n;const J=$.numPoints||1;W+=$.x*J,Q+=$.y*J,C+=J,$.parentId=_e,f&&(ne||(ne=this._map(w,!0)),f(ne,this._map($)))}C===1?i.push(w):(w.parentId=_e,i.push(P6(W/C,Q/C,_e,C,ne)))}return i}_map(e,n){if(e.numPoints)return n?jh({},e.properties):e.properties;const i=this.points[e.index].properties,o=this.options.map(i);return n&&o===i?jh({},o):o}}function P6(t,e,n,i,o){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:i,properties:o}}function C6(t,e){const[n,i]=t.geometry.coordinates;return{x:f0(n),y:p0(i),zoom:1/0,index:e,parentId:-1}}function SE(t){return{type:"Feature",id:t.id,properties:zA(t),geometry:{type:"Point",coordinates:[M6(t.x),k6(t.y)]}}}function zA(t){const e=t.numPoints,n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?`${Math.round(e/100)/10}k`:e;return jh(jh({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function f0(t){return t/360+.5}function p0(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function M6(t){return(t-.5)*360}function k6(t){const e=(180-t*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function jh(t,e){for(const n in e)t[n]=e[n];return t}function AE(t){return t.x}function IE(t){return t.y}function L6(t){return t===0?"":t<10?`marker-${t}`:t<100?`marker-${Math.floor(t/10)}0`:"marker-100"}function R6(t){return Math.min(100,t)/100+1}class D6 extends CA{shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:i}){const o=i.dataChanged||e.sizeScale!==n.sizeScale;if(o){const f=new I6({maxZoom:16,radius:e.sizeScale*Math.sqrt(2)});f.load(e.data.map(l=>({geometry:{coordinates:e.getPosition(l)},properties:l}))),this.setState({index:f})}const u=Math.floor(this.context.viewport.zoom);(o||u!==this.state.z)&&this.setState({data:this.state.index.getClusters([-180,-85,180,85],u),z:u})}getPickingInfo({info:e,mode:n}){const i=e.object&&e.object.properties;return i&&(i.cluster&&n!=="hover"&&(e.objects=this.state.index.getLeaves(i.cluster_id,25).map(o=>o.properties)),e.object=i),e}renderLayers(){const{data:e}=this.state,{iconAtlas:n,iconMapping:i,sizeScale:o}=this.props;return new Bm(this.getSubLayerProps({id:"icon",data:e,iconAtlas:n,iconMapping:i,sizeScale:o,getPosition:u=>u.geometry.coordinates,getIcon:u=>L6(u.properties.cluster?u.properties.point_count:1),getSize:u=>R6(u.properties.cluster?u.properties.point_count:1)}))}}const z6="src/data/new_dataset_DSNS.json",O6=new zv({repeat:!0}),F6={longitude:37.5434,latitude:47.0971,zoom:5,maxZoom:15,pitch:40.5,bearing:0},B6="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json";function N6(t){const{object:e,x:n,y:i}=t;return t.objects?fs.jsx("div",{className:"tooltip interactive",style:{left:n,top:i},children:t.objects.map(({name:o,year:u,mass:f,class:l,imageUrl:b})=>fs.jsxs("div",{children:[fs.jsx("h5",{children:o}),b&&fs.jsx("img",{src:b,alt:`Image of ${o}`,style:{maxWidth:"75px",height:"65px"}}),fs.jsxs("div",{children:["Year: ",u||"unknown"]}),fs.jsxs("div",{children:["Verification: ",l]}),fs.jsxs("div",{children:["Priority: ",f]})]},o))}):e?e.cluster?fs.jsxs("div",{className:"tooltip",style:{left:n,top:i},children:[e.point_count," records"]}):fs.jsxs("div",{className:"tooltip",style:{left:n,top:i},children:[e.name," ",e.year?`(${e.year})`:""]}):null}function U6({data:t=z6,iconMapping:e="src/data/location-icon-mapping.json",iconAtlas:n="src/data/location-icon-atlas.png",showCluster:i=!0,mapStyle:o=B6}){const[u,f]=at.useState({}),l=()=>{f({})},b=L=>{L.picked&&i?f(L):f({})},w={data:t,pickable:!0,getPosition:L=>L.coordinates,iconAtlas:n,iconMapping:e,onHover:!u.objects&&f},M=i?new D6({...w,id:"icon-cluster",sizeScale:40}):new Bm({...w,id:"icon",getIcon:L=>"marker",sizeUnits:"meters",sizeScale:2e3,sizeMinPixels:6});return fs.jsxs(u6,{layers:[M],views:O6,initialViewState:F6,controller:{dragRotate:!1},onViewStateChange:l,onClick:b,children:[fs.jsx(wk,{reuseMaps:!0,mapLib:Tk,mapStyle:o,preventStyleDiffing:!0}),N6(u)]})}function V6(t){j2(t).render(fs.jsx(U6,{}))}V6(document.getElementById("app"));export{SP as c,PE as g};
